–ü–†–ê–í–ò–õ–ê –î–õ–Ø –ù–ï–ô–†–û–°–ï–¢–ï–ô (–≤–∞–∂–Ω–æ –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤):
- –Ø–∑—ã–∫ –æ—Ç–≤–µ—Ç–æ–≤: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é RU. –ê–Ω–≥–ª–∏–π—Å–∫–∏–π ‚Äî –µ—Å–ª–∏ —è–≤–Ω–æ –ø–æ–ø—Ä–æ—Å—è—Ç –∏–ª–∏ –≤ –∏–º–µ–Ω–∞—Ö/—Ç–µ—Ä–º–∏–Ω–∞—Ö.
- –í—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–π —Å –ø–æ–ª–Ω–æ–≥–æ –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π —Ç–æ—á–Ω—ã–µ –ø—É—Ç–∏ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ —Å—Å—ã–ª–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, src/app/(main)/timeline/page.tsx).
- –õ—é–±–æ–π –∫–æ–¥ –≤—ã–≤–æ–¥–∏ –¢–û–õ–¨–ö–û –≤ —Ç—Ä–æ–π–Ω—ã—Ö –±—ç–∫—Ç–∏–∫–∞—Ö —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —è–∑—ã–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:
  ```ts
  export function x() {}
  ```
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π —Ç—è–∂–µ–ª–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. –†–∞–∑—Ä–µ—à–µ–Ω—ã: —Å–ø–∏—Å–∫–∏, –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã.
- –ï—Å–ª–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–π –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–∞—Ç—á (unified diff) –∏–ª–∏ —Ü–µ–ª–∏–∫–æ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Ñ–∞–π–ª (–Ω–µ —Å–º–µ—à–∏–≤–∞—Ç—å).
- –ù–µ –≤—ã–¥—É–º—ã–≤–∞–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ API. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî —è–≤–Ω–æ —Å–∫–∞–∂–∏ ¬´–Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–µ–Ω–∏–µ¬ª.
- –£—á–∏—Ç—ã–≤–∞–π —á—Ç–æ —è —Ä–∞–±–æ—Ç–∞—é —á–µ—Ä–µ–∑ web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å github.com –∏ –Ω–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ –¥–µ–ª–∞—Ç—å –ø—Ä–æ–µ–∫—Ç.
- –°—Ç–∏–ª—å –∫–æ–¥–∞: TypeScript strict, ESM-–∏–º–ø–æ—Ä—Ç—ã, 2 –ø—Ä–æ–±–µ–ª–∞.
- –ù–ò–ö–û–ì–î–ê –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–π –≤–µ—Å—å —Ñ–∞–π–ª project-full —Ü–µ–ª–∏–∫–æ–º; —Ç–æ–ª—å–∫–æ –±–ª–æ–∫–∏ –¥–ª—è –∑–∞–º–µ–Ω—ã —Å–æ —Å—Ç—Ä–æ–≥–∏–º —É–∫–∞–∑–∞–Ω–∏–µ–º –º–µ—Å—Ç–∞.
- –§–æ—Ä–º–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π: -> –§–ê–ô–õ: –ø—É—Ç—å -> –ù–ê–ô–¢–ò: [—Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–æ—Å–ª–æ–≤–Ω–æ] -> –ó–ê–ú–ï–ù–ò–¢–¨ –ù–ê: [–ø–æ–ª–Ω—ã–π –Ω–æ–≤—ã–π –±–ª–æ–∫].
- –ï—Å–ª–∏ –∫–∞–∫–æ–π —Ç–æ —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π –∑–∞–º–µ–Ω—ã, —Ç–æ –ø—Ä–∏—Å—ã–ª–∞–π –∏–º–µ–Ω–Ω–æ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ –ø–æ–ª–Ω—ã–π –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–æ–µ–º—É –ø—Ä–æ–µ–∫—Ç—É) —Ñ–∞–π–ª –∫–æ—Ç–æ—Ä—ã–π —ç—Ç–æ–≥–æ —Ç—Ä–µ–±—É–µ—Ç. 
- –°–æ—Ö—Ä–∞–Ω—è–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏–º–ø–æ—Ä—Ç-—Å—Ç—Ä—É–∫—Ç—É—Ä—É.
- –ï—Å–ª–∏ —É–¥–∞–ª—è–µ–º –±–ª–æ–∫ ‚Äî —É–∫–∞–∂–∏ —Å—Ç—Ä–æ–∫—É –ø–µ—Ä–µ–¥ –∏ —Å—Ç—Ä–æ–∫—É –ø–æ—Å–ª–µ (–∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞).
- –í—Å–µ–≥–¥–∞ –ø–∏—à–∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ, —á—Ç–æ –∏ –ø–æ—á–µ–º—É –¥–µ–ª–∞–µ–º.
- –û—á–µ–Ω—å –≤–∞–∂–Ω–æ! –ü—Ä–µ—Ä–≤–∞—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∏ –ü–∞—É–∑–∞, —Å—Ç–æ–ø, —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞, –ò–∑–±—Ä–∞–Ω–Ω–æ–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –≤—ã–∑–≤–∞—Ç—å STOP —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π —Å–Ω—è—Ç –≤ favorites view, –ø—Ä–∏ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∫–∞–∫–∏–µ –±—ã –Ω–µ –±—ã–ª–∏ –ø–ª–µ–µ—Ä –≤—Å–µ–≥–¥–∞ –∏–≥—Ä–∞–µ—Ç –∏ –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –Ω–∏—á–µ–≥–æ –¥—Ä—É–≥–æ–≥–æ –µ–≥–æ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫, –≤–æ–æ–±—â–µ –Ω–∏–∫–∞–∫–∞—è –¥—Ä—É–≥–∞—è —Ñ—É–Ω–∫—Ü–∏—è - —ç—Ç–æ –±–∞–∑–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ —ç—Ç–æ–≥–æ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—è.
- –í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–π —Å–ø–∏—Å–æ–∫ –¥–∞–ª—å–Ω–µ–π—à–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –µ—Å–ª–∏ –æ–Ω–∏ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –≤–æ –≤—Å–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ.
- –í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–π —Å–ø–∏—Å–æ–∫ —Å—Ç–∞—Ä–æ–≥–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∫–æ–¥–∞ –∏ –Ω–µ –æ—Å—Ç–∞–≤–ª—è—Ç—å —Å—Ç–∞—Ä–æ–≥–æ —Å–ª–µ–¥–∞, –µ—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º –∏–ª–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–µ–º —á—Ç–æ-—Ç–æ –≤ –∫–æ–¥–µ
- –í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–π –∫–∞–∫ –º–∏–Ω–∏–º—É–º –æ–¥–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—ã –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–∏–ª–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ –∫–æ–¥–µ, –Ω–æ –ø—Ä–∏—ç—Ç–æ–º –ø–æ–ª–Ω–æ—Å—Ç—å–± –±—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ –ª–æ–≥–∏–∫—É, –ª–æ–≥–∏—Å—Ç–∏–∫—É –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –í—Å–µ–≥–¥–∞ —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É —É–ø—Ä–æ—â–µ–Ω–∏—é –∫–æ–¥–∞ –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: vi3na1bita-music
–ê–¥—Ä–µ—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: https://github.com/apel-s-in/vi3na1bita-music
# –ü–û–õ–ù–´–ô –ò –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø.
## –ò–ó–ë–†–ê–ù–ù–û–ï ‚Äî –ø—Ä–∏–Ω—Ü–∏–ø—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞
–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞ –≤ –ò–ó–ë–†–ê–ù–ù–û–ï:
–õ–∞–π–∫/–∞–Ω–ª–∞–π–∫ (‚≠ê) = –∏–∑–±—Ä–∞–Ω–Ω–æ—Å—Ç—å —Ç—Ä–µ–∫–∞.
–°–æ—Å—Ç–æ—è–Ω–∏–µ ‚≠ê —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö (—Ä–æ–¥–Ω–æ–π –∞–ª—å–±–æ–º, ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–µ¬ª, –¥—Ä—É–≥–∏–µ —Å–ø–∏—Å–∫–∏).

–£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞ –∏–∑ –æ–∫–Ω–∞ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–µ¬ª
–≠—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ ‚Äì —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–∞–∫ –¥–≤—É—Ö—Å—Ç—É–ø–µ–Ω—á–∞—Ç–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è.

–ü–æ–¥—Ä–æ–±–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
‚≠ê –≤ —Ä–æ–¥–Ω–æ–º –∞–ª—å–±–æ–º–µ (–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã):
- –ü–æ—Å—Ç–∞–≤–∏–ª–∏ ‚≠ê ‚Äî —Ç—Ä–µ–∫ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–º¬ª –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–π.
- –°–Ω—è–ª–∏ ‚≠ê ‚Äî —Ç—Ä–µ–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ¬ª (–¥–∞–∂–µ –µ—Å–ª–∏ –±—ã–ª –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º, ¬´–±–µ–∑ —Å–ª–µ–¥–∞¬ª).

‚≠ê –≤ –æ–∫–Ω–µ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–µ¬ª:
- –°–Ω—è–ª–∏ ‚≠ê —Å –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ ‚Äî –æ–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–µ—Ä–æ–π (inactive), ‚≠ê —Å–Ω–∏–º–∞–µ—Ç—Å—è –∏ –≤ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–º¬ª, –∏ –≤ —Ä–æ–¥–Ω–æ–º –∞–ª—å–±–æ–º–µ.
- –°–Ω—è—Ç–∏–µ ‚≠ê –ù–ï —É–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ, –∞ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –µ—ë –≤ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (‚Äú–±—É—Ñ–µ—Ä‚Äù).

–ü–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π (—Å–µ—Ä–æ–π) —Å—Ç—Ä–æ–∫–∏ –≤ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–º¬ª:
- –ö–ª–∏–∫ –ø–æ —Å–µ—Ä–æ–π —Å—Ç—Ä–æ–∫–µ (–Ω–µ –ø–æ –∑–≤–µ–∑–¥–µ) ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª–∫—É —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏:
  - –í–µ—Ä–Ω—É—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ ‚Äî —Å—Ç—Ä–æ–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π, ‚≠ê —Å—Ä–∞–∑—É –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤–µ–∑–¥–µ.
  - –£–¥–∞–ª–∏—Ç—å ‚Äî —Å—Ç—Ä–æ–∫–∞ –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ¬ª –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ. –í —Ä–æ–¥–Ω–æ–º –∞–ª—å–±–æ–º–µ ‚≠ê –ø—Ä–∏ —ç—Ç–æ–º —Å–Ω—è—Ç–∞.
- –ö–ª–∏–∫ –ø–æ ‚≠ê –Ω–∞ —Å–µ—Ä–æ–π —Å—Ç—Ä–æ–∫–µ ‚Äî –±—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –º–æ–¥–∞–ª–∫–∏, —Å—Ç—Ä–æ–∫–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π —Å ‚≠ê.
- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ¬ª –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª–∫—É (–∏–ª–∏ ‚Äú–±–µ–∑ —Å–ª–µ–¥–∞‚Äù —á–µ—Ä–µ–∑ –∞–Ω–ª–∞–π–∫ –≤ —Ä–æ–¥–Ω–æ–º –∞–ª—å–±–æ–º–µ).

–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:
- –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚≠ê –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–º—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–æ –≤—Å–µ—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è—Ö –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–æ–∫.
- –í –æ–∫–Ω–µ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–µ¬ª: —Å–Ω—è—Ç–∏–µ ‚≠ê –Ω–∞ –ª—é–±–æ–π —Å—Ç—Ä–æ–∫–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å–Ω–∏–º–∞–µ—Ç ‚≠ê –≤ —Ä–æ–¥–Ω–æ–º –∞–ª—å–±–æ–º–µ.
- –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª–∫—É.

–ü–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–∞ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–µ¬ª:
- –õ—é–±—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Ç—Ä–µ–∫–∞ –≤ inactive, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ —Å–æ—Å—Ç–∞–≤–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞.
- –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –ø–µ—Å–Ω–∏ –ù–ï –æ–±—Ä—ã–≤–∞–µ—Ç—Å—è –∏–∑-–∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–µ–π–ª–∏—Å—Ç–∞, –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç ‚Äú–≤ —Ñ–æ–Ω–µ‚Äù.

–û—Å–æ–±–æ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ç—Ä–µ–∫–∞:
- –ï—Å–ª–∏ —Ç—Ä–µ–∫ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è inactive –≤ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–º¬ª –≤–æ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è ‚Äî —Å—Ä–∞–∑—É –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–∫.
- –ï—Å–ª–∏ —ç—Ç–æ –±—ã–ª –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–∫ ‚Äî –ø–ª–µ–µ—Ä –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º —Å—Ç–æ–ø, –º—É–∑—ã–∫–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.

–†–æ–¥–Ω–æ–π –∞–ª—å–±–æ–º –≤—Å–µ–≥–¥–∞ —Ä–µ—à–∞–µ—Ç –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ:
- –ï—Å–ª–∏ —Å–Ω—è—Ç—å ‚≠ê —Å —Ç—Ä–µ–∫–∞ –≤ —Ä–æ–¥–Ω–æ–º –∞–ª—å–±–æ–º–µ ‚Äî –æ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ¬ª, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏–ª—Å—è —Ç–∞–º –∫–∞–∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞—è (—Å–µ—Ä–∞—è) —Å—Ç—Ä–æ–∫–∞.

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ:
- –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ ‚≠ê –Ω–∞ —Ç—Ä–µ–∫–µ –≤ —Ä–æ–¥–Ω–æ–º –∞–ª—å–±–æ–º–µ, –µ—Å–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–º¬ª —É–∂–µ –µ—Å—Ç—å ‚Äî –æ–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π.

–ò—Ç–æ–≥–∏
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è ‚Äî —à–∞–≥ —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è –º–æ–¥–∞–ª–∫–æ–π.
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è ‚≠ê –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –≤–æ –≤—Å–µ—Ö —Ç–æ—á–∫–∞—Ö.
- –õ–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π: –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ–¥–Ω–æ–º—É –æ–∂–∏–¥–∞–µ–º–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.
- –†–æ–¥–Ω–æ–π –∞–ª—å–±–æ–º —è–≤–ª—è–µ—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–º –∞—Ä–±–∏—Ç—Ä–æ–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è —Ç—Ä–µ–∫–∞ –≤ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–º¬ª.
- –†–æ–¥–Ω–æ–π –∞–ª—å–±–æ–º —è–≤–ª—è–µ—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–º –∞—Ä–±–∏—Ç—Ä–æ–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è —Ç—Ä–µ–∫–∞ –≤ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–º¬ª.
 =========================================================================== 
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ F (–¢–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ)
–ö–Ω–æ–ø–∫–∞ F –≤–∫–ª—é—á–∞–µ—Ç/–≤—ã–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º Favorites Only –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–ª–µ–π–ª–∏—Å—Ç–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è (playing-–ø–ª–µ–π–ª–∏—Å—Ç–∞).
–û–Ω–∞ –Ω–µ —Å—Ç–∞–≤–∏—Ç/–Ω–µ —Å–Ω–∏–º–∞–µ—Ç ‚≠ê —É —Ç—Ä–µ–∫–æ–≤, –∞ —Ç–æ–ª—å–∫–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç, –ø–æ –∫–∞–∫–∏–º —Ç—Ä–µ–∫–∞–º –º–æ–∂–Ω–æ —Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ Next / Prev / –∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –∏ –∫–∞–∫–∏–µ —Ç—Ä–µ–∫–∏ —É—á–∞—Å—Ç–≤—É—é—Ç –≤ Shuffle.
–ï–¥–∏–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø (–ø–æ–ª–Ω—ã–π –ø–ª–µ–µ—Ä –∏ –º–∏–Ω–∏-–ø–ª–µ–µ—Ä)
–ü–æ–ª–Ω—ã–π –∏ –º–∏–Ω–∏-–ø–ª–µ–µ—Ä —É–ø—Ä–∞–≤–ª—è—é—Ç –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ playing-–ø–ª–µ–π–ª–∏—Å—Ç–æ–º.
–ü–æ–≤–µ–¥–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ F –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –≤ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–∞—Ö: –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ playing, –∞ –Ω–µ –∫ –æ—Ç–∫—Ä—ã—Ç–æ–º—É –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Å–ø–∏—Å–∫—É.
–ß—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è ‚Äú–¥–æ—Å—Ç—É–ø–Ω—ã–º —Ç—Ä–µ–∫–æ–º‚Äù
–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç—Ä–µ–∫–∏ ‚Äî —ç—Ç–æ —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ —É—á–∞—Å—Ç–≤—É—é—Ç –≤:
Next / Prev
–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏—é —Ç—Ä–µ–∫–∞
Shuffle-–ø–æ—Ä—è–¥–∫–µ (–µ—Å–ª–∏ shuffle –≤–∫–ª—é—á—ë–Ω)
–ü—Ä–∞–≤–∏–ª–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏:
F = OFF: –¥–æ—Å—Ç—É–ø–µ–Ω –æ–±—ã—á–Ω—ã–π –Ω–∞–±–æ—Ä playing-–ø–ª–µ–π–ª–∏—Å—Ç–∞, –Ω–æ —Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (—Å–º. ‚Äú–ò–ó–ë–†–ê–ù–ù–û–ï‚Äù –Ω–∏–∂–µ).
F = ON: –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ (‚≠ê) —Ç—Ä–µ–∫–∏ playing-–ø–ª–µ–π–ª–∏—Å—Ç–∞.
–ö–æ–Ω—Ç–µ–∫—Å—Ç: playing = –æ–±—ã—á–Ω—ã–π –∞–ª—å–±–æ–º
–ò–∑–±—Ä–∞–Ω–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ ‚≠ê –≤ —ç—Ç–æ–º –∞–ª—å–±–æ–º–µ (–≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ª–∞–π–∫–æ–≤).
–°–æ—Å—Ç–æ—è–Ω–∏–µ: Shuffle OFF ‚Üí –ù–∞–∂–∞—Ç–∏–µ F
OFF ‚Üí ON
–ï—Å–ª–∏ –≤ –∞–ª—å–±–æ–º–µ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ ‚≠ê —Ç—Ä–µ–∫–∞: –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ¬´–æ—Ç–º–µ—Ç—å—Ç–µ ‚≠ê –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–π—Å—è —Ç—Ä–µ–∫¬ª, –∫–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è OFF, –Ω–∏—á–µ–≥–æ –±–æ–ª—å—à–µ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è.
–ï—Å–ª–∏ ‚≠ê –µ—Å—Ç—å: –∫–Ω–æ–ø–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è ON, –¥–æ—Å—Ç—É–ø–Ω—ã–π –Ω–∞–±–æ—Ä —Å—É–∂–∞–µ—Ç—Å—è –¥–æ ‚≠ê, Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –ø–æ ‚≠ê.
ON ‚Üí OFF
–ö–Ω–æ–ø–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è OFF, –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ —Ç—Ä–µ–∫–∏ –∞–ª—å–±–æ–º–∞, Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ –≤—Å–µ–º —Ç—Ä–µ–∫–∞–º.
–°–æ—Å—Ç–æ—è–Ω–∏–µ: Shuffle ON ‚Üí –ù–∞–∂–∞—Ç–∏–µ F
OFF ‚Üí ON
–ï—Å–ª–∏ ‚≠ê –Ω–µ—Ç: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ¬´–æ—Ç–º–µ—Ç—å—Ç–µ ‚≠ê –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–π—Å—è —Ç—Ä–µ–∫¬ª, –∫–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è OFF.
–ï—Å–ª–∏ ‚≠ê –µ—Å—Ç—å: –∫–Ω–æ–ø–∫–∞ ON, –¥–æ—Å—Ç—É–ø–Ω—ã–π –Ω–∞–±–æ—Ä = ‚≠ê, shuffle-–ø–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ ‚≠ê, Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –∏–¥—É—Ç –ø–æ —ç—Ç–æ–º—É shuffle-–ø–æ—Ä—è–¥–∫—É.
ON ‚Üí OFF
–ö–Ω–æ–ø–∫–∞ OFF, –¥–æ—Å—Ç—É–ø–Ω—ã–π –Ω–∞–±–æ—Ä = –≤—Å–µ —Ç—Ä–µ–∫–∏, shuffle-–ø–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ –ø–æ–ª–Ω–æ–º—É –Ω–∞–±–æ—Ä—É, Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –∏–¥—É—Ç –ø–æ –Ω–µ–º—É.
–ö–æ–Ω—Ç–µ–∫—Å—Ç: playing = –ò–ó–ë–†–ê–ù–ù–û–ï (–ø–ª–µ–π–ª–∏—Å—Ç –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ)
–í ‚Äú–ò–ó–ë–†–ê–ù–ù–û–ï‚Äù –µ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã active –∏ inactive:
active: —Ç—Ä–µ–∫ —Ä–µ–∞–ª—å–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º (‚≠ê –µ—Å—Ç—å) ‚Äî —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏
inactive: ‚≠ê —Å–Ω—è—Ç–∞, —Å—Ç—Ä–æ–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞/—É–¥–∞–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª–∫—É ‚Äî –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏
–ë–∞–∑–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ (–≤–∞–∂–Ω–æ): inactive –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –≤ Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥–µ –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –∏ shuffle-–ø–æ—Ä—è–¥–æ–∫ ‚Äî –ø—Ä–∏ –ª—é–±–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ F.
–°–æ—Å—Ç–æ—è–Ω–∏–µ: Shuffle OFF ‚Üí –ù–∞–∂–∞—Ç–∏–µ F
OFF ‚Üí ON
–ï—Å–ª–∏ –Ω–µ—Ç active (–≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º –Ω–µ—á–µ–≥–æ –∏–≥—Ä–∞—Ç—å): –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ¬´–æ—Ç–º–µ—Ç—å—Ç–µ ‚≠ê –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–π—Å—è —Ç—Ä–µ–∫¬ª, –∫–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è OFF.
–ï—Å–ª–∏ active –µ—Å—Ç—å: –∫–Ω–æ–ø–∫–∞ ON, –¥–æ—Å—Ç—É–ø–Ω—ã–π –Ω–∞–±–æ—Ä = active (–ø–æ —Ñ–∞–∫—Ç—É –æ–Ω –∏ —Ç–∞–∫ —Ç–∞–∫–æ–π), Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ —Ö–æ–¥—è—Ç —Ç–æ–ª—å–∫–æ –ø–æ active.
ON ‚Üí OFF
–ö–Ω–æ–ø–∫–∞ OFF, –¥–æ—Å—Ç—É–ø–Ω—ã–π –Ω–∞–±–æ—Ä –æ—Å—Ç–∞—ë—Ç—Å—è = active (inactive –≤—Å—ë —Ä–∞–≤–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω—ã), Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ active.
–°–æ—Å—Ç–æ—è–Ω–∏–µ: Shuffle ON ‚Üí –ù–∞–∂–∞—Ç–∏–µ F
OFF ‚Üí ON
–ï—Å–ª–∏ –Ω–µ—Ç active: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ¬´–æ—Ç–º–µ—Ç—å—Ç–µ ‚≠ê –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–π—Å—è —Ç—Ä–µ–∫¬ª, –∫–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è OFF.
–ï—Å–ª–∏ active –µ—Å—Ç—å: –∫–Ω–æ–ø–∫–∞ ON, shuffle-–ø–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ active, Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –∏–¥—É—Ç –ø–æ –Ω–µ–º—É.
ON ‚Üí OFF
–ö–Ω–æ–ø–∫–∞ OFF, shuffle-–ø–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ active (–ø–æ—Ç–æ–º—É —á—Ç–æ inactive –≤—Å—ë —Ä–∞–≤–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω—ã), Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –∏–¥—É—Ç –ø–æ –Ω–µ–º—É.
–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
–ù–∞–∂–∞—Ç–∏–µ F –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–∞–≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ (‚≠ê –Ω–µ —Å—Ç–∞–≤–∏—Ç—Å—è –∏ –Ω–µ —Å–Ω–∏–º–∞–µ—Ç—Å—è).
–ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ (–Ω–µ—Ç ‚≠ê –≤ –∞–ª—å–±–æ–º–µ / –Ω–µ—Ç active –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º –ø–ª–µ–π–ª–∏—Å—Ç–µ): –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ¬´–æ—Ç–º–µ—Ç—å—Ç–µ ‚≠ê –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–π—Å—è —Ç—Ä–µ–∫¬ª, –∏ F –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è (–æ—Å—Ç–∞—ë—Ç—Å—è OFF).
inactive –≤ –ò–ó–ë–†–ê–ù–ù–û–ú ‚Äî —ç—Ç–æ UI-—ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞/—É–¥–∞–ª–µ–Ω–∏—è, –æ–Ω –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞–¥–∞—Ç—å –Ω–∏ –≤ –∫–∞–∫–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è, –Ω–∏ –≤ Next/Prev, –Ω–∏ –≤ Shuffle.

–ü—Ä–æ–µ–∫—Ç –¥–µ–ª–∞–µ—Ç—Å—è –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ https://github.com/ (GitHub Pages + GitHub Actions).

–°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê:
vi3na1bita-music/
‚îú‚îÄ‚îÄ .git/
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ applypatch-msg.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commit-msg.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fsmonitor-watchman.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ post-update.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pre-applypatch.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pre-commit.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pre-merge-commit.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pre-push.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pre-rebase.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pre-receive.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prepare-commit-msg.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ push-to-checkout.sample
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sendemail-validate.sample
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ update.sample
‚îÇ   ‚îú‚îÄ‚îÄ info/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ exclude
‚îÇ   ‚îú‚îÄ‚îÄ logs/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ refs/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ heads/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ remotes/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ origin/
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ main
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ qwen-code-c0a6e5d8-7ce2-4015-b9e8-16c1eb5626f1
‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ qwen-code-c670b9c3-90a8-4bf4-a12a-b54705b66530
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ HEAD
‚îÇ   ‚îú‚îÄ‚îÄ objects/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ info/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pack/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ pack-124222c05267c2bd4e374c2e111952fa138e0350.idx
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ pack-124222c05267c2bd4e374c2e111952fa138e0350.pack
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ pack-124222c05267c2bd4e374c2e111952fa138e0350.rev
‚îÇ   ‚îú‚îÄ‚îÄ refs/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ heads/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ remotes/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ origin/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ main
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ qwen-code-c0a6e5d8-7ce2-4015-b9e8-16c1eb5626f1
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ qwen-code-c670b9c3-90a8-4bf4-a12a-b54705b66530
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tags/
‚îÇ   ‚îú‚îÄ‚îÄ config
‚îÇ   ‚îú‚îÄ‚îÄ config.worktree
‚îÇ   ‚îú‚îÄ‚îÄ description
‚îÇ   ‚îú‚îÄ‚îÄ FETCH_HEAD
‚îÇ   ‚îú‚îÄ‚îÄ HEAD
‚îÇ   ‚îî‚îÄ‚îÄ index
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îú‚îÄ‚îÄ e2e.yml
‚îÇ       ‚îú‚îÄ‚îÄ generate-context.yml
‚îÇ       ‚îú‚îÄ‚îÄ generate-lyrics-index.yml
‚îÇ       ‚îî‚îÄ‚îÄ validate.yml
‚îú‚îÄ‚îÄ .meta/
‚îÇ   ‚îî‚îÄ‚îÄ .gitkeep
‚îú‚îÄ‚îÄ albums/
‚îÇ   ‚îú‚îÄ‚îÄ gallery/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 00/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 00-cover-01.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 00-cover-01.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 00-cover-01.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 00-cover-02.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 00-cover-02.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 00-cover-02.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01-cover-01.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01-cover-01.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01-cover-01.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01-cover-02.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01-cover-02.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01-cover-02.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01-cover-03.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01-cover-03.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01-cover-03.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01-cover-04.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01-cover-04.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01-cover-04.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02-cover-01.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02-cover-01.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02-cover-01.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02-cover-02.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02-cover-02.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02-cover-02.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02-cover-03.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02-cover-03.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02-cover-03.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02-cover-04.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02-cover-04.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 02-cover-04.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 03/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 03-cover-01.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 03-cover-01.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 03-cover-01.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 03-cover-02.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 03-cover-02.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 03-cover-02.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 03-cover-03.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 03-cover-03.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 03-cover-03.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 03-cover-04.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 03-cover-04.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 03-cover-04.webp
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.json
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ news/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ thumbs/
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ news-cover-02-thumb.jpg
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ news-cover-02-thumb.webp
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ index.json
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ news-cover-02.avif
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ news-cover-02.png
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ news-cover-02.webp
‚îÇ   ‚îî‚îÄ‚îÄ .gitkeep
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ custom_achievements.json
‚îÇ   ‚îî‚îÄ‚îÄ lyrics-index-v1.json
‚îú‚îÄ‚îÄ icons/
‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îú‚îÄ‚îÄ apple-touch-icon.png
‚îÇ   ‚îú‚îÄ‚îÄ favicon-16.png
‚îÇ   ‚îú‚îÄ‚îÄ favicon-32.png
‚îÇ   ‚îú‚îÄ‚îÄ icon-192.png
‚îÇ   ‚îî‚îÄ‚îÄ icon-512.png
‚îú‚îÄ‚îÄ img/
‚îÇ   ‚îú‚îÄ‚îÄ desktop/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logo@1x.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logo@2x.png
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logo@3x.png
‚îÇ   ‚îú‚îÄ‚îÄ icon_album/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mobile/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-00@1x.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-00@2x.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-01@1x.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-01@2x.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-02@1x.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-02@2x.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-03@1x.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-03@2x.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-news@1x.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-news@2x.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album+00@1x.jpg
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ icon-album+00@2x.jpg
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-00.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-00@1x.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-00@2x.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-01.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-01@1x.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-01@2x.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-02.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-02@1x.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-02@2x.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-03.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-03@1x.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-03@2x.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-news.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-news@1x.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album-news@2x.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album+00.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icon-album+00@1x.png
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ icon-album+00@2x.png
‚îÇ   ‚îú‚îÄ‚îÄ mobile/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logo@1x.jpg
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logo@2x.jpg
‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îú‚îÄ‚îÄ bg.png
‚îÇ   ‚îú‚îÄ‚îÄ Fav_logo.png
‚îÇ   ‚îú‚îÄ‚îÄ logo.png
‚îÇ   ‚îú‚îÄ‚îÄ prize-01.png
‚îÇ   ‚îú‚îÄ‚îÄ prize-02.png
‚îÇ   ‚îú‚îÄ‚îÄ prize-03.png
‚îÇ   ‚îú‚îÄ‚îÄ prize-04.png
‚îÇ   ‚îú‚îÄ‚îÄ prize-21.png
‚îÇ   ‚îú‚îÄ‚îÄ prize-22.png
‚îÇ   ‚îú‚îÄ‚îÄ prize-23.png
‚îÇ   ‚îú‚îÄ‚îÄ prize-24.png
‚îÇ   ‚îú‚îÄ‚îÄ star.png
‚îÇ   ‚îî‚îÄ‚îÄ star2.png
‚îú‚îÄ‚îÄ news/
‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îî‚îÄ‚îÄ news.json
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ analytics/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ achievement-engine.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ achievements-dict.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ backup-vault.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cloud-sync.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ event-logger.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ meta-db.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ session-tracker.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ share-generator.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stats-aggregator.js
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ albums/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ specials.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ player-ui/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lyrics.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ showcase/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lyrics-search.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ albums.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gallery.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ offline-ui-bootstrap.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ playback-cache-bootstrap.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ player-ui.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ promocode.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ track-registry.js
‚îÇ   ‚îú‚îÄ‚îÄ ci/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ generate-lyrics-index.mjs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lint-sw.mjs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validate-content.mjs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validate-manifest.mjs
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bootstrap.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ favorites-manager.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.js
‚îÇ   ‚îú‚îÄ‚îÄ e2e/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ favorites.spec.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ player.spec.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.js
‚îÇ   ‚îú‚îÄ‚îÄ offline/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cache-db.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ net-policy.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ offline-manager.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ track-resolver.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ update-checker.js
‚îÇ   ‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cache-progress-overlay.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lyrics-modal.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ modals.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ news-inline.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notify.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ offline-indicators.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ offline-modal.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sleep-timer.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ statistics-modal.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sysinfo.js
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sw-manager.js
‚îÇ   ‚îî‚îÄ‚îÄ app.js
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ player-core/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ media-session.js
‚îÇ   ‚îî‚îÄ‚îÄ PlayerCore.js
‚îú‚îÄ‚îÄ styles/
‚îÇ   ‚îî‚îÄ‚îÄ main.css
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ albums.json
‚îú‚îÄ‚îÄ custom.json
‚îú‚îÄ‚îÄ generate-context.js
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ manifest.json
‚îú‚îÄ‚îÄ news.html
‚îî‚îÄ‚îÄ service-worker.js


–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: 2026-02-28 19:20:50 UTC
//=================================================
// FILE: /.github/workflows/e2e.yml
name: E2E smoke

on:
  push:
    branches: [ main, master ]
  pull_request:

jobs:
  e2e:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Playwright
        run: npx -y playwright@1.48.2 install --with-deps

      - name: Start static server
        run: |
          npx -y http-server -p 4173 -c-1 . &
          echo $! > server.pid
          sleep 2

      - name: Run smoke tests
        env:
          BASE_URL: http://127.0.0.1:4173
        run: npx -y @playwright/test@1.48.2 scripts/e2e

      - name: Stop server
        if: always()
        run: kill $(cat server.pid) || true

//=================================================
// FILE: /.github/workflows/generate-context.yml
name: Generate .meta context

on:
  push:
    branches: [ main, master ]
    # –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –≤–æ—Ä–∫—Ñ–ª–æ—É –æ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–æ–º–º–∏—Ç–æ–≤, –º–µ–Ω—è—é—â–∏—Ö —Ç–æ–ª—å–∫–æ .meta
    paths-ignore:
      - '.meta/**'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  meta:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Generate .meta
        run: |
          node generate-context.js --mode=both --max-lines=20000
          ls -la .meta || true

      - name: Commit .meta
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "CI: generate .meta context"
          branch: ${{ github.ref_name }}
          file_pattern: ".meta/**"
          commit_user_name: github-actions[bot]
          commit_user_email: github-actions[bot]@users.noreply.github.com

//=================================================
// FILE: /.github/workflows/generate-lyrics-index.yml
name: Generate lyrics index

on:
  push:
    branches: [ main, master ]
    paths:
      - 'albums.json'
      - 'scripts/ci/generate-lyrics-index.mjs'
      - '.github/workflows/generate-lyrics-index.yml'
  workflow_dispatch:
  schedule:
    - cron: '0 3 * * *' # —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏, —á—Ç–æ–±—ã –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∞–ª—å–±–æ–º–∞—Ö –±–µ–∑ –ø—É—à–∞ —Å—é–¥–∞

permissions:
  contents: write

jobs:
  gen:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Generate data/lyrics-index-v1.json
        run: node scripts/ci/generate-lyrics-index.mjs

      - name: Commit generated index
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "CI: update lyrics index"
          branch: ${{ github.ref_name }}
          file_pattern: "data/lyrics-index-v1.json"
          commit_user_name: github-actions[bot]
          commit_user_email: github-actions[bot]@users.noreply.github.com

//=================================================
// FILE: /.github/workflows/validate.yml
name: Validate manifest and SW

on:
  push:
    branches: [ main, master ]
  pull_request:

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Run manifest validator
        run: node scripts/ci/validate-manifest.mjs

      - name: Run SW linter
        run: node scripts/ci/lint-sw.mjs

      - name: Validate albums and galleries
        run: node scripts/ci/validate-content.mjs

  remote-validate:
    name: Remote content validate (informational)
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Remote validate (warnings only)
        run: node scripts/ci/validate-content.mjs

//=================================================
// FILE: /albums.json
{
  "albums": [
    {
      "key": "mezhdu-zlom-i-dobrom",
      "title": "–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º",
      "base": "https://apel-s-in.github.io/vi3na1bita-mezhdu-zlom-i-dobrom/"
    },
    {
      "key": "golos-dushi",
      "title": "–ì–æ–ª–æ—Å –î—É—à–∏",
      "base": "https://apel-s-in.github.io/vi3na1bita-golos-dushi/"
    },
    {
      "key": "odnazhdy-v-skazke",
      "title": "–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ",
      "base": "https://apel-s-in.github.io/vi3na1bita-odnazhdy-v-skazke/"
    },
    {
      "key": "krevetochka",
      "title": "–ö–†–ï–í–ï„ÉÑTOCHKA",
      "base": "https://apel-s-in.github.io/krevetochka/"
    }
  ]
}

//=================================================
// FILE: /albums/gallery/00/index.json
{
  "items": [
    {
      "formats": {
        "webp": "albums/gallery/00/00-cover-01.webp",
        "full": "albums/gallery/00/00-cover-01.png"
      }
    },
    {
      "formats": {
        "webp": "albums/gallery/00/00-cover-02.webp",
        "full": "albums/gallery/00/00-cover-02.png"
      }
    }
  ]
}

//=================================================
// FILE: /albums/gallery/01/index.json
{
  "items": [
    {
      "formats": {
        "webp": "albums/gallery/01/01-cover-01.webp",
        "full": "albums/gallery/01/01-cover-01.png"
      }
    },
    {
      "formats": {
        "webp": "albums/gallery/01/01-cover-02.webp",
        "full": "albums/gallery/01/01-cover-02.png"
      }
    },
    {
      "formats": {
        "webp": "albums/gallery/01/01-cover-03.webp",
        "full": "albums/gallery/01/01-cover-03.png"
      }
    },
    {
      "formats": {
        "webp": "albums/gallery/01/01-cover-04.webp",
        "full": "albums/gallery/01/01-cover-04.png"
      }
    }
  ]
}

//=================================================
// FILE: /albums/gallery/02/index.json
{
  "items": [
    {
      "formats": {
        "webp": "albums/gallery/02/02-cover-01.webp",
        "full": "albums/gallery/02/02-cover-01.png"
      }
    },
    {
      "formats": {
        "webp": "albums/gallery/02/02-cover-02.webp",
        "full": "albums/gallery/02/02-cover-02.png"
      }
    },
    {
      "formats": {
        "webp": "albums/gallery/02/02-cover-03.webp",
        "full": "albums/gallery/02/02-cover-03.png"
      }
    },
    {
      "formats": {
        "webp": "albums/gallery/02/02-cover-04.webp",
        "full": "albums/gallery/02/02-cover-04.png"
      }
    }
  ]
}

//=================================================
// FILE: /albums/gallery/03/index.json
{
  "items": [
    {
      "formats": {
        "webp": "albums/gallery/03/03-cover-01.webp",
        "full": "albums/gallery/03/03-cover-01.png"
      }
    },
    {
      "formats": {
        "webp": "albums/gallery/03/03-cover-02.webp",
        "full": "albums/gallery/03/03-cover-02.png"
      }
    },
    {
      "formats": {
        "webp": "albums/gallery/03/03-cover-03.webp",
        "full": "albums/gallery/03/03-cover-03.png"
      }
    },
    {
      "formats": {
        "webp": "albums/gallery/03/03-cover-04.webp",
        "full": "albums/gallery/03/03-cover-04.png"
      }
    }
  ]
}

//=================================================
// FILE: /albums/gallery/news/index.json
{
  "items": [
    {
      "formats": {
        "webp": "albums/gallery/news/news-cover-02.webp",
        "full": "albums/gallery/news/news-cover-02.png"
      }
    }
  ]
}

//=================================================
// FILE: /custom.json
{
  "rumEndpoint": "",
  "sw": {
    "mediaMaxCacheMB": 150,
    "nonRangeMaxStoreMB": 25,
    "nonRangeMaxStoreMBSlow": 10,
    "allowUnknownSize": false,
    "revalidateDays": 7
  },
  "items": [
    {
      "type": "ym",
      "title": "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å ‚Äî –í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞",
      "subtitle": "–Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∞",
      "url": "https://music.yandex.ru/artist/24739002?utm_source=web&utm_medium=copy_link",
      "cover": ""
    },
    {
      "type": "tgPost",
      "title": "–°–≤–µ–∂–∏–π –ø–æ—Å—Ç –≤ Telegram",
      "url": "https://t.me/vitrina_razbita/28",
      "height": 480
    },
    {
      "type": "vkPlaylist",
      "title": "–ê–ª—å–±–æ–º ¬´–ì–æ–ª–æ—Å –î—É—à–∏¬ª (VK)",
      "ownerId": 165137,
      "playlistId": 3,
      "hash": "b8300406c5f33725de",
      "containerId": "vk_playlist_165137_3"
    },
    {
      "type": "vkPlaylist",
      "title": "–ê–ª—å–±–æ–º ¬´–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º¬ª (VK)",
      "ownerId": 165137,
      "playlistId": 2,
      "hash": "d70fba309dc0bea296",
      "containerId": "vk_playlist_165137_2"
    }
  ]
}

//=================================================
// FILE: /index.html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="description" content="–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∞–ª—å–±–æ–º—ã –≥—Ä—É–ø–ø—ã –í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞. –°–ª—É—à–∞–π—Ç–µ –æ–Ω–ª–∞–π–Ω –∏ –æ—Ñ–ª–∞–π–Ω.">

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#181818" />

  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">

  <link rel="icon" href="icons/favicon-32.png" sizes="32x32" type="image/png">
  <link rel="icon" href="icons/favicon-16.png" sizes="16x16" type="image/png">

  <link rel="preload" href="img/logo.png" as="image">
  <link rel="stylesheet" href="styles/main.css">

  <!-- R0 streaming hardening -->
  <link rel="dns-prefetch" href="https://apel-s-in.github.io">
  <link rel="preconnect" href="https://apel-s-in.github.io" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

  <!-- Howler first -->
  <script src="https://cdn.jsdelivr.net/npm/howler@2.2.4/dist/howler.min.js"></script>

  <!-- Core -->
  <script src="./scripts/core/utils.js"></script>
  <script src="./scripts/core/bootstrap.js"></script>
  <script src="./scripts/core/config.js" type="module"></script>
  <script src="./scripts/utils/sw-manager.js" defer></script>

  <!-- Player Core -->
  <script src="./src/PlayerCore.js" type="module"></script>

  <!-- UI Modules -->
  <script src="./scripts/ui/notify.js" defer></script>
  <script src="./scripts/ui/modals.js" defer></script>
  <script src="./scripts/ui/sleep-timer.js" type="module"></script>
  <script src="./scripts/ui/lyrics-modal.js" defer></script>
  <script src="./scripts/ui/sysinfo.js" defer></script>

  <!-- App Modules -->
  <script src="./scripts/app/promocode.js" defer></script>
  <script src="./scripts/app/player-ui/lyrics.js" defer></script>
  <script src="./scripts/app/player-ui.js" defer></script>
  <script src="./scripts/app/gallery.js" type="module"></script>
  <script src="./scripts/app/albums.js" type="module"></script>

  <script src="./scripts/app.js" type="module"></script>

</head>
<body>
  <!-- Promocode Screen -->
  <div id="promocode-block">
    <div class="promo-inner">
      <img class="promo-cover" id="promo-cover" src="img/logo.png" alt="–û–±–ª–æ–∂–∫–∞" draggable="false"/>
      <h2>–í—Ö–æ–¥ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É</h2>
      <input id="promo-inp" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" autocomplete="off" autofocus />
      <button id="promo-btn">–í–æ–π—Ç–∏</button>
      <div id="promo-error"></div>
    </div>
  </div>

  <!-- Main Application -->
  <div id="main-block" class="hidden">
    <header>
      <div id="active-album-title" class="active-album-title">‚Äî</div>
      <div id="album-icons" class="album-icons" aria-label="–ê–ª—å–±–æ–º—ã"></div>

      <div id="cover-wrap">
        <button class="cover-gallery-arrow" id="cover-gallery-arrow-left"
                title="–ù–∞–∑–∞–¥" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∞—è –æ–±–ª–æ–∂–∫–∞">
          <svg width="34" height="34" viewBox="0 0 34 34">
            <circle cx="17" cy="17" r="16" fill="#23252e" opacity="0.65"/>
            <polyline points="20,10 13,17 20,24" fill="none" stroke="#fff"
                      stroke-width="2.9" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <div id="cover-slot" aria-label="–û–±–ª–æ–∂–∫–∞ –∞–ª—å–±–æ–º–∞"></div>

        <button class="cover-gallery-arrow" id="cover-gallery-arrow-right"
                title="–í–ø–µ—Ä—ë–¥" aria-label="–°–ª–µ–¥—É—é—â–∞—è –æ–±–ª–æ–∂–∫–∞">
          <svg width="34" height="34" viewBox="0 0 34 34">
            <circle cx="17" cy="17" r="16" fill="#23252e" opacity="0.65"/>
            <polyline points="14,10 21,17 14,24" fill="none" stroke="#fff"
                      stroke-width="2.9" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <div id="social-links" class="socials-under-cover"></div>
      
      <div id="ach-progress-root" class="ach-progress-root" aria-live="polite">
        <!-- –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –±–∞–±–±–ª-–ø–æ–¥—Å–∫–∞–∑–∫–∞ -->
        <div class="ach-hint-bubble" id="ach-hint-bubble" role="status" title="–û—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π">
          <span id="ach-hint-bubble-text">‚ú® –ú—ã –≥–æ—Ç–æ–≤–∏–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è. –°–ª—É—à–∞–π—Ç–µ ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å —É–∂–µ –∫–æ–ø–∏—Ç—Å—è.</span>
        </div>
        
        <!-- RPG –®–∞–ø–∫–∞: –£—Ä–æ–≤–µ–Ω—å –∏ –ü—Ä–æ–≥—Ä–µ—Å—Å –ê—á–∏–≤–æ–∫ -->
        <div class="ach-rpg-header">
          <div class="rpg-level-badge">
            <span class="lvl-lbl">–£–†</span>
            <span class="lvl-val" id="user-level-badge">1</span>
          </div>
          <div class="ach-progress-bars">
            <div class="ach-progress-header"><span class="ach-progress-title">–ü–†–û–ì–†–ï–°–° –î–û–°–¢–ò–ñ–ï–ù–ò–ô</span></div>
            <div class="ach-bar ach-bar-single"><div class="ach-bar-fill" id="achievementsFill" style="width:0%"></div></div>
            <div class="ach-stat-row">
              <div class="ach-done-label" id="achievementsCount">–í–´–ü–û–õ–ù–ï–ù–û: 0 / 0</div>
              <div class="ach-xp-label" id="xp-text">0 / 100 XP</div>
            </div>
            <!-- –ü–æ–ª–æ—Å–∫–∞ –æ–ø—ã—Ç–∞ -->
            <div class="ach-bar ach-bar-xp"><div class="ach-bar-fill xp-fill" id="xp-progress-fill" style="width:0%"></div></div>
          </div>
        </div>

        <div class="ach-backup-controls" id="ach-backup-controls">
          <button class="backup-btn" id="dash-save-btn" type="button">–°–û–•–†–ê–ù–ò–¢–¨ –ü–†–û–ì–†–ï–°–°</button>
        </div>
      </div>
      
    </header>

    <div id="now-playing" style="width:100%; max-width:395px; margin:8px auto 0 auto;"></div>
    <div class="track-list" id="track-list"></div>

    <div class="bottom-controls-center">
      <img class="logo-bottom" id="logo-bottom" src="img/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø"/>

      <button id="install-pwa-btn" style="display: none;">–£–°–¢–ê–ù–û–í–ò–¢–¨ –ö–ê–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–ï</button>
      <button class="hotkeys-btn" id="hotkeys-btn" style="display:none;">–ì–û–†–Ø–ß–ò–ï –ö–õ–ê–í–ò–®–ò</button>
      <button id="sysinfo-btn" style="display:none;">–û –°–ò–°–¢–ï–ú–ï</button>

      <span class="feedback-link" id="feedback-link">–û–ë–†–ê–¢–ù–ê–Ø –°–í–Ø–ó–¨</span>

      <a class="support-link" id="support-link" href="#" target="_blank">–ü–û–î–î–ï–†–ñ–ê–¢–¨</a>

      <button class="offline-btn" id="offline-btn">OFFLINE</button>
    </div>
  </div>

  <div id="modals-container"></div>

  <template id="mini-header-template">
    <div class="mini-now" id="mini-now">
      <span class="tnum" id="mini-now-num">--.</span>
      <span class="track-title" id="mini-now-title">‚Äî</span>
      <img src="img/star2.png" class="like-star" id="mini-now-star" alt="–∑–≤–µ–∑–¥–∞">
    </div>
  </template>

<template id="profile-template">
<div class="profile-wrap">
<div class="profile-header">
<div class="profile-avatar-btn" id="prof-avatar-btn" title="–ò–∑–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä"></div>
<div class="profile-name-wrap">
<input type="text" id="prof-name-inp" class="profile-name-input" maxlength="15" autocomplete="off" spellcheck="false">
<span class="profile-edit-icon" id="prof-name-edit">‚úèÔ∏è</span>
</div>
</div>
<div class="profile-auth-grid" id="prof-auth-grid"></div>
<div class="profile-tabs" id="prof-tabs">
<button class="profile-tab-btn active" data-tab="stats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
<button class="profile-tab-btn" data-tab="achievements">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
<button class="profile-tab-btn" data-tab="recs">–î–ª—è –í–∞—Å</button>
<button class="profile-tab-btn" data-tab="logs">–ñ—É—Ä–Ω–∞–ª</button>
</div>
<div class="profile-tab-content active" id="tab-stats">
<div class="stats-grid-compact">
<div class="stat-box"><b id="prof-stat-tracks">0</b><span>–¢—Ä–µ–∫–æ–≤</span></div>
<div class="stat-box"><b id="prof-stat-time">0–º</b><span>–í –ø—É—Ç–∏</span></div>
<div class="stat-box"><b id="prof-stat-streak">0</b><span>–°—Ç—Ä–∏–∫ (–¥–Ω–µ–π)</span></div>
<div class="stat-box"><b id="prof-stat-ach">0</b><span>–ê—á–∏–≤–æ–∫</span></div>
</div>
<div class="profile-section-title">üèÜ –¢–û–ü-5 –¢–†–ï–ö–û–í</div>
<div id="prof-top-tracks"></div>
</div>
<div class="profile-tab-content" id="tab-achievements">
<div class="ach-classic-tabs" id="ach-inner-tabs">
<div class="ach-classic-tab active" data-filter="all">–í—Å–µ</div>
<div class="ach-classic-tab" data-filter="available">–î–æ—Å—Ç—É–ø–Ω—ã–µ</div>
<div class="ach-classic-tab" data-filter="done">–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</div>
<div class="ach-classic-tab" data-filter="secret">–°–µ–∫—Ä–µ—Ç–Ω—ã–µ</div>
</div>
<div id="prof-ach-list"></div>
</div>
<div class="profile-tab-content" id="tab-recs">
<div class="profile-section-title">üí° –ú–´ –†–ï–ö–û–ú–ï–ù–î–£–ï–ú</div>
<div id="prof-recs-list"></div>
</div>
<div class="profile-tab-content" id="tab-logs">
<div class="profile-section-title">üìú –ò–°–¢–û–†–ò–Ø –ê–ö–¢–ò–í–ù–û–°–¢–ò</div>
<div id="prof-logs-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>
</div>
</template>

<template id="next-up-template">
    <div class="next-up" id="next-up">
      <span class="label">–î–∞–ª–µ–µ:</span>
      <span class="title" title="">‚Äî</span>
    </div>
  </template>

  <template id="player-template">
    <!-- (—Ä–∞–∑–º–µ—Ç–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) -->
    <div class="lyrics-player-block" id="lyricsplayerblock">
      <div id="lyrics-window" class="lyrics-normal">
        <div class="lyrics-animated-bg"></div>
        <div class="lyrics-scroll" id="lyrics">
          <div class="lyrics-placeholder lyrics-spinner"></div>
        </div>
      </div>

      <div class="player-progress-wrapper">
        <div class="player-progress-bar" id="player-progress-bar">
          <div class="player-progress-fill" id="player-progress-fill">
            <div class="player-progress-handle"></div>
          </div>
        </div>
      </div>

      <div class="player-controls">
        <div class="player-controls-row">
          <span class="time-in-controls" id="time-elapsed">00:00</span>

          <button class="player-control-btn" id="prev-btn" title="–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç—Ä–µ–∫ (P)">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M11 5L4 12l7 7V5zm9 0v14l-7-7 7-7z"/>
            </svg>
          </button>

          <button class="player-control-btn main" id="play-pause-btn" title="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ/–ü–∞—É–∑–∞ (K)">
            <svg id="play-pause-icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7z"/>
            </svg>
          </button>

          <button class="player-control-btn" id="stop-btn" title="–°—Ç–æ–ø (X)">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <rect x="6" y="6" width="12" height="12"/>
            </svg>
          </button>

          <button class="player-control-btn" id="next-btn" title="–°–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫ (N)">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M13 5l7 7-7 7V5zM4 5v14l7-7-7-7z"/>
            </svg>
          </button>

          <span class="time-in-controls" id="time-remaining">--:--</span>
        </div>

        <div class="player-controls-row">
          <button class="player-control-btn" id="pq-btn" title="–ö–∞—á–µ—Å—Ç–≤–æ (Hi/Lo)">
            <span class="pq-btn-label" id="pq-btn-label">Hi</span>
          </button>

          <button class="player-control-btn" id="mute-btn" title="–ë–µ–∑ –∑–≤—É–∫–∞ (M)">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
            </svg>
          </button>

          <button class="player-control-btn" id="shuffle-btn" title="–°–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ (U)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 17h2.735a4 4 0 003.43-1.942l3.67-6.116A4 4 0 0116.265 7H21m0 0l-3-3m3 3l-3 3"/>
              <path d="M3 7h2.735a4 4 0 013.43 1.942l3.67 6.116A4 4 0 0016.265 17H21m0 0l-3 3m3-3l-3-3"/>
            </svg>
          </button>

          <button class="player-control-btn" id="repeat-btn" title="–ü–æ–≤—Ç–æ—Ä —Ç—Ä–µ–∫–∞ (R)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 2l4 4-4 4"/>
              <path d="M3 11V9a4 4 0 014-4h14"/>
              <path d="M7 22l-4-4 4-4"/>
              <path d="M21 13v2a4 4 0 01-4 4H3"/>
              <circle cx="12" cy="12" r="1" fill="currentColor"/>
            </svg>
          </button>

          <button class="sleep-timer-btn" id="sleep-timer-btn" title="–¢–∞–π–º–µ—Ä —Å–Ω–∞ (T)">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2"></circle>
              <path d="M12 7v5l3 3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <span class="sleep-timer-badge" id="sleep-timer-badge" style="display:none;">0</span>
          </button>

          <button class="player-control-btn" id="favorites-btn" title="–¢–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ (F)">
            <img src="img/star2.png" alt="‚òÖ" id="favorites-btn-icon"/>
          </button>
        </div>
      </div>

      <div class="volume-control-wrapper">
        <div class="volume-track" id="volume-track">
          <div class="volume-fill" id="volume-fill"></div>
          <div class="volume-handle" id="volume-handle"></div>
        </div>
        <input type="range" class="volume-slider" id="volume-slider" min="0" max="100" value="100" aria-label="–ì—Ä–æ–º–∫–æ—Å—Ç—å">
      </div>

      <div class="player-buttons-wrapper">
        <div class="player-extra-buttons-row">
          <button class="lyrics-toggle-btn lyrics-normal" id="lyrics-toggle-btn" title="–†–µ–∂–∏–º –ª–∏—Ä–∏–∫–∏ (Y)">
            <span class="lyrics-toggle-btn-visual">–¢</span>
          </button>

          <button class="animation-btn" id="animation-btn" title="–ê–Ω–∏–º–∞—Ü–∏—è –ª–∏—Ä–∏–∫–∏ (A)">A</button>

          <button class="karaoke-btn" id="lyrics-text-btn" title="–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–µ—Å–Ω–∏">üìù</button>

          <button class="stats-btn" id="stats-btn" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" style="background:none; border:none; cursor:pointer; font-size:18px; opacity:0.8; padding:0 8px;">üìä</button>

          <button class="pulse-btn" id="pulse-btn" title="–ü—É–ª—å—Å–∞—Ü–∏—è –ª–æ–≥–æ—Ç–∏–ø–∞">
            <span id="pulse-heart">ü§ç</span>
          </button>

          <a class="player-download-btn" href="#" id="track-download-btn" download title="–°–∫–∞—á–∞—Ç—å —Ç—Ä–µ–∫">üíæ</a>
        </div>
      </div>
    </div>
  </template>

  <script>
    const VERSION = String(window.APP_CONFIG?.APP_VERSION || '8.0.5');
    const BUILD_DATE = String(window.APP_CONFIG?.BUILD_DATE || '2025-12-08');

    // Legacy globals removed ‚Äî SleepTimer uses playerCore.setSleepTimer

    window.VERSION = VERSION;
    window.BUILD_DATE = BUILD_DATE;

    console.log(`üéµ –í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞ v${VERSION} (${BUILD_DATE})`);
  </script>
</body>
</html>

//=================================================
// FILE: /manifest.json
{
  "name": "–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞",
  "short_name": "Vi3na1bita",
  "description": "–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∞–ª—å–±–æ–º—ã –≥—Ä—É–ø–ø—ã –í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞",
  "start_url": "./",
  "display": "standalone",
  "background_color": "#181818",
  "theme_color": "#181818",
  "orientation": "portrait-primary",
  "icons": [
    {
      "src": "icons/icon-192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "icons/icon-512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ],
  "categories": ["music", "entertainment"],
  "screenshots": []
}

//=================================================
// FILE: /news.html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ù–æ–≤–æ—Å—Ç–∏ ‚Äî –í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0b0e15;
      --panel: #131a26;
      --text: #eaf2ff;
      --muted: #9db7dd;
      --accent: #4daaff;
      --danger: #E80100;
      --border: #23324a;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 14px;
      background: var(--bg); color: var(--text);
      font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,sans-serif;
    }
    .container { max-width: 760px; margin: 0 auto; }
    h1 { margin: 6px 0 16px; font-size: 22px; }
    .news-list { display: grid; gap: 14px; }
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,.25);
    }
    .card h2 { margin: 0 0 8px; font-size: 18px; }
    .date { color: var(--muted); font-size: 13px; margin-bottom: 8px; }
    .media { margin: 10px 0; }
    .media iframe, .media img, .media video {
      width: 100%; border: 0; border-radius: 8px; min-height: 220px; background: #0b0e15;
    }
    .card p { margin: 8px 0; line-height: 1.45; }
    .tags { margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap; }
    .tag { font-size: 12px; color: var(--accent); background: rgba(77,170,255,.12); border: 1px solid rgba(77,170,255,.25); padding: 4px 8px; border-radius: 999px; }
    .error { color: var(--danger); background: rgba(232,1,0,.1); border: 1px solid rgba(232,1,0,.2); padding: 10px; border-radius: 8px; }
    .loading { color: var(--muted); }
    a { color: var(--accent); text-decoration: none; }
    a:hover { color: #fff; }
  </style>
</head>
<body>
  <div class="container">
    <h1>–ù–æ–≤–æ—Å—Ç–∏</h1>
    <div id="status" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div id="news" class="news-list"></div>
  </div>

  <script>
    async function loadNews() {
      const status = document.getElementById('status');
      const listEl = document.getElementById('news');
      try {
        const r = await fetch('./news/news.json', { cache: 'no-cache' });
        if (!r.ok) throw new Error('HTTP ' + r.status);
        const j = await r.json();
        const items = Array.isArray(j.items) ? j.items : [];
        status.style.display = 'none';
        if (!items.length) {
          status.style.display = '';
          status.textContent = '–ü–æ–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π –Ω–µ—Ç';
          return;
        }
        listEl.innerHTML = items.map(renderCard).join('');
      } catch (e) {
        status.className = 'error';
        status.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ—Å—Ç–∏';
      }
    }
    function esc(s) {
      // –µ–¥–∏–Ω—ã–π esc –±–µ–∑ –¥—É–±–ª–µ–π –≤ –ø—Ä–æ–µ–∫—Ç–µ (–∑–¥–µ—Å—å standalone, –ø–æ—ç—Ç–æ–º—É –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–æ–º–ø–∞–∫—Ç–Ω–æ)
      return String(s || '').replace(/[<>&'"]/g, (m) => ({
        '<': '&lt;', '>': '&gt;', '&': '&amp;', "'": '&#39;', '"': '&quot;'
      })[m]);
    }
    function renderCard(it) {
      const title = esc(it.title || '–ù–æ–≤–æ—Å—Ç—å');
      const date = esc(it.date || '');
      const text = esc(it.text || '');
      const tags = Array.isArray(it.tags) ? it.tags : [];
      let media = '';
      if (it.embedUrl) {
        media = `<div class="media"><iframe loading="lazy" src="${esc(it.embedUrl)}" allowfullscreen></iframe></div>`;
      } else if (it.image) {
        media = `<div class="media"><img loading="lazy" src="${esc(it.image)}" alt=""></div>`;
      } else if (it.video) {
        media = `<div class="media"><video controls preload="metadata" src="${esc(it.video)}"></video></div>`;
      }
      return `<article class="card">
        <h2>${title}</h2>
        ${date ? `<div class="date">${date}</div>` : ''}
        ${media}
        ${text ? `<p>${text}</p>` : ''}
        ${tags.length ? `<div class="tags">${tags.map(t=>`<span class="tag">#${esc(t)}</span>`).join('')}</div>` : ''}
      </article>`;
    }
    loadNews();
  </script>
</body>
</html>

//=================================================
// FILE: /service-worker.js
// service-worker.js
// Optimized Service Worker for "Vi3na1bita" (v8.1.8) - Spec Compliant

const SW_VERSION = '8.1.8';

// Cache Names (Required by lint-sw.mjs)
const CORE_CACHE = `vitrina-core-v${SW_VERSION}`;
const RUNTIME_CACHE = `vitrina-runtime-v${SW_VERSION}`;
const MEDIA_CACHE = `vitrina-media-v${SW_VERSION}`; // Reserved: audio cached via IndexedDB, not SW
const OFFLINE_CACHE = `vitrina-offline-v${SW_VERSION}`;
const META_CACHE = `vitrina-meta-v${SW_VERSION}`;

// Config (Required by lint-sw.mjs - do not remove)
const DEFAULT_SW_CONFIG = {
  mediaMaxCacheMB: 150,
  nonRangeMaxStoreMB: 25,
  nonRangeMaxStoreMBSlow: 10,
  allowUnknownSize: false,
  revalidateDays: 7
};

let isAirplaneMode = false;

const STATIC_ASSETS = [
  './', './index.html', './news.html', './manifest.json',
  './albums.json',
  './data/lyrics-index-v1.json',
  './styles/main.css', './img/logo.png', './img/star.png', './img/star2.png',
  './icons/favicon-32.png', './icons/favicon-16.png', './icons/apple-touch-icon.png',
  './scripts/core/bootstrap.js', './scripts/core/config.js', './scripts/core/utils.js',
  './scripts/core/favorites-manager.js',
  './scripts/app/gallery.js', './scripts/ui/notify.js',
  './scripts/ui/sleep-timer.js', './scripts/ui/lyrics-modal.js', './scripts/ui/sysinfo.js',
  './scripts/ui/modals.js',
  './scripts/ui/offline-modal.js', './scripts/ui/offline-indicators.js',
  './scripts/ui/cache-progress-overlay.js', './scripts/ui/statistics-modal.js',
  './scripts/app/player-ui.js', './scripts/app/albums.js',
  './scripts/app.js', './src/PlayerCore.js',
  './src/player-core/media-session.js',
  './scripts/app/track-registry.js',
  './scripts/core/favorites-manager.js',
  './scripts/app/offline-ui-bootstrap.js', './scripts/app/playback-cache-bootstrap.js'
];

const norm = (u) => { 
  try { 
    const p = new URL(u, self.registration.scope); 
    p.hash = ''; p.search = ''; 
    if (p.pathname.endsWith('/')) p.pathname += 'index.html'; 
    return p.href; 
  } catch { return String(u); } 
};
const STATIC_SET = new Set(STATIC_ASSETS.map(norm));

self.addEventListener('install', (e) => {
  e.waitUntil(
    caches.open(CORE_CACHE).then(async (c) => {
      await Promise.all(STATIC_ASSETS.map(u => 
        fetch(new Request(u)).then(r => { if (r.ok && !r.redirected) c.put(u, r); }).catch(()=>{})
      ));
      return self.skipWaiting();
    })
  );
});

self.addEventListener('activate', (e) => {
  e.waitUntil(
    caches.keys()
      .then(k => Promise.all(k.map(n => ![CORE_CACHE, RUNTIME_CACHE, MEDIA_CACHE, OFFLINE_CACHE, META_CACHE].includes(n) && caches.delete(n))))
      .then(() => self.clients.claim())
  );
});

self.addEventListener('fetch', (e) => {
  const req = e.request;
  if (req.method !== 'GET') return;
  const url = new URL(req.url);

  // Spec 5.2 & 5.3: Airplane mode fully blocks all network requests in SW layer too.
    if (/\.(mp3|ogg|m4a|flac)$/i.test(url.pathname)) {
      if (isAirplaneMode) e.respondWith(new Response(null, { status: 503, statusText: 'Airplane Mode Active' }));
      return;
    }

    if (isAirplaneMode) {
      e.respondWith(caches.match(req).then(c => c || new Response(null, { status: 503, statusText: 'Airplane Mode Active' })));
      return;
    }

  // Static core assets (Cache First)
  if (STATIC_SET.has(norm(url.href))) {
    e.respondWith(
      caches.open(CORE_CACHE).then(c => c.match(req)).then(r => r || fetch(req).then(n => {
        if(n.ok) caches.open(CORE_CACHE).then(cx => cx.put(req, n.clone()));
        return n;
      }))
    );
    return;
  }

  // Fallback (Network First -> Cache)
  e.respondWith(
    caches.match(req).then(cached => cached || fetch(req).then(r => {
      if (r.ok && url.protocol.startsWith('http')) {
        const cl = r.clone();
        caches.open(RUNTIME_CACHE).then(cx => cx.put(req, cl));
      }
      return r;
    }).catch(() => cached))
  );
});

self.addEventListener('message', (e) => {
  const d = e.data, p = e.ports[0];
  if (!d) return;

  if (d.type === 'SYNC_AIRPLANE_MODE') {
    isAirplaneMode = !!d.payload;
  } else if (d.type === 'GET_SW_VERSION' && p) {
    p.postMessage({ version: SW_VERSION });
  } else if (d.type === 'SKIP_WAITING') {
    self.skipWaiting();
  } else if (d.type === 'CLEAR_CACHE') {
    e.waitUntil(caches.keys().then(k => Promise.all(k.map(n => caches.delete(n)))));
  } else if (d.type === 'GET_CACHE_SIZE' && p) {
    e.waitUntil((async () => {
      let s = 0, n = 0;
      try {
        for (const k of await caches.keys()) {
          const c = await caches.open(k), reqs = await c.keys();
          n += reqs.length;
          for (const r of reqs) {
            const res = await c.match(r);
            if (res) s += parseInt(res.headers.get('content-length') || 0, 10);
          }
        }
      } catch {}
      p.postMessage({ size: s, entries: n, approx: true });
    })());
  }
});

//=================================================
// FILE: /scripts/analytics/achievement-engine.js
import { metaDB } from './meta-db.js';
import { eventLogger } from './event-logger.js';
import { AchievementDictionary } from './achievements-dict.js';

export class AchievementEngine {
  constructor() {
    this.dict = { ...AchievementDictionary };
    this.unlocked = {};
    this.profile = { xp: 0, level: 1 };
    this.achievements = [];
    this.lastAgg = {};
    
    this._initBoot();
    window.addEventListener('stats:updated', () => this.check());
  }

  async _initBoot() {
    const [unData, profData] = await Promise.all([
      metaDB.getGlobal('unlocked_achievements'),
      metaDB.getGlobal('user_profile_rpg')
    ]);
    
    this.unlocked = unData?.value || {};
    this.profile = profData?.value || { xp: 0, level: 1 };
    
    try {
      const res = await fetch('./data/custom_achievements.json', { cache: 'no-cache' });
      if (res.ok) Object.assign(this.dict, await res.json());
    } catch (e) {}

    // –ê–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –¥–ª—è –∞–ª—å–±–æ–º–æ–≤
    (window.albumsIndex || []).forEach(a => {
      if (!a.key.startsWith('__')) {
        this.dict[`album_complete_${a.key}`] = {
          id: `album_complete_${a.key}`, type: "static", category: "albums",
          ui: { name: `–ê–ª—å–±–æ–º ¬´${a.title}¬ª`, short: `–ü–æ—Å–ª—É—à–∞–π—Ç–µ –≤—Å–µ —Ç—Ä–µ–∫–∏ –∞–ª—å–±–æ–º–∞.`, desc: `–°–æ–±–µ—Ä–∏—Ç–µ –ø–æ–ª–Ω—ã–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Ç—Ä–µ–∫–æ–≤ —Ä–µ–ª–∏–∑–∞.`, howTo: `–ó–∞–π–¥–∏—Ç–µ –≤ –∞–ª—å–±–æ–º –∏ —Å–ª—É—à–∞–π—Ç–µ –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤.`, icon: "üíø", color: "#4caf50" },
          reward: { xp: 150, tier: 3 },
          trigger: { conditions: [{ metric: `album_${a.key}_complete`, operator: "gte", target: 1 }] }
        };
      }
    });

    this.achievements = this._buildUIArray();
    this.broadcast(0);
  }

  _evalCondition(cond, agg) {
    const val = agg[cond.metric] || 0;
    return cond.operator === 'gte' ? val >= cond.target : val === cond.target;
  }

  // –ï–¥–∏–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –¶–µ–ª–∏ –∏–ª–∏ XP –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö –∞—á–∏–≤–æ–∫
  _getSc(r, lvl, isXp) {
    if (isXp) return Math.floor(r.reward.xpBase * Math.pow(r.reward.xpMultiplier, lvl - 1));
    const s = r.scaling;
    return s.math === 'custom' ? (s.steps[lvl - 1] || s.steps[s.steps.length - 1]) : r.trigger.conditions[0].startTarget * Math.pow(s.factor, lvl - 1);
  }

  async check() {
    const statsArr = await metaDB.getAllStats();
    const globalStat = statsArr.find(s => s.uid === 'global')?.featuresUsed || {};
    const trackStats = statsArr.filter(s => s.uid !== 'global');
    const streak = (await metaDB.getGlobal('global_streak'))?.value?.current || 0;
    const favCount = window.FavoritesManager ? window.FavoritesManager.getSnapshot().filter(i => !i.inactiveAt).length : 0;

    // –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: O(N) –ø—Ä–æ—Ö–æ–¥ –≤–º–µ—Å—Ç–æ O(10*N). –û–¥–∏–Ω reduce –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ —Ç—Ä–µ–∫–æ–≤ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.
    const agg = trackStats.reduce((a, b) => {
      const f = b.featuresUsed || {};
      a.validPlays += b.globalValidListenCount || 0;
      a.fullPlays += b.globalFullListenCount || 0;
      a.totalSec += b.globalListenSeconds || 0;
      if (b.globalValidListenCount > 0) a.uniqueTracks++;
      a.maxOneTrackFull = Math.max(a.maxOneTrackFull, b.globalFullListenCount || 0);
      a.featLyrics += f.lyrics || 0;
      a.nightPlays += f.nightPlay || 0;
      a.earlyPlays += f.earlyPlay || 0;
      a.hiPlays += f.hiQuality || 0;
      a.shufflePlays += f.shufflePlay || 0;
      return a;
    }, {
      validPlays: 0, fullPlays: 0, totalSec: 0, uniqueTracks: 0, maxOneTrackFull: 0,
      featLyrics: 0, nightPlays: 0, earlyPlays: 0, hiPlays: 0, shufflePlays: 0,
      favCount, streak,
      play11_11: globalStat.play_11_11 || 0, weekendPlays: globalStat.weekend_play || 0,
      backups: globalStat.backup || 0, pwaInstalled: globalStat.pwa_installed || 0,
      sleepTimerTriggers: globalStat.sleep_timer || 0, socialVisits: globalStat.social_visit || 0,
      favOrderedCombo: globalStat.fav_ordered_5 || 0, favShuffleCombo: globalStat.fav_shuffle_5 || 0,
      midnightTriple: globalStat.midnight_triple || 0
    });

    // –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: O(1) –ø–æ–∏—Å–∫ –ø–æ Set (–≤–º–µ—Å—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ O(N^2) –ø–æ–∏—Å–∫–∞ .find() –≤–Ω—É—Ç—Ä–∏ .filter())
    if (window.TrackRegistry) {
      const allReg = window.TrackRegistry.getAllUids().map(u => window.TrackRegistry.getTrackByUid(u));
      const playedUids = new Set(trackStats.filter(s => s.globalFullListenCount > 0).map(s => s.uid));
      const albumsSet = new Set(allReg.map(t => t.sourceAlbum).filter(Boolean));
      
      albumsSet.forEach(aKey => {
        const aTracks = allReg.filter(t => t.sourceAlbum === aKey);
        const played = aTracks.filter(t => playedUids.has(t.uid));
        agg[`album_${aKey}_complete`] = (played.length >= aTracks.length && aTracks.length > 0) ? 1 : 0;
      });
    }

    let changed = false;
    let earnedXp = 0;
    const now = Date.now();

    for (const [key, rule] of Object.entries(this.dict)) {
      if (rule.seasonal && ((rule.seasonal.start && now < rule.seasonal.start) || (rule.seasonal.end && now > rule.seasonal.end) || (rule.seasonal.months && !rule.seasonal.months.includes(new Date().getMonth())))) continue;

      if (rule.type === 'static' && !this.unlocked[key]) {
        if (rule.trigger.conditions.every(c => this._evalCondition({ ...c, target: c.target }, agg))) {
          this.unlocked[key] = now; earnedXp += rule.reward.xp; changed = true;
          this._notifyUnlock(rule.ui.name, rule.ui.icon, rule.reward.xp);
        }
      } else if (rule.type === 'scalable') {
        let lvl = 1, safety = 50;
        while (this.unlocked[`${key}_${lvl}`]) lvl++;
        
        // –°—Ç—Ä–æ–≥–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ü–∏–∫–ª–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–π, —á—Ç–æ–±—ã –Ω–µ –ø–æ–≤–µ—Å–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä
        while (safety-- > 0 && (!rule.scaling.maxLevel || lvl <= rule.scaling.maxLevel) && (!rule.scaling.steps || lvl <= rule.scaling.steps.length)) {
          const tgt = this._getSc(rule, lvl, false);
          if (rule.trigger.conditions.every(c => this._evalCondition({ ...c, target: tgt }, agg))) {
            this.unlocked[`${key}_${lvl}`] = now;
            const xp = this._getSc(rule, lvl, true);
            earnedXp += xp; changed = true;
            this._notifyUnlock(rule.ui.name.replace('{level}', lvl), rule.ui.icon, xp);
            lvl++;
          } else break;
        }
      }
    }

    this.lastAgg = agg;
    if (changed) {
      this.profile.xp += earnedXp;
      const newLevel = Math.floor(Math.sqrt(this.profile.xp / 100)) + 1;
      if (newLevel > this.profile.level) {
        this.profile.level = newLevel;
        setTimeout(() => window.NotificationSystem?.success(`üéâ –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –í–∞—à —É—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω –¥–æ ${newLevel}!`), 2000);
      }
      await Promise.all([metaDB.setGlobal('unlocked_achievements', this.unlocked), metaDB.setGlobal('user_profile_rpg', this.profile)]);
      this.achievements = this._buildUIArray();
      this.broadcast(agg.streak);
    }
  }

  _buildUIArray() {
    const arr = [];
    const agg = this.lastAgg || {};
    
    // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –±–∏–ª–¥–µ—Ä (—Å–ø–∞—Å–∞–µ—Ç 40 —Å—Ç—Ä–æ–∫ –∫–æ–ø–∏–ø–∞—Å—Ç—ã)
    const add = (id, r, lvl, unl, uAt, cur, tgt) => {
      const t = r.formatters?.target_hours ? r.formatters.target_hours(tgt) : tgt;
      const c = r.formatters?.target_hours ? r.formatters.target_hours(cur) : cur;
      const isHid = !unl && r.hidden;
      
      arr.push({
        id,
        name: lvl ? r.ui.name.replace('{level}', lvl) : (isHid ? "–°–µ–∫—Ä–µ—Ç–Ω–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ" : r.ui.name),
        short: isHid ? "–û—Ç–∫—Ä–æ–µ—Ç—Å—è –ø—Ä–∏ –æ—Å–æ–±—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö" : r.ui.short.replace(/{target[a-z_]*}/g, t),
        desc: isHid ? "–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Å–µ–∫—Ä–µ—Ç." : r.ui.desc,
        howTo: isHid ? "–°–∫—Ä—ã—Ç–æ" : r.ui.howTo,
        icon: isHid ? "üîí" : r.ui.icon,
        color: isHid || (!unl && lvl) ? "#888888" : r.ui.color,
        isUnlocked: unl,
        isHidden: isHid,
        unlockedAt: uAt || null,
        xpReward: lvl ? this._getSc(r, lvl, true) : (r.reward.xp || 0),
        ...(!unl && !isHid && tgt && { progress: { current: c, target: t, pct: Math.min(100, Math.max(0, (c / t) * 100)) } })
      });
    };

    for (const [k, r] of Object.entries(this.dict)) {
      if (r.type === 'static') {
        add(k, r, null, !!this.unlocked[k], this.unlocked[k], agg[r.trigger.conditions[0].metric] || 0, r.trigger.conditions[0].target);
      } else if (r.type === 'scalable') {
        let lvl = 1;
        while (this.unlocked[`${k}_${lvl}`]) {
          add(`${k}_${lvl}`, r, lvl, true, this.unlocked[`${k}_${lvl}`], 0, this._getSc(r, lvl, false));
          lvl++;
        }
        if ((!r.scaling.maxLevel || lvl <= r.scaling.maxLevel) && (!r.scaling.steps || lvl <= r.scaling.steps.length)) {
          add(`${k}_${lvl}`, r, lvl, false, null, agg[r.trigger.conditions[0].metric] || 0, this._getSc(r, lvl, false));
        }
      }
    }
    
    return arr.sort((a, b) => a.isUnlocked === b.isUnlocked ? (b.unlockedAt || 0) - (a.unlockedAt || 0) : (a.isUnlocked ? -1 : 1));
  }

  _notifyUnlock(name, icon, xp) {
    eventLogger.log('ACHIEVEMENT_UNLOCK', null, { name, xp });
    window.NotificationSystem?.success(`üèÜ ${icon} –û—Ç–∫—Ä—ã—Ç–æ: ${name} (+${xp} XP)`);
  }

  broadcast(streak) {
    window.dispatchEvent(new CustomEvent('achievements:updated', { 
      detail: { 
        total: this.achievements.length, unlocked: Object.keys(this.unlocked).length, 
        items: this.unlocked, streak, profile: this.profile 
      } 
    }));
  }
}

//=================================================
// FILE: /scripts/analytics/achievements-dict.js
/**
 * scripts/analytics/achievements-dict.js
 * –ü–û–õ–ù–´–ô –°–õ–û–í–ê–†–¨: –ë–∞–∑–æ–≤—ã–µ (–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ) + –ö–æ–º–±–æ (—Å—Ç–∞—Ä—ã–µ) + –°–µ–∫—Ä–µ—Ç—ã
 */

export const AchievementDictionary = {
  // ==========================================
  // 1. –ú–ù–û–ì–û–£–†–û–í–ù–ï–í–´–ï (–ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å)
  // ==========================================
  "play_total": {
    id: "play_total", type: "scalable", category: "listening",
    ui: { name: "–í –ø–æ—Ç–æ–∫–µ —É—Ä. {level}", short: "–°–æ–±–µ—Ä–∏—Ç–µ {target} –≤–∞–ª–∏–¥–Ω—ã—Ö –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π.", desc: "–õ—é–±—ã–µ —Ç—Ä–µ–∫–∏ ‚Äî –≥–ª–∞–≤–Ω–æ–µ –≤–∞–ª–∏–¥–Ω–æ–µ –≤—Ä–µ–º—è.", howTo: "–°–ª—É—à–∞–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Shuffle. –ó–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è ‚â•13 —Å–µ–∫.", icon: "üéß", color: "#4daaff" },
    reward: { xpBase: 10, xpMultiplier: 1.5, tierBase: 1 },
    trigger: { conditions: [{ metric: "validPlays", operator: "gte" }] },
    scaling: { math: "custom", steps: [1, 25, 100, 500, 1000, 5000] }
  },
  "full_total": {
    id: "full_total", type: "scalable", category: "listening",
    ui: { name: "–í–µ—Ä–Ω–æ–µ —É—Ö–æ —É—Ä. {level}", short: "{target} –ø–æ–ª–Ω—ã—Ö –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π.", desc: "–ü–æ–ª–Ω–æ–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ ‚Äî –¥–æ –∫–æ–Ω—Ü–∞ –∏–ª–∏ ‚â•90%.", howTo: "–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é –∏ –¥–æ—Å–ª—É—à–∏–≤–∞–π—Ç–µ —Ç—Ä–µ–∫–∏.", icon: "üèÜ", color: "#ff9800" },
    reward: { xpBase: 15, xpMultiplier: 1.8, tierBase: 2 },
    trigger: { conditions: [{ metric: "fullPlays", operator: "gte" }] },
    scaling: { math: "custom", steps: [1, 10, 50, 100, 500, 1000] }
  },
  "time_total": {
    id: "time_total", type: "scalable", category: "time",
    ui: { name: "–•—Ä–∞–Ω–∏—Ç–µ–ª—å –≤—Ä–µ–º–µ–Ω–∏ —É—Ä. {level}", short: "–ù–∞–∫–æ–ø–∏—Ç–µ {target_hours} —á. –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è.", desc: "–°—É–º–º–∞—Ä–Ω–æ–µ –≤–∞–ª–∏–¥–Ω–æ–µ –≤—Ä–µ–º—è.", howTo: "–°–ª—É—à–∞–π—Ç–µ –º—É–∑—ã–∫—É, –≤—Ä–µ–º—è —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.", icon: "‚è≥", color: "#ffb74d" },
    reward: { xpBase: 25, xpMultiplier: 2.0, tierBase: 2 },
    trigger: { conditions: [{ metric: "totalSec", operator: "gte" }] },
    scaling: { math: "custom", steps: [3600, 18000, 36000, 86400, 360000] },
    formatters: { target_hours: val => Math.floor(val / 3600) || 1 }
  },
  "streak_base": {
    id: "streak_base", type: "scalable", category: "loyalty",
    ui: { name: "–ü—Ä–µ–¥–∞–Ω–Ω–æ—Å—Ç—å —É—Ä. {level}", short: "–°–ª—É—à–∞–π—Ç–µ –º—É–∑—ã–∫—É {target} –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥.", desc: "–•–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –≤ —Å—É—Ç–∫–∏.", howTo: "–û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.", icon: "‚ö°", color: "#ff9800" },
    reward: { xpBase: 30, xpMultiplier: 1.8, tierBase: 1 },
    trigger: { conditions: [{ metric: "streak", operator: "gte" }] },
    scaling: { math: "custom", steps: [3, 7, 14, 30, 100, 365] }
  },
  "unique_tracks": {
    id: "unique_tracks", type: "scalable", category: "collection",
    ui: { name: "–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä —É—Ä. {level}", short: "–ü–æ—Å–ª—É—à–∞–π—Ç–µ {target} —Ä–∞–∑–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤.", desc: "–ó–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω–æ–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ.", howTo: "–í–∫–ª—é—á–∞–π—Ç–µ —Ä–∞–∑–Ω—ã–µ —Ç—Ä–µ–∫–∏, –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—è—Å—å.", icon: "üíø", color: "#9c27b0" },
    reward: { xpBase: 20, xpMultiplier: 1.5, tierBase: 1 },
    trigger: { conditions: [{ metric: "uniqueTracks", operator: "gte" }] },
    scaling: { math: "custom", steps: [5, 10, 16, 50, 100] }
  },
  "fav_total": {
    id: "fav_total", type: "scalable", category: "collection",
    ui: { name: "–ú–æ–π –ø–ª–µ–π–ª–∏—Å—Ç —É—Ä. {level}", short: "–î–æ–±–∞–≤—å—Ç–µ {target} —Ç—Ä–µ–∫–æ–≤ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ.", desc: "–®–∏—Ä–æ–∫–∏–π –ø—É–ª –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ —á–µ–ª–ª–µ–Ω–¥–∂–∏.", howTo: "–ù–∞–∂–∏–º–∞–π—Ç–µ –Ω–∞ –∑–≤—ë–∑–¥–æ—á–∫—É —Å–ø—Ä–∞–≤–∞ –æ—Ç —Ç—Ä–µ–∫–∞.", icon: "‚≠ê", color: "#fdd835" },
    reward: { xpBase: 10, xpMultiplier: 1.4, tierBase: 1 },
    trigger: { conditions: [{ metric: "favCount", operator: "gte" }] },
    scaling: { math: "custom", steps: [3, 5, 8, 15, 50] }
  },
  "one_track_full": {
    id: "one_track_full", type: "scalable", category: "listening",
    ui: { name: "–ê–±—Å–æ–ª—é—Ç–Ω—ã–π —Ñ–∞–≤–æ—Ä–∏—Ç —É—Ä. {level}", short: "–û–¥–∏–Ω —Ç—Ä–µ–∫ {target} —Ä–∞–∑ –ø–æ–ª–Ω–æ—Å—Ç—å—é.", desc: "–ü–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç —Å—É–ø–µ—Ä-–ª—é–±–∏–º–æ–≥–æ.", howTo: "–í—ã–±–µ—Ä–∏—Ç–µ –ª—é–±–∏–º—ã–π —Ç—Ä–µ–∫ –∏ –≤–∫–ª—é—á–∞–π—Ç–µ –µ–≥–æ –Ω–∞ —Ä–µ–ø–∏—Ç–µ.", icon: "‚ù§Ô∏è", color: "#e91e63" },
    reward: { xpBase: 50, xpMultiplier: 2.0, tierBase: 3 },
    trigger: { conditions: [{ metric: "maxOneTrackFull", operator: "gte" }] },
    scaling: { math: "custom", steps: [10, 25, 100, 500] }
  },
  "sleep_timer": {
    id: "sleep_timer", type: "scalable", category: "features",
    ui: { name: "–ë–µ—Ä–µ–∂–Ω—ã–π —Å–æ–Ω —É—Ä. {level}", short: "–¢–∞–π–º–µ—Ä —Å–Ω–∞ —Å—Ä–∞–±–æ—Ç–∞–ª {target} —Ä–∞–∑.", desc: "–£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.", howTo: "–ó–∞–¥–∞–π—Ç–µ —Ç–∞–π–º–µ—Ä –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.", icon: "üò¥", color: "#607d8b" },
    reward: { xpBase: 20, xpMultiplier: 1.5, tierBase: 1 },
    trigger: { conditions: [{ metric: "sleepTimerTriggers", operator: "gte" }] },
    scaling: { math: "custom", steps: [1, 5, 10, 50] }
  },
  
  // ==========================================
  // 2. –°–¢–ê–¢–ò–ß–ù–´–ï: –í–†–ï–ú–Ø –ò –§–ò–ß–ò
  // ==========================================
  "quality_snob": {
    id: "quality_snob", type: "static", category: "features",
    ui: { name: "–ö–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞", short: "10 –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ Hi.", desc: "–¢–æ–ª—å–∫–æ –¥–ª—è —Ü–µ–Ω–∏—Ç–µ–ª–µ–π –∫—Ä–∏—Å—Ç–∞–ª—å–Ω–æ–≥–æ –∑–≤—É–∫–∞.", howTo: "–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –≤ –ø–æ–ª–æ–∂–µ–Ω–∏–∏ Hi.", icon: "üíé", color: "#4fc3f7" },
    reward: { xp: 30, tier: 2 },
    trigger: { conditions: [{ metric: "hiPlays", operator: "gte", target: 10 }] }
  },
  "early_bird": {
    id: "early_bird", type: "static", category: "time",
    ui: { name: "–†–∞–Ω–Ω—è—è –ø—Ç–∞—à–∫–∞", short: "–°–ª—É—à–∞–π—Ç–µ —É—Ç—Ä–æ–º (10 —Ä–∞–∑).", desc: "–û–∫–Ω–æ 05:00‚Äì08:00 (–ø–æ –≤–∞—à–µ–º—É –≤—Ä–µ–º–µ–Ω–∏).", howTo: "–ó–∞–ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ —É—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ.", icon: "üåÖ", color: "#ffd54f" },
    reward: { xp: 50, tier: 2 },
    trigger: { conditions: [{ metric: "earlyPlays", operator: "gte", target: 10 }] }
  },
  "night_owl": {
    id: "night_owl", type: "static", category: "time",
    ui: { name: "–ù–æ—á–Ω–æ–π —Å–ª—É—à–∞—Ç–µ–ª—å", short: "–°–ª—É—à–∞–π—Ç–µ –Ω–æ—á—å—é (10 —Ä–∞–∑).", desc: "–û–∫–Ω–æ 02:00‚Äì04:30.", howTo: "–í–∫–ª—é—á–∏—Ç–µ —Ç—Ä–µ–∫ –ø–æ–∑–¥–Ω–æ –Ω–æ—á—å—é.", icon: "ü¶â", color: "#b388ff" },
    reward: { xp: 50, tier: 2 },
    trigger: { conditions: [{ metric: "nightPlays", operator: "gte", target: 10 }] }
  },
  "weekend_warrior": {
    id: "weekend_warrior", type: "static", category: "time",
    ui: { name: "–í—ã—Ö–æ–¥–Ω—ã–µ —Å –º—É–∑—ã–∫–æ–π", short: "10 –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ.", desc: "–î–æ–±–∏—Ç—å—Å—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –°–± –∏–ª–∏ –í—Å.", howTo: "–°–ª—É—à–∞–π—Ç–µ –º—É–∑—ã–∫—É –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö.", icon: "üéâ", color: "#ff5252" },
    reward: { xp: 100, tier: 3 },
    trigger: { conditions: [{ metric: "weekendPlays", operator: "gte", target: 10 }] }
  },
  "socials_all_visited": {
    id: "socials_all_visited", type: "static", category: "features",
    ui: { name: "–ü–æ–¥–ø–∏—Å—á–∏–∫ –≤—Å–µ–≥–æ", short: "–û—Ç–∫—Ä–æ–π—Ç–µ –≤—Å–µ —Å–æ—Ü—Å–µ—Ç–∏ –∏–∑ —à–∞–ø–∫–∏.", desc: "–ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –∫–∞–∂–¥–æ–π –∏–∑ —Å—Å—ã–ª–æ–∫.", howTo: "–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –≤—Å–µ–º —Å—Å—ã–ª–∫–∞–º —Å–æ—Ü—Å–µ—Ç–µ–π.", icon: "üåê", color: "#03a9f4" },
    reward: { xp: 50, tier: 1 },
    trigger: { conditions: [{ metric: "socialVisits", operator: "gte", target: 1 }] }
  },
  "pwa_installed": {
    id: "pwa_installed", type: "static", category: "features",
    ui: { name: "–ù–∞ –º–æ—ë–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ", short: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞–∫ PWA.", desc: "–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ —Å–æ–±—ã—Ç–∏–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏.", howTo: "–ù–∞–∂–º–∏—Ç–µ '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ'.", icon: "üì±", color: "#4caf50" },
    reward: { xp: 200, tier: 4 },
    trigger: { conditions: [{ metric: "pwaInstalled", operator: "gte", target: 1 }] }
  },
  "backup_saves": {
    id: "backup_saves", type: "scalable", category: "features",
    ui: { name: "–ë–µ—Ä–µ–∂—ë–Ω–æ–≥–æ –±–µ—Ä–µ–∂—ë—Ç —É—Ä. {level}", short: "–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –±—ç–∫–∞–ø {target} —Ä–∞–∑.", desc: "–ó–∞—â–∏—Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.", howTo: "–û—Ç–∫—Ä–æ–π—Ç–µ '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π' –∏ —Å–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª.", icon: "üíΩ", color: "#00bcd4" },
    reward: { xpBase: 20, xpMultiplier: 1.5, tierBase: 1 },
    trigger: { conditions: [{ metric: "backups", operator: "gte" }] },
    scaling: { math: "custom", steps: [1, 3, 10] }
  },
  "feature_lyrics": {
    id: "feature_lyrics", type: "static", category: "features",
    ui: { name: "–ö–∞—Ä–∞–æ–∫–µ –º–∞—Å—Ç–µ—Ä", short: "–í–∫–ª—é—á–∏—Ç—å –ª–∏—Ä–∏–∫—É –≤–ø–µ—Ä–≤—ã–µ.", desc: "–¢–µ–∫—Å—Ç –ø–µ—Å–µ–Ω –≤–æ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è.", howTo: "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É '–¢' –≤ –ø–ª–µ–µ—Ä–µ.", icon: "üé§", color: "#4db6ac" },
    reward: { xp: 15, tier: 1 },
    trigger: { conditions: [{ metric: "featLyrics", operator: "gte", target: 1 }] }
  },

  // ==========================================
  // 3. –•–ê–†–î–ö–û–†–ù–´–ï –ö–û–ú–ë–û (–ò–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
  // ==========================================
  "use_shuffle_5": {
    id: "use_shuffle_5", type: "static", category: "listening",
    ui: { name: "–í —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ", short: "5 –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π –≤ —Ä–µ–∂–∏–º–µ Shuffle.", desc: "–°–ª—É—à–∞–π—Ç–µ —Å –≤–∫–ª—é—á—ë–Ω–Ω—ã–º —Å–ª—É—á–∞–π–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º.", howTo: "–í–∫–ª—é—á–∏—Ç–µ Shuffle –∏ —Å–ª—É—à–∞–π—Ç–µ.", icon: "üîÄ", color: "#ff9800" },
    reward: { xp: 50, tier: 2 },
    trigger: { conditions: [{ metric: "shufflePlays", operator: "gte", target: 5 }] }
  },
  "favorites_order_5_full": {
    id: "favorites_order_5_full", type: "static", category: "listening",
    ui: { name: "–¢–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ ‚Äî –ø–æ –ø–æ—Ä—è–¥–∫—É", short: "5 –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–¥—Ä—è–¥, –ø–æ–ª–Ω–æ—Å—Ç—å—é.", desc: "–†–µ–∂–∏–º ¬´—Ç–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ¬ª, –±–µ–∑ Shuffle.", howTo: "–í–∫–ª—é—á–∏—Ç–µ ¬´—Ç–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ¬ª (–±–µ–∑ Shuffle) –∏ —Å–ª—É—à–∞–π—Ç–µ 5 —Ç—Ä–µ–∫–æ–≤.", icon: "‚≠ê", color: "#ff5252" },
    reward: { xp: 200, tier: 3 },
    trigger: { conditions: [{ metric: "favOrderedCombo", operator: "gte", target: 5 }] }
  },
  "favorites_shuffle_5_full": {
    id: "favorites_shuffle_5_full", type: "static", category: "listening",
    ui: { name: "–¢–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ ‚Äî –≤–ø–µ—Ä–µ–º–µ—à–∫—É", short: "5 –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ Shuffle.", desc: "–†–µ–∂–∏–º ¬´—Ç–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ¬ª + Shuffle.", howTo: "–í–∫–ª—é—á–∏—Ç–µ ¬´—Ç–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ¬ª –∏ Shuffle. –°–ª—É—à–∞–π—Ç–µ 5 —Ä–∞–∑–Ω—ã—Ö.", icon: "üåÄ", color: "#fdd835" },
    reward: { xp: 200, tier: 3 },
    trigger: { conditions: [{ metric: "favShuffleCombo", operator: "gte", target: 5 }] }
  },

  // ==========================================
  // 4. –°–ï–ö–†–ï–¢–ù–´–ï (Secrets)
  // ==========================================
  "exact_time_11_11": {
    id: "exact_time_11_11", type: "static", category: "secret", hidden: true,
    ui: { name: "11:11", short: "–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ 11:11.", desc: "–°–µ–∫—Ä–µ—Ç–Ω–∞—è –æ—Ç—Å—ã–ª–∫–∞.", howTo: "–í–∫–ª—é—á–∏—Ç–µ —Ç—Ä–µ–∫ —Ä–æ–≤–Ω–æ –≤ 11:11.", icon: "üëÅÔ∏è", color: "#e80100" },
    reward: { xp: 300, tier: 6 },
    trigger: { conditions: [{ metric: "play11_11", operator: "gte", target: 1 }] }
  },
  "midnight_triple": {
    id: "midnight_triple", type: "static", category: "secret", hidden: true,
    ui: { name: "–ü–æ–ª–Ω–æ—á–Ω—ã–π —Ü–∏–∫–ª", short: "–û–¥–∏–Ω —Ç—Ä–µ–∫ 3 —Ä–∞–∑–∞ –ø–æ–¥—Ä—è–¥ –≤ 00:00‚Äì00:30.", desc: "–°–ª–æ–∂–Ω—ã–π –Ω–æ—á–Ω–æ–π —á–µ–ª–ª–µ–Ω–¥–∂.", howTo: "–ó–∞–ø—É—Å–∫–∞–π—Ç–µ –æ–¥–∏–Ω —Ç—Ä–µ–∫ 3 —Ä–∞–∑–∞ –¥–æ –∫–æ–Ω—Ü–∞ –≤ –ø–æ–ª–Ω–æ—á—å.", icon: "ü¶á", color: "#8a2be2" },
    reward: { xp: 400, tier: 6 },
    trigger: { conditions: [{ metric: "midnightTriple", operator: "gte", target: 1 }] }
  },
  "speed_runner": {
    id: "speed_runner", type: "static", category: "secret", hidden: true,
    ui: { name: "–°–ø–∏–¥—Ä–∞–Ω–Ω–µ—Ä", short: "–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å 3 —á–∞—Å–∞ –±–µ–∑ –ø–µ—Ä–µ—Ä—ã–≤–∞.", desc: "–°–ª—É—à–∞–π—Ç–µ –º—É–∑—ã–∫—É –¥–æ–ª–≥–æ –∏ —É–ø–æ—Ä–Ω–æ.", howTo: "–ù–µ –≤—ã–∫–ª—é—á–∞–π—Ç–µ –º—É–∑—ã–∫—É 3 —á–∞—Å–∞ –ø–æ–¥—Ä—è–¥.", icon: "üèÉ", color: "#ff5722" },
    reward: { xp: 300, tier: 6 },
    trigger: { conditions: [{ metric: "speedRunnerCombo", operator: "gte", target: 1 }] }
  }
};

//=================================================
// FILE: /scripts/analytics/backup-vault.js
import { metaDB } from './meta-db.js';

export class BackupVault {
  static async buildBackupObject() {
    const stats = await metaDB.getAllStats();
    const warm = await metaDB.getEvents('events_warm');
    const achievements = await metaDB.getGlobal('unlocked_achievements');
    const streaks = await metaDB.getGlobal('global_streak');

    return {
      version: "4.0", timestamp: Date.now(), deviceHash: localStorage.getItem('deviceHash'),
      data: { stats, eventLog: { warm }, achievements: achievements?.value || {}, streaks: streaks?.value || {} }
    };
  }

  static async exportData() {
    const data = await this.buildBackupObject();
    const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; 
    a.download = `vi3na1bita_backup_${new Date().toISOString().split('T')[0]}.vi3bak`; 
    a.click(); URL.revokeObjectURL(url);
    
    if (window.eventLogger) {
      window.eventLogger.log('FEATURE_USED', 'global', { feature: 'backup' });
      window.dispatchEvent(new CustomEvent('analytics:forceFlush'));
    }
  }

  static async importData(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = async (e) => {
        try {
          const backup = JSON.parse(e.target.result);
          if (!backup.data || !backup.data.eventLog) throw new Error("Invalid format v4.0 required");
          
          // –¢–ó 8.1: –°–ª–∏—è–Ω–∏–µ –∂—É—Ä–Ω–∞–ª–æ–≤ (Merge Logs)
          const localWarm = await metaDB.getEvents('events_warm');
          const cloudWarm = backup.data.eventLog.warm || [];
          const seen = new Set();
          const merged = [...localWarm, ...cloudWarm].filter(ev => {
            if (seen.has(ev.eventId)) return false;
            seen.add(ev.eventId); return true;
          }).sort((a, b) => a.timestamp - b.timestamp);

          await metaDB.clearEvents('events_warm');
          await metaDB.addEvents(merged, 'events_warm');
          
          // –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç Stats –∏–∑ –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–æ–≥–æ –∂—É—Ä–Ω–∞–ª–∞ –∑–¥–µ—Å—å (—É–ø—Ä–æ—â–µ–Ω–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º)
          for (const s of backup.data.stats) await metaDB.tx('stats', 'readwrite', st => st.put(s));
          if (backup.data.achievements) await metaDB.setGlobal('unlocked_achievements', backup.data.achievements);
          if (backup.data.streaks) await metaDB.setGlobal('global_streak', backup.data.streaks);
          
          window.dispatchEvent(new CustomEvent('stats:updated'));
          resolve(true);
        } catch (err) { reject(err); }
      };
      reader.readAsText(file);
    });
  }
}

//=================================================
// FILE: /scripts/analytics/cloud-sync.js
import { BackupVault } from './backup-vault.js';
import { eventLogger } from './event-logger.js';

export class CloudSyncManager {
  constructor() {
    this.providers = { 
      yandex: { clientId: 'YOUR_YANDEX_CLIENT_ID', authUrl: 'https://oauth.yandex.ru/authorize', name: '–Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫' },
      google: { clientId: 'YOUR_GOOGLE_CLIENT_ID', authUrl: 'https://accounts.google.com/o/oauth2/v2/auth', name: 'Google Drive' },
      vk: { clientId: 'YOUR_VK_CLIENT_ID', authUrl: 'https://oauth.vk.com/authorize', name: 'VK ID' }
    };
    this.tokens = JSON.parse(localStorage.getItem('cloud_tokens') || '{}');
  }

  auth(provider) {
    const p = this.providers[provider];
    if (!p || p.clientId === 'YOUR_YANDEX_CLIENT_ID') return window.NotificationSystem?.warning('–ù–∞—Å—Ç—Ä–æ–π—Ç–µ ClientID –æ–±–ª–∞–∫–∞');
    window.location.href = `${p.authUrl}?response_type=token&client_id=${p.clientId}&redirect_uri=${encodeURIComponent(window.location.origin + window.location.pathname)}`;
  }

  checkAuthCallback() {
    const hash = window.location.hash.substring(1);
    const token = new URLSearchParams(hash).get('access_token');
    if (token) {
      this.tokens.yandex = token; localStorage.setItem('cloud_tokens', JSON.stringify(this.tokens));
      window.history.replaceState(null, '', window.location.pathname);
      window.NotificationSystem?.success(`–û–±–ª–∞–∫–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ!`);
    }
  }

  async sync(provider) {
    if (!window.NetPolicy?.isNetworkAllowed()) return window.NotificationSystem?.error('–°–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
    window.NotificationSystem?.info('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –æ–±–ª–∞–∫–æ–º...');
    try {
      const data = await BackupVault.buildBackupObject();
      const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
      
      const getUrlRes = await fetch('https://cloud-api.yandex.net/v1/disk/resources/upload?path=app:/vi3na1bita_sync.vi3bak&overwrite=true', { headers: { 'Authorization': `OAuth ${this.tokens.yandex}` } });
      if (!getUrlRes.ok) throw { status: getUrlRes.status };
      await fetch((await getUrlRes.json()).href, { method: 'PUT', body: blob });
      
      window.NotificationSystem?.success('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
      eventLogger.log('CLOUD_SYNC_SUCCESS', null, { provider });
    } catch (e) { window.NotificationSystem?.error('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏'); }
  }
}
export const cloudSync = new CloudSyncManager();

//=================================================
// FILE: /scripts/analytics/event-logger.js
import { metaDB } from './meta-db.js';

class EventLogger {
  constructor() {
    this.queue = [];
    this.deviceHash = localStorage.getItem('deviceHash') || crypto.randomUUID();
    this.sessionId = crypto.randomUUID();
    localStorage.setItem('deviceHash', this.deviceHash);
  }

  async init() {
    await metaDB.init();
    window.addEventListener('visibilitychange', () => document.hidden && this.flush());
    window.addEventListener('beforeunload', () => this.flush());
    window.addEventListener('analytics:forceFlush', () => this.flush()); // –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Å–±—Ä–æ—Å –ø—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ —Ç—Ä–µ–∫–∞ –¥–ª—è –≤—ã–¥–∞—á–∏ –∞—á–∏–≤–æ–∫
    setInterval(() => this.flush(), 15000); // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω–æ–≤—ã–π —Å–±—Ä–æ—Å
  }

  log(type, uid, data = {}) {
    this.queue.push({
      eventId: crypto.randomUUID(),
      sessionId: this.sessionId,
      deviceHash: this.deviceHash,
      platform: window.Utils?.getPlatform()?.isIOS ? 'ios' : 'web',
      type, uid, timestamp: Date.now(), data
    });
    if (this.queue.length > 20) this.flush();
  }

  async flush() {
    if (!this.queue.length) return;
    const batch = [...this.queue];
    this.queue = [];
    try {
      await metaDB.addEvents(batch, 'events_hot');
      window.dispatchEvent(new CustomEvent('analytics:logUpdated'));
    } catch (e) {
      this.queue = [...batch, ...this.queue]; // –í–æ–∑–≤—Ä–∞—Ç –≤ –æ—á–µ—Ä–µ–¥—å –ø—Ä–∏ –æ—à–∏–±–∫–µ
    }
  }
}
export const eventLogger = new EventLogger();

//=================================================
// FILE: /scripts/analytics/meta-db.js
export class MetaDB {
  constructor() { 
    this.dbName = 'MetaDB_v4'; 
    this.version = 1; 
    this.db = null; 
  }
  
  async init() {
    if (this.db) return;
    
    return new Promise((resolve, reject) => {
      if (!window.indexedDB) {
        console.error("IndexedDB –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º");
        return reject('IndexedDB is not supported');
      }

      const req = indexedDB.open(this.dbName, this.version);

      req.onupgradeneeded = (e) => {
        const db = e.target.result;
        if (!db.objectStoreNames.contains('events_hot')) db.createObjectStore('events_hot', { keyPath: 'eventId' });
        if (!db.objectStoreNames.contains('events_warm')) db.createObjectStore('events_warm', { keyPath: 'eventId' });
        if (!db.objectStoreNames.contains('stats')) db.createObjectStore('stats', { keyPath: 'uid' });
        if (!db.objectStoreNames.contains('global')) db.createObjectStore('global', { keyPath: 'key' });
      };

      // –ü—É–ª–µ–Ω–µ–ø—Ä–æ–±–∏–≤–∞–µ–º—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: –±–µ—Ä–µ–º result –Ω–∞–ø—Ä—è–º—É—é –∏–∑ req, –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è event.target
      req.onsuccess = () => { 
        this.db = req.result; 
        resolve(); 
      };

      req.onerror = () => { 
        console.error("MetaDB Error:", req.error);
        reject(req.error); 
      };
    });
  }

  async tx(storeName, mode, op) {
    if (!this.db) await this.init();
    return new Promise((res, rej) => {
      try {
        const transaction = this.db.transaction(storeName, mode);
        const request = op(transaction.objectStore(storeName));
        request.onsuccess = () => res(request.result);
        request.onerror = () => rej(request.error);
      } catch (e) {
        rej(e);
      }
    });
  }

  async addEvents(events, store = 'events_hot') {
    if (!this.db) await this.init();
    return new Promise((res, rej) => {
      try {
        const t = this.db.transaction(store, 'readwrite');
        const s = t.objectStore(store);
        events.forEach(ev => s.put(ev));
        t.oncomplete = () => res(true);
        t.onerror = () => rej(t.error);
      } catch (e) {
        rej(e);
      }
    });
  }

  async getEvents(store = 'events_hot') { return this.tx(store, 'readonly', s => s.getAll()); }
  async clearEvents(store = 'events_hot') { return this.tx(store, 'readwrite', s => s.clear()); }
  
  async updateStat(uid, mutatorFn) {
    return this.tx('stats', 'readwrite', store => {
      const req = store.get(uid);
      req.onsuccess = () => {
        const data = req.result || { 
          uid, globalListenSeconds: 0, globalValidListenCount: 0, globalFullListenCount: 0, 
          firstPlayedAt: Date.now(), lastPlayedAt: Date.now(), featuresUsed: {} 
        };
        store.put(mutatorFn(data));
      };
      return req;
    });
  }
  
  async getStat(uid) { return this.tx('stats', 'readonly', s => s.get(uid)); }
  async getAllStats() { return this.tx('stats', 'readonly', s => s.getAll()); }
  async getGlobal(key) { return this.tx('global', 'readonly', s => s.get(key)); }
  async setGlobal(key, value) { return this.tx('global', 'readwrite', s => s.put({ key, value })); }
}

export const metaDB = new MetaDB();

//=================================================
// FILE: /scripts/analytics/session-tracker.js
import { eventLogger } from './event-logger.js';

export class SessionTracker {
  constructor() {
    this.s = null;
    this._bindEvents();
  }

  _bindEvents() {
    window.addEventListener('player:play', e => this._start(e.detail));
    window.addEventListener('player:pause', () => this._pause());
    window.addEventListener('player:tick', e => this._tick(e.detail));
    window.addEventListener('player:ended', () => this._end(true));
    window.addEventListener('player:stop', () => this._end(false));
    window.addEventListener('player:trackChanged', () => this._end(false));
  }

  _start({ uid, duration, type = 'audio' }) {
    if (this.s && this.s.uid === uid && this.s.variant === type) {
      this.s.lastUpdate = Date.now(); return;
    }
    this._end(false);
    this.s = { 
      uid, variant: type, quality: window.playerCore?.qMode || 'hi',
      duration: duration || 0, accumulatedMs: 0, lastPos: 0, lastUpdate: Date.now() 
    };
    
    // –°–∫—Ä—ã—Ç—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è Rule Engine
    const d = new Date();
    if (d.getHours() === 11 && d.getMinutes() === 11) {
      eventLogger.log('FEATURE_USED', 'global', { feature: 'play_11_11' });
    }
    if (d.getDay() === 0 || d.getDay() === 6) {
      eventLogger.log('FEATURE_USED', 'global', { feature: 'weekend_play' });
    }

    eventLogger.log('LISTEN_START', uid, { variant: type });
  }

  _tick({ currentTime, volume, muted }) {
    if (!this.s) return;
    const now = Date.now();
    const deltaMs = now - this.s.lastUpdate;
    const posDelta = Math.abs(currentTime - this.s.lastPos);
    
    this.s.lastUpdate = now;
    this.s.lastPos = currentTime;
    
    // –°—á–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–≤—É—á–∞–Ω–∏–µ (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–º–æ—Ç–∫–∏/–ø–∞—É–∑—ã)
    if (deltaMs > 0 && deltaMs < 2000 && posDelta < 1.5 && volume > 0 && !muted) {
      this.s.accumulatedMs += deltaMs;
    }
    
    if (this.s.duration <= 0) this.s.duration = window.playerCore?.getDuration() || 0;
  }

  _pause() { if (this.s) this.s.lastUpdate = Date.now(); }

  _end(isEndedEvent) {
    if (!this.s) return;
    const { uid, variant, quality, accumulatedMs, duration, lastPos } = this.s;
    this.s = null;

    if (duration <= 0 && !isEndedEvent) return;

    const seconds = Math.floor(accumulatedMs / 1000);
    const progress = duration > 0 ? (lastPos / duration) : 0;
    
    // –¢–ó: Valid = 13 —Å–µ–∫ –ò–õ–ò –¥–æ–∏–≥—Ä–∞–ª –¥–æ –∫–æ–Ω—Ü–∞. Full = 90% –ò–õ–ò –¥–æ–∏–≥—Ä–∞–ª –¥–æ –∫–æ–Ω—Ü–∞.
    const isValid = seconds >= 13 || isEndedEvent;
    const isFull = progress >= 0.9 || isEndedEvent;

    if (isValid || isFull) {
      eventLogger.log('LISTEN_COMPLETE', uid, {
        variant, quality, listenedSeconds: seconds, trackDuration: duration, 
        progress, isFullListen: isFull, isValidListen: isValid
      });
    } else {
      eventLogger.log('LISTEN_SKIP', uid, { listenedSeconds: seconds });
    }
  }
}

//=================================================
// FILE: /scripts/analytics/share-generator.js
export class ShareGenerator {
  static async generateAndShare(type, track, stats = {}) {
    if (!window.NotificationSystem) return;
    window.NotificationSystem.info('–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏...');

    try {
      const canvas = document.createElement('canvas');
      canvas.width = 1080; canvas.height = 1080;
      const ctx = canvas.getContext('2d');

      // –§–æ–Ω
      const grad = ctx.createLinearGradient(0, 0, 0, 1080);
      grad.addColorStop(0, '#131a26'); grad.addColorStop(1, '#0b0e15');
      ctx.fillStyle = grad; ctx.fillRect(0, 0, 1080, 1080);

      // –û–±–ª–æ–∂–∫–∞ —Ç—Ä–µ–∫–∞
      const img = new Image(); img.crossOrigin = 'Anonymous';
      await new Promise((res, rej) => { img.onload = res; img.onerror = rej; img.src = track?.cover || 'img/logo.png'; });
      ctx.shadowColor = 'rgba(0,0,0,0.8)'; ctx.shadowBlur = 40;
      ctx.drawImage(img, 140, 150, 800, 800);
      ctx.shadowBlur = 0;

      // –¢–µ–∫—Å—Ç
      ctx.fillStyle = '#ffffff'; ctx.font = 'bold 70px sans-serif'; ctx.textAlign = 'center';
      ctx.fillText(type === 'achievement' ? 'üèÜ –î–û–°–¢–ò–ñ–ï–ù–ò–ï –ü–û–õ–£–ß–ï–ù–û' : (track?.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'), 540, 100);
      
      ctx.fillStyle = '#8ab8fd'; ctx.font = '50px sans-serif';
      ctx.fillText(track?.artist || '–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞', 540, 990);

      canvas.toBlob(async (blob) => {
        const file = new File([blob], 'share.png', { type: 'image/png' });
        if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
           await navigator.share({ title: '–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞', files: [file] });
        } else {
           const url = URL.createObjectURL(blob);
           const a = document.createElement('a'); a.href = url; a.download = `VR_Share.png`; a.click();
           window.NotificationSystem.success('–ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
        }
      }, 'image/png', 0.9);
    } catch (e) {
      window.NotificationSystem.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏');
    }
  }
}

//=================================================
// FILE: /scripts/analytics/stats-aggregator.js
import { metaDB } from './meta-db.js';

export class StatsAggregator {
  constructor() {
    this.lastFullListens = new Map(); // Anti-tamper & Rate Limiting (in-memory)
    this.session = {
      favOrderedRun: 0,
      favShuffleEvents: new Set(),
      midnightTripleTrack: null,
      midnightTripleCount: 0
    };
    window.addEventListener('analytics:logUpdated', () => this.processHotEvents());
  }

  async processHotEvents() {
    const events = await metaDB.getEvents('events_hot');
    if (!events.length) return;

    let globalSecs = 0, todayStr = new Date().toISOString().split('T')[0];
    let dailyActive = false;

    for (const ev of events) {
      if (ev.type === 'LISTEN_COMPLETE' && ev.data) {
        const { isFullListen, isValidListen, listenedSeconds, variant } = ev.data;
        globalSecs += (listenedSeconds || 0);
        
        // Rate Limiting (–¢–ó 7.1)
        const lastPlay = this.lastFullListens.get(ev.uid) || 0;
        const timeSince = ev.timestamp - lastPlay;
        const minInterval = (ev.data.trackDuration || 0) * 1000 * 0.9;
        const isRateLimited = isFullListen && timeSince < minInterval;

        await metaDB.updateStat(ev.uid, (stat) => {
          stat.globalListenSeconds += (listenedSeconds || 0);
          stat.lastPlayedAt = ev.timestamp;
          if (!stat.featuresUsed) stat.featuresUsed = {};
          
          if (isValidListen) {
            stat.globalValidListenCount++;
            dailyActive = true;

            // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞: –ü–æ —á–∞—Å–∞–º –∏ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏ (–∏–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
            try {
              const d = new Date(ev.timestamp);
              const h = d.getHours();
              const w = (d.getDay() + 6) % 7; // –ü–Ω=0, –í—Å=6
              
              if (!stat.byHour) stat.byHour = Array(24).fill(0);
              if (!stat.byWeekday) stat.byWeekday = Array(7).fill(0);
              
              stat.byHour[h] = (stat.byHour[h] || 0) + 1;
              stat.byWeekday[w] = (stat.byWeekday[w] || 0) + 1;
            } catch (e) {}
          }

          if (isFullListen && !isRateLimited && variant !== 'short') {
            stat.globalFullListenCount++;
            this.lastFullListens.set(ev.uid, ev.timestamp);
            
            // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –î–æ—Å—Ç–∏–∂–µ–Ω–∏–π (–¢–ó 11.3)
            const hour = new Date(ev.timestamp).getHours();
            if (hour >= 0 && hour < 5) stat.featuresUsed.nightPlay = (stat.featuresUsed.nightPlay || 0) + 1;
            if (hour >= 5 && hour < 8) stat.featuresUsed.earlyPlay = (stat.featuresUsed.earlyPlay || 0) + 1;
            if (ev.data?.quality === 'hi') stat.featuresUsed.hiQuality = (stat.featuresUsed.hiQuality || 0) + 1;

            // –¢—Ä–∏–≥–≥–µ—Ä –æ–±–ª–∞—á–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (–¢–ó 5.2)
            const cN = parseInt(localStorage.getItem('cloud:listenThreshold')) || 5;
            if (stat.globalFullListenCount >= cN) {
               window.dispatchEvent(new CustomEvent('analytics:cloudThresholdReached', { detail: { uid: ev.uid } }));
            }
            
            // --- –¢–†–ï–ö–ò–ù–ì –ö–û–ú–ë–û (–°—Ç–∞—Ä–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ) ---
            const g = window.playerCore;
            if (g) {
              const isFavOnly = localStorage.getItem('favoritesOnlyMode') === '1';
              const isShuffle = g.isShuffle();
              const isFavNow = g.isFavorite(ev.uid);

              if (isShuffle) stat.featuresUsed.shufflePlay = (stat.featuresUsed.shufflePlay || 0) + 1;

              if (isFavOnly && !isShuffle && isFavNow) this.session.favOrderedRun++;
              else this.session.favOrderedRun = 0;

              if (isFavOnly && isShuffle && isFavNow) this.session.favShuffleEvents.add(ev.uid);
              else this.session.favShuffleEvents.clear();

              // –ü–æ–ª–Ω–æ—á–Ω—ã–π —Ü–∏–∫–ª (00:00 - 00:30)
              const timeStr = new Date(ev.timestamp).toTimeString().slice(0, 8);
              if (timeStr >= '00:00:00' && timeStr <= '00:30:00') {
                if (this.session.midnightTripleTrack === ev.uid) this.session.midnightTripleCount++;
                else { this.session.midnightTripleTrack = ev.uid; this.session.midnightTripleCount = 1; }
              } else {
                this.session.midnightTripleCount = 0;
              }

              // –ó–∞–ø–∏—Å—å –∫–æ–º–±–æ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
              if (this.session.favOrderedRun >= 5 || this.session.favShuffleEvents.size >= 5 || this.session.midnightTripleCount >= 3) {
                 setTimeout(async () => {
                   await metaDB.updateStat('global', s => {
                     if (!s.featuresUsed) s.featuresUsed = {};
                     if (this.session.favOrderedRun >= 5) s.featuresUsed.fav_ordered_5 = 5;
                     if (this.session.favShuffleEvents.size >= 5) s.featuresUsed.fav_shuffle_5 = 5;
                     if (this.session.midnightTripleCount >= 3) s.featuresUsed.midnight_triple = 1;
                     return s;
                   });
                 }, 500);
              }
            }
          }
          return stat;
        });
      } else if (ev.type === 'FEATURE_USED') {
         // –î–ª—è —Ñ–∏—á —Å–∞–º–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π uid "global"
         const targetUid = ev.uid || 'global';
         await metaDB.updateStat(targetUid, s => {
           if (!s.featuresUsed) s.featuresUsed = {};
           s.featuresUsed[ev.data.feature] = (s.featuresUsed[ev.data.feature] || 0) + 1;
           return s;
         });
      }
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∏–∫–∞–º–∏ (–¢–ó 10.2)
    if (dailyActive) {
      const streakObj = (await metaDB.getGlobal('global_streak'))?.value || { current: 0, longest: 0, lastActiveDate: '' };
      if (streakObj.lastActiveDate !== todayStr) {
        const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
        streakObj.current = (streakObj.lastActiveDate === yesterday) ? streakObj.current + 1 : 1;
        streakObj.longest = Math.max(streakObj.longest, streakObj.current);
        streakObj.lastActiveDate = todayStr;
        await metaDB.setGlobal('global_streak', streakObj);
      }
    }

    // –†–æ—Ç–∞—Ü–∏—è: Hot -> Warm
    await metaDB.addEvents(events, 'events_warm');
    await metaDB.clearEvents('events_hot');
    window.dispatchEvent(new CustomEvent('stats:updated'));
  }
}

//=================================================
// FILE: /scripts/app.js
// scripts/app.js
// Application Entry Point v2.3.0 (Optimized, Compact, Playback Safe)
(function (W, D) {
  'use strict';

  const $ = id => D.getElementById(id);
  const click = id => $(id)?.click();

  const waitObj = async (name) => {
    const U = W.Utils;
    if (U?.waitFor) return U.waitFor(() => !!W[name]?.initialize, 3000);
    for (let i = 0; !W[name]?.initialize && i < 30; i++) await new Promise(r => setTimeout(r, 100));
    return !!W[name];
  };

  const initModules = async () => {
    const C = W.APP_CONFIG || {};

    // 1. Offline Core & UI
    try {
      (await import('./offline/net-policy.js')).initNetPolicy?.();
      (await import('./app/offline-ui-bootstrap.js'))?.initOfflineUI?.();
      const om = await import('./offline/offline-manager.js');
      await om.default.initialize();
      (await import('./offline/track-resolver.js')).initTrackResolver(om.default);
      (await import('./app/playback-cache-bootstrap.js'))?.initPlaybackCache?.();
    } catch (e) { console.error('Offline init failed:', e); }

    // 2. Analytics & RPG Progress UI (Parallel execution)
    try {
      const loadA = async (p) => await import(`./analytics/${p}.js`);
      const [M, L, ST, SA, AE, CS] = await Promise.all(['meta-db', 'event-logger', 'session-tracker', 'stats-aggregator', 'achievement-engine', 'cloud-sync'].map(loadA));
      
      await M.metaDB.init(); await L.eventLogger.init();
      new ST.SessionTracker(); new SA.StatsAggregator();
      W.achievementEngine = new AE.AchievementEngine();
      
      W.addEventListener('achievements:updated', e => {
        const { total, unlocked, streak, profile } = e.detail;
        const $el = id => $(id);
        
        if ($el('achievementsCount')) $el('achievementsCount').textContent = `–í–´–ü–û–õ–ù–ï–ù–û: ${unlocked} / ${total}`;
        if ($el('achievementsFill') && total) $el('achievementsFill').style.width = `${(unlocked / total) * 100}%`;
        
        if (profile) {
          if ($el('user-level-badge')) $el('user-level-badge').textContent = profile.level;
          const curXp = Math.pow(profile.level - 1, 2) * 100, nxtXp = Math.pow(profile.level, 2) * 100;
          if ($el('xp-progress-fill')) $el('xp-progress-fill').style.width = `${Math.max(0, Math.min(100, ((profile.xp - curXp) / (nxtXp - curXp)) * 100))}%`;
          if ($el('xp-text')) $el('xp-text').textContent = `${profile.xp} / ${nxtXp} XP`;
        }
        
        const bTxt = $el('ach-hint-bubble-text');
        if (bTxt && W.achievementEngine?.achievements) {
          const goals = W.achievementEngine.achievements.filter(a => !a.isUnlocked && !a.isHidden && a.progress?.target > a.progress?.current).sort((a, b) => b.progress.pct - a.progress.pct).slice(0, 3).map(a => `‚ú® –î–æ ¬´${a.name.replace(/ —É—Ä\. \d+/, '')}¬ª: –æ—Å—Ç–∞–ª–æ—Å—å ${a.progress.target - a.progress.current}`);
          const nS = streak < 3 ? 3 : (streak < 7 ? 7 : (streak < 14 ? 14 : 30));
          goals.push(streak < 30 ? `‚ú® –î–æ ¬´–°—Ç—Ä–∏–∫ ${nS} –¥–Ω–µ–π¬ª: –æ—Å—Ç–∞–ª–æ—Å—å ${nS - streak}` : `‚ú® –õ–µ–≥–µ–Ω–¥–∞! –í–∞—à —Å—Ç—Ä–∏–∫: ${streak} –¥–Ω–µ–π`);
          
          clearInterval(W._bInt); let i = 0;
          const uB = () => { if (!goals.length) return; bTxt.style.opacity = 0; setTimeout(() => { bTxt.innerHTML = goals[i++ % goals.length]; bTxt.style.opacity = 1; }, 300); };
          uB(); if (goals.length > 1) W._bInt = setInterval(uB, 8000);
        }
      });

      const bub = $('ach-hint-bubble'); if (bub) bub.onclick = () => W.AlbumsManager?.loadAlbum(C.SPECIAL_PROFILE_KEY || '__profile__');
      const sv = $('dash-save-btn'); if (sv) sv.onclick = () => {
        if (!W.NetPolicy?.isNetworkAllowed()) return W.NotificationSystem?.warning('–°–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
        const tk = JSON.parse(localStorage.getItem('cloud_tokens') || '{}');
        if (tk.yandex) CS.cloudSync.sync('yandex'); else CS.cloudSync.auth('yandex');
      };
      CS.cloudSync?.checkAuthCallback?.();
      W.dispatchEvent(new CustomEvent('analytics:logUpdated'));
    } catch (e) { console.warn('Analytics init skipped/failed:', e); }

    // 3. UI Modules
    const run = n => W[n]?.initialize?.();
    if (await waitObj('GalleryManager')) run('GalleryManager');
    try { const sm = await import('./app/showcase/index.js'); await sm.default.initialize(); } catch (e) { console.error('Showcase init failed:', e); }
    if (await waitObj('AlbumsManager')) run('AlbumsManager');
    if (await waitObj('PlayerUI')) run('PlayerUI');
    
    ['SleepTimer', 'LyricsModal', 'SystemInfoManager'].forEach(run);
    import('./ui/statistics-modal.js').catch(e => console.warn('Statistics modal skipped:', e));

    const fb = $('feedback-link');
    if (fb) fb.onclick = e => {
      e.preventDefault();
      W.Modals?.open?.({ title: '–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å', maxWidth: 420, bodyHtml: `<p style="margin-bottom:20px;color:#8ab8fd;text-align:center;">–ï—Å—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ –Ω–∞—à–ª–∏ –æ—à–∏–±–∫—É?<br>–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º!</p><div style="display:flex;flex-direction:column;gap:15px;max-width:300px;margin:0 auto;"><a href="https://t.me/vitrina_razbita" target="_blank" style="background:#0088cc;color:#fff;padding:15px;border-radius:8px;text-decoration:none;text-align:center;">Telegram</a><a href="mailto:${C.SUPPORT_EMAIL || 'support@vitrina-razbita.ru'}" target="_blank" style="background:#4daaff;color:#fff;padding:15px;border-radius:8px;text-decoration:none;text-align:center;">Email</a><a href="${C.GITHUB_URL || 'https://github.com/apel-s-in/vi3na1bita-music'}" target="_blank" style="background:#333;color:#fff;padding:15px;border-radius:8px;text-decoration:none;text-align:center;">GitHub</a></div>` });
    };
    const sl = $('support-link'); if (sl) sl.href = C.SUPPORT_URL || 'https://example.com/support';
  };

  const setupHotkeys = () => {
    const p = () => W.playerCore;
    const m = {
      k: () => W.PlayerUI?.togglePlayPause(), ' ': e => { e.preventDefault(); W.PlayerUI?.togglePlayPause(); },
      n: () => p()?.next(), p: () => p()?.prev(), x: () => p()?.stop(),
      m: () => click('mute-btn'), r: () => click('repeat-btn'), u: () => click('shuffle-btn'),
      a: () => click('animation-btn'), b: () => click('pulse-btn'), f: () => click('favorites-btn'),
      t: () => W.SleepTimer?.show?.(), y: () => click('lyrics-toggle-btn'),
      arrowleft: () => p()?.seek(Math.max(0, (p().getPosition() || 0) - 5)),
      arrowright: () => p()?.seek(Math.min(p().getDuration() || 0, (p().getPosition() || 0) + 5)),
      arrowup: e => { e.preventDefault(); p()?.setVolume(Math.min(100, p().getVolume() + 5)); },
      arrowdown: e => { e.preventDefault(); p()?.setVolume(Math.max(0, p().getVolume() - 5)); }
    };
    D.addEventListener('keydown', e => !['INPUT', 'TEXTAREA'].includes(e.target?.tagName) && m[e.key.toLowerCase()]?.(e));
  };

  const setupPWA = () => {
    W.addEventListener('beforeinstallprompt', e => {
      e.preventDefault(); const b = $('install-pwa-btn'); if (!b) return;
      b.style.display = 'block';
      b.onclick = async () => { e.prompt(); if ((await e.userChoice).outcome === 'accepted') W.NotificationSystem?.success('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!'); b.style.display = 'none'; };
    });
    W.addEventListener('appinstalled', () => {
      W.NotificationSystem?.success('–£—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!');
      const b = $('install-pwa-btn'); if (b) b.style.display = 'none';
      if (W.eventLogger) { W.eventLogger.log('FEATURE_USED', 'global', { feature: 'pwa_installed' }); W.dispatchEvent(new CustomEvent('analytics:forceFlush')); }
    });
    const s = $('social-links');
    if (s) s.addEventListener('click', e => {
      if (e.target.tagName === 'A' && W.eventLogger) { W.eventLogger.log('FEATURE_USED', 'global', { feature: 'social_visit' }); W.dispatchEvent(new CustomEvent('analytics:forceFlush')); }
    });
  };

  const setupSW = () => {
    if (!('serviceWorker' in navigator)) return;
    const h = e => { if (e.data?.type === 'SW_VERSION') { const v = String(e.data.version || '').trim(); if (v && v !== String(W.VERSION || '')) W.ServiceWorkerManager?.handleVersionMessage?.({ swVer: v }); } };
    navigator.serviceWorker.addEventListener('message', h); W.addEventListener('message', h);
  };

  let _init = false;
  W.app = {
    checkShowcaseShare: () => {
      const p = new URLSearchParams(W.location.search).get('playlist');
      if (p && W.ShowcaseManager) { W.ShowcaseManager.handleSharedPlaylist(p); W.history.replaceState(null, '', W.location.pathname); }
    },
    initialize: async () => {
      if (_init) return; _init = true;
      try {
        await initModules(); setupHotkeys(); setupPWA(); setupSW(); W.app.checkShowcaseShare();
      } catch (e) { console.error('App init failed:', e); W.NotificationSystem?.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏'); }
    }
  };
})(window, document);

//=================================================
// FILE: /scripts/app/albums.js
import { registerTrack } from './track-registry.js';
import { injectIndicator } from '../ui/offline-indicators.js';

const W = window, D = document, C = W.APP_CONFIG || {};
const { $, toStr, escHtml, isMobileUA } = W.AppUtils || { $: id => D.getElementById(id), toStr: v => v == null ? '' : String(v), escHtml: s => String(s||''), isMobileUA: () => false };

const [FAV, NEWS, SHOWCASE, PROFILE, STAR_ON, STAR_OFF, LOGO] = [
  W.SPECIAL_FAVORITES_KEY || '__favorites__', W.SPECIAL_RELIZ_KEY || '__reliz__',
  W.SPECIAL_SHOWCASE_KEY || '__showcase__', C.SPECIAL_PROFILE_KEY || '__profile__',
  'img/star.png', 'img/star2.png', 'img/logo.png'
];

class AlbumsManager {
  curr = null; playing = null; cache = new Map(); covers = new Map();
  loading = false; galVis = true;

  async initialize() {
    if (!W.albumsIndex?.length) try { await W.Utils?.onceEvent?.(W, 'albumsIndex:ready', { timeoutMs: 5000 }); } catch {}
    this._renderIcons();
    this._bindEvents();
    
    const def = C.ICON_ALBUMS_ORDER?.find(x => !x.key.startsWith('__'))?.key || W.albumsIndex?.[0]?.key;
    const key = localStorage.getItem('currentAlbum') || def;
    if (key) await this.loadAlbum(key);

    W.addEventListener('quality:changed', () => this.cache.forEach(d => delete d._pTracks));
  }

  _renderIcons() {
    const box = $('album-icons'); 
    if (!box) return;
    
    const isMob = isMobileUA(), idx = W.albumsIndex || [];
    box.innerHTML = (C.ICON_ALBUMS_ORDER || []).filter(it => it.key && (it.key.startsWith('__') || idx.some(a => a.key === it.key))).map(it => {
      let b = it.icon || LOGO, p1 = b, p2 = b;
      if (b.includes('icon_album') && !b.includes('Fav_logo')) {
        p1 = isMob ? b.replace(/icon_album\/(.+)\.png$/, 'icon_album/mobile/$1@1x.jpg') : b.replace(/\.png$/, '@1x.png');
        p2 = isMob ? p1.replace(/@1x\.jpg$/, '@2x.jpg') : p1.replace(/@1x\.png$/, '@2x.png');
      }
      return `<div class="album-icon" data-album="${it.key}" data-akey="${it.key}" title="${escHtml(it.title)}"><img src="${p1}" srcset="${p2} 2x" alt="${escHtml(it.title)}" draggable="false" loading="lazy" width="60" height="60"></div>`;
    }).join('');
  }

  _bindEvents() {
    const iconsBox = $('album-icons');
    if (iconsBox) {
      let touchTimer = null, isDragging = false;
      
      iconsBox.addEventListener('touchstart', e => {
        const k = e.target.closest('.album-icon')?.dataset.album;
        if (!k || k.startsWith('__')) return;
        isDragging = false;
        touchTimer = setTimeout(() => { touchTimer = null; W.ShowcaseManager?.openColorPicker?.(null, k); }, 600);
      }, {passive: true});
      
      iconsBox.addEventListener('touchmove', () => { isDragging = true; if(touchTimer) clearTimeout(touchTimer); }, {passive: true});
      iconsBox.addEventListener('touchend', () => { if(touchTimer) clearTimeout(touchTimer); });
      
      iconsBox.addEventListener('contextmenu', e => {
        const k = e.target.closest('.album-icon')?.dataset.album;
        if (k && !k.startsWith('__')) { e.preventDefault(); W.ShowcaseManager?.openColorPicker?.(null, k); }
      });
      
      iconsBox.addEventListener('click', e => {
        if (isDragging) return;
        const k = e.target.closest('.album-icon')?.dataset.album; 
        if (!k) return;
        
        if (this.curr === k && !k.startsWith('__')) {
          this.galVis = !this.galVis;
          const w = $('cover-wrap'); 
          if (w) w.style.display = this.galVis ? '' : 'none';
          W.NotificationSystem?.info(this.galVis ? 'üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è –ø–æ–∫–∞–∑–∞–Ω–∞' : 'üö´ –ì–∞–ª–µ—Ä–µ—è —Å–∫—Ä—ã—Ç–∞');
        } else this.loadAlbum(k);
      });
    }

    $('track-list')?.addEventListener('click', e => {
      W.playerCore?.prepareContext?.();
      if (this.curr === FAV || e.target.closest('.offline-ind')) return;
      
      const trk = e.target.closest('.track'); 
      if (!trk) return;
      
      const aKey = toStr(trk.dataset.album).trim(), uid = toStr(trk.dataset.uid).trim(), pc = W.playerCore;
      if (!aKey || aKey.startsWith('__')) return;

      if (e.target.classList.contains('like-star') && uid && pc) {
        e.preventDefault(); e.stopPropagation();
        e.target.src = !pc.isFavorite(uid) ? STAR_ON : STAR_OFF;
        e.target.classList.add('animating'); 
        setTimeout(() => e.target.classList.remove('animating'), 320);
        pc.toggleFavorite(uid, { fromAlbum: true, albumKey: aKey });
        return;
      }

      const data = this.cache.get(aKey); 
      if (!data || !pc) return;
      this.playing = aKey;
      
      if (!data._pTracks) {
        data._pTracks = data.tracks.filter(t => t.src).map(t => ({ 
          src: t.src, sources: t.sources, title: t.title, artist: data.artist, album: data.title, 
          cover: this.covers.get(aKey) || LOGO, uid: t.uid, lyrics: t.lyrics, fulltext: t.fulltext, 
          hasLyrics: t.hasLyrics, sourceAlbum: aKey 
        }));
      }
      
      const pIdx = data._pTracks.findIndex(t => t.uid === uid); 
      if (pIdx === -1) return;
      
      const curSnap = pc.getPlaylistSnapshot() || [];
      if (curSnap.length !== data._pTracks.length || curSnap[0]?.sourceAlbum !== aKey) {
        pc.setPlaylist(data._pTracks, pIdx, null, { preservePosition: false });
      }
      
      this.highlightCurrentTrack(pIdx); 
      pc.play(pIdx);
      W.PlayerUI?.ensurePlayerBlock?.(pIdx, { userInitiated: true });
    });

    W.playerCore?.onFavoritesChanged(d => {
      const s = d?.liked ? STAR_ON : STAR_OFF;
      const sel = d?.albumKey ? `.like-star[data-album="${CSS.escape(d.albumKey)}"][data-uid="${CSS.escape(d.uid)}"]` : `.like-star[data-uid="${CSS.escape(d?.uid)}"]`;
      D.querySelectorAll(sel).forEach(el => el.src = s);
    });
  }

  async loadAlbum(key) {
    if (this.loading) return; 
    this.loading = true; 
    this.galVis = true;
    
    try {
      const trackList = $('track-list');
      if (trackList) trackList.innerHTML = '';
      $('social-links').innerHTML = ''; 
      W.GalleryManager?.clear?.();

      const specials = {
        [FAV]: 'loadFavoritesAlbum',
        [NEWS]: 'loadNewsAlbum',
        [SHOWCASE]: 'loadShowcaseAlbum',
        [PROFILE]: 'loadProfileAlbum'
      };

      if (specials[key]) {
        const mod = await import('./albums/specials.js');
        await mod[specials[key]](this);
      } else {
        const cached = this.cache.get(key);
        if (cached) delete cached._pTracks;
        
        await W.TrackRegistry?.ensurePopulated?.();
        let data = this.cache.get(key);
        
        if (!data) {
          const cfg = W.TrackRegistry.getAlbumConfig(key);
          if (!cfg) throw new Error(`Album ${key} missing or failed to load`);
          data = { ...cfg, tracks: W.TrackRegistry.getTracksForAlbum(key) };
          this.cache.set(key, data);
        }
        
        await W.GalleryManager?.loadGallery?.(key);
        this.covers.set(key, await W.GalleryManager?.getFirstCoverUrl?.(key) || LOGO);
        
        const coverSlot = $('cover-slot');
        if (coverSlot && W.GalleryManager?.getItemsCount?.() <= 0) {
          coverSlot.innerHTML = `<img src="${LOGO}" alt="Cover">`;
        }
        
        $('cover-wrap').style.display = ''; 
        this.renderAlbumTitle(data.title);
        
        $('social-links').innerHTML = (data.links || []).filter(l => l.url).map(l => `<a href="${l.url}" target="_blank" rel="noopener noreferrer">${l.label}</a>`).join('');
        
        if (trackList) {
          trackList.innerHTML = data.tracks.map((t, i) => `<div class="track" id="trk${i}" data-index="${i}" data-album="${escHtml(key)}" data-uid="${escHtml(t.uid)}"><div class="tnum">${String(t.num).padStart(2,'0')}.</div><div class="track-title">${escHtml(t.title)}</div><img src="${t.uid && W.playerCore?.isFavorite?.(t.uid) ? STAR_ON : STAR_OFF}" class="like-star" alt="‚òÖ" data-album="${escHtml(key)}" data-uid="${escHtml(t.uid)}"></div>`).join('');
          trackList.querySelectorAll('.track[data-uid]').forEach(el => injectIndicator(el));
        }
        W.PlayerUI?.updateMiniHeader?.();
      }

      this.curr = key; 
      localStorage.setItem('currentAlbum', key);
      D.querySelectorAll('.album-icon').forEach(el => el.classList.toggle('active', el.dataset.album === key));
      $('track-list')?.classList.remove('filtered'); 
      W.PlayerUI?.switchAlbumInstantly?.(key);
      
    } catch (e) { 
      console.error('[AlbumsManager] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–ª—å–±–æ–º–∞:', e);
      W.NotificationSystem?.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
    } finally { 
      this.loading = false; 
    }
  }

  highlightCurrentTrack(i, { uid, albumKey } = {}) {
    D.querySelectorAll('.track.current').forEach(n => n.classList.remove('current'));
    
    if (W.Utils?.isShowcaseContext?.(this.curr) && uid) {
      D.querySelectorAll(`[data-uid="${CSS.escape(uid)}"]`).forEach(el => el.classList.add('current'));
      return;
    }
    
    const sel = (this.curr === FAV && uid && albumKey) ?
      `.track[data-album="${CSS.escape(albumKey)}"][data-uid="${CSS.escape(uid)}"]` : 
      (uid ? `.track[data-uid="${CSS.escape(uid)}"]` : (i >= 0 ? `.track[data-index="${i}"]` : null));
      
    if (sel) D.querySelector(sel)?.classList.add('current');
  }

  getCurrentAlbum() { return this.curr; } 
  getPlayingAlbum() { return this.playing; } 
  setPlayingAlbum(k) { this.playing = k; }
  
  getPlayingAlbumTracks() {
    if (W.Utils?.isShowcaseContext?.(this.playing)) return W.ShowcaseManager?.getActiveListTracks?.() || [];
    const d = this.cache.get(this.playing);
    return d ? (d._pTracks || d.tracks) : [];
  }
  
  renderAlbumTitle(t, mod) { 
    const el = $('active-album-title'); 
    if(el) { 
      el.textContent = t; 
      el.className = `active-album-title ${mod||''}`; 
    } 
  }
}

W.AlbumsManager = new AlbumsManager();
export default W.AlbumsManager;

//=================================================
// FILE: /scripts/app/albums/specials.js
import { loadAndRenderNewsInline } from '../../ui/news-inline.js';
import { injectOfflineIndicators } from '../../ui/offline-indicators.js';

const FAV = window.SPECIAL_FAVORITES_KEY || '__favorites__';
const NEWS = window.SPECIAL_RELIZ_KEY || '__reliz__';
const FAV_COVER = 'img/Fav_logo.png';
const esc = (s) => window.Utils?.escapeHtml ? window.Utils.escapeHtml(String(s || '')) : String(s || '');

export async function loadFavoritesAlbum(ctx) {
  ctx.renderAlbumTitle('‚≠ê‚≠ê‚≠ê –ò–ó–ë–†–ê–ù–ù–û–ï ‚≠ê‚≠ê‚≠ê', 'fav');
  document.getElementById('cover-wrap').style.display = 'none';
  const container = document.getElementById('track-list');
  if (!container) return;

  const rebuild = () => {
    const pc = window.playerCore;
    if (!pc) return;
    const st = pc.getFavoritesState();
    const items = [...(st.active || []).map(i => ({ ...i, active: true })), ...(st.inactive || []).map(i => ({ ...i, active: false }))];
    const pb = document.getElementById('lyricsplayerblock');
    const hasPlayer = pb && container.contains(pb);

    if (!items.length) {
      container.innerHTML = `<div class="fav-empty"><h3>–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∏</h3><p>–û—Ç–º–µ—Ç—å—Ç–µ —Ç—Ä–µ–∫–∏ –∑–≤—ë–∑–¥–æ—á–∫–æ–π ‚≠ê</p></div>`;
      if (hasPlayer) container.appendChild(pb);
      return;
    }

    container.innerHTML = items.map((it, i) => {
      const t = window.TrackRegistry?.getTrackByUid(it.uid) || { title: '–ó–∞–≥—Ä—É–∑–∫–∞...', sourceAlbum: it.sourceAlbum };
      const aTitle = window.TrackRegistry?.getAlbumTitle(t.sourceAlbum) || window.albumsIndex?.find(a => a.key === t.sourceAlbum)?.title || '–ê–ª—å–±–æ–º';
      return `
        <div class="track ${it.active ? '' : 'inactive'}" id="${esc(`fav_${it.sourceAlbum}_${it.uid}`)}" data-index="${i}" data-album="${esc(t.sourceAlbum)}" data-uid="${esc(it.uid)}">
          <div class="tnum">${String(i + 1).padStart(2, '0')}.</div>
          <div class="track-title" title="${esc(t.title)} - ${esc(aTitle)}">
            <span class="fav-track-name">${esc(t.title)}</span>
            <span class="fav-album-name"> ‚Äî ${esc(aTitle)}</span>
          </div>
          <img src="${it.active ? 'img/star.png' : 'img/star2.png'}" class="like-star" alt="–∑–≤–µ–∑–¥–∞" data-album="${esc(t.sourceAlbum)}" data-uid="${esc(it.uid)}">
        </div>`;
    }).join('');

    if (hasPlayer) {
      const row = container.querySelector(`.track[data-uid="${CSS.escape(pc?.getCurrentTrackUid?.() || '')}"]`) || container.lastElementChild;
      row ? row.after(pb) : container.appendChild(pb);
    }
    injectOfflineIndicators(container);
  };

  if (!ctx._favBound) {
    ctx._favBound = true;
    container.addEventListener('click', e => {
      if (ctx.getCurrentAlbum() !== FAV) return;
      const row = e.target.closest('.track');
      if (!row) return;
      
      const uid = row.dataset.uid, aKey = row.dataset.album, pc = window.playerCore;
      const isActive = pc.getFavoritesState().active.some(x => x.uid === uid);

      if (e.target.classList.contains('like-star')) {
        e.preventDefault(); e.stopPropagation();
        isActive ? pc.toggleFavorite(uid, { source: 'favorites', albumKey: aKey }) : pc.restoreInactive(uid);
        return;
      }

      if (isActive) {
        ctx.setPlayingAlbum(FAV);
        const tracks = pc.getFavoritesState().active.map(i => ({ ...(window.TrackRegistry?.getTrackByUid(i.uid) || {}), uid: i.uid, album: '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ', cover: FAV_COVER, sourceAlbum: i.sourceAlbum }));
        const idx = tracks.findIndex(t => t.uid === uid);
        if (idx >= 0) {
          pc.setPlaylist(tracks, idx, { artist: '–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞', album: '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ', cover: FAV_COVER }, { preservePosition: false });
          pc.play(idx);
          ctx.highlightCurrentTrack(-1, { uid, albumKey: aKey });
          window.PlayerUI?.ensurePlayerBlock?.(idx, { userInitiated: true });
          window.PlayerUI?.updateAvailableTracksForPlayback?.();
        }
      } else {
        pc.showInactiveFavoriteModal({ uid, title: window.TrackRegistry?.getTrackByUid(uid)?.title || '–¢—Ä–µ–∫', onDeleted: () => { rebuild(); window.PlayerUI?.updateAvailableTracksForPlayback?.(); } });
      }
    });

    window.playerCore?.onFavoritesChanged(() => {
      if (ctx.getCurrentAlbum() === FAV) {
        rebuild();
        const pc = window.playerCore;
        if (pc && ctx.getPlayingAlbum?.() === FAV) {
          const activeTracks = pc.getFavoritesState().active.map(i => ({ ...(window.TrackRegistry?.getTrackByUid(i.uid) || {}), uid: i.uid, album: '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ', cover: FAV_COVER, sourceAlbum: i.sourceAlbum }));
          if (activeTracks.length) pc.originalPlaylist = activeTracks;
        }
        window.PlayerUI?.updateAvailableTracksForPlayback?.();
      }
    });
  }
  
  rebuild();
}

export async function loadShowcaseAlbum(ctx) {
  ctx.renderAlbumTitle('–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞', 'showcase');
  document.getElementById('cover-wrap').style.display = 'none';
  if (window.ShowcaseManager) await window.ShowcaseManager.renderTab();
}

export async function loadNewsAlbum(ctx) {
  ctx.renderAlbumTitle('üì∞ –ù–û–í–û–°–¢–ò üì∞', 'news');
  if (window.GalleryManager?.loadGallery) await window.GalleryManager.loadGallery(NEWS);
  document.getElementById('cover-wrap').style.display = '';
  const container = document.getElementById('track-list');
  if (container) await loadAndRenderNewsInline(container);
}

export async function loadProfileAlbum(ctx) {
  ctx.renderAlbumTitle('üë§ –õ–ò–ß–ù–´–ô –ö–ê–ë–ò–ù–ï–¢ üë§', 'profile');
  document.getElementById('cover-wrap').style.display = 'none';
  const container = document.getElementById('track-list');
  if (!container) return;

  let metaDB = null, cloudSync = null;
  let allStats = [], achVal = {}, streakVal = { current: 0 }, upVal = { name: '–°–ª—É—à–∞—Ç–µ–ª—å', avatar: 'üòé' };

  try {
    const mDB = await import('../../analytics/meta-db.js'); metaDB = mDB.metaDB;
    const cSync = await import('../../analytics/cloud-sync.js'); cloudSync = cSync.cloudSync;

    const results = await Promise.all([
      metaDB.getAllStats().catch(()=>[]),
      metaDB.getGlobal('unlocked_achievements').catch(()=>({})),
      metaDB.getGlobal('global_streak').catch(()=>({})),
      metaDB.getGlobal('user_profile').catch(()=>({}))
    ]);
    allStats = results[0] || [];
    achVal = results[1]?.value || {};
    streakVal = results[2]?.value || { current: 0 };
    upVal = results[3]?.value || { name: '–°–ª—É—à–∞—Ç–µ–ª—å', avatar: 'üòé' };
  } catch (e) { console.error('[Profile] –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', e); }

  const totalFull = allStats.reduce((acc, s) => acc + (s.globalFullListenCount || 0), 0);
  const totalSecs = allStats.reduce((acc, s) => acc + (s.globalListenSeconds || 0), 0);
  const totalTimeStr = window.Utils?.fmt?.durationHuman ? window.Utils.fmt.durationHuman(totalSecs) : `${Math.floor(totalSecs / 60)}–º`;
  const engine = window.achievementEngine;

  const tokens = JSON.parse(localStorage.getItem('cloud_tokens') || '{}');
  const renderAuthBtn = (id, name, icon) => `<button class="auth-btn ${id} ${tokens[id] ? 'connected' : ''}" data-auth="${id}"><span>${icon}</span> ${tokens[id] ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : name}</button>`;

  container.innerHTML = '';
  const tpl = document.getElementById('profile-template').content.cloneNode(true);
  tpl.querySelector('#prof-avatar-btn').textContent = upVal.avatar;
  tpl.querySelector('#prof-name-inp').value = esc(upVal.name);
  tpl.querySelector('#prof-auth-grid').innerHTML = renderAuthBtn('yandex', '–Ø–Ω–¥–µ–∫—Å', 'üíΩ') + renderAuthBtn('google', 'Google', '‚òÅÔ∏è') + renderAuthBtn('vk', 'VK ID', 'üîµ');
  tpl.querySelector('#prof-stat-tracks').textContent = totalFull;
  tpl.querySelector('#prof-stat-time').textContent = totalTimeStr;
  tpl.querySelector('#prof-stat-streak').textContent = streakVal.current;
  tpl.querySelector('#prof-stat-ach').textContent = Object.keys(achVal).length;
  container.appendChild(tpl);

  const nameInp = container.querySelector('#prof-name-inp');
  if (nameInp) {
    nameInp.onblur = async () => {
      upVal.name = nameInp.value.trim() || '–°–ª—É—à–∞—Ç–µ–ª—å';
      if (metaDB) await metaDB.setGlobal('user_profile', upVal).catch(()=>{});
      window.NotificationSystem?.success('–ò–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
    };
    nameInp.onkeydown = e => e.key === 'Enter' && nameInp.blur();
  }

  const achListEl = container.querySelector('#prof-ach-list');
  const renderAchievements = (filter) => {
    if (!achListEl || !engine?.achievements) return;
    let items = engine.achievements.filter(a => filter === 'secret' ? a.isHidden : (filter === 'done' ? a.isUnlocked : (filter === 'available' ? !a.isUnlocked && !a.isHidden : (!a.isHidden || a.isUnlocked))));
    
    achListEl.innerHTML = items.length ? items.map(a => {
      const p = (!a.isUnlocked && !a.isHidden && a.progress) ? `<div style="margin-top:8px;"><div class="ach-mini-bar" style="width:100%"><div class="ach-mini-fill" style="width:${a.progress.pct}%"></div></div><div style="color:#9aa8c4; font-size:.86em; margin-top:4px;">–û—Å—Ç–∞–ª–æ—Å—å: ${Math.max(0, a.progress.target - a.progress.current)}</div></div>` : '';
return `
        <div class="ach-item ${a.isUnlocked ? 'done' : ''}" data-ach="${a.id}">
          <div class="ach-top">
            <div class="ach-title" style="color:${a.isUnlocked ? '#fff' : (a.color || '#fff')}">${a.icon} ${a.name}</div>
          </div>
          <div class="ach-sub">${a.isUnlocked && a.unlockedAt ? `–û—Ç–∫—Ä—ã—Ç–æ: ${new Date(a.unlockedAt).toLocaleDateString()}` : (a.isHidden ? '–û—Ç–∫—Ä–æ–µ—Ç—Å—è –ø—Ä–∏ –æ—Å–æ–±—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö' : a.short)}</div>
          ${(!a.isUnlocked && !a.isHidden && a.progress) ? `<div class="ach-progress"><div class="ach-mini-bar"><div class="ach-mini-fill" style="width:${a.progress.pct}%"></div></div></div>` : ``}
          <div class="ach-bottom">
            <div class="ach-xp">${a.isUnlocked ? `+${a.xpReward} XP` : (a.isHidden ? `–°–µ–∫—Ä–µ—Ç–Ω–æ–µ` : `${a.xpReward} XP`)}</div>
            <div class="ach-remaining">${(!a.isUnlocked && !a.isHidden && a.progress) ? `–û—Å—Ç–∞–ª–æ—Å—å: ${Math.max(0, a.progress.target - a.progress.current)}` : ``}</div>
            <button class="ach-more" type="button">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
          </div>
          <div class="ach-details" style="display:none;"><div class="ach-details-title">–ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å</div><div class="ach-details-how">${a.howTo || '–í—ã–ø–æ–ª–Ω–∏—Ç–µ —É—Å–ª–æ–≤–∏—è.'}</div>${a.desc ? `<div class="ach-details-desc">${a.desc}</div>` : ''}</div>
        </div>`;
    }).join('') : '<div class="fav-empty">–ü–æ –¥–∞–Ω–Ω–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É –Ω–∏—á–µ–≥–æ –Ω–µ—Ç</div>';
  };
  renderAchievements('all');

  const topTracksEl = container.querySelector('#prof-top-tracks');
  if (topTracksEl) {
    const validStats = allStats.filter(s => s.uid !== 'global');
    const mkList = (arr, valFn) => arr.length ? `<ul class="stat-list">${arr.map(s => `<li><span>${esc(window.TrackRegistry?.getTrackByUid(s.uid)?.title)}</span><span>${valFn(s)}</span></li>`).join('')}</ul>` : `<div class="stat-sub" style="color:#888;font-size:12px;text-align:center;">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö</div>`;
    const topValid = [...validStats].sort((a, b) => (b.globalValidListenCount || 0) - (a.globalValidListenCount || 0)).slice(0, 5);
    const topTime = [...validStats].sort((a, b) => (b.globalListenSeconds || 0) - (a.globalListenSeconds || 0)).slice(0, 5);
    
    const byH = Array(24).fill(0), byW = Array(7).fill(0);
    validStats.forEach(s => { (s.byHour||[]).forEach((v,h)=>byH[h]+=v||0); (s.byWeekday||[]).forEach((v,d)=>byW[d]+=v||0); });
    
    const renderChart = (id, title, data, lsK, lbls) => `
      <div class="chart-block" id="${id}">
        <div class="chart-title" style="cursor:pointer;" data-tg="${id}-bars" data-ls="${lsK}">${title}</div>
        <div class="chart-bars" id="${id}-bars" ${localStorage.getItem(lsK)==='0'?'style="display:none;"':''}>
          ${data.map((v, i) => `<div class="chart-row"><div class="label">${lbls?lbls[i]:String(i).padStart(2,'0')}</div><div class="bar"><div class="fill" style="width:${Math.round((v/Math.max(1,...data))*100)}%"></div></div><div class="val">${v}</div></div>`).join('')}
        </div>
      </div>`;

    topTracksEl.innerHTML = renderChart('chart-hours', '–ü–æ —á–∞—Å–∞–º —Å—É—Ç–æ–∫', byH, 'myStatsHoursOpen') +
                            renderChart('chart-week', '–ü–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏', byW, 'myStatsWeekOpen', ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å']) +
                            `<div class="stat-card" style="margin-bottom:10px;"><div class="stat-title">–¢–æ–ø‚Äë5 –ø–æ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è–º</div>${mkList(topValid, s=>s.globalValidListenCount||0)}</div>
                            <div class="stat-card" style="margin-bottom:15px;"><div class="stat-title">–¢–æ–ø‚Äë5 –ø–æ –≤—Ä–µ–º–µ–Ω–∏</div>${mkList(topTime, s=>window.Utils?.fmt?.durationHuman(s.globalListenSeconds||0))}</div>
                            <div style="display:flex; justify-content:center; margin-top:8px;"><button class="backup-btn" id="stats-reset-open-btn" style="background:#444;" type="button">–û–ß–ò–°–¢–ò–¢–¨ –°–¢–ê–¢–ò–°–¢–ò–ö–£</button></div>`;
  }

  const recsListEl = container.querySelector('#prof-recs-list');
  if (recsListEl) {
    const played = new Set(allStats.filter(s => s.globalFullListenCount > 0).map(s => s.uid));
    const recs = (window.TrackRegistry?.getAllUids?.()||[]).filter(u => !played.has(u)).sort(() => Math.random() - 0.5).slice(0, 4);
    recsListEl.innerHTML = recs.length ? recs.map(uid => `<div class="profile-list-item"><div class="log-info"><div class="log-title">${esc(window.TrackRegistry?.getTrackByUid(uid)?.title)}</div><div class="log-desc">${esc(window.TrackRegistry?.getTrackByUid(uid)?.album)}</div></div><button class="rec-play-btn" data-playuid="${uid}">‚ñ∂</button></div>`).join('') : '<div class="fav-empty">–í—ã –ø—Ä–æ—Å–ª—É—à–∞–ª–∏ –∞–±—Å–æ–ª—é—Ç–Ω–æ –≤—Å—ë! üèÜ</div>';
  }

  setTimeout(async () => {
    const logsEl = container.querySelector('#prof-logs-list');
    if (!logsEl) return;
    try {
      const logs = [...(metaDB ? await metaDB.getEvents('events_hot').catch(()=>[]) : []), ...(metaDB ? await metaDB.getEvents('events_warm').catch(()=>[]) : [])].sort((a, b) => b.timestamp - a.timestamp).slice(0, 20);
      const tMap = { 'LISTEN_COMPLETE': 'üéµ –ü—Ä–æ—Å–ª—É—à–∞–Ω–æ', 'LISTEN_SKIP': '‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ', 'ACHIEVEMENT_UNLOCK': 'üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ', 'FEATURE_USED': 'üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ' };
      logsEl.innerHTML = logs.length ? logs.map(l => {
        const d = new Date(l.timestamp);
        let desc = window.TrackRegistry?.getTrackByUid?.(l.uid)?.title || l.uid || '';
        if (l.type === 'ACHIEVEMENT_UNLOCK') desc = `–ê—á–∏–≤–∫–∞: ${l.data?.id || ''}`;
        return `<div class="profile-list-item"><div class="log-time">${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}</div><div class="log-info"><div class="log-title">${tMap[l.type] || l.type}</div><div class="log-desc">${esc(desc)}</div></div></div>`;
      }).join('') : '<div class="fav-empty">–ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π –ø—É—Å—Ç</div>';
    } catch { logsEl.innerHTML = '<div class="fav-empty">–ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π –ø—É—Å—Ç –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</div>'; }
  }, 100);

  if (!ctx._profBound) {
    ctx._profBound = true;
    container.addEventListener('click', e => {
      const t = e.target;
      
      const tab = t.closest('.profile-tab-btn');
      if (tab) {
        container.querySelectorAll('.profile-tab-btn, .profile-tab-content').forEach(x => x.classList.remove('active'));
        tab.classList.add('active');
        container.querySelector(`#tab-${tab.dataset.tab}`)?.classList.add('active');
        return;
      }
      
      const achTab = t.closest('.ach-classic-tab');
      if (achTab) {
        container.querySelectorAll('.ach-classic-tab').forEach(x => x.classList.remove('active'));
        achTab.classList.add('active');
        renderAchievements(achTab.dataset.filter);
        return;
      }
      
      const achBtn = t.closest('.ach-more') || t.closest('.ach-main');
      if (achBtn) {
        const item = achBtn.closest('.ach-item'), det = item?.querySelector('.ach-details'), b = item?.querySelector('.ach-more');
        if (det) {
          const isHid = det.style.display === 'none';
          det.style.display = isHid ? 'block' : 'none';
          if (b) b.textContent = isHid ? '–°–≤–µ—Ä–Ω—É—Ç—å' : '–ü–æ–¥—Ä–æ–±–Ω–µ–µ';
        }
        return;
      }
      
      const chTitle = t.closest('.chart-title');
      if (chTitle) {
        const b = container.querySelector('#' + chTitle.dataset.tg);
        if (b) {
          const v = b.style.display !== 'none';
          b.style.display = v ? 'none' : '';
          localStorage.setItem(chTitle.dataset.ls, v ? '0' : '1');
        }
        return;
      }
      
      const auth = t.closest('.auth-btn');
      if (auth) {
        const id = auth.dataset.auth;
        if (tokens[id]) id === 'yandex' && cloudSync?.sync ? cloudSync.sync(id) : window.NotificationSystem?.info('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞...');
        else id === 'yandex' && cloudSync?.auth ? cloudSync.auth(id) : window.NotificationSystem?.info(`–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ${id} –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞`);
        return;
      }
      
      if (t.closest('#prof-avatar-btn')) {
        const avatars = ['üòé','üéß','üé∏','ü¶Ñ','ü¶á','üëΩ','ü§ñ','üê±','ü¶ä','üêº','üî•','üíé'];
        const m = window.Modals.open({ title: '–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä', bodyHtml: `<div style="display:flex;flex-wrap:wrap;gap:12px;justify-content:center;">${avatars.map(a => `<button class="showcase-color-dot" style="font-size:24px;background:#232b38" data-ava="${a}">${a}</button>`).join('')}</div>` });
        m.onclick = async ev => {
          const btn = ev.target.closest('[data-ava]');
          if (btn) {
            upVal.avatar = btn.dataset.ava;
            t.closest('#prof-avatar-btn').textContent = btn.dataset.ava;
            if (metaDB) await metaDB.setGlobal('user_profile', upVal).catch(()=>{});
            m.remove();
          }
        };
        return;
      }
      
      if (t.closest('#prof-name-edit')) return container.querySelector('#prof-name-inp')?.focus();
      
      const recBtn = t.closest('.rec-play-btn');
      if (recBtn && window.ShowcaseManager?.playContext) {
        window.ShowcaseManager.playContext(recBtn.dataset.playuid);
        window.NotificationSystem?.info('–ó–∞–ø—É—Å–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏');
        return;
      }
      
      if (t.closest('#stats-reset-open-btn')) {
        if (!window.Modals?.confirm) return;
        const m = window.Modals.confirm({
          title: '–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö',
          textHtml: `<button class="om-btn om-btn--outline" style="width:100%;margin-bottom:8px;" data-act="stats">–¢–æ–ª—å–∫–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç—Ä–µ–∫–æ–≤</button>
                     <button class="om-btn om-btn--outline" style="width:100%;margin-bottom:8px;" data-act="ach">–¢–æ–ª—å–∫–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
                     <button class="om-btn om-btn--danger" style="width:100%;" data-act="all">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë –≤–æ–æ–±—â–µ</button>`,
          confirmText: '–ó–∞–∫—Ä—ã—Ç—å', cancelText: '–û—Ç–º–µ–Ω–∞'
        });
        m.onclick = async ev => {
          const act = ev.target.closest('.om-btn')?.dataset?.act;
          if (!act) return;
          if (act === 'stats') { const dev = localStorage.getItem('deviceHash'); await metaDB.tx('stats', 'readwrite', s => s.clear()); localStorage.setItem('deviceHash', dev); window.NotificationSystem?.success('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–∏—â–µ–Ω–∞'); }
          else if (act === 'ach') { await metaDB.setGlobal('unlocked_achievements', {}); await metaDB.setGlobal('user_profile_rpg', {xp:0, level:1}); window.NotificationSystem?.success('–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Å–±—Ä–æ—à–µ–Ω—ã'); }
          else if (act === 'all') { await metaDB.tx('stats', 'readwrite', s => s.clear()); await metaDB.setGlobal('unlocked_achievements', {}); await metaDB.setGlobal('user_profile_rpg', {xp:0, level:1}); await metaDB.setGlobal('global_streak', {current:0, longest:0}); window.NotificationSystem?.success('–í—Å—ë —Å–±—Ä–æ—à–µ–Ω–æ'); }
          window.location.reload();
        };
        return;
      }
    });
  }
}

//=================================================
// FILE: /scripts/app/gallery.js
// Optimized GalleryManager v3.0
const W = window, D = document, $ = id => D.getElementById(id);
const BASE = './albums/gallery/', LOGO = 'img/logo.png', C404 = 'gallery_404_cache:v2';
const MAP = { 'krevetochka': '00', 'mezhdu-zlom-i-dobrom': '01', 'golos-dushi': '02', 'odnazhdy-v-skazke': '03', '__reliz__': 'news' };
const ss = (k, v) => v === undefined ? JSON.parse(sessionStorage.getItem(k) || '{}') : sessionStorage.setItem(k, JSON.stringify(v));

class GalleryManager {
  it = []; idx = 0; tm = null; pre = new Set(); flip = 0;
  
  initialize() {
    const go = d => this.it.length > 1 && (this.show((this.idx + d + this.it.length) % this.it.length), this.play());
    $('cover-gallery-arrow-left')?.addEventListener('click', () => go(-1));
    $('cover-gallery-arrow-right')?.addEventListener('click', () => go(1));
    
    const w = $('cover-wrap');
    if (w) {
      let x = null;
      w.addEventListener('touchstart', e => x = e.touches[0].clientX, { passive: true });
      w.addEventListener('touchend', e => { if (x !== null && Math.abs(e.changedTouches[0].clientX - x) > 50) go(e.changedTouches[0].clientX < x ? 1 : -1); x = null; }, { passive: true });
    }
    D.addEventListener('visibilitychange', () => D.hidden ? this.stop() : this.play());
  }
  
  _norm(i, dir) {
    if (!i || i.type === 'html' || (typeof i === 'string' && /\.html/i.test(i))) return null;
    const p = (typeof i === 'string') ? i : (i.formats?.webp || i.formats?.full || i.src);
    if (!p) return null;
    return /^(https?:)?\/\//.test(p) ? p : (/^(albums|img|icons)\//.test(p) ? './'+p : dir + p);
  }
  
  async loadGallery(key) {
    this.stop(); this.it = []; this.idx = 0;
    const id = MAP[key], slot = $('cover-slot'), dir = `${BASE}${id}/`;
    const setL = () => { if(slot) slot.innerHTML = `<img src="${LOGO}" alt="Cover" draggable="false" style="width:100%;height:100%;object-fit:contain">`; this._nav(); };
    
    if (!id || ss(C404)[id]) return setL();
    try {
      const r = await fetch(`${dir}index.json`, { cache: 'force-cache' });
      if (!r.ok) { if (r.status === 404) ss(C404, { ...ss(C404), [id]: 1 }); throw 0; }
      const d = await r.json();
      this.it = (Array.isArray(d.items) ? d.items : (Array.isArray(d) ? d : [])).map(i => this._norm(i, dir)).filter(Boolean);
      this.it.length ? (this.show(0), this.play()) : setL();
    } catch { setL(); }
    this._nav();
  }

  show(i) {
    if (!this.it.length) return;
    this.idx = i; const src = this.it[i], slot = $('cover-slot');
    if (!slot) return;
    
    if (slot.children.length < 2 || slot.querySelector('iframe')) {
      slot.innerHTML = [0,1].map(() => `<img style="position:absolute;inset:0;width:100%;height:100%;object-fit:contain;transition:opacity .3s ease-out;opacity:0" alt="Cover" draggable="false">`).join('');
      this.flip = 0;
    }
    
    const imgs = slot.querySelectorAll('img'), nxt = imgs[this.flip === 0 ? 1 : 0], cur = imgs[this.flip];
    const img = new Image();
    img.onload = () => { nxt.src = src; nxt.style.opacity = '1'; cur.style.opacity = '0'; this.flip = this.flip === 0 ? 1 : 0; this._pre(); };
    img.onerror = () => this._pre();
    img.src = src;
  }

  _pre() {
    const n = this.it[(this.idx + 1) % this.it.length];
    if (n && !this.pre.has(n)) { if (this.pre.size > 20) this.pre.clear(); (new Image()).src = n; this.pre.add(n); }
  }

  _nav() { $('cover-wrap')?.classList.toggle('gallery-nav-ready', this.it.length > 1); }
  play() { this.stop(); if (this.it.length > 1) this.tm = setInterval(() => this.show((this.idx + 1) % this.it.length), 5000); }
  stop() { if (this.tm) clearInterval(this.tm); this.tm = null; }
  clear() { this.stop(); this.it = []; this.pre.clear(); if ($('cover-slot')) $('cover-slot').innerHTML = ''; this._nav(); }
  getItemsCount() { return this.it.length; }
  getCurrentIndex() { return this.idx; }
  
  async getFirstCoverUrl(key) {
    const id = MAP[key]; if (!id) return LOGO;
    try {
      const r = await fetch(`${BASE}${id}/index.json`, { cache: 'force-cache' });
      if (!r.ok) return LOGO;
      const d = await r.json(), n = this._norm((d.items || d || [])[0], `${BASE}${id}/`);
      return n || LOGO;
    } catch { return LOGO; }
  }
}
W.GalleryManager = new GalleryManager();
export default W.GalleryManager;

//=================================================
// FILE: /scripts/app/offline-ui-bootstrap.js
/**
 * scripts/app/offline-ui-bootstrap.js
 * Optimized Bridge for Network Policy & Service Worker.
 * FIX: Syncs TRUE airplane mode from NetPolicy to SW. Eliminates dead DOM listeners.
 */
export async function initOfflineUI() {
  // 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ê–≤–∏–∞—Ä–µ–∂–∏–º–∞ —Å Service Worker
  const sync = () => {
    const isAir = window.NetPolicy ? window.NetPolicy.getNetPolicyState().airplaneMode : !navigator.onLine;
    navigator.serviceWorker?.controller?.postMessage({ type: 'SYNC_AIRPLANE_MODE', payload: isAir });
  };
  ['netPolicy:changed', 'online', 'offline'].forEach(e => window.addEventListener(e, sync));
  sync();

  // 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –æ—Ñ—Ñ–ª–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã
  try {
    (await import('../ui/offline-indicators.js'))?.initOfflineIndicators?.();
    (await import('../ui/offline-modal.js'))?.initOfflineModal?.();
    (await import('../ui/cache-progress-overlay.js'))?.initCacheProgressOverlay?.();
  } catch (e) { console.error('Offline UI init failed:', e); }
}

export default { initOfflineUI };

//=================================================
// FILE: /scripts/app/playback-cache-bootstrap.js
/**
 * playback-cache-bootstrap.js ‚Äî PlaybackCache window controller.
 * FIX: Fully supports both R1 and R2 specs.
 */
import { getOfflineManager } from '../offline/offline-manager.js';
import { deleteTrackCache, getTrackMeta } from '../offline/cache-db.js';

let _init = false, _protected = false, _win = { prev: null, cur: null, next: null }, _pendingGC = new Set();
const uidOf = t => String(t?.uid || '').trim() || null;

function getWin(pl, idx) {
  const len = pl.length, cur = (len > 0 && idx >= 0) ? uidOf(pl[idx]) : null;
  if (!cur) return { prev: null, cur: null, next: null };
  if (len === 1) return { prev: cur, cur, next: cur };
  const wrap = i => (i % len + len) % len;
  return { prev: uidOf(pl[wrap(idx - 1)]) || cur, cur, next: uidOf(pl[wrap(idx + 1)]) || cur };
}

async function rebuild(dir = 1) {
  const mgr = getOfflineManager(), pc = window.playerCore;
  
  // Spec R2 Q.5.1: Window mechanism MUST stay active when R2 is enabled.
  if (!['R1', 'R2'].includes(mgr.getMode())) {
    Object.values(_win).filter(Boolean).forEach(u => _pendingGC.add(u));
    _win = { prev: null, cur: null, next: null };
    if (pc && !pc.isPlaying?.()) flushGC().catch(()=>{});
    return;
  }

  const pl = pc?.getPlaylistSnapshot?.() || [], idx = pc?.getIndex?.() ?? -1;
  if (idx < 0 || !pl.length) return;

  const nW = getWin(pl, idx);
  if (!nW.cur) return;
  
  const keep = new Set(Object.values(nW).filter(Boolean));
  Object.values(_win).filter(u => u && !keep.has(u)).forEach(u => _pendingGC.add(u));
  _win = nW;

  const netOk = window.NetPolicy?.isNetworkAllowed?.() ?? navigator.onLine;
  if (!netOk || !(await mgr.hasSpace())) return;

  // Spec 8.5 "anti-stutter": if CUR is streaming, do not prefetch neighbors yet (especially iOS)
  // We keep CUR-first rule always.
  let curIsStreaming = false;
  try {
    const curUid = nW.cur;
    if (curUid) {
      const resolved = await window.TrackResolver?.resolve?.(curUid, mgr.getEffectiveQuality?.());
      curIsStreaming = resolved?.source === 'stream';
    }
  } catch {}

  // Priority: CUR -> direction neighbor -> other neighbor
  const order = dir >= 0 ? [nW.cur, nW.next, nW.prev] : [nW.cur, nW.prev, nW.next];
  const prio = [100, 90, 80];

  // Always allow CUR download task; neighbors only if CUR is not currently streaming.
  const uniq = [...new Set(order)].filter(Boolean);
  for (let i = 0; i < uniq.length; i++) {
    const u = uniq[i];
    if (!u) continue;
    if (i > 0 && curIsStreaming) continue;
    mgr.enqueueAudioDownload(u, { priority: prio[i] || 50, kind: 'playbackCache' });
  }
}

async function flushGC() {
  if (_protected || !_pendingGC.size) return;
  const keep = new Set(Object.values(_win).filter(Boolean));
  const toDel = [..._pendingGC].filter(u => u && !keep.has(u));
  _pendingGC.clear();
  
  for (const u of toDel) {
    try { 
      const m = await getTrackMeta(u); 
      // Do not delete if changed to pinned/cloud/dynamic while pending
      if (m && ['pinned', 'cloud', 'dynamic'].includes(m.type)) continue;
      await deleteTrackCache(u); 
    } catch {}
  }
}

export function initPlaybackCache() {
  if (_init) return; _init = true;
  const r = (e) => rebuild(Number(e?.detail?.dir) || 1).catch(()=>{});
window.addEventListener('player:trackChanged', r);
  
  // –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ–∫–Ω–∞ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–µ—Ç–∏ (–∑–∞–º–µ–Ω—è–µ—Ç offline-playback.js)
  const toggleNet = () => {
    const isBlocked = !navigator.onLine || (window.NetPolicy && !window.NetPolicy.isNetworkAllowed());
    isBlocked ? protectWindow() : unprotectWindow();
    if (!isBlocked) r();
  };
  ['online', 'offline', 'netPolicy:changed'].forEach(e => window.addEventListener(e, toggleNet));
  
  window.playerCore?.on?.({ onPlay: () => flushGC().catch(()=>{}) });
  toggleNet();
}

export const protectWindow = () => { _protected = true; };
export const unprotectWindow = () => { _protected = false; flushGC().catch(()=>{}); };
export const getWindowState = () => ({ ..._win, protected: _protected, pendingGC: [..._pendingGC] });

// Expose minimal API for other modules (OfflineManager eviction needs protected window, Q.11.1)
window.PlaybackCache = window.PlaybackCache || {};
window.PlaybackCache.getWindowState = getWindowState;
window.PlaybackCache.protectWindow = protectWindow;
window.PlaybackCache.unprotectWindow = unprotectWindow;

//=================================================
// FILE: /scripts/app/player-ui.js
// scripts/app/player-ui.js
// Optimized Player UI v4.0 (Unified State, DOM Caching, 100% Spec Compliant)
(function (W, D) {
  'use strict';

  const U = W.Utils, PC = () => W.playerCore;
  const st = { isMini: false, seeking: false, vizOn: U.lsGetBool01('bitEnabled'), vizId: 0, ctx: null };
  const dom = { blk: null, now: null, mini: null, nUp: null, jump: null, el: {} };

  // 1. Unified & Cached State Synchronization
  const syncUI = () => {
    const c = PC(); if (!c || !dom.blk) return;
    const t = c.getCurrentTrack(), p = c.isPlaying(), e = dom.el, f = U.lsGetBool01('favoritesOnlyMode');
    const oM = W.OfflineManager, isR2 = oM?.getMode?.() === 'R2';
    const q = isR2 ? (oM?.getCQ() || 'hi') : U.pq.getState().mode;

    e.ico.innerHTML = p ? '<path d="M6 4h4v16H6zM14 4h4v16h-4z"/>' : '<path d="M8 5v14l11-7z"/>';
    
    ['shuffle', 'repeat', 'mute'].forEach(k => 
      U.setBtnActive(`${k}-btn`, c[`is${k.charAt(0).toUpperCase() + k.slice(1)}`]?.())
    );
    
    e.fav.className = `player-control-btn ${f ? 'favorites-active' : ''}`;
    e.favI.src = f ? 'img/star.png' : 'img/star2.png';

    const v = c.getVolume();
    e.vF.style.width = `${v}%`; 
    e.vH.style.left = `${Math.max(2, Math.min(98, v))}%`; 
    e.vS.value = v;

    if (e.pq) {
      const netDis = !isR2 && !U.pq.getState().netOk;
      e.pq.className = `player-control-btn ${(!isR2 && (!U.pq.getState().canToggleByTrack || netDis)) ? 'disabled' : `pq-${q}`}`;
      U.setAriaDisabled(e.pq, netDis);
      if (e.pqL) e.pqL.textContent = q === 'lo' ? 'Lo' : 'Hi';
    }

    U.download.applyDownloadLink(e.dl, t);

    // Mini Header sync
    if (st.isMini && dom.mini) {
      const nt = c.getPlaylistSnapshot()?.[c.getNextIndex()];
      const qs = (s, r = dom.mini) => r.querySelector(s);
      const n = qs('#mini-now-num'), ti = qs('#mini-now-title'), sr = qs('#mini-now-star'), nti = qs('.title', dom.nUp);
      
      if (n) n.textContent = `${String((c.getIndex() || 0) + 1).padStart(2, '0')}.`;
      if (ti) ti.textContent = t?.title || '‚Äî';
      if (sr) sr.src = U.fav.isTrackLikedInContext({ playingAlbum: W.AlbumsManager?.getPlayingAlbum?.(), track: t }) ? 'img/star.png' : 'img/star2.png';
      if (nti) nti.textContent = nt?.title || '‚Äî';
    }

    // Fav Filter sync
    const lst = D.getElementById('track-list'), cA = W.AlbumsManager?.getCurrentAlbum?.();
    if (lst) {
      const active = f && cA === W.AlbumsManager?.getPlayingAlbum?.() && !U.isSpecialAlbumKey(cA);
      lst.classList.toggle('favonly-filtered', active);
      if (active) {
        const lkd = new Set(c.getLikedUidsForAlbum(cA));
        lst.querySelectorAll('.track[data-uid]').forEach(r => r.toggleAttribute('data-hidden-by-favonly', !lkd.has(r.dataset.uid)));
      }
    }
  };

  // 2. Playback Quality Logic (Strict Playback Safety)
  const onPQClick = async () => {
    const m = W.OfflineManager, c = PC();
    if (m?.getMode?.() === 'R2') return W.Modals?.openOfflineModal?.();
    
    const r = U.pq.getState();
    if (!r.netOk) return U.ui.toast('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ç–∏', 'warning');
    if (!r.canToggleByTrack) return U.ui.toast('–ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ', 'warning');
    
    const nq = r.mode === 'hi' ? 'lo' : 'hi', nds = m ? await m.countNeedsReCache(nq) : 0;
    const apply = () => { c.switchQuality(nq); syncUI(); };
    
    nds > 5 
      ? (W.Modals?.confirm?.({ title: '–°–º–µ–Ω–∞ –∫–∞—á–µ—Å—Ç–≤–∞', textHtml: `–ó–∞—Ç—Ä–æ–Ω–µ—Ç ${nds} —Ñ–∞–π–ª–æ–≤. –ü–µ—Ä–µ–∫–∞—á–∞—Ç—å?`, confirmText: '–ü–µ—Ä–µ–∫–∞—á–∞—Ç—å', onConfirm: apply }) || (confirm(`–ó–∞—Ç—Ä–æ–Ω–µ—Ç ${nds} —Ñ–∞–π–ª–æ–≤. –ü–µ—Ä–µ–∫–∞—á–∞—Ç—å?`) && apply())) 
      : apply();
  };

  // 3. Audio Visualizer
  const loopViz = () => {
    if (!st.vizOn || !st.ctx) return;
    const d = new Uint8Array(st.ctx.frequencyBinCount); 
    st.ctx.getByteFrequencyData(d);
    
    const lim = Math.max(1, d.length * 0.3) | 0, logo = D.getElementById('logo-bottom');
    if (logo) logo.style.transform = `scale(${1 + (d.slice(0, lim).reduce((a, b) => a + b, 0) / lim / 255) * 0.2})`;
    st.vizId = requestAnimationFrame(loopViz);
  };

  const togViz = (f = false) => {
    if (!f) U.lsSetBool01('bitEnabled', st.vizOn = !st.vizOn);
    
    const h = D.getElementById('pulse-heart'), b = D.getElementById('pulse-btn'), l = D.getElementById('logo-bottom');
    if (h) h.textContent = st.vizOn ? '‚ù§Ô∏è' : 'ü§ç';
    if (b) b.classList.toggle('active', st.vizOn);
    
    if (st.vizOn) {
      if (!st.ctx && W.Howler?.ctx) {
        W.Howler.ctx.state === 'suspended' && W.Howler.ctx.resume().catch(()=>{});
        try { st.ctx = W.Howler.ctx.createAnalyser(); st.ctx.fftSize = 256; W.Howler.masterGain.connect(st.ctx); } catch {}
      }
      if (st.ctx && !st.vizId) loopViz();
    } else {
      cancelAnimationFrame(st.vizId); st.vizId = 0; 
      if (l) l.style.transform = ''; 
    }
  };

  // 4. Player Block Mounting
  const ensureBlock = (idx, userInit) => {
    if (!dom.blk) {
      dom.blk = D.getElementById('player-template').content.cloneNode(true).querySelector('#lyricsplayerblock');
      dom.now = D.getElementById('now-playing');
      const q = s => dom.blk.querySelector(s);
      
      dom.el = { 
        fill: q('#player-progress-fill'), bar: q('#player-progress-bar'), tE: q('#time-elapsed'), tR: q('#time-remaining'), 
        vF: q('#volume-fill'), vH: q('#volume-handle'), vS: q('#volume-slider'), ico: q('#play-pause-icon'), 
        pq: q('#pq-btn'), pqL: q('#pq-btn-label'), fav: q('#favorites-btn'), favI: q('#favorites-btn-icon'), dl: q('#track-download-btn') 
      };
      bindEvs();
    }

    st.isMini = U.isBrowsingOtherAlbum();
    
    if (st.isMini) {
      if (!dom.mini) {
        dom.mini = D.getElementById('mini-header-template').content.cloneNode(true).querySelector('#mini-now');
        dom.mini.onclick = e => {
          if (e.target.id === 'mini-now-star') { 
            e.stopPropagation(); 
            const t = PC().getCurrentTrack(); 
            if(t?.uid) PC().toggleFavorite(t.uid, { source: W.AlbumsManager?.getPlayingAlbum?.() === W.SPECIAL_FAVORITES_KEY ? 'favorites' : 'album', albumKey: t.sourceAlbum }); 
            syncUI(); 
          } else { 
            const p = W.AlbumsManager?.getPlayingAlbum?.(); 
            if(p) W.AlbumsManager.loadAlbum(p); 
          }
        };
        dom.nUp = D.getElementById('next-up-template').content.cloneNode(true).querySelector('#next-up');
      }
      if (!dom.now.contains(dom.blk)) dom.now.append(dom.mini, dom.blk, dom.nUp);
      W.LyricsController?.applyMiniMode?.();
      dom.mini.style.display = dom.nUp.style.display = 'flex';
    } else {
      const l = D.getElementById('track-list'), t = PC().getCurrentTrack(), u = t?.uid ? CSS.escape(t.uid) : '';
      const r = (u && l?.querySelector(`.track[data-uid="${u}"], .showcase-track[data-uid="${u}"]`)) || (idx != null && l?.querySelector(`.track[data-index="${idx}"]`));
      
      r ? (r.after(dom.blk), userInit && setTimeout(() => r.scrollIntoView({ behavior: 'smooth', block: 'center' }), 50)) : l?.appendChild(dom.blk);
      W.LyricsController?.restoreFromMiniMode?.();
      dom.now.innerHTML = ''; 
      if (dom.mini) dom.mini.style.display = dom.nUp.style.display = 'none';
    }

    if (!dom.jump) {
      dom.jump = D.createElement('div'); dom.jump.className = 'jump-to-playing'; dom.jump.innerHTML = '<button>‚Üë</button>';
      dom.jump.onclick = () => dom.blk?.scrollIntoView({ behavior: 'smooth', block: 'center' }); 
      D.body.appendChild(dom.jump);
    }
    
    if (W.IntersectionObserver) {
      W.pBlockObs?.disconnect();
      W.pBlockObs = new IntersectionObserver(([e]) => dom.jump.style.display = (!e.isIntersecting && !st.isMini) ? 'flex' : 'none', { threshold: 0.1 });
      W.pBlockObs.observe(dom.blk);
    }
    syncUI();
  };

  // 5. Delegation & Event Binding
  const bindEvs = () => {
    dom.blk.addEventListener('click', e => {
      const b = e.target.closest('button, a'); 
      if (!b || b.tagName === 'A') return;
      if (b.id === 'track-download-btn' && !b.getAttribute('href')) return e.preventDefault(), U.ui.toast('–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ', 'error');
      
      e.preventDefault(); 
      const c = PC();
      
      const acts = {
        'play-pause-btn': () => c.isPlaying() ? c.pause() : c.play(),
        'prev-btn': () => c.prev(), 
        'next-btn': () => c.next(), 
        'stop-btn': () => c.stop(),
        'shuffle-btn': () => { c.toggleShuffle(); syncUI(); },
        'repeat-btn': () => { c.toggleRepeat(); syncUI(); },
        'mute-btn': () => { c.setMuted(!c.isMuted()); syncUI(); },
        'pq-btn': onPQClick,
        'lyrics-toggle-btn': () => { W.LyricsController?.toggleLyricsView?.(); W.eventLogger?.log('FEATURE_USED', c.getCurrentTrackUid(), { feature: 'lyrics' }); },
        'animation-btn': () => W.LyricsController?.toggleAnimation?.(),
        'lyrics-text-btn': () => W.LyricsModal?.show?.(),
        'pulse-btn': () => togViz(),
        'stats-btn': () => W.StatisticsModal?.openStatisticsModal?.(),
        'favorites-btn': () => {
          const nx = !U.lsGetBool01('favoritesOnlyMode'), pa = W.AlbumsManager?.getPlayingAlbum?.();
          if (nx && (!c.getLikedUidsForAlbum(pa)?.length && (!pa || pa !== W.SPECIAL_FAVORITES_KEY || !c.getFavoritesState().active.length))) {
            return U.ui.toast('–û—Ç–º–µ—Ç—å—Ç–µ –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–π—Å—è —Ç—Ä–µ–∫ ‚≠ê', 'info');
          }
          U.lsSetBool01('favoritesOnlyMode', nx); 
          c.applyFavoritesOnlyFilter?.();
          W.PlayerUI.updateAvailableTracksForPlayback(); 
          syncUI(); 
          U.ui.toast(nx ? '‚≠ê –¢–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ' : '–ò–≥—Ä–∞—é—Ç –≤—Å–µ —Ç—Ä–µ–∫–∏', nx ? 'success' : 'info');
        }
      };
      acts[b.id]?.();
    });

    const m = e => PC().seek(PC().getDuration() * U.math.clamp(((e.touches ? e.touches[0].clientX : e.clientX) - dom.el.bar.getBoundingClientRect().left) / dom.el.bar.getBoundingClientRect().width, 0, 1));
    const up = () => { st.seeking = false; D.removeEventListener('pointermove', m); D.removeEventListener('pointerup', up); };
    
    dom.el.bar?.addEventListener('pointerdown', e => { st.seeking = true; m(e); D.addEventListener('pointermove', m); D.addEventListener('pointerup', up); });
    dom.el.vS?.addEventListener('input', e => { PC().setVolume(e.target.value); syncUI(); });
  };

  // 6. Entry Point
  const init = () => {
    if (!W.playerCore || !W.albumsIndex || !U) return setTimeout(init, 100);
    
    PC().on({
      onPlay: syncUI, onPause: syncUI, onStop: syncUI, onEnd: syncUI,
      onTrackChange: (t, i) => { 
        W.AlbumsManager?.highlightCurrentTrack?.(t?.uid ? -1 : i, t?.uid ? { uid: t.uid, albumKey: t.sourceAlbum } : {}); 
        ensureBlock(i); 
        W.LyricsController?.onTrackChange?.(t); 
        syncUI(); 
      },
      onTick: (p, d) => {
        if (!st.seeking && dom.el.fill) { 
          dom.el.fill.style.width = `${d > 0 ? (p / d) * 100 : 0}%`; 
          dom.el.tE.textContent = U.fmt.time(p); 
          dom.el.tR.textContent = `-${U.fmt.time((d || 0) - p)}`; 
        }
        W.LyricsController?.onTick?.(p, { inMiniMode: st.isMini });
      }
    });

    PC().onFavoritesChanged(() => { 
      const p = W.AlbumsManager?.getPlayingAlbum?.(); 
      if (p === W.SPECIAL_FAVORITES_KEY || U.lsGetBool01('favoritesOnlyMode')) { 
        PC().applyFavoritesOnlyFilter?.(); 
        W.PlayerUI?.updateAvailableTracksForPlayback?.(); 
      } 
      syncUI(); 
    });

    W.addEventListener('playlist:changed', () => { 
      const p = W.AlbumsManager?.getPlayingAlbum?.(); 
      if (p === W.SPECIAL_FAVORITES_KEY || U.lsGetBool01('favoritesOnlyMode')) PC().applyFavoritesOnlyFilter?.(); 
    });

    ['offline:uiChanged', 'online', 'offline'].forEach(e => W.addEventListener(e, syncUI));
    
    PC().setVolume(U.math.toInt(U.lsGet('playerVolume'), 100));
    if (st.vizOn) togViz(true); 
    syncUI();
  };

  // Exports
  W.PlayerUI = {
    initialize: init, 
    ensurePlayerBlock: (i, o) => ensureBlock(i, o?.userInitiated),
    updateMiniHeader: syncUI, 
    updateNextUpLabel: syncUI, 
    updatePlaylistFiltering: () => syncUI(),
    togglePlayPause: () => PC().isPlaying() ? PC().pause() : PC().play(),
    switchAlbumInstantly: () => { if (PC().getIndex() >= 0) ensureBlock(PC().getIndex()); },
    updateAvailableTracksForPlayback: () => { PC().applyFavoritesOnlyFilter?.(); syncUI(); }
  };
  
  D.readyState === 'loading' ? D.addEventListener('DOMContentLoaded', init) : init();
})(window, document);

//=================================================
// FILE: /scripts/app/player-ui/lyrics.js
// scripts/app/player-ui/lyrics.js
// LyricsController ‚Äî Ultra-Optimized (v4.0)
(function () {
  'use strict';

  const W = window, D = document, U = W.Utils;
  const LS = { V: 'lyricsViewMode', A: 'lyricsAnimationEnabled' }, PRE = 'lyr_';
  const sess = (k, v) => v === undefined ? JSON.parse(sessionStorage.getItem(k) || 'null') : sessionStorage.setItem(k, JSON.stringify(v));
  const esc = s => U?.escapeHtml?.(String(s||'')) || String(s||'');

  let st = { list: [], has: false, mode: 'normal', anim: false, lIdx: -100 }, dom = {};

  const initDom = () => {
    if (dom.blk) return true;
    if (!(dom.blk = D.getElementById('lyricsplayerblock'))) return false;
    const q = s => dom.blk.querySelector(s);
    Object.assign(dom, { win: q('#lyrics-window'), lyr: q('#lyrics'), bg: q('.lyrics-animated-bg'), btnT: q('#lyrics-toggle-btn'), btnA: q('#animation-btn'), btnK: q('#lyrics-text-btn') });
    return true;
  };

  const _pend = new Map();
  const fetchL = async (u) => {
    if (!(u = String(u || '').trim()) || sess('404_'+u)) return null;
    const k = PRE + u, c = sess(k);
    if (c) return c === 'NO' ? null : c;
    if (_pend.has(u)) return _pend.get(u);
    
    const p = (async () => {
      try {
        const r = await fetch(u, { cache: 'force-cache', headers: { Accept: 'application/json' } });
        if (!r.ok) throw r.status;
        const j = await r.json();
        if (Array.isArray(j)) { sess(k, j); return j; }
      } catch (e) {
        if (e === 404) sess('404_'+u, 1);
        else if (!(W.NetPolicy?.isNetworkAllowed?.() ?? navigator.onLine)) return null;
      }
      sess(k, 'NO'); return null;
    })();
    _pend.set(u, p);
    const res = await p;
    _pend.delete(u);
    return res;
  };

  const updateUI = () => {
    if (!initDom() || !dom.win) return;
    const ok = st.has && st.mode !== 'hidden', { win, btnT, btnA, bg, btnK, lyr } = dom;
    
    win.style.display = st.has ? '' : 'none';
    win.className = `lyrics-${st.mode}`;
    
    if (btnT) { btnT.className = `lyrics-toggle-btn lyrics-${st.mode} ${st.has ? '' : 'disabled'}`; U?.setAriaDisabled?.(btnT, !st.has); }
    if (btnA) { btnA.classList.toggle('active', st.anim && ok); btnA.classList.toggle('disabled', !st.has); }
    if (bg) bg.classList.toggle('active', st.anim && ok);
    
    if (btnK) {
      const can = ok || !!W.playerCore?.getCurrentTrack?.()?.fulltext;
      btnK.classList.toggle('disabled', !can);
      Object.assign(btnK.style, { pointerEvents: can ? '' : 'none', opacity: can ? '' : '0.4' });
    }
    if (!st.has && lyr) lyr.innerHTML = '<div class="lyrics-placeholder">–¢–µ–∫—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω</div>';
  };

  const render = (pos) => {
    if (!initDom() || !dom.lyr || !st.has) return;
    const lst = st.list, fT = lst[0].time;
    
    if (pos < fT && fT > 5) {
      const rem = fT - pos, sec = Math.ceil(rem);
      if (st.lIdx === -sec && rem >= 1) return;
      dom.lyr.innerHTML = `<div class="lyrics-countdown${rem<1?' fade-out':''}"${rem<1?` style="opacity:${rem.toFixed(2)}"`:''}>${sec}</div>`;
      st.lIdx = -sec;
      return;
    }

    let idx = -1;
    for (let i = 0; i < lst.length && pos >= lst[i].time; i++) idx = i;
    if (idx === st.lIdx) return;
    st.lIdx = idx;

    const sz = st.mode === 'expanded' ? 9 : 5, hf = (sz-1)/2, s = Math.max(0, idx-hf), pT = Math.max(0, hf-idx);
    const html = Array(sz).fill('<div class="lyrics-window-line"></div>');
    for(let i=0, end=Math.min(lst.length-s, sz-pT); i<end; i++) html[pT+i] = `<div class="lyrics-window-line${(s+i)===idx?' active':''}">${esc(lst[s+i].text)}</div>`;
    dom.lyr.innerHTML = html.join('');
  };

  W.LyricsController = {
    getState: () => ({ lyricsViewMode: st.mode, animationEnabled: st.anim, hasTimedLyricsForCurrentTrack: st.has }),
    getCurrentLyrics: () => st.list,
    getCurrentLyricsLines: () => st.list.map(l => ({ line: l.text })),
    restoreSettingsIntoDom: () => { 
      st.mode = ['normal','hidden','expanded'].includes(localStorage.getItem(LS.V)) ? localStorage.getItem(LS.V) : 'normal';
      st.anim = localStorage.getItem(LS.A) === '1';
      updateUI(); 
    },
    onTrackChange: async (t) => {
      st.has = false; st.list = []; st.lIdx = -100;
      if (!t?.lyrics || t.hasLyrics === false || sess('404_'+t.lyrics)) return updateUI();
      
      if (initDom() && dom.lyr) dom.lyr.innerHTML = '<div class="lyrics-spinner"></div>';
      const d = await fetchL(t.lyrics);
      if (d) {
        st.list = (Array.isArray(d) ? d : []).map(i => ({ time: Number(i?.time), text: String(i?.line || i?.text || '').trim() })).filter(i => Number.isFinite(i.time) && i.text).sort((a,b) => a.time - b.time);
        st.has = st.list.length > 0;
      }
      updateUI();
    },
    onTick: (pos, opts) => { if (st.mode !== 'hidden' && !opts?.inMiniMode && st.has) render(pos); },
    toggleLyricsView: () => {
      const m = ['normal', 'hidden', 'expanded'];
      localStorage.setItem(LS.V, st.mode = m[(m.indexOf(st.mode) + 1) % 3]);
      if (st.mode === 'hidden') st.anim = false;
      updateUI();
      W.NotificationSystem?.info?.({ normal: 'üìù –û–±—ã—á–Ω—ã–π –≤–∏–¥ –ª–∏—Ä–∏–∫–∏', hidden: 'üö´ –õ–∏—Ä–∏–∫–∞ —Å–∫—Ä—ã—Ç–∞', expanded: 'üìñ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –≤–∏–¥ –ª–∏—Ä–∏–∫–∏' }[st.mode]);
    },
    toggleAnimation: () => {
      if (st.mode === 'hidden') return W.NotificationSystem?.info?.('–õ–∏—Ä–∏–∫–∞ —Å–∫—Ä—ã—Ç–∞ ‚Äî –∞–Ω–∏–º–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
      localStorage.setItem(LS.A, (st.anim = !st.anim) ? '1' : '0'); updateUI();
      W.NotificationSystem?.info?.(st.anim ? '‚ú® –ê–Ω–∏–º–∞—Ü–∏—è: –í–ö–õ' : '‚ú® –ê–Ω–∏–º–∞—Ü–∏—è: –í–´–ö–õ');
    },
    getMiniSaveState: () => ({ viewMode: st.mode === 'hidden' ? 'normal' : st.mode, animationEnabled: st.anim }),
    applyMiniMode: () => {
      if (!initDom() || !dom.win) return;
      Object.assign(dom.win.style, { transition: 'none', display: 'none' });
      if (dom.btnT) dom.btnT.style.display = 'none';
      if (dom.bg) dom.bg.classList.remove('active');
    },
    restoreFromMiniMode: (sv) => {
      if (!initDom() || !dom.win) return;
      dom.win.style.display = ''; setTimeout(() => dom.win.style.transition = '', 50);
      if (dom.btnT) dom.btnT.style.display = '';
      if (sv) { st.mode = sv.viewMode || 'normal'; st.anim = !!sv.animationEnabled; }
      updateUI();
    },
    checkTrackHasLyrics: () => st.has
  };
  
  W.LyricsController.restoreSettingsIntoDom();
})();

//=================================================
// FILE: /scripts/app/promocode.js
(function(W, D) {
  'use strict';
  const LS = localStorage, KEY = 'promocode', IOS_KEY = 'iosInstallDismissed';
  const $ = id => D.getElementById(id);
  const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent) && !W.MSStream;
  
  const unlock = () => {
    $('promocode-block')?.classList.add('hidden');
    $('main-block')?.classList.remove('hidden');
    const init = () => W.app?.initialize?.();
    if (!init()) { let a = 0, t = setInterval(() => (init() || ++a > 50) && clearInterval(t), 50); }
  };

  const showIOS = () => {
    if (!isIOS || matchMedia('(display-mode: standalone)').matches || navigator.standalone || LS.getItem(IOS_KEY)) return;
    setTimeout(() => {
      const el = D.createElement('div');
      el.className = 'ios-install-prompt';
      el.innerHTML = `<button class="ios-prompt-close" type="button">√ó</button><div class="ios-prompt-content"><img class="ios-prompt-icon" src="icons/apple-touch-icon.png"><div style="font-weight:800;font-size:18px;margin-bottom:8px">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div><div style="opacity:.85;margin-bottom:14px">–ù–∞–∂–º–∏—Ç–µ <strong>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</strong> ‚ÜóÔ∏è<br>–∏ –≤—ã–±–µ—Ä–∏—Ç–µ <strong>¬´–ù–∞ —ç–∫—Ä–∞–Ω –î–æ–º–æ–π¬ª</strong></div><button class="ios-prompt-button" type="button">–ü–æ–Ω—è—Ç–Ω–æ</button></div>`;
      el.onclick = e => { if (e.target.closest('button') || e.target.closest('.ios-prompt-close')) { el.classList.remove('show'); LS.setItem(IOS_KEY, '1'); setTimeout(() => el.remove(), 350); } };
      D.body.appendChild(el);
      requestAnimationFrame(() => el.classList.add('show'));
    }, 2500);
  };

  W.addEventListener('load', () => {
    if (isIOS) D.body.classList.add('ios');
    const code = String(W.APP_CONFIG?.PROMOCODE || '').trim(), inp = $('promo-inp');
    if (!code || LS.getItem(KEY) === code) { unlock(); return showIOS(); }

    const check = () => {
      if (inp?.value.trim() === code) { LS.setItem(KEY, code); unlock(); inp.blur(); }
      else if (inp) {
        const err = $('promo-error');
        if (err) err.textContent = '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥';
        inp.classList.add('error');
        setTimeout(() => { if (err) err.textContent = ''; inp.classList.remove('error'); }, 2000);
      }
    };

    $('promo-btn')?.addEventListener('click', check);
    inp?.addEventListener('keydown', e => { if (e.key === 'Enter' || e.keyCode === 13) { e.preventDefault(); check(); } });
    setTimeout(() => { if (inp && !inp.disabled) inp.focus(); }, 100);
    showIOS();
  });
})(window, document);

//=================================================
// FILE: /scripts/app/showcase/index.js
/**
 * scripts/app/showcase/index.js
 * "–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞" (Showcase) ‚Äî –ú–∞—Å—Ç–µ—Ä –í–∫–ª–∞–¥–∫–∞.
 * –ü–û–õ–ù–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø (–¢–ó v2.0): –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ, –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫, DND, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ.
 */

import { ensureLyricsIndexLoaded, searchUidsByQuery } from './lyrics-search.js';

const W = window, D = document, U = W.Utils, LS = 'showcase:';
const PALETTE = ['transparent','#ef5350','#ff9800','#fdd835','#4caf50','#00bcd4','#2196f3','#9c27b0','#e91e63','#9e9e9e'];
const esc = s => U.escapeHtml(String(s || ''));
const $ = id => D.getElementById(id);

const Store = {
  get: (k, d) => U.lsGetJson(LS + k, d),
  set: (k, v) => U.lsSet(LS + k, JSON.stringify(v)),
  get pId() { return this.get('activePlaylistId', null); },
  set pId(id) { this.set('activePlaylistId', id); },
  get pls() { return this.get('playlists', []); },
  set pls(p) { this.set('playlists', p); },
  get aCol() { return this.get('albumColors', {}); },
  get pCol() { return this.get('playlistColors', {}); },
  init() {
    let m = this.get('masterOrder', []);
    if (!m.length) {
      [...(W.albumsIndex || [])].reverse().forEach(a => {
        if (!a.key.startsWith('__')) W.TrackRegistry?.getAllUids()?.forEach(u => {
          if (W.TrackRegistry.getTrackByUid(u)?.sourceAlbum === a.key && !m.includes(u)) m.push(u);
        });
      });
      this.set('masterOrder', m); this.set('userOrder', [...m]);
    }
  }
};

class ShowcaseManager {
  constructor() {
    this.editMode = false; this.searchQuery = '';
    this.viewMode = Store.get('viewMode', 'flat'); this.sortMode = Store.get('sortMode', 'user');
    this.selectedUids = new Set(); this._ic = {}; this._stat = new Map();
  }

  async initialize() {
    (W.APP_CONFIG?.ICON_ALBUMS_ORDER || []).forEach(i => this._ic[i.key] = i.icon);
    await W.TrackRegistry?.ensurePopulated?.();
    Store.init();
    W.playerCore?.on({ onTrackChange: t => { if (t?.uid && U.isShowcaseContext(W.AlbumsManager?.getPlayingAlbum())) { Store.set('lastTrackUid', t.uid); Store.set('lastPlayingContext', W.AlbumsManager.getPlayingAlbum()); } } });
    W.playerCore?.onFavoritesChanged(({ uid }) => {
      const img = D.querySelector(`.showcase-track[data-uid="${CSS.escape(uid)}"] .like-star`);
      if (img) img.src = W.playerCore.isFavorite(uid) ? 'img/star.png' : 'img/star2.png';
      this.updStatus();
    });
    W.addEventListener('offline:stateChanged', () => W.AlbumsManager?.getCurrentAlbum() === '__showcase__' && (W.OfflineIndicators?.refreshAllIndicators(), this.updStatus()));
  }

  async getActiveListTracks() {
    const pId = Store.pId;
    let uids = pId ? (Store.pls.find(p => p.id === pId)?.uids || []) : Store.get('userOrder', []);

    if (this.sortMode === 'shuffle' && !this.editMode) {
      let sh = Store.get('shuffledOrder', null);
      if (!sh || sh.length !== uids.length) { sh = [...uids].sort(() => Math.random() - 0.5); Store.set('shuffledOrder', sh); }
      uids = sh;
    } else if (this.sortMode !== 'user' && !this.editMode) {
      const tr = uids.map(u => W.TrackRegistry.getTrackByUid(u)).filter(Boolean);
      if (this.sortMode.startsWith('plays') || this.sortMode === 'last-played') {
        const db = (await import('../../analytics/meta-db.js')).metaDB;
        const full = (await db.getStat('globalFullListens'))?.details || {};
        const last = (await db.getStat('lastPlayed'))?.details || {};
        tr.forEach(t => this._stat.set(t.uid, { plays: full[t.uid] || 0, lastAt: last[t.uid] || 0 }));
      }
      const S = this._stat;
      const sorters = {
        'name-asc': (a, b) => a.title.localeCompare(b.title), 'name-desc': (a, b) => b.title.localeCompare(a.title),
        'album-desc': (a, b) => b.sourceAlbum.localeCompare(a.sourceAlbum), 'album-asc': (a, b) => a.sourceAlbum.localeCompare(b.sourceAlbum),
        'favorites-first': (a, b) => (W.playerCore?.isFavorite(b.uid)?1:0) - (W.playerCore?.isFavorite(a.uid)?1:0),
        'plays-desc': (a, b) => (S.get(b.uid)?.plays||0) - (S.get(a.uid)?.plays||0), 'plays-asc': (a, b) => (S.get(a.uid)?.plays||0) - (S.get(b.uid)?.plays||0),
        'last-played': (a, b) => (S.get(b.uid)?.lastAt||0) - (S.get(a.uid)?.lastAt||0)
      };
      tr.sort(sorters[this.sortMode]);
      uids = tr.map(t => t.uid);
    }

    const hid = pId ? (Store.pls.find(p => p.id === pId)?.hiddenUids || []) : Store.get('hiddenUids', []);
    if (!this.editMode && localStorage.getItem('showcase:showHidden:v1') !== '1') uids = uids.filter(u => !hid.includes(u));

    if (this.searchQuery && !this.editMode) { await ensureLyricsIndexLoaded(); uids = searchUidsByQuery({ uids, query: this.searchQuery }); }

    return uids.map(u => {
      const t = W.TrackRegistry.getTrackByUid(u);
      if (!t) return null;

      // Showcase: –æ–¥–Ω–∞ –æ–±–ª–æ–∂–∫–∞ –Ω–∞ –∞–ª—å–±–æ–º, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–±–µ–∑ await), —á—Ç–æ–±—ã –Ω–µ –ø–∞–¥–∞–ª init.
      // –ë–µ—Ä—ë–º –∏–∫–æ–Ω–∫—É –∞–ª—å–±–æ–º–∞, –∞ –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî logo.
      // (–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –∏–º–µ–Ω–Ω–æ gallery first cover ‚Äî —Å–¥–µ–ª–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π async –ø—Ä–æ–≥—Ä–µ–≤ –ø–æ–∑–∂–µ, –±–µ–∑ await –≤ map.)
      let cv = this._ic[t.sourceAlbum] || 'img/logo.png';

      // –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π mobile –ø—É—Ç—å (—É —Ç–µ–±—è —Ä–µ–∞–ª—å–Ω–æ –µ—Å—Ç—å img/icon_album/mobile/<name>@1x.jpg)
      if (U.isMobile() && /\/icon_album\/[^/]+\.png$/i.test(cv)) {
        const m = cv.match(/\/icon_album\/([^/]+)\.png$/i);
        if (m) cv = `img/icon_album/mobile/${m[1]}@1x.jpg`;
      }

      return { ...t, album: '–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞', cover: cv };
    }).filter(Boolean);
  }

  async renderTab() {
    const list = $('track-list'); if (!list) return;

    if (this.editMode && !this._snap) this._snap = { isPl: !!Store.pId, ord: Store.pId ? [...Store.pls.find(p => p.id === Store.pId).uids] : [...Store.get('userOrder', [])], hid: Store.pId ? [...Store.pls.find(p => p.id === Store.pId).hiddenUids] : [...Store.get('hiddenUids', [])] };
    else if (!this.editMode) this._snap = null;

    const showRes = !this.editMode && !Store.pId && JSON.stringify(Store.get('userOrder', [])) !== JSON.stringify(Store.get('masterOrder', []));

    list.innerHTML = `
      <div class="showcase-header-controls">
        ${this.editMode ? `<div class="showcase-edit-banner">‚úèÔ∏è –†–ï–ñ–ò–ú –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø<div style="display:flex;gap:8px;margin-top:10px;"><button class="showcase-btn" id="sc-save" style="background:#fff; color:#000;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="showcase-btn" id="sc-reset-edit" style="background:transparent; border-color:#ff9800;">‚Ü∫ –°–±—Ä–æ—Å</button><button class="showcase-btn showcase-btn--danger" id="sc-cancel">‚úï –í—ã–π—Ç–∏</button></div></div>` : ''}
        <div class="showcase-search-wrap"><input type="text" class="showcase-search" id="sc-search" placeholder="üîç –ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–∞ –∏–ª–∏ —Ç–µ–∫—Å—Ç–∞..." value="${esc(this.searchQuery)}"><button type="button" class="showcase-search-clear" id="sc-search-clear" style="display:${this.searchQuery?'':'none'}">‚úï</button></div>
        <div class="showcase-btns-row">
          ${!this.editMode ? `<button class="showcase-btn" id="sc-edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>` : ''}
          ${showRes ? `<button class="showcase-btn" id="sc-master-reset" style="flex:0.5">‚Ü∫ –°–±—Ä–æ—Å</button>` : ''}
          <button class="showcase-btn" id="sc-sort">‚ÜïÔ∏è –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ ${this.sortMode !== 'user' ? '‚óè' : ''}</button>
        </div>
        ${!this.editMode ? `<div class="showcase-btns-row"><button class="showcase-btn" id="sc-playall">‚ñ∂ –ò–≥—Ä–∞—Ç—å –≤—Å—ë</button><button class="showcase-btn" id="sc-shuffle">üîÄ –ü–µ—Ä–µ–º–µ—à–∞—Ç—å</button></div>` : ''}
        <div class="showcase-playlists-actions" id="sc-playlists-actions"></div><div class="showcase-playlists-list" id="sc-playlists"></div><div class="showcase-status-bar" id="sc-status"></div>
      </div><div id="sc-tracks-container"></div>`;

    this.bindCtrl(list); this.renderPls(); await this.renderList();
    if (!this.editMode) { const lu = Store.get('lastTrackUid'); if (lu && Store.get('lastPlayingContext') === (Store.pId ? `__showcase__:${Store.pId}` : '__showcase__')) this.hiTrack(lu); }
  }

  bindCtrl(root) {
    const inp = $('sc-search'), clr = $('sc-search-clear');
    const applyQ = U.func.debounceFrame(async () => { this.searchQuery = (inp?.value || '').trim(); await this.renderList(); if (clr) clr.style.display = this.searchQuery ? '' : 'none'; });

    if (inp) {
      inp.addEventListener('input', applyQ);
      inp.addEventListener('keydown', e => e.key === 'Enter' && inp.blur());
      inp.addEventListener('blur', () => window.scrollTo({ top: window.scrollY, behavior: 'instant' }));
    }
    if (clr) clr.addEventListener('click', e => { e.preventDefault(); if (inp) { inp.value = ''; inp.blur(); } this.searchQuery = ''; this.renderList(); clr.style.display = 'none'; });

    const acts = {
      'sc-edit': () => { if (this.sortMode !== 'user') return W.NotificationSystem.warning('–°–±—Ä–æ—Å—å—Ç–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É'); this.editMode = true; this.selectedUids.clear(); this.renderTab(); },
      'sc-save': () => { this.editMode = false; this.selectedUids.clear(); this.renderTab(); W.NotificationSystem.success('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ'); },
      'sc-cancel': () => { this.rstSnap(); this.editMode = false; this.selectedUids.clear(); this.renderTab(); },
      'sc-reset-edit': () => { this.rstSnap(); this.selectedUids.clear(); this.renderList(); W.NotificationSystem.info('–°–±—Ä–æ—à–µ–Ω–æ'); },
      'sc-master-reset': () => W.Modals.confirm({ title: '–°–±—Ä–æ—Å–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫?', textHtml: '–ú–∞—Å—Ç–µ—Ä-—Å–ø–∏—Å–æ–∫ –≤–µ—Ä–Ω–µ—Ç—Å—è –∫ –¥–µ—Ñ–æ–ª—Ç—É.', confirmText: '–°–±—Ä–æ—Å–∏—Ç—å', onConfirm: () => { Store.set('userOrder', Store.get('masterOrder')); Store.set('hiddenUids', []); this.sortMode = 'user'; Store.set('sortMode', 'user'); this.renderTab(); } }),
      'sc-playall': () => this.playCtx(),
      'sc-shuffle': () => { this.sortMode = 'shuffle'; Store.set('sortMode', 'shuffle'); Store.set('shuffledOrder', null); this.playCtx(); this.renderTab(); },
      'sc-sort': () => this.openSort(),
      'sc-tg-e': () => { ls.setItem('showcase:showHidden:v1', ls.getItem('showcase:showHidden:v1') === '1' ? '0' : '1'); this.renderList(); },
      'sc-tg-n': () => { ls.setItem('showcase:showNumbers:v1', ls.getItem('showcase:showNumbers:v1') === '1' ? '0' : '1'); this.renderList(); },
      'sc-tg-v': () => { this.viewMode = this.viewMode === 'flat' ? 'grouped' : 'flat'; Store.set('viewMode', this.viewMode); this.renderList(); }
    };

    let lpTm = null, isLp = false;
    root.addEventListener('touchstart', e => {
      const h = e.target.closest('.showcase-drag-handle'); if (h && this.editMode) return e.preventDefault(), this.strtDrg(e, h.closest('.showcase-track'));
      const t = e.target.closest('.showcase-track');
      if (t && this.editMode && !e.target.closest('button')) {
        isLp = false; lpTm = setTimeout(() => { isLp = true; this.togSel(t.dataset.uid); navigator.vibrate?.(50); }, 500);
      }
    }, { passive: false });
    root.addEventListener('touchmove', () => clearTimeout(lpTm), { passive: true });
    root.addEventListener('touchend', () => clearTimeout(lpTm));

    root.addEventListener('click', e => {
      if (acts[e.target.id]) return acts[e.target.id]();
      if (isLp) return;
      const t = e.target.closest('.showcase-track'), u = t?.dataset.uid;
      if (!t) return;

      if (this.editMode) {
        if (e.target.closest('.showcase-hide-btn')) return this.togHid(u);
        if (e.target.closest('.sc-arrow-up')) return this.swp(u, -1);
        if (e.target.closest('.sc-arrow-down')) return this.swp(u, 1);
        if (this.selectedUids.size > 0 || e.target.closest('.showcase-checkbox')) return this.togSel(u);
        return this.opnMenu(u);
      }
      if (e.target.closest('.showcase-track-menu-btn')) return this.opnMenu(u);
      if (e.target.closest('.like-star') || e.target.closest('.offline-ind')) return;
      this.playCtx(u);
    });

    root.addEventListener('dragstart', e => { if (!this.editMode) return; const t = e.target.closest('.showcase-track'); if (t) { e.dataTransfer.setData('text/plain', t.dataset.uid); t.classList.add('is-dragging'); }});
    root.addEventListener('dragover', e => { if (!this.editMode) return; e.preventDefault(); const t = e.target.closest('.showcase-track'); if (t) t.classList.add('drag-over');});
    root.addEventListener('dragleave', e => e.target.closest('.showcase-track')?.classList.remove('drag-over'));
    root.addEventListener('drop', e => {
      if (!this.editMode) return; e.preventDefault();
      const t = e.target.closest('.showcase-track'), s = e.dataTransfer.getData('text/plain');
      D.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
      if (t && s && s !== t.dataset.uid) { t.before(D.querySelector(`.showcase-track[data-uid="${s}"]`)); this.svOrd(); }
    });
    root.addEventListener('dragend', () => D.querySelectorAll('.is-dragging').forEach(el => el.classList.remove('is-dragging')));
  }

  rstSnap() {
    if (!this._snap) return;
    const { isPl, ord, hid } = this._snap;
    if (isPl) { const p = Store.pls; const trg = p.find(x => x.id === Store.pId); if (trg) { trg.uids = ord; trg.hiddenUids = hid; Store.pls = p; } }
    else { Store.set('userOrder', ord); Store.set('hiddenUids', hid); }
  }

  async playCtx(uid = null) {
    const id = Store.pId, k = id ? `__showcase__:${id}` : '__showcase__';
    const trks = await this.getActiveListTracks();
    if (!trks.length) return;
    let idx = uid ? Math.max(0, trks.findIndex(t => t.uid === uid)) : 0;
    W.AlbumsManager.setPlayingAlbum(k);
    W.playerCore.setPlaylist(trks, idx, null, { preservePosition: false });
    W.playerCore.play(idx);
    W.PlayerUI.ensurePlayerBlock(idx, { userInitiated: true });
    this.hiTrack(trks[idx].uid);
  }

  renderPls() {
    const act = $('sc-playlists-actions'), lst = $('sc-playlists'), id = Store.pId, pls = Store.pls, col = Store.pCol;
    if (!act || !lst) return;
    act.innerHTML = `<button class="sc-pl-action ${!id ? 'active' : ''}" id="sc-pl-all">–í—Å–µ —Ç—Ä–µ–∫–∏</button><button class="sc-pl-action" id="sc-pl-nw">+ –ù–æ–≤—ã–π</button><button class="sc-pl-action" id="sc-pl-pst" title="–í—Å—Ç–∞–≤–∏—Ç—å">üìã</button>`;
    act.onclick = e => {
      const i = e.target.id;
      if (i === 'sc-pl-all') { Store.pId = null; this.renderTab(); }
      else if (i === 'sc-pl-nw') this.mkPl();
      else if (i === 'sc-pl-pst') navigator.clipboard.readText().then(t => this.hndlShPl(new URLSearchParams(t.split('?')[1] || t).get('playlist') || t)).catch(()=>W.NotificationSystem.error('–û—à–∏–±–∫–∞ –±—É—Ñ–µ—Ä–∞'));
    };
    if (!pls.length) return lst.innerHTML = `<div class="sc-pl-empty">–ü–ª–µ–π–ª–∏—Å—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>`;
    lst.innerHTML = pls.map(p => `<div class="sc-pl-row ${id === p.id ? 'active' : ''}" data-pid="${p.id}" ${col[p.id] ? `style="--pl-color:${col[p.id]};"` : ''}><div class="sc-pl-left"><span class="sc-pl-dot"></span><span class="sc-pl-title" title="${esc(p.name)}">${esc(p.name)}</span></div><div class="sc-pl-right"><button class="sc-pl-btn" data-act="shr" data-pid="${p.id}">üîó</button><button class="sc-pl-btn" data-act="ed" data-pid="${p.id}">üî®</button><button class="sc-pl-btn" data-act="col" data-pid="${p.id}">üé®</button><button class="sc-pl-btn danger" data-act="del" data-pid="${p.id}">‚úñ</button></div></div>`).join('');
    lst.onclick = e => {
      const a = e.target.closest('[data-act]')?.dataset.act, pid = e.target.closest('[data-pid]')?.dataset.pid;
      if (a && pid) {
        if (a === 'ed') { Store.pId = pid; this.editMode = true; this.renderTab(); }
        else if (a === 'shr') this.shrPl(pid);
        else if (a === 'del') W.Modals.confirm({ title: '–£–¥–∞–ª–∏—Ç—å?', confirmText: '–î–∞', onConfirm: () => { Store.pls = Store.pls.filter(p => p.id !== pid); if (Store.pId === pid) Store.pId = null; this.renderTab(); }});
        else if (a === 'col') this.opnCol(null, null, pid);
      } else if (e.target.closest('.sc-pl-row')?.dataset.pid) { Store.pId = e.target.closest('.sc-pl-row').dataset.pid; this.renderTab(); }
    };
  }

  async renderList() {
    const c = $('sc-tracks-container'); if (!c) return;
    const trks = await this.getActiveListTracks(), cols = Store.aCol, hidL = Store.pId ? (Store.pls.find(p=>p.id===Store.pId)?.hiddenUids||[]) : Store.get('hiddenUids', []);
    this.updStatus(trks.length);
    let h = '', grp = null, sN = localStorage.getItem('showcase:showNumbers:v1') === '1';
    trks.forEach((t, i) => {
      if (this.viewMode === 'grouped' && grp !== t.sourceAlbum) {
        grp = t.sourceAlbum;
        const albumTitle = W.TrackRegistry.getAlbumTitle(t.sourceAlbum) || '–ê–ª—å–±–æ–º';
        h += `<div class="showcase-group-header">‚îÄ‚îÄ ${esc(albumTitle)} ‚îÄ‚îÄ</div>`;
      }
      const cl = cols[t.sourceAlbum] || 'transparent', isH = hidL.includes(t.uid), isS = this.selectedUids.has(t.uid);
      h += `<div class="showcase-track ${isH?'inactive':''} ${isS?'selected':''}" data-uid="${t.uid}" style="border-left: 3px solid ${cl}" ${this.editMode?'draggable="true"':''}>${this.editMode?`<button class="sc-arrow-up" data-dir="-1">‚ñ≤</button>`:`<div class="tnum"${sN?'':' style="display:none"'}>${i+1}.</div>`}${this.editMode?`<div class="showcase-drag-handle">‚†ø</div><div class="showcase-checkbox"></div>`:''}<img src="${t.cover}" class="showcase-track-thumb" loading="lazy"><div class="track-title"><div>${esc(t.title)}</div><div class="showcase-track-meta">${esc(W.TrackRegistry.getAlbumTitle(t.sourceAlbum))}</div></div><span class="offline-ind" data-uid="${t.uid}">üîí</span>${this.editMode?`<button class="showcase-hide-btn">${isH?'üëÅ‚Äçüó®':'üëÅ'}</button>`:''}<img src="${W.playerCore?.isFavorite(t.uid)?'img/star.png':'img/star2.png'}" class="like-star" data-uid="${t.uid}" data-album="${t.sourceAlbum}">${!this.editMode?`<button class="showcase-track-menu-btn">¬∑¬∑¬∑</button>`:`<button class="sc-arrow-down" data-dir="1">‚ñº</button>`}</div>`;
    });
    if (this.editMode && Store.pId) h += `<div style="padding:20px;text-align:center;"><button class="showcase-btn" id="sc-add-t">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫–∏</button></div>`;
    c.innerHTML = h || '<div class="fav-empty">–¢—Ä–µ–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
    $('sc-add-t')?.addEventListener('click', () => this.addTrks());
    W.OfflineIndicators?.injectOfflineIndicators?.(c); this.hiTrack(W.playerCore?.getCurrentTrackUid()); this.rndrMPnl();
  }

  updStatus(cnt) {
    const s = $('sc-status'); if (!s) return;
    const dom = D.querySelectorAll('.showcase-track'), f = D.querySelectorAll('.showcase-track .like-star[src*="star.png"]').length, o = D.querySelectorAll('.showcase-track .offline-ind:not(.offline-ind--none)').length, c = Array.from(D.querySelectorAll('.showcase-track .offline-ind')).filter(n => (n?.textContent||'').trim() === '‚òÅ').length;
    s.innerHTML = `<span>üìã ${cnt??dom.length} ¬∑ ‚≠ê ${f} ¬∑ üîí ${o} ¬∑ ‚òÅ ${c}${this.editMode&&this.selectedUids.size?`<span style="color:#ff9800"> ¬∑ ‚úì ${this.selectedUids.size}</span>`:''}</span><span style="display:flex;gap:12px;align-items:center"><span id="sc-tg-e" style="cursor:pointer;font-size:18px" title="–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–∫—Ä—ã—Ç—ã–µ">${localStorage.getItem('showcase:showHidden:v1')==='1'?'üëÅ':'üôà'}</span><span id="sc-tg-n" style="cursor:pointer;font-size:18px" title="–ù—É–º–µ—Ä–∞—Ü–∏—è">${localStorage.getItem('showcase:showNumbers:v1')==='1'?'1,2,3':''}</span><span id="sc-tg-v" style="cursor:pointer;font-size:18px" title="–°–º–µ–Ω–∏—Ç—å –≤–∏–¥">${this.viewMode==='flat'?'‚äû':'‚äü'}</span></span>`;
  }

  swp(u, d) { const el = D.querySelector(`.showcase-track[data-uid="${u}"]`), sb = d === -1 ? el?.previousElementSibling : el?.nextElementSibling; if (el && sb?.classList.contains('showcase-track')) { d === -1 ? sb.before(el) : sb.after(el); this.svOrd(); } }
  svOrd() { const u = Array.from(D.querySelectorAll('.showcase-track')).map(e => e.dataset.uid); if (Store.pId) { const p = Store.pls; p.find(x=>x.id===Store.pId).uids = u; Store.pls = p; } else Store.set('userOrder', u); }
  strtDrg(e, n) {
    if(!n)return; const t=e.touches[0], c=n.cloneNode(true), r=n.getBoundingClientRect(), os=t.clientY-r.top;
    c.style.cssText=`position:fixed;left:${r.left}px;width:${r.width}px;z-index:10000;opacity:0.9;background:#252d39;box-shadow:0 10px 30px rgba(0,0,0,0.8);pointer-events:none`; D.body.appendChild(c); n.style.opacity=0.3;
    const m = e2 => { e2.preventDefault(); const y=e2.touches[0].clientY; c.style.top=(y-os)+'px'; D.querySelectorAll('.drag-over').forEach(el=>el.classList.remove('drag-over')); const o = D.elementFromPoint(W.innerWidth/2, y)?.closest('.showcase-track'); if(o && o!==n) o.classList.add('drag-over'); };
    const d = e2 => { D.removeEventListener('touchmove',m); D.removeEventListener('touchend',d); c.remove(); n.style.opacity=''; const y=e2.changedTouches[0].clientY, tg=D.elementFromPoint(W.innerWidth/2,y)?.closest('.showcase-track'); D.querySelectorAll('.drag-over').forEach(el=>el.classList.remove('drag-over')); if(tg && tg!==n) { tg.before(n); this.svOrd(); } };
    D.addEventListener('touchmove',m,{passive:false}); D.addEventListener('touchend',d);
  }

  togHid(u, sk = false) {
    const el = D.querySelector(`.showcase-track[data-uid="${u}"]`); if (el) { el.classList.toggle('inactive'); const b = el.querySelector('.showcase-hide-btn'); if(b) b.textContent = el.classList.contains('inactive') ? 'üëÅ‚Äçüó®' : 'üëÅ'; }
    let h = Store.pId ? Store.pls.find(p=>p.id===Store.pId).hiddenUids : Store.get('hiddenUids', []);
    h.includes(u) ? h = h.filter(x=>x!==u) : h.push(u);
    if (Store.pId) { const p = Store.pls; p.find(x=>x.id===Store.pId).hiddenUids = h; Store.pls = p; } else Store.set('hiddenUids', h);
  }

  togSel(u) {
    const el = D.querySelector(`.showcase-track[data-uid="${u}"]`);
    if (this.selectedUids.has(u)) { this.selectedUids.delete(u); el?.classList.remove('selected'); } else { this.selectedUids.add(u); el?.classList.add('selected'); }
    this.rndrMPnl(); this.updStatus();
  }

  rndrMPnl() {
    let p = $('sc-multi-panel'); if (!this.editMode || !this.selectedUids.size) return p?.remove();
    if (!p) { p = D.createElement('div'); p.id = 'sc-multi-panel'; p.className = 'showcase-multi-panel animate-in'; D.body.appendChild(p); }
    p.innerHTML = `<span style="color:#fff;font-weight:bold;font-size:14px;white-space:nowrap">${this.selectedUids.size} –≤—ã–±—Ä.</span><button class="showcase-btn" id="sc-m-hd">üëÅ –°–∫—Ä—ã—Ç—å</button><button class="showcase-btn" id="sc-m-cl">üé® –¶–≤–µ—Ç</button><button class="showcase-btn" id="sc-m-pl">‚ûï –í –ø–ª–µ–π–ª–∏—Å—Ç</button><button class="showcase-btn showcase-btn--danger" id="sc-m-cr">‚úñ</button>`;
    p.onclick = e => { const id=e.target.id; if(id==='sc-m-cr'){this.selectedUids.clear(); D.querySelectorAll('.showcase-track.selected').forEach(el=>el.classList.remove('selected')); this.rndrMPnl(); this.updStatus();}else if(id==='sc-m-hd'){[...this.selectedUids].forEach(u=>this.togHid(u,true)); $('sc-m-cr').click();}else if(id==='sc-m-cl') this.opnCol([...this.selectedUids][0]);else if(id==='sc-m-pl') this.opnAddPl([...this.selectedUids]); };
  }

  mkPl() {
    const m = W.Modals.open({ title: '–ù–æ–≤—ã–π –ø–ª–µ–π–ª–∏—Å—Ç', bodyHtml: `<input type="text" id="pl-inp" value="–ú–æ–π –ø–ª–µ–π–ª–∏—Å—Ç ${Store.pls.length+1}" style="width:100%;padding:10px;border-radius:8px;background:rgba(255,255,255,.1);color:#fff;border:1px solid #666;margin-bottom:15px"><div style="display:flex;gap:10px"><button class="showcase-btn" id="pl-btn">–°–æ–∑–¥–∞—Ç—å</button></div>` });
    setTimeout(() => m.querySelector('#pl-inp')?.focus(), 100);
    m.querySelector('#pl-btn').onclick = () => { const n = m.querySelector('#pl-inp').value.trim(); if(n) { const p = Store.pls, id = Date.now().toString(36); p.push({id, name:n, uids:[], hiddenUids:[], createdAt:Date.now()}); Store.pls = p; Store.pId = id; m.remove(); this.renderTab(); } };
  }

  shrPl(id) {
    const p = Store.pls.find(x=>x.id===id); if(!p)return; const url = `${W.location.origin}${W.location.pathname}?playlist=${btoa(unescape(encodeURIComponent(JSON.stringify({v:1,n:p.name,u:p.uids}))))}`;
    navigator.share ? navigator.share({title:p.name, url}).catch(()=>{}) : (navigator.clipboard.writeText(url), W.NotificationSystem.success('–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–ª–µ–π–ª–∏—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!'));
  }

  hndlShPl(b64) {
    try {
      const j = JSON.parse(decodeURIComponent(escape(atob(b64)))); if(!j.n || !Array.isArray(j.u)) throw 1;
      const u = j.u.filter(x=>W.TrackRegistry.getTrackByUid(x));
      W.Modals.confirm({ title: 'üéµ –í–∞–º –ø—Ä–∏—Å–ª–∞–Ω –ø–ª–µ–π–ª–∏—Å—Ç', textHtml: `<b>${esc(j.n)}</b><br><br>–î–æ—Å—Ç—É–ø–Ω–æ —Ç—Ä–µ–∫–æ–≤: ${u.length} –∏–∑ ${j.u.length}.${u.length<j.u.length?'<br><span style="color:#ff9800">–ß–∞—Å—Ç—å —Ç—Ä–µ–∫–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.</span>':''}`, confirmText: '–î–æ–±–∞–≤–∏—Ç—å', onConfirm: () => { const p=Store.pls; p.push({id:Date.now().toString(36), name:j.n+' (–ü—Ä–∏—Å–ª–∞–Ω–Ω—ã–π)', uids:u, hiddenUids:[], createdAt:Date.now()}); Store.pls=p; W.NotificationSystem.success('–ü–ª–µ–π–ª–∏—Å—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω'); if(!Store.pId) this.renderPls(); }});
    } catch { W.NotificationSystem.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ –ø–ª–µ–π–ª–∏—Å—Ç–∞'); }
  }

  openSort() {
    const sm = this.sortMode, m = W.Modals.open({ title: '–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞', bodyHtml: `<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;"><button class="showcase-btn ${sm==='user'?'active':''}" style="grid-column:1/-1" data-val="user">‚óè –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π (–†—É—á–Ω–æ–π)</button><button class="showcase-btn ${sm==='album-desc'?'active':''}" data-val="album-desc">–ê–ª—å–±–æ–º—ã (–ù–æ–≤—ã–µ)</button><button class="showcase-btn ${sm==='album-asc'?'active':''}" data-val="album-asc">–ê–ª—å–±–æ–º—ã (–°—Ç–∞—Ä—ã–µ)</button><button class="showcase-btn ${sm==='name-asc'?'active':''}" data-val="name-asc">–ê ‚Üí –Ø</button><button class="showcase-btn ${sm==='name-desc'?'active':''}" data-val="name-desc">–Ø ‚Üí –ê</button><button class="showcase-btn ${sm==='plays-desc'?'active':''}" data-val="plays-desc">–¢–æ–ø –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π</button><button class="showcase-btn ${sm==='plays-asc'?'active':''}" data-val="plays-asc">–ú–µ–Ω—å—à–µ –≤—Å–µ–≥–æ</button><button class="showcase-btn ${sm==='last-played'?'active':''}" data-val="last-played">–ù–µ–¥–∞–≤–Ω–∏–µ</button><button class="showcase-btn ${sm==='favorites-first'?'active':''}" data-val="favorites-first">–°–Ω–∞—á–∞–ª–∞ ‚≠ê</button><button class="showcase-btn ${sm==='shuffle'?'active':''}" style="grid-column:1/-1" data-val="shuffle">üîÄ –°–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫</button><button class="showcase-btn showcase-btn--danger" style="grid-column:1/-1" data-val="user">–°–±—Ä–æ—Å–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É</button></div>` });
    m.onclick = e => { const b = e.target.closest('[data-val]'); if(b) { this.sortMode = b.dataset.val; Store.set('sortMode', this.sortMode); if(this.sortMode==='shuffle') Store.set('shuffledOrder', null); this.renderTab(); m.remove(); } };
  }

  opnMenu(u) {
    if(this._menu) this._menu.remove(); const t = W.TrackRegistry.getTrackByUid(u); if(!t) return;
    const bg = D.createElement('div'); bg.className = 'sc-bottom-sheet-bg';
    bg.innerHTML = `<div class="sc-bottom-sheet"><div class="sc-sheet-title">${esc(t.title)}</div><div class="sc-sheet-sub">${esc(W.TrackRegistry.getAlbumTitle(t.sourceAlbum))}</div><button class="sc-sheet-btn" id="bm-pl">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–ª–µ–π–ª–∏—Å—Ç</button>${Store.pId?`<button class="sc-sheet-btn" id="bm-rm" style="color:#ff6b6b">‚úñ –£–¥–∞–ª–∏—Ç—å –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –ø–ª–µ–π–ª–∏—Å—Ç–∞</button>`:''}<button class="sc-sheet-btn" id="bm-hd">üëÅ –°–∫—Ä—ã—Ç—å / –ü–æ–∫–∞–∑–∞—Ç—å —Ç—Ä–µ–∫</button><button class="sc-sheet-btn" id="bm-fv">${W.playerCore?.isFavorite(u)?'‚ùå –£–±—Ä–∞—Ç—å –∏–∑ –ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ':'‚≠ê –í –ò–∑–±—Ä–∞–Ω–Ω–æ–µ'}</button><button class="sc-sheet-btn" id="bm-of">üîí –°–∫–∞—á–∞—Ç—å / –£–±—Ä–∞—Ç—å –∏–∑ –æ—Ñ–ª–∞–π–Ω</button><button class="sc-sheet-btn" id="bm-dl">‚¨áÔ∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç—å mp3 —Ñ–∞–π–ª</button><button class="sc-sheet-btn" id="bm-st">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç—Ä–µ–∫–∞</button><button class="sc-sheet-btn" id="bm-sh">üì∏ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ç—Ä–µ–∫–æ–º (–ö–∞—Ä—Ç–æ—á–∫–∞)</button><button class="sc-sheet-btn" id="bm-cl">üé® –¶–≤–µ—Ç –∞–ª—å–±–æ–º–∞</button><button class="sc-sheet-btn" style="color:#888;justify-content:center;margin-top:10px" id="bm-cx">–û—Ç–º–µ–Ω–∞</button></div>`;
    D.body.appendChild(bg); this._menu = bg; requestAnimationFrame(() => bg.classList.add('active'));
    const cls = () => { bg.classList.remove('active'); setTimeout(()=>bg.remove(), 200); this._menu=null; };
    bg.onclick = e => {
      const id = e.target.id; if(e.target===bg || id==='bm-cx') return cls(); if(!id) return; cls();
      if(id==='bm-pl') setTimeout(()=>this.opnAddPl([u]),250); else if(id==='bm-rm') { const p=Store.pls, tr=p.find(x=>x.id===Store.pId); if(tr) { tr.uids=tr.uids.filter(x=>x!==u); Store.pls=p; this.renderList(); } } else if(id==='bm-hd') this.togHid(u); else if(id==='bm-fv') W.playerCore?.toggleFavorite(u,{albumKey:t.sourceAlbum}); else if(id==='bm-of') W.OfflineManager?.togglePinned?.(u); else if(id==='bm-dl') { const a=D.createElement('a'); U.download.applyDownloadLink(a,t); if(a.href) a.click(); } else if(id==='bm-st') setTimeout(()=>W.StatisticsModal?.openStatisticsModal?.(u),250); else if(id==='bm-sh') setTimeout(()=>import('../../analytics/share-generator.js').then(m=>m.ShareGenerator.generateAndShare('track',t)),250); else if(id==='bm-cl') setTimeout(()=>this.opnCol(u),250);
    };
  }

  opnAddPl(uids) {
    const pls = Store.pls; if(!pls.length) return W.NotificationSystem.warning('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø–ª–µ–π–ª–∏—Å—Ç');
    const m = W.Modals.open({ title: '–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–µ–π–ª–∏—Å—Ç', bodyHtml: `<div style="display:flex;flex-direction:column;gap:10px;">${pls.map(p=>`<button class="showcase-btn" data-pid="${p.id}">${esc(p.name)}</button>`).join('')}</div>` });
    m.onclick = e => { const b=e.target.closest('[data-pid]'); if(b) { const t=pls.find(x=>x.id===b.dataset.pid); uids.forEach(u=>{if(!t.uids.includes(u)) t.uids.push(u);}); Store.pls=pls; W.NotificationSystem.success(`–î–æ–±–∞–≤–ª–µ–Ω–æ —Ç—Ä–µ–∫–æ–≤: ${uids.length}`); m.remove(); $('sc-m-cr')?.click(); } };
  }

  addTrks() {
    const a = Store.get('userOrder',[]).map(u=>W.TrackRegistry.getTrackByUid(u)).filter(Boolean), c = Store.pls.find(p=>p.id===Store.pId)?.uids||[];
    const m = W.Modals.open({ title: '–¢—Ä–µ–∫–∏ –∏–∑ –í–∏—Ç—Ä–∏–Ω—ã', bodyHtml: `<div style="max-height:50vh;overflow-y:auto;display:flex;flex-direction:column;gap:6px;margin-bottom:15px;">${a.map(t=>`<label style="display:flex;align-items:center;gap:10px;padding:6px;background:rgba(255,255,255,.05);border-radius:6px;"><input type="checkbox" value="${t.uid}" class="pl-add-chk" ${c.includes(t.uid)?'checked disabled':''}>${esc(t.title)} <span style="opacity:.5;font-size:11px">${esc(W.TrackRegistry.getAlbumTitle(t.sourceAlbum))}</span></label>`).join('')}</div><button class="showcase-btn" id="pl-ac">–î–æ–±–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>` });
    m.querySelector('#pl-ac').onclick = () => { const ch = Array.from(m.querySelectorAll('.pl-add-chk:checked:not(:disabled)')).map(i=>i.value); if(ch.length) { const p=Store.pls; p.find(x=>x.id===Store.pId).uids.push(...ch); Store.pls=p; this.renderList(); W.NotificationSystem.success(`–î–æ–±–∞–≤–ª–µ–Ω–æ: ${ch.length}`); } m.remove(); };
  }

  opnCol(u, aKey = null, pId = null) {
    if (u && !aKey) aKey = W.TrackRegistry.getTrackByUid(u)?.sourceAlbum;
    const cur = pId ? Store.pCol[pId] : Store.aCol[aKey], m = W.Modals.open({ title: pId ? '–¶–≤–µ—Ç –ø–ª–µ–π–ª–∏—Å—Ç–∞' : '–¶–≤–µ—Ç –∞–ª—å–±–æ–º–∞', bodyHtml: `<div class="showcase-color-picker">${PALETTE.map(c=>`<div class="showcase-color-dot" style="background:${c};${cur===c?'border-color:#fff':''}" data-col="${c}"></div>`).join('')}</div><button class="showcase-btn" data-col="transparent" style="margin-top:15px;width:100%">–°–±—Ä–æ—Å–∏—Ç—å —Ü–≤–µ—Ç</button>` });
    m.onclick = e => { const el = e.target.closest('[data-col]'); if(el) { const c = el.dataset.col==='transparent'?'':el.dataset.col; if(pId) { const p = Store.pCol; p[pId]=c; Store.pCol=p; this.renderPls(); } else { const a = Store.aCol; a[aKey]=c; Store.aCol=a; W.AlbumsManager?.getCurrentAlbum() === '__showcase__' && this.renderList(); } m.remove(); } };
  }

  hiTrack(u) { D.querySelectorAll('.showcase-track.current').forEach(e=>e.classList.remove('current')); if(u) D.querySelectorAll(`.showcase-track[data-uid="${CSS.escape(u)}"]`).forEach(e=>e.classList.add('current')); }
}

W.ShowcaseManager = new ShowcaseManager();
export default W.ShowcaseManager;

//=================================================
// FILE: /scripts/app/showcase/lyrics-search.js
/**
 * scripts/app/showcase/lyrics-search.js
 * Offline fast search (title/album/lyrics) based on prebuilt index file.
 *
 * Index is expected at: ./data/lyrics-index-v1.json
 * Format v1:
 * {
 *   v: 1,
 *   buildTs: number,
 *   meta: { [uid]: { t: string, a: string, k: string, n?: number } },
 *   idx:  { [token]: string[] }
 * }
 */

const W = window;

const INDEX_URL = './data/lyrics-index-v1.json';

let _loaded = false;
let _pending = null;

let _meta = {};
let _idx = {};
let _buildTs = 0;

const normStr = (s) => String(s || '')
  .toLowerCase()
  .replace(/—ë/g, '–µ')
  .replace(/[^\p{L}\p{N}\s]+/gu, ' ')
  .replace(/\s+/g, ' ')
  .trim();

const tokenize = (q) => {
  const s = normStr(q);
  if (!s) return [];
  return s.split(' ').filter(w => w.length >= 2);
};

async function fetchJsonCacheFirst(url) {
  // Cache-first: —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ SW precache.
  const r = await fetch(url, { cache: 'force-cache' });
  if (!r.ok) throw new Error('HTTP ' + r.status);
  return r.json();
}

export async function ensureLyricsIndexLoaded() {
  if (_loaded) return true;
  if (_pending) return _pending;

  _pending = (async () => {
    try {
      const j = await fetchJsonCacheFirst(INDEX_URL);
      if (!j || j.v !== 1 || typeof j !== 'object') throw new Error('Bad index format');

      _meta = j.meta && typeof j.meta === 'object' ? j.meta : {};
      _idx = j.idx && typeof j.idx === 'object' ? j.idx : {};
      _buildTs = Number(j.buildTs) || 0;

      _loaded = true;
      return true;
    } catch (e) {
      // –ò–Ω–¥–µ–∫—Å –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∑–∞–ø—É—Å–∫–∞ UI: –ø—Ä–æ—Å—Ç–æ —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ lyrics-–ø–æ–∏—Å–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.
      _meta = {};
      _idx = {};
      _buildTs = 0;
      _loaded = false;
      return false;
    } finally {
      _pending = null;
    }
  })();

  return _pending;
}

export function getLyricsIndexState() {
  return { loaded: _loaded, buildTs: _buildTs, metaCount: Object.keys(_meta).length };
}

function getTrackText(uid) {
  const t = W.TrackRegistry?.getTrackByUid?.(uid);
  if (!t) return { title: '', album: '' };

  const title = String(t.title || '');
  const album = String(W.TrackRegistry?.getAlbumTitle?.(t.sourceAlbum) || t.album || '');
  return { title, album };
}

export function searchUidsByQuery({ uids, query }) {
  const q = String(query || '').trim();
  if (!q) return uids;

  const qNorm = normStr(q);
  const toks = tokenize(qNorm);

  // –ë–∞–∑–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤: –µ—Å–ª–∏ –∏–Ω–¥–µ–∫—Å –∑–∞–≥—Ä—É–∂–µ–Ω ‚Äî –∏–∑ idx, –∏–Ω–∞—á–µ –ø—Ä–æ—Å—Ç–æ "–≤—Å–µ uids" (–ø–æ–∏—Å–∫–æ–º –ø–æ title/album).
  let candidates = null;

  if (_loaded && toks.length) {
    const set = new Set();
    toks.forEach(tok => {
      const list = _idx[tok];
      if (Array.isArray(list)) list.forEach(uid => set.add(uid));
    });
    candidates = [...set];
  } else {
    candidates = [...uids];
  }

  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ —Ç–µ–∫—É—â–∏–º —Å–ø–∏—Å–∫–æ–º (–º–∞—Å—Ç–µ—Ä/–ø–ª–µ–π–ª–∏—Å—Ç) ‚Äî –≤–∞–∂–Ω–æ –¥–ª—è Showcase.
  const allowed = new Set(uids);
  candidates = candidates.filter(uid => allowed.has(uid));

  // –°–∫–æ—Ä–∏–Ω–≥: title > album > lyrics.
  const scored = candidates.map(uid => {
    const { title, album } = getTrackText(uid);
    const tN = normStr(title);
    const aN = normStr(album);

    let score = 0;

    // –§—Ä–∞–∑–∞ —Ü–µ–ª–∏–∫–æ–º
    if (tN.includes(qNorm)) score += 120;
    if (aN.includes(qNorm)) score += 70;

    // –¢–æ–∫–µ–Ω—ã
    toks.forEach(tok => {
      if (tN.includes(tok)) score += 40;
      else if (aN.includes(tok)) score += 20;
      else if (_loaded && Array.isArray(_idx[tok]) && _idx[tok].includes(uid)) score += 8;
    });

    return { uid, score };
  });

  scored.sort((x, y) => y.score - x.score);

  // –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –Ω–∞–±—Ä–∞–ª 0 ‚Äî –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º, –Ω–æ –Ω–∏–∂–µ (—ç—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤).
  return scored.map(x => x.uid);
}

//=================================================
// FILE: /scripts/app/track-registry.js
/**
 * track-registry.js ‚Äî –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä —Ç—Ä–µ–∫–æ–≤ –ø–æ uid.
 * –ü–æ–∑–≤–æ–ª—è–µ—Ç –ª—é–±–æ–º—É –º–æ–¥—É–ª—é –ø–æ–ª—É—á–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∞ –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫—ç—à—É –∞–ª—å–±–æ–º–æ–≤.
 */

const _tracks = new Map();
const _albums = new Map();
const _albumConfigs = new Map();
const _albumTracks = new Map();
let _populatedPromise = null;

const toUrl = (b, r) => r ? new URL(r, b).toString() : null;

/**
 * –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–∫.
 * @param {Object} track - { uid, title, audio, audio_low, size, size_low, lyrics, fulltext, sourceAlbum }
 * @param {Object} [albumMeta] - { title }
 */
export function registerTrack(track, albumMeta) {
  if (!track?.uid) return;
  const uid = String(track.uid).trim();
  if (!uid) return;

  _tracks.set(uid, {
    uid,
    title: track.title || '–¢—Ä–µ–∫',
    audio: track.audio || null,
    audio_low: track.audio_low || null,
    src: track.audio || null,
    size: track.size || 0,
    size_low: track.size_low || 0,
    lyrics: track.lyrics || null,
    fulltext: track.fulltext || null,
    sourceAlbum: track.sourceAlbum || null,
    album: albumMeta?.title || null
  });

  if (track.sourceAlbum && albumMeta?.title) {
    _albums.set(track.sourceAlbum, albumMeta.title);
  }
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–µ–∫ –ø–æ uid.
 */
export function getTrackByUid(uid) {
  const u = String(uid || '').trim();
  return _tracks.get(u) || null;
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ uid.
 */
export function getAllUids() {
  return [..._tracks.keys()];
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–ª—å–±–æ–º–∞ –ø–æ –∫–ª—é—á—É.
 */
export function getAlbumTitle(key) { return _albums.get(key) || null; }
export function getAlbumConfig(key) { return _albumConfigs.get(key) || null; }
export function getTracksForAlbum(key) { return _albumTracks.get(key) || []; }

export async function ensurePopulated() {
    if (_populatedPromise) return _populatedPromise;
    _populatedPromise = (async () => {
    if (!window.albumsIndex?.length) {
    try { await window.Utils?.onceEvent?.(window, 'albumsIndex:ready', { timeoutMs: 5000 }); } catch {}
    }
    const idx = window.albumsIndex || [];
    await Promise.allSettled(idx.filter(a => !a.key.startsWith('__')).map(async a => {
      try {
        const base = a.base.endsWith('/') ? a.base : `${a.base}/`;
        const r = await fetch(`${base}config.json`, { cache: 'force-cache' });
        if (!r.ok) return;
        const raw = await r.json();
        
        const title = raw.albumName || a.title;
        _albums.set(a.key, title);
        
        _albumConfigs.set(a.key, {
          title,
          artist: raw.artist || '–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞',
          links: (raw.social_links || raw.socials || []).map(s => ({ label: s.title || s.label, url: s.url }))
        });

        const trks = (raw.tracks || []).map((t, i) => {
          const hi = toUrl(base, t.audio), lo = toUrl(base, t.audio_low), uid = String(t.uid || '').trim() || null;
          if (uid) registerTrack({ uid, title: t.title, audio: hi, audio_low: lo, size: t.size, size_low: t.size_low, lyrics: toUrl(base, t.lyrics), fulltext: toUrl(base, t.fulltext), sourceAlbum: a.key }, { title });
          return { num: i + 1, title: t.title || `–¢—Ä–µ–∫ ${i + 1}`, uid, src: hi, sources: (hi || lo) ? { audio: { hi, lo } } : null, lyrics: toUrl(base, t.lyrics), fulltext: toUrl(base, t.fulltext), hasLyrics: t.hasLyrics ?? !!t.lyrics };
        });
        _albumTracks.set(a.key, trks);
      } catch(e) { console.error('[TrackRegistry]', e); }
    }));
  })();
  return _populatedPromise;
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø
const TrackRegistry = { registerTrack, getTrackByUid, getAllUids, getAlbumTitle, ensurePopulated, getAlbumConfig, getTracksForAlbum };
window.TrackRegistry = TrackRegistry;

export default TrackRegistry;

//=================================================
// FILE: /scripts/ci/generate-lyrics-index.mjs
#!/usr/bin/env node
import fs from 'node:fs';
import path from 'node:path';

const ROOT = process.cwd();
const ALBUMS_FILE = path.resolve(ROOT, 'albums.json');
const OUT_FILE = path.resolve(ROOT, 'data/lyrics-index-v1.json');

const escRe = /[^\p{L}\p{N}\s]+/gu;

function normStr(s) {
  return String(s || '')
    .toLowerCase()
    .replace(/—ë/g, '–µ')
    .replace(escRe, ' ')
    .replace(/\s+/g, ' ')
    .trim();
}

function tokenize(s) {
  const t = normStr(s);
  if (!t) return [];
  return t.split(' ').filter(w => w.length >= 2);
}

async function fetchText(url) {
  const r = await fetch(url, { cache: 'no-cache' });
  if (!r.ok) throw new Error(`HTTP ${r.status} for ${url}`);
  return r.text();
}

async function fetchJson(url) {
  const r = await fetch(url, { cache: 'no-cache' });
  if (!r.ok) throw new Error(`HTTP ${r.status} for ${url}`);
  return r.json();
}

function ensureDirForFile(file) {
  const dir = path.dirname(file);
  if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });
}

function uniq(arr) {
  return [...new Set(arr)];
}

async function main() {
  if (!fs.existsSync(ALBUMS_FILE)) {
    console.error('albums.json not found at', ALBUMS_FILE);
    process.exit(2);
  }

  const albumsJson = JSON.parse(fs.readFileSync(ALBUMS_FILE, 'utf8'));
  const albums = Array.isArray(albumsJson?.albums) ? albumsJson.albums : [];

  const meta = {};
  const idx = {}; // token -> Set(uids) during build

  const errors = [];
  let totalTracks = 0;
  let totalTexts = 0;

  for (const a of albums) {
    const albumKey = String(a?.key || '').trim();
    const albumTitle = String(a?.title || '').trim();
    const base = String(a?.base || '').trim();
    if (!albumKey || !base) continue;

    const baseUrl = base.endsWith('/') ? base : `${base}/`;
    const cfgUrl = `${baseUrl}config.json`;

    let cfg;
    try {
      cfg = await fetchJson(cfgUrl);
    } catch (e) {
      errors.push(`config.json failed: ${albumKey} (${cfgUrl}) -> ${e.message}`);
      continue;
    }

    const tracks = Array.isArray(cfg?.tracks) ? cfg.tracks : [];
    totalTracks += tracks.length;

    for (let i = 0; i < tracks.length; i++) {
      const tr = tracks[i] || {};
      const uid = String(tr.uid || '').trim();
      if (!uid) continue;

      const title = String(tr.title || `–¢—Ä–µ–∫ ${i + 1}`);
      meta[uid] = { t: title, a: albumTitle || String(cfg?.albumName || ''), k: albumKey, n: i + 1 };

      // –ë–µ—Ä—ë–º fulltext (txt), –∫–∞–∫ —Ç—ã –æ–ø–∏—Å–∞–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É
      const rel = String(tr.fulltext || '').trim();
      if (!rel) continue;

      const url = new URL(rel, baseUrl).toString();

      let text = '';
      try {
        text = await fetchText(url);
      } catch (e) {
        errors.push(`fulltext failed: uid=${uid} (${url}) -> ${e.message}`);
        continue;
      }

      totalTexts++;
      const toks = tokenize(text);
      toks.forEach(tok => {
        if (!idx[tok]) idx[tok] = new Set();
        idx[tok].add(uid);
      });

      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º title+album (—á—Ç–æ–±—ã ‚Äú—Å—Ç—Ä–æ–∫–∏ –∏–∑ –∏–º–µ–Ω–∏‚Äù —Ä–∞–±–æ—Ç–∞–ª–∏ –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ—Ç —Ç–µ–∫—Å—Ç–∞)
      tokenize(title).forEach(tok => {
        if (!idx[tok]) idx[tok] = new Set();
        idx[tok].add(uid);
      });
      tokenize(albumTitle).forEach(tok => {
        if (!idx[tok]) idx[tok] = new Set();
        idx[tok].add(uid);
      });
    }
  }

  // Convert Sets -> sorted arrays (stable)
  const idxOut = {};
  for (const [tok, set] of Object.entries(idx)) {
    idxOut[tok] = uniq([...set]).sort();
  }

  const payload = {
    v: 1,
    buildTs: Date.now(),
    meta,
    idx: idxOut
  };

  ensureDirForFile(OUT_FILE);
  fs.writeFileSync(OUT_FILE, JSON.stringify(payload), 'utf8');

  console.log('[lyrics-index] albums:', albums.length);
  console.log('[lyrics-index] tracks:', totalTracks);
  console.log('[lyrics-index] texts fetched:', totalTexts);
  console.log('[lyrics-index] tokens:', Object.keys(idxOut).length);
  console.log('[lyrics-index] out:', OUT_FILE);

  // –ù–µ —Ñ–µ–π–ª–∏–º –±–∏–ª–¥ –∏–∑-–∑–∞ –ø–∞—Ä—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º warnings
  if (errors.length) {
    console.warn('\n[lyrics-index] WARNINGS:\n- ' + errors.slice(0, 50).join('\n- '));
    if (errors.length > 50) console.warn(`[lyrics-index] ... +${errors.length - 50} more`);
  }
}

main().catch((e) => {
  console.error('[lyrics-index] fatal:', e);
  process.exit(2);
});

//=================================================
// FILE: /scripts/ci/lint-sw.mjs
#!/usr/bin/env node
import fs from 'node:fs';
import path from 'node:path';

const file = path.resolve('service-worker.js');
if (!fs.existsSync(file)) {
  console.error('service-worker.js not found');
  process.exit(1);
}
const src = fs.readFileSync(file, 'utf8');

const errors = [];
const warns = [];

if (!/const\s+SW_VERSION\s*=\s*['"`]\d+\.\d+\.\d+['"`]/.test(src)) {
  errors.push('SW_VERSION is missing or has wrong format (x.y.z)');
}

const listeners = (name) => (src.match(new RegExp(`addEventListener\\(['"]${name}['"]`, 'g')) || []).length;
['install','activate','fetch'].forEach(ev => {
  const n = listeners(ev);
  if (n === 0) errors.push(`No ${ev} event listener`);
  if (n > 1) warns.push(`Multiple (${n}) ${ev} listeners`);
});

const consts = ['CORE_CACHE','RUNTIME_CACHE','MEDIA_CACHE','OFFLINE_CACHE','META_CACHE'];
consts.forEach(cn => {
  const n = (src.match(new RegExp(`\\bconst\\s+${cn}\\b`, 'g')) || []).length;
  if (n === 0) errors.push(`Missing const ${cn}`);
  if (n > 1) warns.push(`Duplicate const ${cn} (${n} times)`);
});

// –î–æ–ø.–ø—Ä–æ–≤–µ—Ä–∫–∏: DEFAULT_SW_CONFIG —á–∏—Å–ª–æ–≤—ã–µ –ª–∏–º–∏—Ç—ã –∏ revalidateDays —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ
const cfgMatch = src.match(/const\s+DEFAULT_SW_CONFIG\s*=\s*\{([\s\S]*?)\};/);
if (cfgMatch) {
  const body = cfgMatch[1];
  const num = (key) => {
    const m = body.match(new RegExp(`${key}\\s*:\\s*([0-9]+(?:\\.[0-9]+)?)`));
    return m ? Number(m[1]) : null;
  };
  const revalidateDays = num('revalidateDays');
  if (!(Number.isInteger(revalidateDays) && revalidateDays > 0)) {
    errors.push('DEFAULT_SW_CONFIG.revalidateDays must be positive integer');
  }
  ['mediaMaxCacheMB','nonRangeMaxStoreMB','nonRangeMaxStoreMBSlow'].forEach(k => {
    const v = num(k);
    if (!(typeof v === 'number' && v > 0)) errors.push(`DEFAULT_SW_CONFIG.${k} must be positive number`);
  });
}

if (warns.length) {
  console.warn('SW linter warnings:\n - ' + warns.join('\n - '));
}
if (errors.length) {
  console.error('SW linter errors:\n - ' + errors.join('\n - '));
  process.exit(2);
}
console.log('Service Worker lint OK');

//=================================================
// FILE: /scripts/ci/validate-content.mjs
#!/usr/bin/env node
import fs from 'node:fs';
import path from 'node:path';

const fail = (msg) => { console.error(msg); process.exit(2); };
const warn = (msg) => { console.warn(msg); };

// 1) albums.json –±–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
const albumsFile = path.resolve('albums.json');
if (!fs.existsSync(albumsFile)) fail('albums.json not found');
let albums;
try {
  const raw = fs.readFileSync(albumsFile, 'utf8');
  const j = JSON.parse(raw);
  if (!j || !Array.isArray(j.albums)) fail('albums.json: "albums" must be an array');
  albums = j.albums;
} catch (e) {
  fail('albums.json is not valid JSON: ' + e.message);
}
albums.forEach((a, i) => {
  if (!a.key || !a.title || !a.base) fail(`albums.json: album[${i}] must contain key/title/base`);
  if (typeof a.key !== 'string' || typeof a.title !== 'string' || typeof a.base !== 'string') {
    fail(`albums.json: album[${i}] key/title/base must be strings`);
  }
  if (!/^https?:\/\//i.test(a.base)) {
    fail(`albums.json: album[${i}].base must be absolute http(s) url`);
  }
  if (!/\/$/.test(a.base)) {
    warn(`albums.json: album[${i}].base should end with "/" (got: ${a.base})`);
  }
});

// 1.5) –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–π –∞–ª—å–±–æ–º–æ–≤
{
  const keys = albums.map(a => a.key);
  const uniq = new Set(keys);
  if (uniq.size !== keys.length) {
    const dup = keys.filter((k, idx) => keys.indexOf(k) !== idx);
    fail(`albums.json: duplicate album keys: ${Array.from(new Set(dup)).join(', ')}`);
  }
}

// 2) –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã—Ö –≥–∞–ª–µ—Ä–µ–π –∏ index.json –Ω–∞–ª–∏—á–∏—è/—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
const galleryRoot = path.resolve('albums/gallery');
const required = ['00','01','02','03','news'];
required.forEach(id => {
  const dir = path.join(galleryRoot, id);
  const idx = path.join(dir, 'index.json');
  if (!fs.existsSync(dir)) fail(`albums/gallery/${id} directory missing`);
  if (!fs.existsSync(idx)) fail(`albums/gallery/${id}/index.json missing`);
  try {
    const raw = fs.readFileSync(idx, 'utf8');
    const j = JSON.parse(raw);
    const items = Array.isArray(j.items) ? j.items : (Array.isArray(j) ? j : []);
    if (!Array.isArray(items)) fail(`albums/gallery/${id}/index.json: items must be array`);
    if (items.length === 0) warn(`albums/gallery/${id}/index.json: items is empty`);
    // –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏ ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ (–µ—Å–ª–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ)
    items.forEach((it, k) => {
      const check = (p) => {
        if (!p || /^https?:\/\//i.test(p)) return;
        const rel = p.replace(/^\.\//, '');
        const fp = path.resolve(rel);
        if (!fs.existsSync(fp)) warn(`Missing file referenced from gallery ${id} item[${k}]: ${p}`);
      };
      if (typeof it === 'string') check(it);
      else if (it && typeof it === 'object') {
        if (it.src) check(it.src);
        if (it.formats) Object.values(it.formats).forEach(check);
      }
    });
  } catch (e) {
    fail(`albums/gallery/${id}/index.json invalid JSON: ${e.message}`);
  }
});

// 3) custom.json sw –∫–æ–Ω—Ñ–∏–≥: revalidateDays —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ
const customFile = path.resolve('custom.json');
if (fs.existsSync(customFile)) {
  try {
    const raw = fs.readFileSync(customFile, 'utf8');
    const j = JSON.parse(raw);
    if (j && j.sw) {
      const d = j.sw.revalidateDays;
      if (!(Number.isInteger(d) && d > 0)) {
        fail('custom.json.sw.revalidateDays must be positive integer');
      }
      ['mediaMaxCacheMB','nonRangeMaxStoreMB','nonRangeMaxStoreMBSlow'].forEach(key => {
        const v = j.sw[key];
        if (!(typeof v === 'number' && v > 0)) fail(`custom.json.sw.${key} must be positive number`);
      });
      if (typeof j.sw.allowUnknownSize !== 'boolean') {
        fail('custom.json.sw.allowUnknownSize must be boolean');
      }
    }
  } catch (e) {
    fail('custom.json invalid JSON: ' + e.message);
  }
}
// 4) –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å uid –≤ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö config.json (–ù–ï —Ñ–µ–π–ª–∏–º –±–∏–ª–¥ –∏–∑-–∑–∞ —Å–µ—Ç–∏)
{
  // Node 20: fetch –¥–æ—Å—Ç—É–ø–µ–Ω. –ï—Å–ª–∏ –≤–¥—Ä—É–≥ –µ–≥–æ –Ω–µ—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º.
  const hasFetch = typeof fetch === 'function';
  if (!hasFetch) {
    warn('fetch() is not available in this Node runtime; skip remote config.json uid checks');
  } else {
    for (const a of albums) {
      const base = a.base.endsWith('/') ? a.base : `${a.base}/`;
      const url = `${base}config.json`;

      try {
        const r = await fetch(url, { cache: 'no-cache' });
        if (!r.ok) {
          warn(`remote config.json not reachable for "${a.key}": HTTP ${r.status} (${url})`);
          continue;
        }

        const cfg = await r.json();
        const tracks = Array.isArray(cfg?.tracks) ? cfg.tracks : null;
        if (!tracks) {
          warn(`remote config.json "${a.key}": tracks must be array (${url})`);
          continue;
        }

        const seen = new Set();
        const dups = new Set();
        let missing = 0;

        for (const t of tracks) {
          const uid = String(t?.uid || '').trim();
          if (!uid) {
            missing++;
            continue;
          }
          if (seen.has(uid)) dups.add(uid);
          seen.add(uid);
        }

        if (missing > 0) {
          warn(`remote config.json "${a.key}": ${missing} track(s) have empty uid (${url})`);
        }
        if (dups.size > 0) {
          warn(`remote config.json "${a.key}": duplicate uid(s): ${Array.from(dups).join(', ')} (${url})`);
        }
      } catch (e) {
        warn(`remote config.json check failed for "${a.key}": ${e?.message || e} (${url})`);
      }
    }
  }
}

console.log('Content validation OK');

//=================================================
// FILE: /scripts/ci/validate-manifest.mjs
#!/usr/bin/env node
import fs from 'node:fs';
import path from 'node:path';

const file = path.resolve('manifest.json');
if (!fs.existsSync(file)) {
  console.error('manifest.json not found');
  process.exit(1);
}
const raw = fs.readFileSync(file, 'utf8');
let json;
try {
  json = JSON.parse(raw);
} catch (e) {
  console.error('manifest.json is not valid JSON:', e.message);
  process.exit(1);
}
const errors = [];
function req(key) { if (!(key in json)) errors.push(`Missing key: ${key}`); }

req('name');
req('short_name');
req('start_url');
req('icons');

if (json.icons && !Array.isArray(json.icons)) {
  errors.push('icons must be an array');
}
if (Array.isArray(json.icons) && json.icons.length === 0) {
  errors.push('icons must contain at least one icon');
}
if (!json.display) errors.push('Missing key: display');
if (!json.theme_color) errors.push('Missing key: theme_color');
if (!json.background_color) errors.push('Missing key: background_color');

if (errors.length) {
  console.error('Manifest validation failed:\n - ' + errors.join('\n - '));
  process.exit(2);
}
console.log('Manifest validation OK');

//=================================================
// FILE: /scripts/core/bootstrap.js
//=================================================
// FILE: /scripts/core/bootstrap.js
// scripts/core/bootstrap.js
// –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –∑–∞–≥—Ä—É–∑—á–∏–∫: –ø—Ä–æ–≤–µ—Ä–∫–∞ env, –∑–∞–≥—Ä—É–∑–∫–∞ config, init.

(function () {
  'use strict';

  const W = window;
  const D = document;

  const fail = (msg) => {
    D.body.innerHTML = `<div style="position:fixed;inset:0;background:#111;color:#fff;display:flex;align-items:center;justify-content:center;text-align:center;padding:20px;font-family:sans-serif"><h2 style="color:#e80100">–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞</h2><p>${msg}</p></div>`;
    throw new Error(msg);
  };

  const checkEnv = () => {
    if (!W.fetch || !W.Promise || !W.localStorage) return '–í–∞—à –±—Ä–∞—É–∑–µ—Ä —É—Å—Ç–∞—Ä–µ–ª. –û–±–Ω–æ–≤–∏—Ç–µ –µ–≥–æ.';
    try { localStorage.setItem('_t', '1'); localStorage.removeItem('_t'); } catch { return '–í–∫–ª—é—á–∏—Ç–µ Cookies/Storage.'; }
    return null;
  };

  const preventZoom = () => {
    // iOS zoom fix
    D.addEventListener('touchstart', (e) => { if (e.touches.length > 1) e.preventDefault(); }, { passive: false });
    let last = 0;
    D.addEventListener('touchend', (e) => {
      const now = Date.now();
      if (now - last < 300) e.preventDefault();
      last = now;
    }, { passive: false });
  };

  const loadIndex = async () => {
    try {
      const res = await fetch('./albums.json');
      if (!res.ok) throw new Error('HTTP ' + res.status);
      W.albumsIndex = (await res.json())?.albums || [];
      W.dispatchEvent(new Event('albumsIndex:ready'));
    } catch (e) {
      console.error(e);
      W.albumsIndex = []; // –ù–µ —Ä–æ–Ω—è–µ–º, –¥–∞—ë–º –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –ø—É—Å—Ç—ã–º (–¥–ª—è offline –∫—ç—à–∞)
    }
  };

  const waitForHowler = async () => {
    for (let i = 0; i < 50; i++) { // 5 sec max
      if (W.Howler) return true;
      await new Promise(r => setTimeout(r, 100));
    }
    return false;
  };

  const init = async () => {
    const err = checkEnv();
    if (err) return fail(err);

    preventZoom();
    
    // Mark env
    if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !W.MSStream) D.body.classList.add('ios');
    if (matchMedia('(display-mode: standalone)').matches) D.body.classList.add('standalone');

    if (!(await waitForHowler())) return fail('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ-–¥–≤–∏–∂–∫–∞ (Howler).');

    await loadIndex();
  };

  if (D.readyState === 'loading') D.addEventListener('DOMContentLoaded', init);
  else init();

})();

//=================================================
// FILE: /scripts/core/config.js
// scripts/core/config.js
// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
export const APP_CONFIG = {
  // –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  APP_VERSION: '8.0.5',
  BUILD_DATE: '2025-12-08',
  // ‚úÖ –ü–†–û–ú–û–ö–û–î –î–õ–Ø –í–•–û–î–ê
  PROMOCODE: 'VITRINA2025',
  // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∫–æ–Ω–æ–∫ –∞–ª—å–±–æ–º–æ–≤
  ICON_ALBUMS_ORDER: [
    // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏–∫–æ–Ω–∫–∞ –ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
    { key: 'odnazhdy-v-skazke', title: '–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ', icon: 'img/icon_album/icon-album-03.png' },
    { key: 'golos-dushi', title: '–ì–æ–ª–æ—Å –î—É—à–∏', icon: 'img/icon_album/icon-album-02.png' },
    { key: 'mezhdu-zlom-i-dobrom', title: '–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º', icon: 'img/icon_album/icon-album-01.png' },
    { key: 'krevetochka', title: '–ö–†–ï–í–ï—ÜTOCHKA', icon: 'img/icon_album/icon-album+00.png' },
    { key: '__showcase__', title: '–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞', icon: 'img/logo.png' },
    { key: '__reliz__', title: '–ù–û–í–û–°–¢–ò', icon: 'img/icon_album/icon-album-news.png' },
    { key: '__favorites__', title: '‚≠ê‚≠ê‚≠ê–ò–ó–ë–†–ê–ù–ù–û–ï‚≠ê‚≠ê‚≠ê', icon: 'img/Fav_logo.png' },
    { key: '__profile__', title: '–õ–ò–ß–ù–´–ô –ö–ê–ë–ò–ù–ï–¢', icon: 'data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22white%22%3E%3Cpath%20d%3D%22M12%2012c2.21%200%204-1.79%204-4s-1.79-4-4-4-4%201.79-4%204%201.79%204%204%204zm0%202c-2.67%200-8%201.34-8%204v2h16v-2c0-2.66-5.33-4-8-4z%22%2F%3E%3C%2Fsvg%3E' }
  ],
  // –ö–ª—é—á–∏ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –∞–ª—å–±–æ–º–æ–≤
  SPECIAL_FAVORITES_KEY: '__favorites__',
  SPECIAL_RELIZ_KEY: '__reliz__',
  SPECIAL_SHOWCASE_KEY: '__showcase__',
  SPECIAL_PROFILE_KEY: '__profile__',
  // –°—Å—ã–ª–∫–∏
  SUPPORT_URL: 'https://example.com/support',
  SUPPORT_EMAIL: 'support@vitrina-razbita.ru',
  GITHUB_URL: 'https://github.com/apel-s-in/vi3na1bita-music',
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–µ–µ—Ä–∞
  PLAYER_SETTINGS: {
    defaultVolume: 1.0,
    crossfade: false,
    preload: true
  },
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
  CACHE_VERSION: 'v1.0.0',
  CACHE_AUDIO: false, // –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –ª–∏ –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã
  // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  ANALYTICS_ENABLED: false,
  ANALYTICS_ID: null,
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–∞–ª–µ—Ä–µ–∏
  CENTRAL_GALLERY_BASE: './albums/gallery/',
  // –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∞–ª—å–±–æ–º–æ–≤
  PUBLISHED_ALBUM_KEYS: new Set(['odnazhdy-v-skazke', 'golos-dushi', 'mezhdu-zlom-i-dobrom', 'krevetochka'])
};

// –≠–∫—Å–ø–æ—Ä—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
if (typeof window !== 'undefined') {
  window.APP_CONFIG = APP_CONFIG;
  // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
  window.SPECIAL_FAVORITES_KEY = APP_CONFIG.SPECIAL_FAVORITES_KEY;
  window.SPECIAL_RELIZ_KEY = APP_CONFIG.SPECIAL_RELIZ_KEY;
  window.SPECIAL_SHOWCASE_KEY = APP_CONFIG.SPECIAL_SHOWCASE_KEY;
}

//=================================================
// FILE: /scripts/core/favorites-manager.js
// scripts/core/favorites-manager.js
// Optimized v2.0
const KEY = '__favorites_v2__';

export class FavoritesManager {
  constructor() {
    this._map = new Map();
    this._subs = new Set();
    this.init();
  }

  init() {
    try { 
      JSON.parse(localStorage.getItem(KEY) || '[]').forEach(i => i?.uid && this._map.set(String(i.uid).trim(), i)); 
    } catch {}
  }

  isLiked(uid) {
    const i = this._map.get(String(uid || '').trim());
    return !!(i && !i.inactiveAt);
  }

  getSnapshot() { 
    return Array.from(this._map.values()); 
  }

  readLikedSet() { 
    return new Set([...this._map.values()].filter(i => !i.inactiveAt).map(i => i.uid)); 
  }

  toggle(uid, { source = 'album', albumKey } = {}) {
    const u = String(uid || '').trim(); 
    if (!u) return false;
    
    const i = this._map.get(u), act = i && !i.inactiveAt;
    let isL = false;

    if (act) {
      source === 'favorites' ? this._map.set(u, { ...i, inactiveAt: Date.now() }) : this._map.delete(u);
    } else {
      this._map.set(u, { uid: u, addedAt: i?.addedAt || Date.now(), albumKey: albumKey || i?.albumKey || null, sourceAlbum: albumKey || i?.albumKey || i?.sourceAlbum || null, inactiveAt: null });
      isL = true;
    }
    
    this._save(); 
    this._notify(u, isL); 
    return isL;
  }

  remove(uid) {
    const u = String(uid).trim();
    if (this._map.delete(u)) { 
      this._save(); 
      this._notify(u, false); 
      return true; 
    }
    return false;
  }

  _save() { 
    try { localStorage.setItem(KEY, JSON.stringify(Array.from(this._map.values()))); } catch {} 
  }
  
  subscribe(cb) { 
    this._subs.add(cb); 
    return () => this._subs.delete(cb); 
  }

  _notify(uid, liked) { 
    this._subs.forEach(cb => { try { cb({ uid, liked }); } catch {} }); 
  }
}

export const Favorites = new FavoritesManager();
window.FavoritesManager = Favorites;

//=================================================
// FILE: /scripts/core/utils.js
/**
 * scripts/core/utils.js
 * Optimized Utilities v4.0 ‚Äî Spec Compliant & Memory Safe
 */
(function(W, D) {
  'use strict';

  // Internal Blob Registry
  const _blobReg = new Map(); 

  const U = {
    $: (id) => D.getElementById(id),
    
    dom: {
      byId: (id) => D.getElementById(id),
      on: (el, ev, fn, opts) => {
        if (!el) return () => {};
        el.addEventListener(ev, fn, opts);
        return () => { try { el.removeEventListener(ev, fn, opts); } catch {} };
      },
      raf: requestAnimationFrame,
      defer: (fn) => setTimeout(fn, 0),
      createStyleOnce: (id, css) => {
        if (D.getElementById(id)) return;
        const s = D.createElement('style');
        s.id = id; s.textContent = css;
        D.head.appendChild(s);
      }
    },

    getNet: () => {
      // SOURCE OF TRUTH: NetPolicy (Compliant with Spec)
      const NP = W.NetPolicy;
      if (NP) return { online: NP.isNetworkAllowed(), kind: NP.detectNetworkType(), saveData: false };
      
      // Fallback if NetPolicy is somehow not loaded yet
      const n = navigator, c = n.connection || n.mozConnection || n.webkitConnection, k = c?.type || 'unknown';
      return { online: n.onLine, kind: /cellular|2g|3g|4g/i.test(k) ? 'cellular' : 'wifi', saveData: c?.saveData || false };
    },
    
    getPlatform: () => {
      const ua = navigator.userAgent;
      return { 
        isIOS: /iPad|iPhone|iPod/.test(ua) && !W.MSStream, 
        isPWA: matchMedia('(display-mode: standalone)').matches || navigator.standalone, 
        isDesktop: !/Mobi|Android/i.test(ua), 
        isAndroid: /Android/.test(ua) 
      };
    },

    fmt: {
      time: (s) => {
        const n = Number(s); if (!n || n < 0) return '00:00';
        const h = n / 3600 | 0, m = (n % 3600) / 60 | 0, sc = n % 60 | 0;
        return (h ? h + ':' : '') + String(h ? m % 60 : m).padStart(2, '0') + ':' + String(sc).padStart(2, '0');
      },
      bytes: (b) => {
        const n = Number(b); if (!Number.isFinite(n) || n <= 0) return '0 B';
        const i = Math.floor(Math.log(n) / Math.log(1024));
        return parseFloat((n / Math.pow(1024, i)).toFixed(1)) + ' ' + (['B','KB','MB','GB'][i] || 'TB');
      },
      durationHuman: (s) => { const h = s / 3600 | 0, m = (s % 3600) / 60 | 0; return h ? `${h}—á ${m}–º` : `${m}–º`; }
    },
    
    math: {
      clamp: (n, min, max) => Math.min(Math.max(Number(n) || 0, min), max),
      toInt: (v, d = 0) => Number.isFinite(Number(v)) ? Number(v) : d
    },

    obj: {
      safeJson: (k, d = null) => { try { return JSON.parse(localStorage.getItem(k)) ?? d; } catch { return d; } },
      trim: (v) => String(v || '').trim() || null,
      normQuality: (q) => String(q || '').toLowerCase() === 'lo' ? 'lo' : 'hi'
    },

    blob: {
      createUrl: (key, blob) => {
        // FIX: Spec 21.2 Strict Compliance - No early/arbitrary revokes. Managed by PlayerCore.
        if (_blobReg.has(key)) URL.revokeObjectURL(_blobReg.get(key));
        const url = URL.createObjectURL(blob);
        _blobReg.set(key, url);
        return url;
      },
      revokeUrl: (key) => {
        if (_blobReg.has(key)) {
          URL.revokeObjectURL(_blobReg.get(key));
          _blobReg.delete(key);
          return true;
        }
        return false;
      }
    },

    ui: {
      toast: (msg, type, dur) => W.NotificationSystem?.show?.(msg, type, dur),
      escapeHtml: (s) => String(s || '').replace(/[<>&'"]/g, m => ({'<':'&lt;','>':'&gt;','&':'&amp;',"'":'&#39;','"':'&quot;'}[m]))
    },
    
    pq: {
      getMode: () => localStorage.getItem('qualityMode:v1') === 'lo' ? 'lo' : 'hi',
      getState: () => {
        const netOk = W.NetPolicy?.isNetworkAllowed?.() ?? navigator.onLine;
        const can = !!W.playerCore?.canToggleQualityForCurrentTrack?.();
        return { mode: U.pq.getMode(), canToggle: can && netOk, canToggleByTrack: can, netOk };
      },
      toggle: () => {
        const c = W.playerCore; if (!c) return { ok: false, reason: 'noCore' };
        if (!(W.NetPolicy?.isNetworkAllowed?.() ?? navigator.onLine)) return { ok: false, reason: 'offline' };
        if (!c.canToggleQualityForCurrentTrack()) return { ok: false, reason: 'trackNoLo' };
        
        const n = U.pq.getMode() === 'hi' ? 'lo' : 'hi';
        c.switchQuality(n); // PlayerCore handles persistence and background events
        return { ok: true, next: n };
      }
    },

    fav: {
      isTrackLikedInContext: ({ track: t } = {}) => !!(W.playerCore && t?.uid && W.playerCore.isFavorite(t.uid))
    },

    download: {
      applyDownloadLink: (btn, track) => {
        if (!btn) return;
        if (!track?.src) { btn.removeAttribute('href'); btn.removeAttribute('download'); btn.classList.add('disabled'); return; }
        btn.href = track.src; 
        btn.download = track.artist && track.title ? `${track.artist} - ${track.title}.mp3` : 'track.mp3'; 
        btn.classList.remove('disabled');
      }
    },

    func: {
      debounceFrame: (fn) => { let f; return (...a) => { if (f) cancelAnimationFrame(f); f = requestAnimationFrame(() => { f = null; fn(...a); }); }; },
      throttle: (fn, w) => { let l = 0; return (...a) => { const n = Date.now(); if (n - l >= w) { l = n; fn(...a); } }; }
    },

    isSpecialAlbumKey: (k) => String(k || '').startsWith('__'),
    isShowcaseContext: (k) => k === '__showcase__' || String(k || '').startsWith('__showcase__:'),
    isBrowsingOtherAlbum: () => { const p = W.AlbumsManager?.getPlayingAlbum?.(), c = W.AlbumsManager?.getCurrentAlbum?.(); return !!(p && c && p !== c && !(p === '__favorites__' && c === '__favorites__')); },
    setBtnActive: (id, a) => D.getElementById(id)?.classList.toggle('active', !!a),
    setAriaDisabled: (el, d) => { if (el) { el.classList.toggle('disabled', !!d); el.setAttribute('aria-disabled', !!d); } },
    lsGet: (k, d) => localStorage.getItem(k) ?? d,
    lsSet: (k, v) => localStorage.setItem(k, v),
    lsGetBool01: (k, d = false) => (localStorage.getItem(k) ?? (d ? '1' : '0')) === '1',
    lsSetBool01: (k, v) => localStorage.setItem(k, v ? '1' : '0'),
    lsGetJson: (k, d = null) => U.obj.safeJson(k, d)
  };
  
  // Safe Global Aliases
  U.escapeHtml = U.ui.escapeHtml;
  U.isMobile = () => U.getPlatform().isIOS || U.getPlatform().isAndroid;
  
  // ESM-compatible exports via window (–ü–û–°–õ–ï –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è U.isMobile –∏ U.escapeHtml)
  W.AppUtils = {
    $: U.$,
    toStr: (v) => (v == null ? '' : String(v)),
    isMobileUA: () => U.isMobile(),  // –ó–∞–º—ã–∫–∞–Ω–∏–µ, –∞ –Ω–µ –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞
    escHtml: (s) => U.escapeHtml(s)  // –ó–∞–º—ã–∫–∞–Ω–∏–µ, –∞ –Ω–µ –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞
  };
  U.waitFor = async (fn, t = 2000) => { for (let i = 0; i < t / 50; i++) { if (fn()) return true; await new Promise(r => setTimeout(r, 50)); } return !!fn(); };
  U.onceEvent = (el, ev, { timeoutMs } = {}) => new Promise(r => { const h = () => { el.removeEventListener(ev, h); r(); }; el.addEventListener(ev, h, { once: true }); if (timeoutMs) setTimeout(h, timeoutMs); });

  W.Utils = U;
})(window, document);

//=================================================
// FILE: /scripts/e2e/favorites.spec.js
// scripts/e2e/favorites.spec.js
// @ts-check
import { test, expect } from '@playwright/test';
import { loginByPromo, likeFirstTrack, openFavorites, playFirstTrack } from './utils.js';

test('favorites UI builds and plays from favorites list', async ({ page }) => {
  await loginByPromo(page);
  await likeFirstTrack(page);
  await openFavorites(page);
  
  const favCount = await page.locator('#track-list .track').count();
  expect(favCount).toBeGreaterThan(0);

  // Click first track -> player should appear
  await page.locator('#track-list .track').first().click();
  await expect(page.locator('#lyricsplayerblock')).toBeVisible();
});

test('toggle star in favorites updates row state and localStorage (uid-based)', async ({ page }) => {
  await loginByPromo(page);

  // Like first track in album
  await page.waitForSelector('#track-list .track', { timeout: 10000 });
  const firstAlbumRow = page.locator('#track-list .track').first();
  await firstAlbumRow.hover();
  await firstAlbumRow.locator('.like-star').click();

  // Go to Favorites
  await page.click('.album-icon[data-akey="__favorites__"]');
  await page.waitForSelector('#track-list .track', { timeout: 10000 });

  const favRow = page.locator('#track-list .track').first();
  const favId = await favRow.getAttribute('id');
  expect(favId).toMatch(/^fav_/);

  // Unlike -> row becomes inactive
  await favRow.locator('.like-star').click();
  await expect(favRow).toHaveClass(/inactive/);

  // Check V2 Storage (__favorites_v2__)
  const isLiked = await page.evaluate((id) => {
    const m = String(id || '').match(/^fav_(.+)_(.+)$/);
    const u = m ? m[2] : '';
    const raw = localStorage.getItem('__favorites_v2__');
    const items = raw ? JSON.parse(raw) : [];
    // –í V2 —Ö—Ä–∞–Ω—è—Ç—Å—è –æ–±—ä–µ–∫—Ç—ã, –∏—â–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π (–±–µ–∑ inactiveAt)
    return items.some(i => i.uid === u && !i.inactiveAt);
  }, favId);

  expect(isLiked).toBeFalsy();
});

test('favorites playing: removing star of current track triggers next', async ({ page }) => {
  await loginByPromo(page);
  await page.click('#promo-btn');

  // Like & Play in Favorites
  await page.waitForSelector('#track-list .track', { timeout: 10000 });
  const row = page.locator('#track-list .track').first();
  await row.hover();
  await row.locator('.like-star').click();

  await page.click('.album-icon[data-akey="__favorites__"]');
  await page.waitForSelector('#track-list .track', { timeout: 10000 });
  
  const favFirst = page.locator('#track-list .track').first();
  await favFirst.click();
  await expect(page.locator('#lyricsplayerblock')).toBeVisible();

  // Remove star on current playing track
  const beforeIdx = await page.evaluate(() => window.playerCore?.getIndex?.() ?? -1);
  await favFirst.locator('.like-star').click();

  // Should skip to next or handle gracefully (not stop)
  await page.waitForTimeout(300);
  const afterIdx = await page.evaluate(() => window.playerCore?.getIndex?.() ?? -1);
  
  // Track should change or index update
  expect(afterIdx).not.toBe(beforeIdx);
  await expect(favFirst).toHaveClass(/inactive/);
});

test('quick prev/next uses PlayerCore only (no legacy audio)', async ({ page }) => {
  await loginByPromo(page);
  await page.waitForSelector('#track-list .track', { timeout: 10000 });
  await page.click('#track-list .track >> nth=0');

  // Ensure no <audio> tag exists
  const hasAudioTag = await page.evaluate(() => !!document.querySelector('audio'));
  expect(hasAudioTag).toBeFalsy();

  // Ensure PlayerCore is active
  const isPlaying = await page.evaluate(() => window.playerCore?.isPlaying());
  expect(isPlaying).toBeTruthy();
});

//=================================================
// FILE: /scripts/e2e/player.spec.js
// @ts-check
import { test, expect } from '@playwright/test';
import {
  loginByPromo,
  likeFirstTrack,
  openFavorites,
  playFirstTrack,
  seedPlayerStateV2FromCurrent
} from './utils.js';

test('play track, toggle favorites-only and sleep timer UI', async ({ page }) => {
  await loginByPromo(page);
  await expect(page.locator('#main-block')).toBeVisible();

  // –î–æ–∂–¥–∞—Ç—å—Å—è —Å–ø–∏—Å–∫–∞ –∞–ª—å–±–æ–º–æ–≤ –∏ –∫–ª–∏–∫ –ø–æ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–µ —Ç—Ä–µ–∫–ª–∏—Å—Ç–∞
  await page.waitForSelector('#track-list .track', { timeout: 10000 });
  const firstTrack = page.locator('#track-list .track').first();
  await firstTrack.click();

  // –ü–æ—è–≤–∏–ª—Å—è –±–ª–æ–∫ –ø–ª–µ–µ—Ä–∞ –∏ –∫–Ω–æ–ø–∫–∞ Play/Pause –µ—Å—Ç—å
  await expect(page.locator('#lyricsplayerblock')).toBeVisible();
  await expect(page.locator('#play-pause-icon')).toBeVisible();

  // –í–∫–ª—é—á–∞–µ–º —Ñ–∏–ª—å—Ç—Ä "—Ç–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ" (–∫–Ω–æ–ø–∫–∞ –≤ –ø–ª–µ–µ—Ä–µ)
  await page.click('#favorites-btn');
  const favBtn = page.locator('#favorites-btn');
  await expect(favBtn).toHaveClass(/favorites-active/);

  // –¢–∞–π–º–µ—Ä —Å–Ω–∞: –æ—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é –∏ –≤—ã–±—Ä–∞—Ç—å "15 –º–∏–Ω—É—Ç", –∑–∞—Ç–µ–º –≤—ã–∫–ª—é—á–∏—Ç—å
  await page.click('#sleep-timer-btn');
  await page.click('.sleep-menu-item:has-text("15 –º–∏–Ω—É—Ç")');
  // –ë–µ–π–¥–∂ –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è
  await expect(page.locator('#sleep-timer-badge')).toBeVisible();
  // –í—ã–∫–ª—é—á–∏–º
  await page.click('#sleep-timer-btn');
  await page.click('.sleep-menu-item:has-text("–í—ã–∫–ª—é—á–∏—Ç—å")');
  await expect(page.locator('#sleep-timer-badge')).toBeHidden();
});

test('favoritesOnly: unliking current track switches to next (no stop)', async ({ page }) => {
  await loginByPromo(page);

  await page.waitForSelector('#track-list .track', { timeout: 10000 });

  // –õ–∞–π–∫–Ω–µ–º –ø–µ—Ä–≤—ã–π —Ç—Ä–µ–∫ –∏ –∑–∞–ø—É—Å—Ç–∏–º –µ–≥–æ
  const firstRow = page.locator('#track-list .track').first();
  await firstRow.hover();
  await firstRow.locator('.like-star').click();
  await firstRow.click();

  // –í–∫–ª—é—á–∏–º favoritesOnly
  await page.click('#favorites-btn');
  await expect(page.locator('#favorites-btn')).toHaveClass(/favorites-active/);

  const before = await page.evaluate(() => ({
    playing: !!window.playerCore?.isPlaying?.(),
    idx: window.playerCore?.getIndex?.() ?? -1,
    uid: String(window.playerCore?.getCurrentTrack?.()?.uid || '')
  }));

  // –°–Ω–∏–º–µ–º –ª–∞–π–∫ —Å —Ç–µ–∫—É—â–µ–≥–æ (—á–µ—Ä–µ–∑ –º–∏–Ω–∏/–∑–≤–µ–∑–¥—É —Å–ø–∏—Å–∫–∞ –ø—Ä–æ—â–µ: –∫–ª–∏–∫ –ø–æ –∑–≤–µ–∑–¥–µ –≤ —Å—Ç—Ä–æ–∫–µ)
  await firstRow.locator('.like-star').click();

  // –î–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–∏–π (–∏–ª–∏ —Ö–æ—Ç—è –±—ã –∏–∑–º–µ–Ω–∏—Ç—å—Å—è uid/index), –ø—Ä–∏ —ç—Ç–æ–º –ù–ï stop.
  await page.waitForTimeout(300);

  const after = await page.evaluate(() => ({
    playing: !!window.playerCore?.isPlaying?.(),
    idx: window.playerCore?.getIndex?.() ?? -1,
    uid: String(window.playerCore?.getCurrentTrack?.()?.uid || '')
  }));

  expect(after.playing).toBeTruthy();
  expect(after.uid).not.toBe(before.uid);
});

test('favoritesOnly + repeat: unliking current track still switches to next in favorites rules', async ({ page }) => {
  await loginByPromo(page);

  await page.waitForSelector('#track-list .track', { timeout: 10000 });

  const firstRow = page.locator('#track-list .track').first();
  await firstRow.hover();
  await firstRow.locator('.like-star').click();
  await firstRow.click();

  // favoritesOnly ON
  await page.click('#favorites-btn');
  await expect(page.locator('#favorites-btn')).toHaveClass(/favorites-active/);

  // repeat ON
  await page.click('#repeat-btn');
  await expect(page.locator('#repeat-btn')).toHaveClass(/active/);

  const before = await page.evaluate(() => ({
    playing: !!window.playerCore?.isPlaying?.(),
    uid: String(window.playerCore?.getCurrentTrack?.()?.uid || '')
  }));

  // –°–Ω–∏–º–µ–º –ª–∞–π–∫ —Å —Ç–µ–∫—É—â–µ–≥–æ —Ç—Ä–µ–∫–∞
  await firstRow.locator('.like-star').click();
  await page.waitForTimeout(300);

  const after = await page.evaluate(() => ({
    playing: !!window.playerCore?.isPlaying?.(),
    uid: String(window.playerCore?.getCurrentTrack?.()?.uid || '')
  }));

  // –¢–ó: –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö –ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—É—â–∏–π —Ç—Ä–µ–∫ –ø—Ä–∏ —Å–Ω—è—Ç–∏–∏ ‚≠ê —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è inactive –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π active.
  expect(after.uid).not.toBe(before.uid);
  expect(after.playing).toBeTruthy();
});

test('favoritesOnly + shuffle: liking another track adds it to tail of queue', async ({ page }) => {
  await loginByPromo(page);
  await page.waitForSelector('#track-list .track', { timeout: 10000 });

  const rows = page.locator('#track-list .track');
  const firstRow = rows.nth(0);
  const secondRow = rows.nth(1);

  // –õ–∞–π–∫–Ω–µ–º 1-–π —Ç—Ä–µ–∫ –∏ –∑–∞–ø—É—Å—Ç–∏–º
  await firstRow.hover();
  await firstRow.locator('.like-star').click();
  await firstRow.click();

  // favoritesOnly ON
  await page.click('#favorites-btn');
  await expect(page.locator('#favorites-btn')).toHaveClass(/favorites-active/);

  // shuffle ON
  await page.click('#shuffle-btn');
  await expect(page.locator('#shuffle-btn')).toHaveClass(/active/);

  // –ó–∞–ø–æ–º–Ω–∏–º –¥–ª–∏–Ω—É –ø–ª–µ–π–ª–∏—Å—Ç–∞
  const beforeLen = await page.evaluate(() => (window.playerCore?.getPlaylistSnapshot?.() || []).length);

  // –õ–∞–π–∫–Ω–µ–º –≤—Ç–æ—Ä–æ–π —Ç—Ä–µ–∫ (–¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞—Å—Ç—å –≤ –∫–æ–Ω–µ—Ü –æ—á–µ—Ä–µ–¥–∏)
  await secondRow.hover();
  await secondRow.locator('.like-star').click();
  await page.waitForTimeout(300);

  const after = await page.evaluate(() => {
    const snap = window.playerCore?.getPlaylistSnapshot?.() || [];
    const tail = snap.length ? snap[snap.length - 1] : null;
    return {
      len: snap.length,
      tailUid: String(tail?.uid || '').trim(),
      likedUids: window.playerCore?.getLikedUidsForAlbum?.(window.AlbumsManager?.getPlayingAlbum?.() || '') || []
    };
  });

  expect(after.len).toBeGreaterThanOrEqual(beforeLen);
  expect(after.likedUids.includes(after.tailUid)).toBeTruthy();
});

test('shuffle history: next-next-prev returns to previously played track', async ({ page }) => {
  await loginByPromo(page);
  await page.waitForSelector('#track-list .track', { timeout: 10000 });

  // –ó–∞–ø—É—Å—Ç–∏–º –ø–µ—Ä–≤—ã–π —Ç—Ä–µ–∫
  await page.click('#track-list .track >> nth=0');

  // –í–∫–ª—é—á–∏–º shuffle
  await page.click('#shuffle-btn');
  await expect(page.locator('#shuffle-btn')).toHaveClass(/active/);

  const first = await page.evaluate(() => String(window.playerCore?.getCurrentTrack?.()?.uid || ''));

  await page.click('#next-btn');
  await page.waitForTimeout(200);
  const second = await page.evaluate(() => String(window.playerCore?.getCurrentTrack?.()?.uid || ''));

  await page.click('#next-btn');
  await page.waitForTimeout(200);
  const third = await page.evaluate(() => String(window.playerCore?.getCurrentTrack?.()?.uid || ''));

  await page.click('#prev-btn');
  await page.waitForTimeout(200);
  const back = await page.evaluate(() => String(window.playerCore?.getCurrentTrack?.()?.uid || ''));

  expect(first).toBeTruthy();
  expect(second).toBeTruthy();
  expect(third).toBeTruthy();
  expect(back).toBe(second);
});

test('favoritesOnly + shuffle: unliking NOT current removes it from tail if not played yet', async ({ page }) => {
  await loginByPromo(page);
  await page.waitForSelector('#track-list .track', { timeout: 10000 });

  const rows = page.locator('#track-list .track');
  const firstRow = rows.nth(0);
  const secondRow = rows.nth(1);

  // –õ–∞–π–∫–∞–µ–º 1 –∏ 2 —Ç—Ä–µ–∫
  await firstRow.hover();
  await firstRow.locator('.like-star').click();
  await secondRow.hover();
  await secondRow.locator('.like-star').click();

  // –ó–∞–ø—É—Å–∫–∞–µ–º 1-–π
  await firstRow.click();

  // favoritesOnly ON
  await page.click('#favorites-btn');
  await expect(page.locator('#favorites-btn')).toHaveClass(/favorites-active/);

  // shuffle ON
  await page.click('#shuffle-btn');
  await expect(page.locator('#shuffle-btn')).toHaveClass(/active/);

  // –¢–µ–ø–µ—Ä—å –ø–ª–µ–π–ª–∏—Å—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 2 —Ç—Ä–µ–∫–∞ (–∏–ª–∏ –±–æ–ª—å—à–µ, –µ—Å–ª–∏ already), —Ñ–∏–∫—Å–∏—Ä—É–µ–º –¥–ª–∏–Ω—É
  const beforeLen = await page.evaluate(() => (window.playerCore?.getPlaylistSnapshot?.() || []).length);

  // –°–Ω–∏–º–∞–µ–º –ª–∞–π–∫ —Å–æ 2-–≥–æ —Ç—Ä–µ–∫–∞ (–ù–ï —Ç–µ–∫—É—â–µ–≥–æ)
  await secondRow.locator('.like-star').click();
  await page.waitForTimeout(300);

  const afterLen = await page.evaluate(() => (window.playerCore?.getPlaylistSnapshot?.() || []).length);

  expect(afterLen).toBeLessThanOrEqual(beforeLen);
});

//=================================================
// FILE: /scripts/e2e/utils.js
// @ts-check
/**
 * scripts/e2e/utils.js
 * –û–±—â–∏–µ —Ö–µ–ª–ø–µ—Ä—ã –¥–ª—è Playwright e2e, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –≤ spec-—Ñ–∞–π–ª–∞—Ö.
 */

export const BASE = process.env.BASE_URL || 'http://127.0.0.1:4173';

export async function loginByPromo(page, promo = 'VITRINA2025') {
  await page.goto(`${BASE}/index.html`, { waitUntil: 'load' });
  await page.fill('#promo-inp', promo);
  await page.click('#promo-btn');
  await page.waitForSelector('#main-block:not(.hidden)', { timeout: 10000 });
}

export async function waitTracks(page) {
  await page.waitForSelector('#track-list .track', { timeout: 10000 });
}

export async function likeFirstTrack(page) {
  await waitTracks(page);
  const first = page.locator('#track-list .track').first();
  await first.hover();
  await first.locator('.like-star').click();
}

export async function openFavorites(page) {
  await page.click('.album-icon[data-akey="__favorites__"]');
  await waitTracks(page);
}

export async function playFirstTrack(page) {
  await waitTracks(page);
  await page.click('#track-list .track >> nth=0');
  await page.waitForSelector('#lyricsplayerblock', { timeout: 10000 });
}

/**
 * –ó–∞–ø–∏—Å–∞—Ç—å PlayerState –≤ localStorage –≤ uid-—Ñ–æ—Ä–º–∞—Ç–µ (V2).
 * –ë–µ—Ä—ë–º playingAlbum –∏–∑ AlbumsManager, –∞ uid/sourceAlbum –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ç—Ä–µ–∫–∞.
 */
export async function seedPlayerStateV2FromCurrent(page, opts = {}) {
  const position = typeof opts.position === 'number' ? opts.position : 5;
  const wasPlaying = typeof opts.wasPlaying === 'boolean' ? opts.wasPlaying : true;

  await page.evaluate(({ position, wasPlaying }) => {
    const pc = window.playerCore;
    const track = pc?.getCurrentTrack?.() || null;

    const albumKey = window.AlbumsManager?.getPlayingAlbum?.() || null;

    const st = {
      album: albumKey,
      currentAlbum: window.AlbumsManager?.getCurrentAlbum?.() || albumKey,
      trackUid: String(track?.uid || '').trim() || null,
      sourceAlbum: String(track?.sourceAlbum || '').trim() || null,
      trackIndex: typeof pc?.getIndex === 'function' ? (pc.getIndex() || 0) : 0,
      position: Math.floor(position),
      volume: typeof pc?.getVolume === 'function' ? (pc.getVolume() ?? 100) : 100,
      wasPlaying: !!wasPlaying
    };

    localStorage.setItem('playerStateV2', JSON.stringify(st));
  }, { position, wasPlaying });
}

//=================================================
// FILE: /scripts/offline/cache-db.js
/**
 * cache-db.js ‚Äî IndexedDB-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è offline-–∫—ç—à–∞.
 * Stores: 'audio', 'trackMeta', 'global'.
 * Optimized: Fixed OOM memory leak in blob checks, drastically reduced boilerplate.
 */

const DB_NAME = 'offlineCache';
const DB_VERSION = 2;
let _db = null, _dbPending = null;

export const openDB = () => {
  if (_db) return Promise.resolve(_db);
  if (_dbPending) return _dbPending;
  return (_dbPending = new Promise((res, rej) => {
    const req = indexedDB.open(DB_NAME, DB_VERSION);
    req.onupgradeneeded = (e) => {
      const db = e.target.result;
      if (!db.objectStoreNames.contains('audio')) db.createObjectStore('audio', { keyPath: ['uid', 'quality'] });
      
      let metaStore = db.objectStoreNames.contains('trackMeta') 
        ? e.target.transaction.objectStore('trackMeta') 
        : db.createObjectStore('trackMeta', { keyPath: 'uid' });
        
      if (!metaStore.indexNames.contains('type')) metaStore.createIndex('type', 'type', { unique: false });
      if (!metaStore.indexNames.contains('cloudExpiresAt')) metaStore.createIndex('cloudExpiresAt', 'cloudExpiresAt', { unique: false });
      
      if (!db.objectStoreNames.contains('global')) db.createObjectStore('global', { keyPath: 'key' });
    };
    req.onsuccess = () => { _db = req.result; _dbPending = null; res(_db); };
    req.onerror = () => { _dbPending = null; rej(req.error); };
  }));
};

const db = () => { if (!_db) throw new Error('cache-db not opened. Call openDB() first.'); return _db; };

// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Ö–µ–ª–ø–µ—Ä—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
const read = (store, fn) => new Promise((res, rej) => {
  const r = fn(db().transaction(store, 'readonly').objectStore(store));
  r.onsuccess = () => res(r.result); r.onerror = () => rej(r.error);
});

const write = (store, fn) => new Promise((res, rej) => {
  const tx = db().transaction(store, 'readwrite');
  fn(tx.objectStore(store));
  tx.oncomplete = () => res(true); tx.onerror = () => rej(tx.error);
});

/* ‚îÄ‚îÄ‚îÄ Audio blob operations ‚îÄ‚îÄ‚îÄ */
export const setAudioBlob = (uid, q, blob) => write('audio', s => s.put({ uid, quality: String(q) === 'lo' ? 'lo' : 'hi', blob }));
export const getAudioBlob = async (uid, q) => (await read('audio', s => s.get([uid, q])))?.blob || null;
export const deleteAudio = uid => write('audio', s => { s.delete([uid, 'hi']); s.delete([uid, 'lo']); });
export const deleteAudioVariant = (uid, q) => write('audio', s => s.delete([uid, q]));

// CRITICAL FIX: –ò—Å–ø–æ–ª—å–∑—É–µ–º .count() –≤–º–µ—Å—Ç–æ .get() –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —É—Ç–µ—á–µ–∫ RAM (OOM) –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫—ç—à–∞
export const hasAudioForUid = async uid => !!(await read('audio', s => s.count([uid, 'hi']))) || !!(await read('audio', s => s.count([uid, 'lo'])));
export const getStoredVariant = async uid => (await read('audio', s => s.count([uid, 'hi']))) ? 'hi' : ((await read('audio', s => s.count([uid, 'lo']))) ? 'lo' : null);

/* ‚îÄ‚îÄ‚îÄ Track meta operations ‚îÄ‚îÄ‚îÄ */
export const setTrackMeta = (uid, meta) => write('trackMeta', s => s.put({ ...meta, uid }));
export const getTrackMeta = uid => read('trackMeta', s => s.get(uid));
export const updateTrackMeta = async (uid, updates) => setTrackMeta(uid, { ...((await getTrackMeta(uid)) || {}), ...updates, uid });
export const deleteTrackMeta = uid => write('trackMeta', s => s.delete(uid));
export const getAllTrackMetas = async () => (await read('trackMeta', s => s.getAll())) || [];

/* ‚îÄ‚îÄ‚îÄ Convenience & Storage ‚îÄ‚îÄ‚îÄ */
export const deleteTrackCache = async uid => { await deleteAudio(uid); await deleteTrackMeta(uid); };

/* ‚îÄ‚îÄ‚îÄ Global KV store (offlineCache/global) ‚îÄ‚îÄ‚îÄ */
export const getGlobal = (key) => read('global', s => s.get(String(key)));
export const setGlobal = (key, value) => write('global', s => s.put({ key: String(key), value }));

export const estimateUsage = async () => {
  try {
    if (navigator.storage?.estimate) {
      const e = await navigator.storage.estimate();
      return { used: e.usage || 0, quota: e.quota || 0, free: Math.max(0, (e.quota || 0) - (e.usage || 0)) };
    }
  } catch {}
  return { used: 0, quota: 500 * 1048576, free: 500 * 1048576 }; // Fallback 500MB
};

//=================================================
// FILE: /scripts/offline/net-policy.js
/**
 * scripts/offline/net-policy.js
 * Network Policy v2.0 ‚Äî Optimized, Memory-Safe, 100% Spec-Compliant.
 *
 * Fixes:
 * 1. CRITICAL OOM LEAK: Removed `res.clone().blob()` in fetch interceptor which
 *    buffered entire audio streams in RAM just to check their size.
 * 2. Added missing spec notifications for blocked networks on state change.
 * 3. Reduced LOC by >60% by consolidating state access and parsing.
 */

const K = { W: 'netPolicy:wifi:v1', C: 'netPolicy:cellular:v1', T: 'netPolicy:cellularToast:v1', K: 'netPolicy:killSwitch:v1', S: 'trafficStats:v1' };

let _platform = null, _installed = false, _lastBlocked = null;

const ls = (k, d) => localStorage.getItem(k) ?? d;
const set = (k, v) => { localStorage.setItem(k, v); emitChange(); return v === 'off'; };

export const getPlatform = () => {
  if (_platform) return _platform;
  const u = navigator.userAgent, i = /iPad|iPhone|iPod/.test(u) && !window.MSStream, f = /Firefox\//i.test(u);
  const c = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
  const h = !!c && typeof c.type !== 'undefined';
  return (_platform = { isIOS: i, isFirefox: f, hasNetInfo: h, supportsNetControl: h && !i && !f });
};

export const detectNetworkType = () => {
  const c = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
  return String(c?.type || '').toLowerCase() === 'cellular' ? 'cellular' : 'wifi';
};

export const getNetworkLabel = () => detectNetworkType() === 'cellular' ? 'Cellular' : 'Wi-Fi';
export const getNetworkSpeed = () => navigator.connection?.downlink ?? null;

export const getNetPolicyState = () => {
  const p = getPlatform();
  if (!p.supportsNetControl) {
    const k = ls(K.K, 'off') === 'on';
    return { wifiEnabled: true, cellularEnabled: true, cellularToast: false, killSwitch: k, airplaneMode: k, supportsNetControl: false };
  }
  const w = ls(K.W, 'on') === 'on', c = ls(K.C, 'on') === 'on';
  return { wifiEnabled: w, cellularEnabled: c, cellularToast: ls(K.T, 'off') === 'on', killSwitch: false, airplaneMode: !w && !c, supportsNetControl: true };
};

export const toggleWifi = () => set(K.W, ls(K.W, 'on') === 'on' ? 'off' : 'on');
export const toggleCellular = () => set(K.C, ls(K.C, 'on') === 'on' ? 'off' : 'on');
export const toggleCellularToast = () => set(K.T, ls(K.T, 'off') === 'on' ? 'off' : 'on');
export const toggleKillSwitch = () => set(K.K, ls(K.K, 'off') === 'on' ? 'off' : 'on');

export const isNetworkAllowed = () => {
  if (!navigator.onLine) return false;
  const s = getNetPolicyState();
  if (s.airplaneMode || s.killSwitch) return false;
  if (!s.supportsNetControl) return true;
  return detectNetworkType() === 'cellular' ? s.cellularEnabled : s.wifiEnabled;
};

export const shouldShowCellularToast = () => {
  const s = getNetPolicyState();
  return s.supportsNetControl && s.cellularToast && detectNetworkType() === 'cellular' && isNetworkAllowed();
};

export const getStatusText = () => {
  const s = getNetPolicyState();
  if (!s.supportsNetControl) return s.killSwitch ? '–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á—ë–Ω' : '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ç—å—é –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
  if (s.airplaneMode) return '–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á—ë–Ω';
  const t = detectNetworkType();
  if (!s.cellularEnabled && t === 'cellular') return '–ú–æ–±–∏–ª—å–Ω–∞—è —Å–µ—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏';
  if (!s.wifiEnabled && t === 'wifi') return 'Wi-Fi/Ethernet –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏';
  return '';
};

const emitChange = () => {
  const s = getNetPolicyState(), t = detectNetworkType();
  let block = 'none';

  if (s.supportsNetControl && !s.airplaneMode) {
    if (t === 'cellular' && !s.cellularEnabled) block = 'cell';
    if (t === 'wifi' && !s.wifiEnabled) block = 'wifi';
  }

  if (block !== 'none' && block !== _lastBlocked) {
    const m = block === 'cell' 
      ? '–ú–æ–±–∏–ª—å–Ω–∞—è —Å–µ—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏. –†–∞–±–æ—Ç–∞–µ–º –æ—Ñ–ª–∞–π–Ω.' 
      : 'Wi-Fi/Ethernet –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏. –†–∞–±–æ—Ç–∞–µ–º —á–µ—Ä–µ–∑ –º–æ–±–∏–ª—å–Ω—É—é —Å–µ—Ç—å.';
    window.NotificationSystem?.[block === 'cell' ? 'warning' : 'info']?.(m);
  }
  _lastBlocked = block;
  try { window.dispatchEvent(new CustomEvent('netPolicy:changed', { detail: s })); } catch {}
};

const mk = () => { const d = new Date(); return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`; };

export const getCurrentMonthName = () => {
  try { return new Intl.DateTimeFormat('ru', { month: 'long' }).format(new Date()); }
  catch { return ['–Ø–Ω–≤–∞—Ä—å','–§–µ–≤—Ä–∞–ª—å','–ú–∞—Ä—Ç','–ê–ø—Ä–µ–ª—å','–ú–∞–π','–ò—é–Ω—å','–ò—é–ª—å','–ê–≤–≥—É—Å—Ç','–°–µ–Ω—Ç—è–±—Ä—å','–û–∫—Ç—è–±—Ä—å','–ù–æ—è–±—Ä—å','–î–µ–∫–∞–±—Ä—å'][new Date().getMonth()]; }
};

const readStats = () => {
  const m = mk(), def = () => ({ total: 0, monthly: 0, monthKey: m });
  const out = { wifi: def(), cellular: def(), general: def() };
  try {
    const raw = JSON.parse(localStorage.getItem(K.S) || '{}');
    for (const k in out) {
      if (raw[k]) {
        out[k].total = Number(raw[k].total) || 0;
        out[k].monthly = raw[k].monthKey === m ? (Number(raw[k].monthly) || 0) : 0;
      }
    }
  } catch {}
  return out;
};

const writeStats = (bytes, type) => {
  const b = Number(bytes);
  if (!b || b <= 0) return;
  const s = readStats();
  s[type].total += b; s[type].monthly += b;
  localStorage.setItem(K.S, JSON.stringify(s));
};

export const getTrafficStats = () => {
  const s = readStats(), n = getCurrentMonthName();
  return getPlatform().supportsNetControl
    ? { type: 'split', monthName: n, wifi: s.wifi, cellular: s.cellular }
    : { type: 'general', monthName: n, general: s.general };
};

export const clearTrafficStats = () => { localStorage.removeItem(K.S); emitChange(); };

export const initNetPolicy = () => {
  if (_installed) return; _installed = true;

  window.NetPolicy = { isNetworkAllowed, shouldShowCellularToast, getStatusText, detectNetworkType, getNetPolicyState };

  const orig = window.fetch?.bind(window);
  if (orig) {
    window.fetch = async (req, init) => {
      if (!isNetworkAllowed()) throw new TypeError('Network blocked by NetPolicy');
      const t = getPlatform().supportsNetControl ? detectNetworkType() : 'general';
      const res = await orig(req, init);
      try {
        // FIXED OOM: Only trust headers, do not clone stream into RAM
        const len = res.headers?.get('content-length');
        if (len) writeStats(len, t);
      } catch {}
      return res;
    };
  }

  const c = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
  c?.addEventListener?.('change', emitChange);
  window.addEventListener('online', emitChange);
  window.addEventListener('offline', emitChange);
  emitChange();
};

export default {
  initNetPolicy, getPlatform, getNetPolicyState, getStatusText, detectNetworkType, getNetworkLabel,
  getNetworkSpeed, toggleWifi, toggleCellular, toggleCellularToast, toggleKillSwitch, isNetworkAllowed,
  shouldShowCellularToast, getTrafficStats, clearTrafficStats, getCurrentMonthName
};

//=================================================
// FILE: /scripts/offline/offline-manager.js
/**
 * scripts/offline/offline-manager.js
 * OfflineManager v3.3 ‚Äî Ultra-Compact, 100% Spec-Compliant.
 */

import * as DB from './cache-db.js';
const W = window;
const LS = { MODE: 'offline:mode:v1', QUAL: 'qualityMode:v1', CQ: 'offline:cacheQuality:v1', CN: 'cloud:listenThreshold', CD: 'cloud:ttlDays' };
const DEF = { N: 5, D: 31, MIN_MB: 60, R2_DYN_MB: 80 };
const G = { MRU: 'r2:mru:list:v1', DYN_MB: 'r2:dynamicLimitMB:v1' };
const PRIO = { CUR: 100, NEXT: 90, PIN: 80, UPD: 70, FILL: 60, DYN: 50 };
const now = () => Date.now();
const normQ = q => String(q || '').toLowerCase() === 'lo' ? 'lo' : 'hi';
const sUid = u => String(u || '').trim() || null;
const emit = (n, d) => W.dispatchEvent(new CustomEvent(n, { detail: d }));
const toast = (m, t = 'info') => W.NotificationSystem?.show?.(m, t);
const netOk = () => W.NetPolicy?.isNetworkAllowed?.() ?? navigator.onLine;
const getUrl = (u, q) => { const t = W.TrackRegistry?.getTrackByUid?.(u); return t ? (normQ(q) === 'lo' ? (t.audio_low || t.audio) : t.audio) : null; };
const hasSpace = async () => { try { const e = await navigator.storage?.estimate(); return !e || (e.quota - e.usage) >= DEF.MIN_MB * 1048576; } catch { return true; } };

class DownloadQueue {
  constructor(m) { this.m = m; this.q = new Map(); this.act = new Map(); this.par = 1; this.p = false; const w = () => this.pump(); W.addEventListener('netPolicy:changed', w); W.addEventListener('online', w); }
  add(i) { const u = sUid(i.uid); if (!u || !i.url) return; const a = this.act.get(u), e = this.q.get(u); if (a) { if (a.i.quality !== i.quality) this.cancel(u); else return; } if (!e || e.priority < i.priority || e.quality !== i.quality) { this.q.set(u, { ...i, uid: u, ts: now() }); this.pump(); } }
  cancel(u) { if (u = sUid(u)) { this.q.delete(u); const a = this.act.get(u); if (a) { a.c.abort(); this.act.delete(u); emit('offline:stateChanged'); } this.pump(); } }
  clearOldQualities(q) { for (const [u, t] of this.q) if (t.quality !== q) this.q.delete(u); }
  getStatus() { return { active: this.act.size, queued: this.q.size }; }
  pause() { this.p = true; } resume() { this.p = false; this.pump(); } setParallel(n) { this.par = n; this.pump(); }
  pump() { if (this.p || !netOk() || this.act.size >= this.par || !this.q.size) return; const t = [...this.q.values()].sort((a, b) => b.priority - a.priority || a.ts - b.ts)[0]; this.q.delete(t.uid); this._run(t); }
  async _run(i) {
    if (i.priority === PRIO.DYN && !(await hasSpace()) && (await this.m.evictDynamic(), !(await hasSpace()))) return;
    const c = new AbortController(); this.act.set(i.uid, { c, i }); emit('offline:downloadStart', { uid: i.uid });
    try {
      const r = await fetch(i.url, { signal: c.signal, redirect: 'follow' }); if (!r.ok) throw new Error(`HTTP ${r.status}`);
      const b = await r.blob(); await DB.setAudioBlob(i.uid, i.quality, b);
      await DB.updateTrackMeta(i.uid, { quality: i.quality, size: b.size, cachedComplete: true, needsReCache: false, needsUpdate: false, lastAccessedAt: now() });
      if ((await DB.getTrackMeta(i.uid))?.type === 'dynamic') await this.m.touchMRU(i.uid);
      if (W.playerCore?.getCurrentTrackUid?.() !== i.uid) await DB.deleteAudioVariant(i.uid, i.quality === 'hi' ? 'lo' : 'hi').catch(()=>{}); else { (W._orphanedBlobs ??= new Set()).add(i.uid); }
      emit('offline:trackCached', { uid: i.uid });
    } catch (e) { if (e.name !== 'AbortError') emit('offline:downloadFailed', { uid: i.uid, error: e.message });
    } finally { this.act.delete(i.uid); emit('offline:stateChanged'); this.pump(); }
  }
}

class OfflineManager {
  constructor() { this.queue = new DownloadQueue(this); this.ready = false; W._offlineManagerInstance = W.OfflineManager = this; }
  async initialize() {
    if (this.ready) return; await DB.openDB();
    if (['R1', 'R2'].includes(this.getMode()) && !(await hasSpace())) { this.setMode('R0'); toast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ', 'warning'); }
    const all = await DB.getAllTrackMetas(), t = now();
    for (const m of all) if (m.type === 'cloud' && m.cloudExpiresAt && m.cloudExpiresAt < t) { await this.removeCached(m.uid); toast('–û—Ñ–ª–∞–π–Ω-–¥–æ—Å—Ç—É–ø –∏—Å—Ç—ë–∫. –¢—Ä–µ–∫ —É–¥–∞–ª—ë–Ω.', 'warning'); }
    W.addEventListener('quality:changed', e => this._onQualChg(e.detail?.quality));
    W.addEventListener('analytics:cloudThresholdReached', e => e.detail?.uid && this.registerFullListen(e.detail.uid, { forcedCloud: true }));
    W.addEventListener('player:trackChanged', async e => {
      if (!W._orphanedBlobs?.size) return;
      for (const u of W._orphanedBlobs) if (u !== e.detail?.uid) { const m = await DB.getTrackMeta(u); if (m?.quality) await DB.deleteAudioVariant(u, m.quality === 'hi' ? 'lo' : 'hi').catch(()=>{}); W._orphanedBlobs.delete(u); }
    });
    this.ready = true; emit('offline:ready');
  }
  getMode() { return localStorage.getItem(LS.MODE) || 'R0'; }
  setMode(m) { localStorage.setItem(LS.MODE, m); emit('offline:uiChanged'); }
  getQuality() { return normQ(localStorage.getItem(LS.QUAL)); }
  setQuality(q) { localStorage.setItem(LS.QUAL, normQ(q)); emit('offline:uiChanged'); }
  getCQ() { return normQ(localStorage.getItem(LS.CQ)); }
  setCQ(q) { localStorage.setItem(LS.CQ, normQ(q)); this._onQualChg(normQ(q)); emit('offline:uiChanged'); }
  getEffectiveQuality() { return this.getMode() === 'R2' ? this.getCQ() : this.getQuality(); }
  getCloudSettings() { return { N: parseInt(localStorage.getItem(LS.CN)) || DEF.N, D: parseInt(localStorage.getItem(LS.CD)) || DEF.D }; }
  async hasSpace() { return hasSpace(); }
  async isSpaceOk() { return hasSpace(); }
  async getDynamicLimitMB() { return await DB.getGlobal(G.DYN_MB).then(r => Number.isFinite(Number(r?.value)) && r.value >= 0 ? r.value : DEF.R2_DYN_MB).catch(() => DEF.R2_DYN_MB); }
  async setDynamicLimitMB(mb) { await DB.setGlobal(G.DYN_MB, Math.max(0, Math.floor(Number(mb) || 0))); emit('offline:uiChanged'); }
  async _getMRU() { return await DB.getGlobal(G.MRU).then(r => Array.isArray(r?.value) ? r.value.map(sUid).filter(Boolean) : []).catch(() => []); }
  async _setMRU(l) { await DB.setGlobal(G.MRU, l); }
  async touchMRU(u) {
    if (!(u = sUid(u)) || this.getMode() !== 'R2') return; const m = await DB.getTrackMeta(u);
    if (['pinned', 'cloud', 'playbackCache'].includes(m?.type)) return this._dropFromMRU(u);
    await this._setMRU([u, ...(await this._getMRU()).filter(x => x !== u)].slice(0, 2000));
  }
  async _dropFromMRU(u) { if (u = sUid(u)) { const l = await this._getMRU(), n = l.filter(x => x !== u); if (n.length !== l.length) await this._setMRU(n); } }
  async getDynamicUsedBytes() { return (await DB.getAllTrackMetas()).reduce((s, m) => s + (m.type === 'dynamic' ? (m.size || 0) : 0), 0); }
  async getTrackOfflineState(u) {
    if (!(u = sUid(u)) || !this.ready) return { status: 'none', downloading: false, cachedComplete: false };
    const m = await DB.getTrackMeta(u), c = !!m?.cachedComplete, q = this.getEffectiveQuality();
    const s = m?.type === 'pinned' ? 'pinned' : (m?.type === 'cloud' ? (c ? 'cloud' : 'cloud_loading') : (['playbackCache', 'dynamic'].includes(m?.type) ? 'transient' : 'none'));
    return { status: s, downloading: this.queue.act.has(u), cachedComplete: c, needsReCache: !!m?.needsReCache || (c && m.quality !== q), needsUpdate: !!m?.needsUpdate, quality: m?.quality, daysLeft: m?.cloudExpiresAt ? Math.ceil((m.cloudExpiresAt - now()) / 864e5) : 0 };
  }
  async togglePinned(u) {
    if (!(u = sUid(u))) return; const m = (await DB.getTrackMeta(u)) || { uid: u }, { D } = this.getCloudSettings(), q = this.getEffectiveQuality();
    if (m.type === 'pinned') { await DB.updateTrackMeta(u, { type: 'cloud', cloud: true, pinnedAt: null, cloudAddedAt: now(), cloudExpiresAt: now() + D * 864e5 }); toast(`–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–Ω—è—Ç–æ. –î–æ—Å—Ç—É–ø–Ω–æ –∫–∞–∫ –æ–±–ª–∞–∫–æ –Ω–∞ ${D} –¥–Ω.`, 'info'); }
    else { if (!(await hasSpace())) return toast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞', 'warning'); await DB.updateTrackMeta(u, { type: 'pinned', cloud: false, pinnedAt: now() }); if (!m.cachedComplete || m.quality !== q) { const url = getUrl(u, q); if (url) { toast('–ó–∞–∫—Ä–µ–ø–ª—ë–Ω. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ...', 'info'); this.queue.add({ uid: u, url, quality: q, priority: PRIO.PIN, kind: 'pinned' }); } } else toast('–¢—Ä–µ–∫ –∑–∞–∫—Ä–µ–ø–ª—ë–Ω üîí', 'success'); }
    emit('offline:stateChanged');
  }
  async removeCached(u) { if (u = sUid(u)) { this.queue.cancel(u); await DB.deleteAudio(u); await DB.updateTrackMeta(u, { type: null, cloud: false, cachedComplete: false, quality: null, size: 0, cloudFullListenCount: 0, lastFullListenAt: null, cloudAddedAt: null, cloudExpiresAt: null }); emit('offline:stateChanged'); } }
  async removeAllCached() { for (const m of await DB.getAllTrackMetas()) if (['pinned', 'cloud', 'dynamic'].includes(m.type)) await this.removeCached(m.uid); }
  async evictDynamic() {
    const pS = new Set(Object.values(W.PlaybackCache?.getWindowState?.() || {}).filter(Boolean)), ms = new Map((await DB.getAllTrackMetas()).map(m => [m.uid, m]));
    const c = (await this._getMRU()).filter(u => { const m = ms.get(u); return m && m.type === 'dynamic' && !pS.has(u); });
    await this._setMRU(c);
    for (let i = c.length - 1; i >= 0; i--) { await DB.deleteTrackCache(c[i]).catch(()=>{}); await this._dropFromMRU(c[i]); if (await hasSpace()) return; }
  }
  async registerFullListen(u, { forcedCloud } = {}) {
    if (!(u = sUid(u)) || !forcedCloud) return; const m = (await DB.getTrackMeta(u)) || { uid: u }, { N, D } = this.getCloudSettings(), nC = (m.cloudFullListenCount || 0) + 1, upd = { cloudFullListenCount: nC, lastFullListenAt: now() };
    if (m.type === 'cloud') upd.cloudExpiresAt = now() + D * 864e5;
    if (!['pinned', 'cloud'].includes(m.type)) {
      if (nC >= N) { if (await hasSpace()) { Object.assign(upd, { type: 'cloud', cloud: true, cloudOrigin: 'auto', cloudExpiresAt: now() + D * 864e5 }); if (!m.cachedComplete) { const q = this.getEffectiveQuality(), url = getUrl(u, q); if (url) this.queue.add({ uid: u, url, quality: q, priority: PRIO.FILL, kind: 'cloud' }); } } }
      else if (this.getMode() === 'R2' && m.type !== 'playbackCache') {
        upd.type = 'dynamic'; upd.lastAccessedAt = now();
        if (!m.cachedComplete) { const lB = (await this.getDynamicLimitMB()) * 1048576, uB = await this.getDynamicUsedBytes(), q = this.getEffectiveQuality(), url = getUrl(u, q); if (url) { if (lB <= 0) upd.type = null; else if (uB >= lB) { await this.evictDynamic(); if (await this.getDynamicUsedBytes() >= lB) toast('–•—Ä–∞–Ω–∏–ª–∏—â–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–æ', 'warning'); else this.queue.add({ uid: u, url, quality: q, priority: PRIO.DYN, kind: 'dynamic' }); } else this.queue.add({ uid: u, url, quality: q, priority: PRIO.DYN, kind: 'dynamic' }); } }
      }
    }
    await DB.updateTrackMeta(u, upd); emit('offline:stateChanged');
  }
  async resolveTrackSource(u, reqQ) {
    if (!(u = sUid(u))) return { source: 'none' };
    const q = normQ(reqQ || this.getEffectiveQuality()), a = q === 'hi' ? 'lo' : 'hi', iN = netOk(), m = await DB.getTrackMeta(u);
    if (m?.type === 'dynamic') { DB.updateTrackMeta(u, { lastAccessedAt: now() }); this.touchMRU(u).catch(()=>{}); }
    const b1 = await DB.getAudioBlob(u, q); if (b1) return { source: 'local', blob: b1, quality: q };
    const b2 = await DB.getAudioBlob(u, a);
    if (b2) { if (q === 'lo') return { source: 'local', blob: b2, quality: a }; if (iN) { const url = getUrl(u, q); if (url) { if (this.getMode() !== 'R2') this._reCache(u, q); return { source: 'stream', url, quality: q }; } } return { source: 'local', blob: b2, quality: a }; }
    if (iN) { const url = getUrl(u, q); if (url) return { source: 'stream', url, quality: q }; }
    return { source: 'none' };
  }
  async enqueueAudioDownload(u, { priority, kind } = {}) {
    if (!(u = sUid(u)) || await DB.hasAudioForUid(u).catch(()=>false)) return; const m = await DB.getTrackMeta(u);
    if (['pinned', 'cloud', 'dynamic'].includes(m?.type) || m?.cachedComplete || (kind === 'playbackCache' && !(await hasSpace()))) return;
    const q = this.getEffectiveQuality(), url = getUrl(u, q);
    if (kind === 'playbackCache' && m?.type !== 'playbackCache') await DB.updateTrackMeta(u, { type: 'playbackCache', lastAccessedAt: now() });
    if (url) this.queue.add({ uid: u, url, quality: q, priority: priority || PRIO.UPD, kind });
  }
  _reCache(u, q, p = PRIO.UPD) { if (W.playerCore?.getCurrentTrackUid?.() === u) return; const url = getUrl(u, q); if (url) this.queue.add({ uid: u, url, quality: q, priority: p, kind: 'reCache' }); }
  async _onQualChg(nQ) { const q = normQ(nQ); this.queue.clearOldQualities(q); for (const [u] of this.queue.act) this.queue.cancel(u); for (const m of await DB.getAllTrackMetas()) if (['pinned', 'cloud', 'dynamic'].includes(m.type) && m.cachedComplete && m.quality !== q) { await DB.updateTrackMeta(m.uid, { needsReCache: true }); this._reCache(m.uid, q, m.type === 'pinned' ? PRIO.PIN : (m.type === 'cloud' ? PRIO.UPD : PRIO.DYN)); } emit('offline:uiChanged'); }
  async confirmApplyCloudSettings({ newN, newD }) { localStorage.setItem(LS.CN, newN); localStorage.setItem(LS.CD, newD); emit('offline:uiChanged'); }
  async getStorageBreakdown() { return (await DB.getAllTrackMetas()).reduce((a, m) => { a[['pinned','cloud','playbackCache','dynamic'].includes(m.type) ? (m.type === 'playbackCache' ? 'transient' : m.type) : 'other'] += (m.size || 0); return a; }, { pinned: 0, cloud: 0, transient: 0, dynamic: 0, other: 0 }); }
  getDownloadStatus() { return this.queue.getStatus(); }
  async getTrackMeta(u) { return DB.getTrackMeta(u); }
  async countNeedsReCache(q) { if (this.getMode() === 'R2') return 0; return (await DB.getAllTrackMetas()).filter(m => ['pinned', 'cloud'].includes(m.type) && m.cachedComplete && m.quality !== normQ(q)).length; }
  async reCacheAll(q) { this._onQualChg(q); }
  setCacheQualitySetting(q) { this.setCQ(q); }
  recordTickStats() {} getBackgroundPreset() { return 'balanced'; } setBackgroundPreset() {}
}

const instance = new OfflineManager();
export const getOfflineManager = () => instance;
export default instance;

//=================================================
// FILE: /scripts/offline/track-resolver.js
/**
 * scripts/offline/track-resolver.js
 * Optimized v2.0 ‚Äî 100% Spec-Compliant (R1/R2)
 * 
 * FIX: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –∏–∑–±—ã—Ç–æ—á–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ IndexedDB (N+1 query problem).
 * PlayerCore –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ `source`, `blob` –∏ `url`. 
 * –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∑–∞ `meta` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ 
 * –ø–µ—Ä–µ—Ö–æ–¥—ã (instant transitions) –≤ —Ä–µ–∂–∏–º–µ PlaybackCache.
 */

let _mgr = null;

export const initTrackResolver = (offlineManager) => {
  _mgr = offlineManager;
  window.TrackResolver = { resolve };
};

export async function resolve(uid, quality) {
  if (!_mgr) return { source: 'stream', url: null, blob: null, quality, localKind: 'none' };
  
  try {
    // –í—Å—è —Ç—è–∂–µ–ª–∞—è —Ä–∞–±–æ—Ç–∞ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤–Ω—É—Ç—Ä–∏ OfflineManager
    const res = await _mgr.resolveTrackSource(uid, quality);
    
    return {
      source: res.source || 'stream',
      url: res.url || null,
      blob: res.blob || null,
      quality: res.quality || quality,
      localKind: res.source === 'local' ? 'cache' : 'none' // –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ, –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ Main Thread
    };
  } catch (e) {
    console.warn('[TrackResolver] resolve failed:', e);
    return { source: 'stream', url: null, blob: null, quality, localKind: 'none' };
  }
}

export default { initTrackResolver, resolve };

//=================================================
// FILE: /scripts/offline/update-checker.js
/**
 * scripts/offline/update-checker.js
 * Optimized & 100% Spec-Compliant (Section 11.1, 11.2).
 * Fixes O(N^2) lookups, parallelizes network requests, and automatically
 * enqueues updates in the background (via OfflineManager) as mandated by the spec.
 */
import { getAllTrackMetas, updateTrackMeta } from './cache-db.js';
import { getOfflineManager } from './offline-manager.js';

let _timer = null;

export function initUpdateChecker() {
  setTimeout(checkForUpdates, 8000);
  _timer = setInterval(checkForUpdates, 30 * 60 * 1000); // 30 –º–∏–Ω—É—Ç
}

export async function checkForUpdates() {
  const np = window.NetPolicy;
  if ((np && !np.isNetworkAllowed()) || !navigator.onLine) return;

  const albums = window.albumsIndex || [];
  const metas = await getAllTrackMetas();
  
  // O(1) Lookup: —Ñ–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ 100% –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ pinned/cloud —Ñ–∞–π–ª—ã
  const targets = new Map();
  for (const m of metas) {
    if ((m.type === 'pinned' || m.type === 'cloud') && m.cachedComplete && m.size) {
      targets.set(m.uid, m);
    }
  }

  if (!albums.length || !targets.size) return;

  let changed = false;
  const mgr = getOfflineManager();

  // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ–ø—Ä–æ—Å –≤—Å–µ—Ö remote config.json
  await Promise.allSettled(albums.map(async (album) => {
    const base = album.base.endsWith('/') ? album.base : `${album.base}/`;
    const res = await fetch(`${base}config.json`, { cache: 'no-cache' });
    if (!res.ok) return;

    const { tracks = [] } = await res.json();

    for (const t of tracks) {
      const uid = String(t.uid || t.id || '').trim();
      const meta = targets.get(uid);
      if (!meta) continue;

      const q = meta.quality || 'lo';
      const rSize = q === 'hi' ? (t.size || t.fileSize || 0) : (t.size_low || t.fileSizeLow || 0);
      const rBytes = rSize > 0 ? Math.round(rSize * 1048576) : 0;
      
      // Mismatch: —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 100 –ö–ë (–∑–∞—â–∏—Ç–∞ –æ—Ç –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è MB –≤ JSON)
      const mismatch = rBytes > 0 && Math.abs(rBytes - (meta.size || 0)) > 102400;

      if (mismatch && !meta.needsUpdate) {
        await updateTrackMeta(uid, { needsUpdate: true, remoteSize: rSize });
        
        // SPEC FIX 11.2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        const audioPath = q === 'hi' ? t.audio : (t.audio_low || t.audio);
        if (audioPath && mgr?.queue) {
          mgr.queue.add({
            uid,
            url: new URL(audioPath, base).toString(),
            quality: q,
            priority: 70, // PRIO.UPD = 70 (–Ω–∏–∂–µ –æ–∫–Ω–∞, –≤—ã—à–µ assets)
            kind: 'update'
          });
        }
        changed = true;
      } else if (!mismatch && meta.needsUpdate) {
        // –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä —Å–æ–≤–ø–∞–ª, –Ω–æ —Ñ–ª–∞–≥ –æ—Å—Ç–∞–ª—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è)
        await updateTrackMeta(uid, { needsUpdate: false });
        changed = true;
      }
    }
  }));

  if (changed) window.dispatchEvent(new CustomEvent('offline:uiChanged'));
}

export const countNeedsUpdate = async () => (await getAllTrackMetas()).filter(m => m.needsUpdate).length;
export const getUpdateList = async () => (await getAllTrackMetas()).filter(m => m.needsUpdate);

export default { initUpdateChecker, checkForUpdates, countNeedsUpdate, getUpdateList };

//=================================================
// FILE: /scripts/ui/cache-progress-overlay.js
/**
 * scripts/ui/cache-progress-overlay.js
 * –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–û: –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó (–†–∞–∑–¥–µ–ª 13 "UI –ü–†–û–ì–†–ï–°–° –ö–≠–®–ê –í –ü–õ–ï–ï–†–ï").
 * –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –ø–ª–∞–≤–∞—é—â–∏–π overlay —É–¥–∞–ª–µ–Ω. –ò–Ω–¥–∏–∫–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–ø–µ—Ä—å –≤—Å—Ç—Ä–æ–µ–Ω–∞
 * –≤—Ç–æ—Ä—ã–º —Å–ª–æ–µ–º (background) –Ω–∞–ø—Ä—è–º—É—é –ø–æ–¥ –ø–æ–ª–∑—É–Ω–æ–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –ø–ª–µ–µ—Ä–∞.
 */

import { getOfflineManager } from '../offline/offline-manager.js';

let _layer = null;

export function initCacheProgressOverlay() {
  const sync = () => requestAnimationFrame(updateProgressBar);
  
  // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –≤—Å–µ —Å–æ–±—ã—Ç–∏—è, —Å–ø–æ—Å–æ–±–Ω—ã–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∏–ª–∏ UI –ø–ª–µ–µ—Ä–∞
  ['player:trackChanged', 'offline:downloadStart', 'offline:trackCached', 'offline:downloadFailed', 'offline:stateChanged', 'offline:uiChanged'].forEach(ev => 
    window.addEventListener(ev, sync)
  );
  
  // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ (legacy) –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ –æ–∫–Ω–∞, –µ—Å–ª–∏ –æ–Ω–æ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–ª–æ—Å—å –≤ —Å—Ç–∞—Ä–æ–º DOM
  document.getElementById('cache-progress-overlay')?.remove();
}

async function updateProgressBar() {
  const bar = document.getElementById('player-progress-bar');
  if (!bar) return;

  // –ï—Å–ª–∏ —Å–ª–æ–π –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω –ò–õ–ò –ø–ª–µ–µ—Ä –±—ã–ª –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞–Ω (isConnected === false), —Å–æ–∑–¥–∞–µ–º –∑–∞–Ω–æ–≤–æ
  if (!_layer || !_layer.isConnected) {
    _layer = document.createElement('div');
    _layer.className = 'player-cache-layer';
    bar.insertBefore(_layer, bar.firstChild); // –í—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–≥–æ –ü–û–î –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ–ª–∑—É–Ω–æ–∫

    // –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –Ω—É–∂–Ω—ã–µ —Å—Ç–∏–ª–∏, –Ω–µ –ª–æ–º–∞—è main.css
    if (!document.getElementById('cache-layer-styles')) {
      const s = document.createElement('style');
      s.id = 'cache-layer-styles';
      s.textContent = `
        .player-cache-layer {
          position: absolute; inset: 0 auto auto 0; height: 100%;
          background: rgba(255, 255, 255, 0.2); border-radius: 3px;
          pointer-events: none; transition: width 0.3s ease, opacity 0.3s;
          width: 0%; opacity: 0; z-index: 0;
        }
        .player-cache-layer.is-loading {
          background: linear-gradient(90deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0.05) 100%);
          background-size: 200% 100%; animation: cacheAnim 1.5s infinite linear;
          width: 100%; opacity: 1;
        }
        .player-progress-fill { position: relative; z-index: 1; } /* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ —Å–∏–Ω–∏–π –±–∞—Ä –≤—Å–µ–≥–¥–∞ —Å–≤–µ—Ä—Ö—É */
        @keyframes cacheAnim { to { background-position: -200% 0; } }
      `;
      document.head.appendChild(s);
    }
  }

  const uid = window.playerCore?.getCurrentTrackUid?.();
  if (!uid) {
    _layer.style.opacity = '0';
    _layer.classList.remove('is-loading');
    return;
  }

  const state = await getOfflineManager().getTrackOfflineState(uid);

  if (state.cachedComplete) {
    // 100% = –¢—Ä–µ–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω (Pinned, Cloud –∏–ª–∏ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª R1 PlaybackCache)
    _layer.style.width = '100%';
    _layer.style.opacity = '1';
    _layer.classList.remove('is-loading');
    _layer.style.background = 'rgba(255,255,255,0.2)'; 
  } else if (state.downloading) {
    // –¢—Ä–µ–∫ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∑–∞–≥—Ä—É–∑–∫–∏ (–∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π indeterminate-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä)
    _layer.classList.add('is-loading');
    _layer.style.background = ''; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç –∏–∑ CSS-–∫–ª–∞—Å—Å–∞
  } else {
    // –¢—Ä–µ–∫–∞ –Ω–µ—Ç –≤ –∫—ç—à–µ –∏ –Ω–µ –ø—Ä–µ–¥–≤–∏–¥–∏—Ç—Å—è (—Å—Ç—Ä–∏–º–∏–Ω–≥ –±–µ–∑ R1)
    _layer.style.opacity = '0';
    _layer.classList.remove('is-loading');
  }
}

export default { initCacheProgressOverlay };

//=================================================
// FILE: /scripts/ui/lyrics-modal.js
// scripts/ui/lyrics-modal.js
// –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–ª–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –ø–µ—Å–Ω–∏ (–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ v2.0 + Offline Fallback)

(function () {
  'use strict';

  const show = async () => {
    const W = window, D = document, N = W.NotificationSystem;
    const t = W.playerCore?.getCurrentTrack();
    
    if (!t) return N?.warning('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç—Ä–µ–∫–∞');

    let txt = '';

    // 1. –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç (fulltext). 
    // –ï—Å–ª–∏ —Å–µ—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∞ –°–µ—Ç–µ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–æ–π, fetch –≤—ã–±—Ä–æ—Å–∏—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.
    if (t.fulltext) {
      try {
        const r = await fetch(t.fulltext);
        if (r.ok) txt = await r.text();
      } catch (e) {
        console.warn('[LyricsModal] Fulltext fetch failed (Offline/Network Policy). Falling back to timeline.');
      }
    }

    // 2. –£–º–Ω—ã–π Fallback: –ï—Å–ª–∏ fulltext –Ω–µ—Ç –∏–ª–∏ –æ–Ω –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–æ–º,
    // –±–µ—Å—à–æ–≤–Ω–æ –±–µ—Ä–µ–º —É–∂–µ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–π–º–ª–∞–π–Ω-—Å—Ç—Ä–æ–∫–∏ –∏–∑ –ø–∞–º—è—Ç–∏.
    if (!txt) {
      const lines = W.LyricsController?.getCurrentLyricsLines?.() || [];
      txt = lines.map(i => i.line).filter(Boolean).join('\n');
    }

    if (!txt) return N?.warning('–¢–µ–∫—Å—Ç –ø–µ—Å–Ω–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');

    const esc = W.Utils?.escapeHtml || (s => String(s || ''));
    
    // –°—Ç—Ä–æ–≥–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∏–∫—Å–µ–ª—å-–≤-–ø–∏–∫—Å–µ–ª—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ ID –∫–Ω–æ–ø–æ–∫
    const html = `
      <div class="lyrics-modal" style="max-height: 80vh;">
        <h2 style="margin: 0 0 8px 0;">${esc(t.title)}</h2>
        <div style="color: #8ab8fd; margin-bottom: 16px; font-size: 14px;">
          ${esc(t.artist || '–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞')} ¬∑ ${esc(t.album || '')}
        </div>
        <div class="lyrics-fulltext" style="max-height: 50vh; overflow-y: auto; padding: 16px; background: rgba(0,0,0,0.2); border-radius: 10px; line-height: 1.8; white-space: pre-wrap; font-size: 15px; scrollbar-width: thin; scrollbar-color: rgba(77,170,255,0.3) transparent;">${esc(txt)}</div>
        <div style="display:flex; gap:10px; margin-top:16px; justify-content:center; flex-wrap:wrap;">
          <button class="modal-action-btn" id="copy-lyrics-btn">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
          <button class="modal-action-btn" id="share-lyrics-btn">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
        </div>
      </div>
    `;

    if (!W.Modals?.open) return N?.error('–°–∏—Å—Ç–µ–º–∞ –æ–∫–æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
    const m = W.Modals.open({ title: '–¢–µ–∫—Å—Ç –ø–µ—Å–Ω–∏', maxWidth: 560, bodyHtml: html });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API -> Fallback –Ω–∞ execCommand)
    m.querySelector('#copy-lyrics-btn')?.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(txt);
        N?.success('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω');
        m.remove();
      } catch {
        const ta = D.createElement('textarea');
        Object.assign(ta.style, { position: 'fixed', opacity: '0' });
        ta.value = txt;
        D.body.appendChild(ta);
        ta.select();
        try { D.execCommand('copy'); N?.success('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω'); m.remove(); } 
        catch { N?.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å'); }
        ta.remove();
      }
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫: –ü–æ–¥–µ–ª–∏—Ç—å—Å—è (Web Share API)
    m.querySelector('#share-lyrics-btn')?.addEventListener('click', async () => {
      if (!navigator.share) return N?.info('–§—É–Ω–∫—Ü–∏—è "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
      try {
        await navigator.share({ title: t.title, text: `${t.title} - ${t.artist}\n\n${txt}` });
      } catch (e) {
        if (e.name !== 'AbortError') console.error('Share failed:', e);
      }
    });
  };

  window.LyricsModal = { show };
})();

//=================================================
// FILE: /scripts/ui/modals.js
(function () {
  'use strict';
  const esc = s => window.Utils?.escapeHtml?.(String(s ?? '')) ?? String(s ?? '');
  
  const open = ({ title = '', bodyHtml = '', maxWidth = 520, onClose } = {}) => {
    let c = document.getElementById('modals-container');
    if (!c) { c = document.createElement('div'); c.id = 'modals-container'; document.body.appendChild(c); }

    const bg = document.createElement('div');
    bg.className = 'modal-bg active';
    bg.innerHTML = `<div class="modal-feedback" style="max-width:${maxWidth}px"><button class="bigclose" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.3 5.71a1 1 0 0 0-1.41 0L12 10.59 7.11 5.7A1 1 0 0 0 5.7 7.11L10.59 12l-4.9 4.89a1 1 0 1 0 1.41 1.42L12 13.41l4.89 4.9a1 1 0 0 0 1.42-1.41L13.41 12l4.9-4.89a1 1 0 0 0-.01-1.4z"/></svg></button>${title ? `<h2>${esc(title)}</h2>` : ''}<div class="modal-body">${bodyHtml}</div></div>`;
    c.appendChild(bg);

    const close = () => { onClose?.(); bg.remove(); };
    const onKey = e => { if (e.key === 'Escape') { e.preventDefault(); close(); } };
    
    bg.onclick = e => { if (e.target === bg || e.target.closest('.bigclose')) close(); };
    window.addEventListener('keydown', onKey);
    
    // Garbage collection protection for external bg.remove() calls
    const _rem = bg.remove.bind(bg);
    bg.remove = () => { window.removeEventListener('keydown', onKey); _rem(); };
    
    return bg;
  };

  const confirm = ({ title = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ', textHtml = '', confirmText = '–û–∫', cancelText = '–û—Ç–º–µ–Ω–∞', maxWidth = 460, onClose, onConfirm, onCancel } = {}) => {
    const m = open({
      title, maxWidth, onClose,
      bodyHtml: `<div style="color:#9db7dd;line-height:1.45;margin-bottom:14px;">${textHtml}</div><div class="om-actions"><button type="button" class="modal-action-btn" data-act="cancel" style="min-width:130px;">${esc(cancelText)}</button><button type="button" class="modal-action-btn online" data-act="confirm" style="min-width:130px;">${esc(confirmText)}</button></div>`
    });
    
    m.addEventListener('click', e => {
      if (e.target.closest('[data-act="cancel"]')) { onCancel?.(); m.remove(); }
      else if (e.target.closest('[data-act="confirm"]')) { onConfirm?.(); m.remove(); }
    });
    
    return m;
  };

  window.Modals = window.Modals || {};
  window.Modals.open = open;
  window.Modals.confirm = confirm;
  Object.defineProperty(window.Modals, 'offlineBody', {
    configurable: true, get() { return window.ModalTemplates?.offlineBody || null; }
  });
})();

//=================================================
// FILE: /scripts/ui/news-inline.js
// scripts/ui/news-inline.js
// –†–µ–Ω–¥–µ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π –≤–Ω—É—Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∞–ª—å–±–æ–º __reliz__).
// –¢–æ–ª—å–∫–æ UI/fetch, –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ.

const esc = (s) => {
  const fn = window.Utils?.escapeHtml;
  return typeof fn === 'function' ? fn(String(s ?? '')) : String(s ?? '');
};

function renderCard(it) {
  const title = esc(it?.title || '–ù–æ–≤–æ—Å—Ç—å');
  const date = esc(it?.date || '');
  const text = esc(it?.text || '');
  const tags = Array.isArray(it?.tags) ? it.tags : [];

  const media = it?.embedUrl
    ? `<div class="news-inline__media"><iframe loading="lazy" src="${esc(it.embedUrl)}" allowfullscreen></iframe></div>`
    : it?.image
      ? `<div class="news-inline__media"><img loading="lazy" src="${esc(it.image)}" alt=""></div>`
      : it?.video
        ? `<div class="news-inline__media"><video controls preload="metadata" src="${esc(it.video)}"></video></div>`
        : '';

  const tagHtml = tags.length
    ? `<div class="news-inline__tags">${tags.map((t) => `<span class="news-inline__tag">#${esc(t)}</span>`).join('')}</div>`
    : '';

  return `
    <article class="news-inline__card">
      <div class="news-inline__title">${title}</div>
      ${date ? `<div class="news-inline__date">${date}</div>` : ''}
      ${media}
      ${text ? `<div class="news-inline__text">${text}</div>` : ''}
      ${tagHtml}
    </article>
  `;
}

export function renderNewsInlineSkeleton(container) {
  if (!container) return;

  container.innerHTML = `
    <div class="news-inline__head">
      <div class="news-inline__links">
        <a href="https://t.me/vitrina_razbita" target="_blank" rel="noopener noreferrer">Telegram –∫–∞–Ω–∞–ª</a>
        <span class="news-inline__dot">¬∑</span>
        <a href="./news.html" target="_blank" rel="noopener noreferrer">–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–æ–≤–æ—Å—Ç–µ–π</a>
      </div>
      <div id="news-inline-status" class="news-inline__status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    <div id="news-inline-list" class="news-inline__list"></div>
  `;
}

export async function loadAndRenderNewsInline(container) {
  if (!container) return;

  renderNewsInlineSkeleton(container);

  const status = container.querySelector('#news-inline-status');
  const list = container.querySelector('#news-inline-list');
  if (!list) return;

  try {
    const r = await fetch('./news/news.json', { cache: 'no-cache' });
    if (!r.ok) throw new Error(`HTTP ${r.status}`);

    const j = await r.json();
    const items = Array.isArray(j?.items) ? j.items : [];

    if (!items.length) {
      if (status) status.textContent = '–ü–æ–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π –Ω–µ—Ç';
      return;
    }

    if (status) status.style.display = 'none';
    list.innerHTML = items.map(renderCard).join('');
  } catch {
    if (status) {
      status.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ—Å—Ç–∏';
      status.classList.add('news-inline__status--error');
    }
  }
}

//=================================================
// FILE: /scripts/ui/notify.js
(function () {
  'use strict';
  const esc = s => String(s || '').replace(/[<>&'"]/g, m => ({'<':'&lt;','>':'&gt;','&':'&amp;',"'":'&#39;','"':'&quot;'}[m]));
  const emojis = { info: '‚ÑπÔ∏è', success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è', offline: 'üì¥' };

  let cont;
  const getCont = () => {
    if (!cont) {
      cont = document.createElement('div');
      cont.id = 'toast-container';
      cont.style.cssText = 'position:fixed;bottom:80px;left:50%;transform:translateX(-50%);z-index:10000;pointer-events:none';
      document.body.appendChild(cont);
    }
    return cont;
  };

  class NotificationSystem {
    constructor() { this.q = Promise.resolve(); }
    
    show(msg, type = 'info', dur = 3000) {
      this.q = this.q.then(() => new Promise(res => {
        const el = document.createElement('div');
        el.className = `toast toast-${type}`;
        el.innerHTML = `<div class="toast-content"><span class="toast-emoji">${emojis[type]||'‚ÑπÔ∏è'}</span><span class="toast-message">${esc(msg)}</span></div>`;
        getCont().appendChild(el);
        
        requestAnimationFrame(() => el.classList.add('show'));
        
        setTimeout(() => {
          el.classList.remove('show');
          setTimeout(() => { el.remove(); res(); }, 300);
        }, Math.max(0, Number(dur) || 0));
      })).catch(() => {});
    }

    info(m, d) { this.show(m, 'info', d); }
    success(m, d) { this.show(m, 'success', d); }
    error(m, d) { this.show(m, 'error', d); }
    warning(m, d) { this.show(m, 'warning', d); }
    offline(m, d) { this.show(m, 'offline', d); }
  }

  window.NotificationSystem = new NotificationSystem();
})();

//=================================================
// FILE: /scripts/ui/offline-indicators.js
/**
 * scripts/ui/offline-indicators.js
 * Optimized Event Delegation & Batch DB Updates. 
 * Eliminates N+1 queries lock and DOM memory leaks.
 */
import { getOfflineManager } from '../offline/offline-manager.js';
import { getAllTrackMetas } from '../offline/cache-db.js';

let _timer = 0;
let _menu = null;

export async function refreshAllIndicators() {
  const mgr = getOfflineManager();
  const hasSpace = await mgr.hasSpace().catch(() => true);
  const metas = await getAllTrackMetas().catch(() => []);
  const metaMap = new Map(metas.map(m => [m.uid, m]));
  
  let needsAlert = false;

  document.querySelectorAll('.offline-ind').forEach(ind => {
    const uid = ind.dataset.uid;
    const m = metaMap.get(uid);
    let s = 'none';

    if (m?.type === 'pinned') s = 'pinned';
    else if (m?.type === 'cloud') s = m.cachedComplete ? 'cloud' : 'cloud_loading';
    else if (m?.type === 'playbackCache' || m?.type === 'dynamic') s = 'transient';

    if (m?.needsReCache || m?.needsUpdate) needsAlert = true;

    ind.className = 'offline-ind';
    ind.textContent = s === 'cloud' ? '‚òÅ' : 'üîí';

    if (s === 'pinned') {
      const dl = mgr.queue?.act?.has(uid);
      ind.classList.add(dl ? 'offline-ind--pinned-loading' : 'offline-ind--pinned');
      ind.title = dl ? '–ó–∞–∫—Ä–µ–ø–ª—ë–Ω (–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è‚Ä¶)' : '–ó–∞–∫—Ä–µ–ø–ª—ë–Ω –æ—Ñ–ª–∞–π–Ω';
    } else if (s === 'cloud') {
      ind.classList.add('offline-ind--cloud');
      ind.title = `–û–±–ª–∞—á–Ω—ã–π –∫—ç—à (–æ—Å—Ç–∞–ª–æ—Å—å ${Math.max(0, Math.ceil(((m.cloudExpiresAt || 0) - Date.now()) / 86400000))} –¥–Ω.)`;
    } else {
      ind.classList.add(hasSpace ? 'offline-ind--none' : 'offline-ind--nospace');
      ind.title = s === 'cloud_loading' ? '–û–±–ª–∞—á–Ω—ã–π –∫—ç—à (–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è‚Ä¶)' : (hasSpace ? '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–∫—Ä–µ–ø–∏—Ç—å' : '–ù–µ—Ç –º–µ—Å—Ç–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ');
    }
  });

  const btn = document.getElementById('offline-btn');
  if (btn) {
    btn.classList.toggle('active', mgr.getMode() === 'R1');
    let alert = btn.querySelector('.offline-btn-alert');
    if (needsAlert && !alert) {
      btn.insertAdjacentHTML('afterbegin', '<span class="offline-btn-alert" title="–ï—Å—Ç—å —Ç—Ä–µ–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è">!</span>');
    } else if (!needsAlert && alert) {
      alert.remove();
    }
  }
}

export function injectOfflineIndicators(root = document) {
  if (!root) return;
  root.querySelectorAll('.track[data-uid]').forEach(t => {
    if (!t.querySelector('.offline-ind')) {
      const i = document.createElement('span');
      i.className = 'offline-ind offline-ind--none';
      i.dataset.uid = t.dataset.uid;
      i.textContent = 'üîí';
      const tn = t.querySelector('.tnum');
      tn ? t.insertBefore(i, tn) : t.prepend(i);
    }
  });
  scheduleRefresh();
}

export const injectIndicator = async (el) => {
  if (!el || el.querySelector('.offline-ind')) return;
  const i = document.createElement('span');
  i.className = 'offline-ind offline-ind--none';
  i.dataset.uid = el.dataset.uid;
  i.textContent = 'üîí';
  const tn = el.querySelector('.tnum');
  tn ? el.insertBefore(i, tn) : el.prepend(i);
  scheduleRefresh();
};

const scheduleRefresh = () => {
  if (!_timer) _timer = setTimeout(() => { _timer = 0; refreshAllIndicators(); }, 50);
};

function showCloudMenu(ind, uid) {
  _menu?.remove();
  _menu = document.createElement('div');
  _menu.className = 'cloud-menu';
  _menu.dataset.uid = uid;
  Object.assign(_menu.style, { position: 'fixed', zIndex: '99999' });
  _menu.innerHTML = `
    <div class="cloud-menu__item" data-action="pin">üîí –ó–∞–∫—Ä–µ–ø–∏—Ç—å</div>
    <div class="cloud-menu__item cloud-menu__item--danger" data-action="del">üóë –£–¥–∞–ª–∏—Ç—å –∏–∑ –∫—ç—à–∞</div>
  `;
  document.body.appendChild(_menu);
  const r = ind.getBoundingClientRect();
  _menu.style.left = `${Math.min(r.left, window.innerWidth - 160)}px`;
  _menu.style.top = (window.innerHeight - r.bottom < 100) ? `${r.top - _menu.offsetHeight}px` : `${r.bottom + 5}px`;
}

// Global Event Delegation (Replaces 1000s of listeners)
document.addEventListener('click', async (e) => {
  const alert = e.target.closest('.offline-btn-alert');
  if (alert) {
    e.stopPropagation();
    return window.NotificationSystem?.show?.('–ï—Å—Ç—å —Ç—Ä–µ–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', 'info', 6000);
  }

  const mItem = e.target.closest('.cloud-menu__item');
  if (mItem) {
    e.stopPropagation();
    const uid = _menu?.dataset.uid, act = mItem.dataset.action, mgr = getOfflineManager();
    _menu?.remove(); _menu = null;
    if (!uid) return;

    if (act === 'pin') {
      await mgr.togglePinned(uid);
      scheduleRefresh();
    } else if (act === 'del' && window.Modals?.confirm) {
      window.Modals.confirm({
        title: '–£–¥–∞–ª–∏—Ç—å –∏–∑ –∫—ç—à–∞?',
        textHtml: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–ª–∞—á–∫–∞ –±—É–¥–µ—Ç —Å–±—Ä–æ—à–µ–Ω–∞.<br>Global-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è.',
        confirmText: '–£–¥–∞–ª–∏—Ç—å',
        cancelText: '–û—Ç–º–µ–Ω–∞',
        onConfirm: async () => { await mgr.removeCached(uid); scheduleRefresh(); }
      });
    }
    return;
  }

  if (_menu && !e.target.closest('.cloud-menu') && !e.target.closest('.offline-ind')) {
    _menu.remove(); _menu = null;
  }

  const ind = e.target.closest('.offline-ind');
  if (ind) {
    e.preventDefault(); e.stopPropagation();
    const uid = ind.dataset.uid, mgr = getOfflineManager();
    const st = await mgr.getTrackOfflineState(uid);

    if (st.status === 'cloud') {
      showCloudMenu(ind, uid);
    } else {
      if (st.status !== 'pinned' && !(await mgr.hasSpace().catch(() => true))) {
        return window.NotificationSystem?.show?.('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ. –û—Å–≤–æ–±–æ–¥–∏—Ç–µ –ø–∞–º—è—Ç—å –¥–ª—è –æ—Ñ–ª–∞–π–Ω-–∫—ç—à–∞.', 'warning');
      }
      await mgr.togglePinned(uid);
      scheduleRefresh();
    }
  }
});

export function initOfflineIndicators() {
  ['offline:uiChanged', 'offline:stateChanged', 'offline:trackCached', 'offline:downloadStart', 'netPolicy:changed'].forEach(ev => window.addEventListener(ev, scheduleRefresh));
  injectOfflineIndicators(); // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º app.js, DOM —É–∂–µ –≥–æ—Ç–æ–≤
}

window.OfflineIndicators = { initOfflineIndicators, injectOfflineIndicators, injectIndicator, refreshAllIndicators };
export default window.OfflineIndicators;

//=================================================
// FILE: /scripts/ui/offline-modal.js
/**
 * scripts/ui/offline-modal.js
 * Offline Modal UI ‚Äî Full Spec Compliance (v1.0 + R2).
 * –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–û: –†–µ—à–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ IndexedDB. 
 * –ï–¥–∏–Ω—ã–π State Fetching, —Ç–æ—á–µ—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DOM –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–æ–∫.
 */

import { getOfflineManager } from '../offline/offline-manager.js';
import * as Net from '../offline/net-policy.js';
import { estimateUsage, getAllTrackMetas } from '../offline/cache-db.js';

let _overlay = null, _dlPaused = false, _listExpanded = false, _stExpanded = false;

const $ = (sel, root = document) => root.querySelector(sel);
const esc = (s) => window.Utils?.escapeHtml?.(String(s ?? '')) ?? String(s ?? '');
const fMB = (b) => ((b || 0) / 1048576 < 0.1 && b > 0) ? '< 0.1 –ú–ë' : `${((b || 0) / 1048576).toFixed(1)} –ú–ë`;
const fB = (b) => b >= 1048576 ? `${(b / 1048576).toFixed(1)} –ú–ë` : (b >= 1024 ? `${(b / 1024).toFixed(0)} –ö–ë` : `${b} –ë`);

const confirmBox = (opts) => window.Modals?.confirm 
  ? window.Modals.confirm(opts) 
  : (confirm(`${opts.title}\n\n${String(opts.textHtml || '').replace(/<[^>]+>/g, '')}`) ? opts.onConfirm?.() : opts.onCancel?.());

const tplSect = (ic, tit, html, lst = false) => `<section class="om-section ${lst ? 'om-section--last' : ''}"><h3 class="om-section__title"><span class="om-section__icon">${ic}</span> ${tit}</h3>${html}</section>`;
const tplTog = (act, on, lbl, sm = false) => `<button class="${sm ? 'om-toggle-small' : 'om-toggle'} ${on ? (sm ? 'om-toggle-small--on' : 'om-toggle--on') : (sm ? '' : 'om-toggle--off')}" data-action="${act}">${sm ? '' : '<span class="om-toggle__dot"></span>'}<span class="${sm ? '' : 'om-toggle__label'}">${lbl}</span></button>`;

const refresh = async () => {
  if (!_overlay) return;
  const body = $('#om-body', _overlay);
  if (!body) return;
  const scroll = body.scrollTop;

  const om = getOfflineManager();
  // Batch Fetching: –û–î–ò–ù –∑–∞–ø—Ä–æ—Å –∫ —Ç—è–∂–µ–ª—ã–º –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞–º –Ω–∞ –≤–µ—Å—å —Ä–µ–Ω–¥–µ—Ä
  const [metas, est, dl] = await Promise.all([getAllTrackMetas(), estimateUsage(), om.getDownloadStatus?.() || { active: 0, queued: 0 }]);
  
  const isR2 = om.getMode() === 'R2';
  const q = isR2 ? om.getCQ() : om.getQuality();
  const { N, D } = om.getCloudSettings();
  const dynLimitMB = isR2 && om.getDynamicLimitMB ? await om.getDynamicLimitMB() : 0;
  
  const bd = { pinned: 0, cloud: 0, transient: 0, dynamic: 0, other: 0 };
  const pcList = [];
  let mismatch = 0;

  metas.forEach(m => {
    const t = m.type, k = ['pinned','cloud','playbackCache','dynamic'].includes(t) ? (t === 'playbackCache' ? 'transient' : t) : 'other';
    bd[k] += (m.size || 0);
    if (['pinned', 'cloud', 'dynamic'].includes(t)) {
      if ((String(m.quality || '').toLowerCase() === 'lo' ? 'lo' : 'hi') !== q) mismatch++;
      if (t === 'pinned' || t === 'cloud') pcList.push(m);
    }
  });

  const tot = Object.values(bd).reduce((a, v) => a + v, 0);
  const pct = v => tot > 0 ? Math.max(0.5, (v / tot) * 100) : 0;
  
  const ns = Net.getNetPolicyState(), pl = Net.getPlatform(), ts = Net.getTrafficStats();
  const trRow = (l, v) => `<div class="om-traffic__row"><span>${l}</span><span>${fMB(v)}</span></div>`;

  pcList.sort((a, b) => a.type !== b.type ? (a.type === 'pinned' ? -1 : 1) : (a.type === 'pinned' ? (a.pinnedAt || 0) - (b.pinnedAt || 0) : (b.cloudExpiresAt || 0) - (a.cloudExpiresAt || 0)));

  const sStorage = `
    <div class="om-storage-info">
      <div class="om-storage-row"><span class="om-storage-label">–ó–∞–Ω—è—Ç–æ</span><span class="om-storage-value">${fMB(est.used)} / ${fMB(est.quota)}</span></div>
      <div class="om-storage-segbar" data-action="toggle-storage-details">
        <div class="om-segbar__fill om-segbar--pinned" style="width:${pct(bd.pinned)}%"></div><div class="om-segbar__fill om-segbar--cloud" style="width:${pct(bd.cloud)}%"></div>
        <div class="om-segbar__fill om-segbar--transient" style="width:${pct(bd.transient)}%"></div><div class="om-segbar__fill" style="background:#9c27b0; width:${pct(bd.dynamic)}%"></div>
        <div class="om-segbar__fill om-segbar--other" style="width:${pct(bd.other)}%"></div>
      </div>
      <div class="om-storage-legend">
        ${bd.pinned ? `<span class="om-legend-item"><span class="om-legend-dot om-legend-dot--pinned"></span>üîí ${fB(bd.pinned)}</span>` : ''}
        ${bd.cloud ? `<span class="om-legend-item"><span class="om-legend-dot om-legend-dot--cloud"></span>‚òÅ ${fB(bd.cloud)}</span>` : ''}
        ${bd.dynamic ? `<span class="om-legend-item"><span class="om-legend-dot" style="background:#9c27b0"></span>üß† ${fB(bd.dynamic)}</span>` : ''}
        ${bd.transient ? `<span class="om-legend-item"><span class="om-legend-dot om-legend-dot--transient"></span>‚è≥ ${fB(bd.transient)}</span>` : ''}
      </div>
      <div id="om-st-detail" style="display:${_stExpanded ? 'block' : 'none'}; margin-top:12px"><button class="om-btn om-btn--danger" data-action="nuke" style="width:100%">–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à (üîí –∏ ‚òÅ)</button></div>
    </div>`;

  const sNet = (pl.supportsNetControl ? 
    `<div class="om-toggles-row">${tplTog('toggle-wifi', ns.wifiEnabled, 'Ethernet / Wi-Fi')}${tplTog('toggle-cell', ns.cellularEnabled, 'Cellular')}</div>
     ${tplTog('toggle-toast', ns.cellularToast, 'üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ Cellular: ' + (ns.cellularToast ? '–í–ö–õ' : '–í–´–ö–õ'), true)}` :
    `<div class="om-net-unsupported">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ç—å—é –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –û–°</div>
     <button class="om-toggle ${ns.killSwitch ? 'om-toggle--on' : 'om-toggle--neutral'}" data-action="toggle-kill" style="margin-top:8px"><span class="om-toggle__dot"></span><span class="om-toggle__label">–û—Ç–∫–ª—é—á–∏—Ç—å –≤–µ—Å—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç</span></button>
     ${ns.killSwitch ? '<div class="om-net-kill-hint">‚ö†Ô∏è –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã (Offline).</div>' : ''}`) +
    `<div class="om-traffic" style="margin-top:12px"><div class="om-traffic__title">–¢—Ä–∞—Ñ–∏–∫ (${esc(ts?.monthName)})</div>
     ${ts?.type === 'split' ? `<div class="om-traffic__group"><div class="om-traffic__subtitle">Wi-Fi</div>${trRow('–ú–µ—Å—è—Ü:', ts.wifi.monthly)}${trRow('–í—Å–µ–≥–æ:', ts.wifi.total)}</div><div class="om-traffic__group"><div class="om-traffic__subtitle">Cellular</div>${trRow('–ú–µ—Å—è—Ü:', ts.cellular.monthly)}${trRow('–í—Å–µ–≥–æ:', ts.cellular.total)}</div>` : `${trRow('–ú–µ—Å—è—Ü:', ts.general.monthly)}${trRow('–í—Å–µ–≥–æ:', ts.general.total)}`}
     <button class="om-btn om-btn--ghost" data-action="clear-traffic" style="margin-top:8px; width:100%;">–û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button></div>`;

  const sList = !pcList.length ? `<div class="om-list-empty">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤</div>` : pcList.map(m => {
    const isPin = m.type === 'pinned', tr = window.TrackRegistry?.getTrackByUid?.(m.uid);
    const sub = isPin ? `üîí –ó–∞–∫—Ä–µ–ø–ª—ë–Ω ‚Ä¢ ${m.quality === 'lo' ? 'Lo' : 'Hi'} ‚Ä¢ ${fMB(m.size)}` : `‚òÅ –û—Å—Ç–∞–ª–æ—Å—å ${Math.max(0, Math.ceil(((m.cloudExpiresAt || 0) - Date.now()) / 86400000))} –¥–Ω. ‚Ä¢ ${m.quality === 'lo' ? 'Lo' : 'Hi'} ‚Ä¢ ${fMB(m.size)}`;
    return `<div class="om-list-item"><div class="om-list-icon">${isPin ? 'üîí' : '‚òÅ'}</div><div class="om-list-title" title="${esc(tr?.title || m.uid)}">${esc(tr?.title || m.uid)}<div class="om-list-meta">${sub}</div></div><button class="om-btn om-btn--ghost" data-action="list-item-act" data-uid="${m.uid}" style="padding:4px 8px; font-size:11px;">${isPin ? '–°–Ω—è—Ç—å' : 'üîí'}</button><button class="om-list-del" data-action="list-item-del" data-uid="${m.uid}" title="–£–¥–∞–ª–∏—Ç—å">√ó</button></div>`;
  }).join('');

  const sPC = `
    <div class="om-pc-toprow">
      <div class="om-pc-quality"><div class="om-pc-quality__label">${isR2 ? 'CQ (SmartPrefetch)' : 'PQ (R0/R1)'}</div><div class="om-quality-toggle"><button class="om-quality-btn ${q === 'hi' ? 'om-quality-btn--active-hi' : ''}" data-action="${isR2 ? 'set-cq' : 'set-q'}" data-val="hi">Hi</button><button class="om-quality-btn ${q === 'lo' ? 'om-quality-btn--active-lo' : ''}" data-action="${isR2 ? 'set-cq' : 'set-q'}" data-val="lo">Lo</button></div></div>
      <div class="om-pc-recache"><div class="om-pc-recache__label">–ù–µ—Å–æ–≤–ø. –∫–∞—á–µ—Å—Ç–≤–æ: ${mismatch}</div><button class="om-btn om-btn--accent om-pc-recache__btn ${mismatch === 0 ? 'om-btn--disabled' : ''}" data-action="recache" ${mismatch === 0 ? 'disabled' : ''}>üîÑ Re-cache</button></div>
    </div>
    <div class="om-settings-grid">
      <div class="om-setting"><label class="om-setting__label">–°–ª—É—à–∞—Ç—å –¥–ª—è ‚òÅ (N)</label><input type="number" id="inp-n" value="${N}" min="1" class="om-setting__input"></div>
      <div class="om-setting"><label class="om-setting__label">–•—Ä–∞–Ω–∏—Ç—å ‚òÅ –¥–Ω–µ–π (D)</label><input type="number" id="inp-d" value="${D}" min="1" class="om-setting__input"></div>
    </div>

    ${isR2 ? `
      <div class="om-divider"></div>
      <div class="om-setting">
        <label class="om-setting__label">–õ–∏–º–∏—Ç —É–º–Ω–æ–≥–æ –∫—ç—à–∞ (Dynamic), –ú–ë</label>
        <input type="number" id="inp-dyn-mb" value="${dynLimitMB}" min="0" class="om-setting__input">
      </div>
      <button class="om-btn om-btn--outline" data-action="apply-r2-dyn" style="width:100%; margin-top:10px; margin-bottom:14px">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ª–∏–º–∏—Ç Dynamic</button>
    ` : ''}

    <button class="om-btn om-btn--primary" data-action="apply-cloud" style="width:100%; margin-bottom:14px">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    <div class="om-divider"></div>
    <button class="om-btn om-btn--outline" data-action="toggle-list" style="width:100%">${_listExpanded ? '–°–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ üîí/‚òÅ' : '–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ üîí/‚òÅ'}</button>
    <div id="om-track-list-container" style="display:${_listExpanded ? 'block' : 'none'}; padding-top: 10px;"><div class="om-track-list" id="om-track-list">${sList}</div><button class="om-btn om-btn--danger-outline om-list-del-all" data-action="nuke" style="width:100%; margin-top:10px;">–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ –∏ –æ–±–ª–∞—á–Ω—ã–µ</button></div>`;

  const sModes = `
    <div class="om-mode-card ${isR2 ? 'om-mode-card--disabled' : ''}" style="margin-bottom:10px"><div class="om-mode-card__head"><div><div class="om-mode-card__name">PlaybackCache (R1)</div><div class="om-mode-card__desc">–û–∫–Ω–æ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ 3 —Ç—Ä–µ–∫–æ–≤</div></div><div class="om-mode-toggle"><button class="om-mode-btn ${om.getMode() === 'R0' ? 'om-mode-btn--active' : ''}" data-action="set-mode" data-val="R0" ${isR2 ? 'disabled' : ''}>OFF</button><button class="om-mode-btn ${om.getMode() === 'R1' ? 'om-mode-btn--active' : ''}" data-action="set-mode" data-val="R1" ${isR2 ? 'disabled' : ''}>ON</button></div></div></div>
    <div class="om-mode-card"><div class="om-mode-card__head"><div><div class="om-mode-card__name">SmartPrefetch (R2)</div><div class="om-mode-card__desc">–£–º–Ω–æ–µ —Ñ–æ–Ω–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (MRU)</div></div><div class="om-mode-toggle"><button class="om-mode-btn ${!isR2 ? 'om-mode-btn--active' : ''}" data-action="set-mode" data-val="not-R2">OFF</button><button class="om-mode-btn ${isR2 ? 'om-mode-btn--active' : ''}" data-action="set-mode" data-val="R2">ON</button></div></div></div>`;

  const sDl = `<div class="om-dl-stats"><div class="om-dl-stat"><span class="om-dl-stat__num">${dl.active}</span><span class="om-dl-stat__label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</span></div><div class="om-dl-stat"><span class="om-dl-stat__num">${dl.queued}</span><span class="om-dl-stat__label">–í –æ—á–µ—Ä–µ–¥–∏</span></div></div><button class="om-btn om-btn--ghost" data-action="dl-toggle" style="width:100%;">${_dlPaused ? '‚ñ∂ –í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å' : '‚è∏ –ü–∞—É–∑–∞'}</button>`;

  body.innerHTML = tplSect('üì¶', '–•—Ä–∞–Ω–∏–ª–∏—â–µ', sStorage) + tplSect('üåê', '–°–µ—Ç–µ–≤–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞', sNet) + tplSect('üîí', 'Pinned –∏ Cloud', sPC) + tplSect('‚öôÔ∏è', '–†–µ–∂–∏–º—ã', sModes) + tplSect('‚¨áÔ∏è', '–ó–∞–≥—Ä—É–∑–∫–∏', sDl, true);
  body.scrollTop = scroll;
};

async function handleAction(e) {
  const el = e.target.closest?.('[data-action]');
  if (!el || el.disabled) return;
  const act = el.dataset.action;
  const om = getOfflineManager();

  const handleQ = async (nq, isR2) => {
    if ((isR2 ? om.getCQ() : om.getQuality()) === nq) return;
    let count = 0, bytes = 0;
    (await getAllTrackMetas()).forEach(m => {
      if (['pinned', 'cloud', 'dynamic'].includes(m.type) && (String(m.quality || '').toLowerCase() === 'lo' ? 'lo' : 'hi') !== nq) { count++; bytes += (m.size || 0); }
    });
    const apply = () => { isR2 ? om.setCQ(nq) : window.playerCore?.switchQuality?.(nq); refresh(); };
    if (count > 5) confirmBox({ title: '–°–º–µ–Ω–∞ –∫–∞—á–µ—Å—Ç–≤–∞', textHtml: `–°–º–µ–Ω–∞ –∑–∞—Ç—Ä–æ–Ω–µ—Ç ${count} —Ñ–∞–π–ª–æ–≤ (${fMB(bytes)}). –ü–µ—Ä–µ–∫–∞—á–∞—Ç—å?`, confirmText: '–ü–µ—Ä–µ–∫–∞—á–∞—Ç—å', onConfirm: apply });
    else apply();
  };

  switch (act) {
    case 'toggle-storage-details':
      _stExpanded = !_stExpanded;
      const st = $('#om-st-detail', _overlay);
      if (st) st.style.display = _stExpanded ? 'block' : 'none';
      break;
    case 'toggle-list':
      _listExpanded = !_listExpanded;
      el.textContent = _listExpanded ? '–°–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ üîí/‚òÅ' : '–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ üîí/‚òÅ';
      const c = $('#om-track-list-container', _overlay);
      if (c) c.style.display = _listExpanded ? 'block' : 'none';
      break;
    case 'nuke':
      confirmBox({ title: '–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ—Ñ–ª–∞–π–Ω-—Ç—Ä–µ–∫–∏?', textHtml: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–ª–∞—á–∫–æ–≤ –±—É–¥–µ—Ç —Å–±—Ä–æ—à–µ–Ω–∞.<br>Global-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è.', confirmText: '–î–∞–ª–µ–µ', onConfirm: () => setTimeout(() => confirmBox({ title: '–í—ã —É–≤–µ—Ä–µ–Ω—ã?', textHtml: '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.', confirmText: '–£–¥–∞–ª–∏—Ç—å –≤—Å—ë', onConfirm: async () => { await om.removeAllCached(); refresh(); } }), 100) });
      break;
    case 'toggle-wifi': Net.toggleWifi(); refresh(); break;
    case 'toggle-cell': Net.toggleCellular(); refresh(); break;
    case 'toggle-toast': Net.toggleCellularToast(); refresh(); break;
    case 'toggle-kill': Net.toggleKillSwitch(); refresh(); break;
    case 'clear-traffic': Net.clearTrafficStats(); refresh(); break;
    case 'set-q': await handleQ(el.dataset.val, false); break;
    case 'set-cq': await handleQ(el.dataset.val, true); break;
    case 'recache': {
      const isR2 = om.getMode() === 'R2';
      const targetQ = isR2 ? om.getCQ() : om.getQuality();

      // Q.13.3: –¥–≤–æ–π–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è R2 (–∏ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –æ–¥–Ω–æ –¥–ª—è R0/R1)
      const metas = await getAllTrackMetas();
      const win = window.PlaybackCache?.getWindowState?.() || {};
      const winUids = [win.prev, win.cur, win.next].filter(Boolean);

      let uidCount = 0;
      let bytes = 0;

      for (const m of metas) {
        if (!m?.cachedComplete) continue;
        if (!['pinned', 'cloud', 'dynamic', 'playbackCache'].includes(m.type)) continue;
        const mq = (String(m.quality || '').toLowerCase() === 'lo') ? 'lo' : 'hi';
        if (mq !== targetQ) { uidCount++; bytes += (m.size || 0); }
      }

      const explain = () => {
        const parts = [
          '–ë—É–¥—É—Ç –ø–µ—Ä–µ–∫–∞—á–∞–Ω—ã —Ç—Ä–µ–∫–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ ' + (targetQ === 'lo' ? 'Lo' : 'Hi') + '.',
          '–ü–æ—Ä—è–¥–æ–∫: –æ–∫–Ω–æ PREV/CUR/NEXT ‚Üí üîí pinned ‚Üí ‚òÅ cloud ‚Üí üß† dynamic.'
        ];
        if (winUids.length) parts.push(`–û–∫–Ω–æ: ${winUids.length} UID.`);
        return parts.join('<br>');
      };

      const doRun = async () => {
        if (om.queue) om.queue.setParallel(3);
        await om.reCacheAll(targetQ);
        setTimeout(() => om.queue?.setParallel?.(1), 15000);
        refresh();
      };

      if (!isR2) {
        await doRun();
        break;
      }

      confirmBox({
        title: 'Re-cache (R2)',
        textHtml: explain(),
        confirmText: '–î–∞–ª–µ–µ',
        cancelText: '–û—Ç–º–µ–Ω–∞',
        onConfirm: () => confirmBox({
          title: 'Re-cache (R2)',
          textHtml: `–ë—É–¥–µ—Ç –ø–µ—Ä–µ–∫–∞—á–∞–Ω–æ: <strong>${uidCount}</strong> UID<br>–û–±—ä—ë–º: <strong>${fMB(bytes)}</strong>`,
          confirmText: '–ù–∞—á–∞—Ç—å',
          cancelText: '–û—Ç–º–µ–Ω–∞',
          onConfirm: doRun
        })
      });

      break;
    }
    case 'apply-cloud':
      await om.confirmApplyCloudSettings({ newN: Math.max(1, parseInt($('#inp-n', _overlay)?.value || '5')), newD: Math.max(1, parseInt($('#inp-d', _overlay)?.value || '31')) });
      refresh(); window.NotificationSystem?.success?.('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã'); break;

    case 'apply-r2-dyn': {
      const v = Math.max(0, parseInt($('#inp-dyn-mb', _overlay)?.value || '0'));
      if (om.setDynamicLimitMB) await om.setDynamicLimitMB(v);
      refresh();
      window.NotificationSystem?.success?.('–õ–∏–º–∏—Ç Dynamic –ø—Ä–∏–º–µ–Ω—ë–Ω');
      break;
    }
    case 'list-item-act': await om.togglePinned(el.dataset.uid); refresh(); break;
    case 'list-item-del': confirmBox({ title: '–£–¥–∞–ª–∏—Ç—å —Ç—Ä–µ–∫?', textHtml: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–ª–∞—á–∫–∞ –±—É–¥–µ—Ç —Å–±—Ä–æ—à–µ–Ω–∞.', confirmText: '–£–¥–∞–ª–∏—Ç—å', onConfirm: async () => { await om.removeCached(el.dataset.uid); refresh(); } }); break;
    case 'set-mode':
      const v = el.dataset.val;
      if (v === 'R2' || v === 'R1') {
        if (await om.hasSpace()) om.setMode(v);
        else window.NotificationSystem?.warning?.('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.');
      }
      else if (v === 'not-R2') om.setMode('R0');
      else om.setMode(v);
      refresh(); break;
    case 'dl-toggle':
      _dlPaused = !_dlPaused;
      if (om.queue) _dlPaused ? om.queue.pause() : om.queue.resume();
      refresh(); break;
  }
}

export function openOfflineModal() {
  if (_overlay) return;
  _overlay = document.createElement('div');
  _overlay.className = 'om-overlay om-overlay--visible';
  _overlay.innerHTML = `
    <div class="om-modal om-modal--visible">
      <div class="om-header"><div class="om-header__title">OFFLINE</div><button class="om-header__close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button></div>
      <div class="om-body" id="om-body"></div>
    </div>`;
  document.body.appendChild(_overlay);
  
  _overlay.addEventListener('click', e => e.target === _overlay && closeOfflineModal());
  $('.om-header__close', _overlay)?.addEventListener('click', closeOfflineModal);
  $('.om-modal', _overlay).addEventListener('click', e => handleAction(e).catch(console.error));
  
  refresh();
}

export function closeOfflineModal() { try { _overlay?.remove(); } catch {} _overlay = null; }

export function initOfflineModal() {
  document.getElementById('offline-btn')?.addEventListener('click', e => e.target?.classList?.contains('offline-btn-alert') ? window.NotificationSystem?.show?.('–ï—Å—Ç—å —Ç—Ä–µ–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', 'info', 6000) : openOfflineModal());
  const r = () => _overlay && refresh();
  ['offline:uiChanged', 'netPolicy:changed', 'offline:stateChanged'].forEach(ev => window.addEventListener(ev, r));
}

export default { initOfflineModal, openOfflineModal, closeOfflineModal };

//=================================================
// FILE: /scripts/ui/sleep-timer.js
/**
 * scripts/ui/sleep-timer.js
 * –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Sleep-—Ç–∞–π–º–µ—Ä–∞ –ø–æ –¢–ó-UID (v4.0)
 * –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è: —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ –∑–∞–¥–µ—Ä–∂–∫–∏ –±–µ–π–¥–∂–∞ –Ω–∞ 1 —Å–µ–∫.
 */

export class SleepTimer {
  constructor() {
    this.tgt = this._int = this._menu = null;
  }

  show() {
    this._cls();
    const btn = document.getElementById('sleep-timer-btn');
    if (!btn) return;

    this._menu = document.createElement('div');
    this._menu.className = 'sleep-menu animate-in';
    this._menu.innerHTML = `
      <div class="sleep-menu-item" data-val="off">–í—ã–∫–ª—é—á–∏—Ç—å</div>
      <div class="sleep-menu-item" data-val="15">15 –º–∏–Ω—É—Ç</div>
      <div class="sleep-menu-item" data-val="30">30 –º–∏–Ω—É—Ç</div>
      <div class="sleep-menu-item" data-val="60">60 –º–∏–Ω—É—Ç</div>
      <div class="sleep-menu-item" data-val="custom">–ö –≤—Ä–µ–º–µ–Ω–∏...</div>
    `;
    btn.appendChild(this._menu);

    const close = (e) => {
      if (!this._menu?.contains(e.target) && e.target !== btn && !btn.contains(e.target)) {
        this._cls();
        document.removeEventListener('click', close);
      }
    };
    setTimeout(() => document.addEventListener('click', close), 0);

    this._menu.onclick = (e) => {
      e.stopPropagation();
      const v = e.target.dataset.val;
      if (!v) return;
      
      this._cls();
      document.removeEventListener('click', close);
      v === 'off' ? this.stop() : (v === 'custom' ? this._custom() : this.startMinutes(+v));
    };
  }

  _cls() {
    this._menu?.remove();
    this._menu = null;
  }

  _custom() {
    if (!window.Modals?.open) return;
    const d = new Date();
    const h = String(d.getHours()).padStart(2, '0');
    const m = String(d.getMinutes()).padStart(2, '0');
    
    const mod = window.Modals.open({
      title: '–¢–∞–π–º–µ—Ä —Å–Ω–∞',
      maxWidth: 320,
      bodyHtml: `
        <div class="sleep-time-title">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º—É–∑—ã–∫—É –≤:</div>
        <div class="sleep-time-row">
          <input type="number" id="st-h" class="sleep-time-input" min="0" max="23" value="${h}">
          <span class="sleep-time-sep">:</span>
          <input type="number" id="st-m" class="sleep-time-input" min="0" max="59" value="${m}">
        </div>
        <div class="sleep-time-actions">
          <button class="sleep-time-btn primary" id="st-save" style="width:100%">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
        </div>
      `
    });

    mod.querySelector('#st-save').onclick = () => {
      this.startAt(`${mod.querySelector('#st-h').value.padStart(2, '0')}:${mod.querySelector('#st-m').value.padStart(2, '0')}`);
      mod.remove();
    };
  }

  startMinutes(m) {
    this._start(Date.now() + m * 60000, `–Ω–∞ ${m} –º–∏–Ω.`, { minutes: m });
  }

  startAt(t) {
    const [h, m] = t.split(':').map(Number), d = new Date();
    const tgt = new Date(d.getFullYear(), d.getMonth(), d.getDate(), h, m, 0);
    if (tgt <= d) tgt.setDate(tgt.getDate() + 1);
    this._start(tgt.getTime(), `–Ω–∞ ${t}`, { exactTime: t });
  }

  stop() {
    this.tgt = null;
    clearInterval(this._int);
    this._upd();
    window.NotificationSystem?.info?.('–¢–∞–π–º–µ—Ä —Å–Ω–∞ –æ—Ç–∫–ª—é—á–µ–Ω');
  }

  _start(t, msg, log) {
    this.tgt = t;
    clearInterval(this._int);

    const tick = () => {
      if (!this.tgt) return clearInterval(this._int);
      const r = this.tgt - Date.now();
      if (r <= 0) {
        this.stop();
        // PLAYBACK SAFETY: –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ª–µ–≥–∞–ª—å–Ω—ã–π STOP —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–∑–≤–Ω–µ (–ø–æ–º–∏–º–æ –ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ)
        window.playerCore?.pause?.();
        window.NotificationSystem?.info?.('–í—Ä–µ–º—è –≤—ã—à–ª–æ. –ú—É–∑—ã–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.');
      } else {
        this._upd(Math.ceil(r / 60000));
      }
    };
    
    tick(); // –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –∞–ø–¥–µ–π—Ç UI (—É–±–∏—Ä–∞–µ—Ç –±–∞–≥ 1-—Å–µ–∫—É–Ω–¥–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏)
    this._int = setInterval(tick, 1000);
    
    window.NotificationSystem?.info?.(`–¢–∞–π–º–µ—Ä —Å–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ${msg}`);
    window.eventLogger?.log?.('FEATURE_USED', window.playerCore?.getCurrentTrackUid?.() || 'none', { feature: 'sleep_timer', ...log });
  }

  _upd(m) {
    const bg = document.getElementById('sleep-timer-badge');
    const btn = document.getElementById('sleep-timer-btn');
    if (!bg || !btn) return;
    
    bg.style.display = m > 0 ? 'block' : 'none';
    bg.textContent = m || '';
    btn.classList.toggle('active', m > 0);
  }
}

export const sleepTimerInstance = new SleepTimer();
window.SleepTimer = sleepTimerInstance;

//=================================================
// FILE: /scripts/ui/statistics-modal.js
import { metaDB } from '../analytics/meta-db.js';

export async function openStatisticsModal(uid = null) {
  if (!uid) uid = window.playerCore?.getCurrentTrackUid?.() || null;
  if (uid) {
    // -----------------------------------------------------
    // 1. –¢–†–ï–ö–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê (–ü–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç—Ä–µ–∫—É)
    // -----------------------------------------------------
    const t = window.TrackRegistry?.getTrackByUid(uid);
    const stat = await metaDB.getStat(uid);
    
    const plays = stat?.globalFullListenCount || 0;
    const totalStarts = stat?.globalValidListenCount || 0;
    const skips = Math.max(0, totalStarts - plays);
    const time = Math.floor((stat?.globalListenSeconds || 0) / 60);
    const lyricsUsed = stat?.featuresUsed?.lyrics || 0;
    
    const bodyHtml = `
      <div style="text-align:center; margin-bottom: 20px;">
        <div style="width:100px; height:100px; border-radius:12px; overflow:hidden; margin:0 auto 12px; box-shadow:0 4px 15px rgba(0,0,0,0.5);">
          <img src="${t?.cover || 'img/logo.png'}" style="width:100%; height:100%; object-fit:cover;">
        </div>
        <h3 style="margin:0; color:#fff; font-size: 18px;">${window.Utils?.escapeHtml(t?.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</h3>
        <div style="font-size:12px; color:var(--secondary-color); margin-top:4px;">${window.Utils?.escapeHtml(t?.album || '')}</div>
      </div>
      <div class="stats-grid-compact" style="margin-bottom: 20px;">
        <div class="stat-box"><b>${plays}</b><span>–î–æ—Å–ª—É—à–∞–Ω–æ</span></div>
        <div class="stat-box"><b>${skips}</b><span>–ü—Ä–æ–ø—É—â–µ–Ω–æ</span></div>
        <div class="stat-box"><b>${time}–º</b><span>–í—Ä–µ–º—è</span></div>
        <div class="stat-box"><b>${lyricsUsed}</b><span>–¢–µ–∫—Å—Ç (—Ä–∞–∑)</span></div>
      </div>
      <button class="om-btn om-btn--primary" id="share-track-stat" style="width:100%;">üì∏ –°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É —Ç—Ä–µ–∫–∞</button>
    `;

    const m = window.Modals.open({ title: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç—Ä–µ–∫–∞', bodyHtml, maxWidth: 340 });
    m.querySelector('#share-track-stat').onclick = () => {
       import('../analytics/share-generator.js').then(mod => {
         m.remove();
         mod.ShareGenerator.generateAndShare('track', t, stat);
       });
    };
  } else {
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞: –º–æ–¥–∞–ª–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ —Ç–µ–∫—É—â–µ–º—É —Ç—Ä–µ–∫—É (uid)
    wrap.innerHTML = `
      <div style="padding:14px;">
        <div style="font-weight:900; color:#fff; margin-bottom:6px;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
        <div style="color:rgba(234,242,255,.72); font-size:12px; line-height:1.35;">
          –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ç—Ä–µ–∫.
        </div>
      </div>
    `;
    const allStats = await metaDB.getAllStats();
    const totalFull = allStats.reduce((acc, s) => acc + (s.globalFullListenCount || 0), 0);
    const totalSecs = allStats.reduce((acc, s) => acc + (s.globalListenSeconds || 0), 0);
    
    const achVal = (await metaDB.getGlobal('unlocked_achievements'))?.value || {};
    const engine = window.achievementEngine;

    const topTracks = [...allStats]
      .sort((a, b) => (b.globalFullListenCount || 0) - (a.globalFullListenCount || 0))
      .slice(0, 5)
      .map(s => {
        const tr = window.TrackRegistry?.getTrackByUid(s.uid);
        return tr ? `<div class="top-track-row" style="display:flex; justify-content:space-between; margin-bottom:6px; font-size:13px; color:#eaf2ff; align-items:center;">
          <span style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis; padding-right:10px;">${window.Utils?.escapeHtml(tr.title)}</span>
          <b style="color:var(--secondary-color); flex-shrink:0;">${s.globalFullListenCount} —Ä–∞–∑</b>
        </div>` : '';
      }).join('') || '<div style="font-size:12px;color:#888;text-align:center;">–°–ª—É—à–∞–π—Ç–µ –º—É–∑—ã–∫—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ç–æ–ø</div>';

    const bodyHtml = `
      <div class="stats-grid-compact" style="margin-bottom: 15px;">
        <div class="stat-box"><b>${totalFull}</b><span>–¢—Ä–µ–∫–æ–≤</span></div>
        <div class="stat-box"><b>${Math.floor(totalSecs / 60)}–º</b><span>–í –ø—É—Ç–∏</span></div>
      </div>
      <div style="margin-bottom:15px; background:rgba(0,0,0,0.2); padding:12px; border-radius:10px; border: 1px solid rgba(255,255,255,0.05);">
        <div style="font-size:11px; color:#888; margin-bottom:8px; font-weight:bold; letter-spacing:1px;">üèÜ –¢–û–ü 5 –¢–†–ï–ö–û–í</div>
        ${topTracks}
      </div>
      <div style="font-size:11px; color:#888; margin-bottom:8px; font-weight:bold; letter-spacing:1px;">–î–û–°–¢–ò–ñ–ï–ù–ò–Ø (${Object.keys(achVal).length}/${engine?.achievements?.length || 0})</div>
      <div style="max-height:220px; overflow-y:auto; padding-right:5px; display:flex; flex-direction:column; gap:8px;">
        ${(engine?.achievements || []).map(a => `
          <div class="ach-item ${achVal[a.id] ? '' : 'locked'}" style="display:flex; align-items:center; gap:12px; padding:10px; background:rgba(255,255,255,0.03); border-radius:10px; border: 1px solid rgba(255,255,255,0.05);">
            <div class="ach-icon" style="font-size:24px; filter:${achVal[a.id] ? 'none' : 'grayscale(1)'}; opacity:${achVal[a.id] ? '1' : '0.5'};">${a.icon}</div>
            <div style="flex:1;">
              <div style="font-size:14px; font-weight:bold; color:#fff; margin-bottom:2px;">${a.name}</div>
              <div style="font-size:11px; color:#aaa;">${a.desc}</div>
            </div>
            ${achVal[a.id] ? '<div style="color:#4caf50; font-weight:bold;">‚úì</div>' : ''}
          </div>
        `).join('')}
      </div>
    `;

    window.Modals.open({ title: '–ü—Ä–æ—Ñ–∏–ª—å —Å–ª—É—à–∞—Ç–µ–ª—è', bodyHtml, maxWidth: 400 });
    return;
  }
}

window.StatisticsModal = { 
  openStatisticsModal, 
  init: () => {
    document.addEventListener('click', e => { 
      const btn = e.target.closest('.stats-trigger');
      if(btn) openStatisticsModal(btn.dataset.uid); 
    });
  }
};

//=================================================
// FILE: /scripts/ui/sysinfo.js
// scripts/ui/sysinfo.js
// Optimized System Info Modal v2.0 (Direct Render)
(function(W, N) {
  'use strict';

  const U = W.Utils;
  const esc = (v) => U.escapeHtml(String(v ?? ''));
  const yn = (v) => v ? '‚úÖ' : '‚ùå';
  const row = (l, v) => `<div><strong>${l}:</strong> ${v}</div>`;

  const Sys = {
    initialize: () => {
      const btn = U.dom.byId('sysinfo-btn');
      if (btn) { btn.style.display = ''; btn.onclick = Sys.show; }
      
      document.addEventListener('keydown', e => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'i') { e.preventDefault(); Sys.show(); }
      });
      console.log('‚úÖ SysInfo optimized');
    },

    show: async () => {
      if (!W.Modals?.open) return;

      // 1. Collect Data directly
      const C = W.APP_CONFIG || {};
      const P = performance, T = P.timing || {}, M = P.memory;
      const SC = W.screen;
      
      // 2. Get SW Version (Async)
      let swVer = '...';
      const getSW = async () => {
        try {
          const reg = await N.serviceWorker?.getRegistration();
          if (!reg?.active) return 'N/A';
          return new Promise(r => {
            const ch = new MessageChannel(), t = setTimeout(() => r('timeout'), 800);
            ch.port1.onmessage = e => { clearTimeout(t); r(e.data.version || 'N/A'); };
            reg.active.postMessage({ type: 'GET_SW_VERSION' }, [ch.port2]);
          });
        } catch { return 'Err'; }
      };

      // 3. Render HTML
      const grp = (t, c) => `<h3 style="color:#8ab8fd;margin:12px 0 6px">${t}</h3>${c}`;
      const render = (ver) => `<div style="font-size:13px;line-height:1.6;color:#eaf2ff">
        ${grp('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ', row('–í–µ—Ä—Å–∏—è', `${esc(C.APP_VERSION)} (${esc(C.BUILD_DATE)})`) + row('PWA', yn(matchMedia('(display-mode: standalone)').matches)) + `<div id="sw-ver-row"><strong>SW:</strong> ${esc(ver)}</div>`)}
        ${grp('–°—Ä–µ–¥–∞', row('UA', esc(N.userAgent).slice(0,45)+'...') + row('–≠–∫—Ä–∞–Ω', `${SC.width}√ó${SC.height}`) + row('Online', yn(N.onLine)))}
        ${grp('–°–∏—Å—Ç–µ–º–∞', row('Audio', W.Howler ? `Howler ${Howler.version}` : 'Off') + row('RAM', M ? U.fmt.bytes(M.usedJSHeapSize) : 'N/A'))}
        <div style="margin-top:16px;border-top:1px solid #333;text-align:center;color:#666;font-size:10px">Vi3na1bita ¬© 2025</div>
      </div>`;

      // 4. Open Modal
      const modal = W.Modals.open({
        title: '–û —Å–∏—Å—Ç–µ–º–µ', maxWidth: 420,
        bodyHtml: render(swVer)
      });

      // 5. Update SW Ver after promise resolves
      getSW().then(v => {
        const el = modal.querySelector('#sw-ver-row');
        if (el) el.innerHTML = `<strong>SW –≤–µ—Ä—Å–∏—è:</strong> ${esc(v)}`;
      });
    }
  };

  W.SystemInfoManager = Sys;
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', Sys.initialize);
  else Sys.initialize();

})(window, navigator);

//=================================================
// FILE: /scripts/utils/sw-manager.js
/**
 * scripts/utils/sw-manager.js
 * Optimized Service Worker Manager v3.1
 */
(function (W, N) {
  'use strict';
  let refreshing = false;

  class SWManager {
    async init() {
      if (!('serviceWorker' in N)) return;

      N.serviceWorker.addEventListener('controllerchange', () => {
        if (!refreshing) { refreshing = true; W.location.reload(); }
      });

      try {
        this.reg = await N.serviceWorker.register('./service-worker.js', { scope: './' });
        if (this.reg.waiting) this._notifyUpdate();

        this.reg.addEventListener('updatefound', () => {
          const newW = this.reg.installing;
          newW?.addEventListener('statechange', () => {
            if (newW.state === 'installed' && N.serviceWorker.controller) this._notifyUpdate();
          });
        });
      } catch (e) { console.warn('SW Register Failed:', e); }
    }

    handleVersionMessage(d) {
      if (d?.swVer && d.swVer !== (W.VERSION || '')) this._notifyUpdate();
    }

    _notifyUpdate() {
      if (document.getElementById('update-app-btn')) return;
      W.NotificationSystem?.info('–î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è', 5000);
      
      const b = document.createElement('button');
      b.id = 'update-app-btn';
      b.className = 'om-btn om-btn--primary';
      b.textContent = '–û–ë–ù–û–í–ò–¢–¨';
      b.style.cssText = 'position:fixed;bottom:90px;left:50%;transform:translateX(-50%);z-index:10001;box-shadow:0 6px 24px rgba(0,0,0,.6);animation:fadeIn .3s ease-out;padding:12px 28px;border-radius:30px;';
      
      b.onclick = () => {
        b.disabled = true; b.textContent = '–û–ë–ù–û–í–õ–ï–ù–ò–ï...';
        this.reg?.waiting ? this.reg.waiting.postMessage({ type: 'SKIP_WAITING' }) : W.location.reload();
      };
      document.body.appendChild(b);
    }

    getCacheSize() {
      if (!this.reg?.active) return Promise.resolve(0);
      return new Promise(resolve => {
        const ch = new MessageChannel();
        ch.port1.onmessage = e => resolve(e.data?.size || 0);
        setTimeout(() => resolve(0), 1000);
        this.reg.active.postMessage({ type: 'GET_CACHE_SIZE' }, [ch.port2]);
      });
    }
  }

  W.ServiceWorkerManager = new SWManager();
  document.readyState === 'loading' ? document.addEventListener('DOMContentLoaded', () => W.ServiceWorkerManager.init()) : W.ServiceWorkerManager.init();

})(window, navigator);

//=================================================
// FILE: /data/custom_achievements.json
{}

//=================================================
// FILE: /data/lyrics-index-v1.json
{"v":1,"buildTs":1772252382979,"meta":{"MZD-01":{"t":"–†—É–ª–µ—Ç–∫–∞","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":1},"MZD-02":{"t":"–î—ã—Ö–∞–Ω–∏–µ 24/7","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":2},"MZD-03":{"t":"–í–∏—Ç—Ä–∏–Ω–∞ —Ä–∞–∑–±–∏—Ç–∞","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":3},"MZD-04":{"t":"–ö–æ—à–∫–∏-–º—ã—à–∫–∏","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":4},"MZD-05":{"t":"–í—Å—ë –≤–∫–ª—é—á–µ–Ω–æ","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":5},"MZD-06":{"t":"–í—ã—Ä–≤–∞—Ç—å —Å–µ—Ä–¥—Ü–µ","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":6},"MZD-07":{"t":"–í—Å–µ —Ç–∞–º –±—É–¥–µ–º","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":7},"MZD-08":{"t":"–ó–∞—á–µ–º —Ü–≤–µ—Ç—ã —Å –∫–æ—Ä–Ω—è–º–∏ –≤—ã—Ä—ã–≤–∞–µ–º","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":8},"MZD-09":{"t":"–ü–∞–º—è—Ç—å","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":9},"MZD-10":{"t":"–ú–∞—à–∞","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":10},"MZD-11":{"t":"–û—Å—Ç–∞–Ω–æ–≤–∏—Å—å, –ü–ª–∞–Ω–µ—Ç–∞","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":11},"MZD-12":{"t":"–ü—Ä–æ—Å—Ç–∏, —è –Ω–µ —Ñ–µ–π–∫","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":12},"MZD-13":{"t":"–û–ª—è —É –º–æ—Ä—è","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":13},"MZD-14":{"t":"–õ–æ–≤–∏ —Å–≤–æ–π –º–∏–≥","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":14},"MZD-15":{"t":"–ü—Ä–∏–∑—Ä–∞–∫","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":15},"MZD-16":{"t":"–ú–µ–∂–¥—É –∑–ª–æ–º –∏ –¥–æ–±—Ä–æ–º","a":"–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º","k":"mezhdu-zlom-i-dobrom","n":16},"GD-01":{"t":"–í–æ–ª–Ω–∞","a":"–ì–æ–ª–æ—Å –î—É—à–∏","k":"golos-dushi","n":1},"GD-02":{"t":"–¶–µ–Ω–∞ –°—á–∞—Å—Ç—å—è","a":"–ì–æ–ª–æ—Å –î—É—à–∏","k":"golos-dushi","n":2},"GD-03":{"t":"–ì–∞–¥–∫–∞—è","a":"–ì–æ–ª–æ—Å –î—É—à–∏","k":"golos-dushi","n":3},"GD-04":{"t":"–ì–æ–ª–æ—Å –î—É—à–∏","a":"–ì–æ–ª–æ—Å –î—É—à–∏","k":"golos-dushi","n":4},"GD-05":{"t":"–ê–Ω–≥–µ–ª","a":"–ì–æ–ª–æ—Å –î—É—à–∏","k":"golos-dushi","n":5},"GD-06":{"t":"–ó–∞–≤—Ç—Ä–∞ –ù–∞—Å—Ç–∞–Ω–µ—Ç –í—Å–µ–≥–¥–∞","a":"–ì–æ–ª–æ—Å –î—É—à–∏","k":"golos-dushi","n":6},"GD-07":{"t":"–£–ø–∞–ª–∞ –°–ª–µ–∑–∞","a":"–ì–æ–ª–æ—Å –î—É—à–∏","k":"golos-dushi","n":7},"GD-08":{"t":"–ü—É—Ç–µ–≤–æ–¥–Ω–∞—è –ó–≤–µ–∑–¥–∞","a":"–ì–æ–ª–æ—Å –î—É—à–∏","k":"golos-dushi","n":8},"GD-09":{"t":"–ú–µ–ª–æ–¥–∏–∏ –î–æ–∂–¥–µ–π","a":"–ì–æ–ª–æ—Å –î—É—à–∏","k":"golos-dushi","n":9},"GD-10":{"t":"–ü—Ä–µ–∫—Ä–∞—Å–Ω–∞—è –õ–æ–∂—å","a":"–ì–æ–ª–æ—Å –î—É—à–∏","k":"golos-dushi","n":10},"GD-11":{"t":"–û–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ","a":"–ì–æ–ª–æ—Å –î—É—à–∏","k":"golos-dushi","n":11},"GD-12":{"t":"–ö–æ–ª—ã–±–µ–ª—å–Ω–∞—è","a":"–ì–æ–ª–æ—Å –î—É—à–∏","k":"golos-dushi","n":12},"GD-13":{"t":"–£–ª—ã–±–∫–∞ –í–µ—Å–Ω—ã","a":"–ì–æ–ª–æ—Å –î—É—à–∏","k":"golos-dushi","n":13},"GD-14":{"t":"–õ—ë–¥","a":"–ì–æ–ª–æ—Å –î—É—à–∏","k":"golos-dushi","n":14},"OS-01":{"t":"–ö–∞–∫ –ì–µ—Ä–º–∏–æ–Ω–∞ –ì—Ä–µ–π–Ω–¥–∂–µ—Ä","a":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","k":"odnazhdy-v-skazke","n":1},"OS-02":{"t":"–¢—Ä—É—Å–ª–∏–≤—ã–π –ü–∞—Ä–µ–Ω—å","a":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","k":"odnazhdy-v-skazke","n":2},"OS-03":{"t":"–ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ –î–æ–±—Ä–∞","a":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","k":"odnazhdy-v-skazke","n":3},"OS-04":{"t":"–ü–æ—Å–ª–µ–¥–Ω–∏–π –î–µ–Ω—å","a":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","k":"odnazhdy-v-skazke","n":4},"OS-05":{"t":"–ó–∞–∑–µ—Ä–∫–∞–ª—å–µ –î—É—à–∏","a":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","k":"odnazhdy-v-skazke","n":5},"OS-06":{"t":"–ú—É–º–∏—è","a":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","k":"odnazhdy-v-skazke","n":6},"OS-07":{"t":"–ö–æ–≤–∞—Ä—Å—Ç–≤–æ","a":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","k":"odnazhdy-v-skazke","n":7},"OS-08":{"t":"–°—É–º–µ—Ä–∫–∏","a":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","k":"odnazhdy-v-skazke","n":8},"OS-09":{"t":"–õ—É–Ω–Ω—ã–π –ö—Ä—É–≥","a":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","k":"odnazhdy-v-skazke","n":9},"OS-10":{"t":"–ù–∏—Ç–∏ –°—É–¥—å–±—ã","a":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","k":"odnazhdy-v-skazke","n":10},"OS-11":{"t":"–î–≤–µ –î—É—à–∏","a":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","k":"odnazhdy-v-skazke","n":11},"OS-12":{"t":"–í–µ—Ç–µ—Ä–æ–∫","a":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","k":"odnazhdy-v-skazke","n":12},"OS-13":{"t":"–£—Ä–æ–∫–∏ –ú—É–∑—ã–∫–∏","a":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","k":"odnazhdy-v-skazke","n":13},"OS-14":{"t":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","a":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","k":"odnazhdy-v-skazke","n":14},"OS-15":{"t":"–°–Ω–µ–∂–∏–Ω–∫–∞","a":"–û–¥–Ω–∞–∂–¥—ã –≤ –°–∫–∞–∑–∫–µ","k":"odnazhdy-v-skazke","n":15},"KREV-01":{"t":"–£–ø–∞–ª–∞ –°–ª–µ–∑–∞","a":"–ö–†–ï–í–ï„ÉÑTOCHKA","k":"krevetochka","n":1},"KREV-02":{"t":"–ü—Ä–∏–Ω—Ü","a":"–ö–†–ï–í–ï„ÉÑTOCHKA","k":"krevetochka","n":2}},"idx":{"24":["GD-02","KREV-02","MZD-02"],"–∞–≤—Ç–æ—Ä":["GD-01","GD-02","GD-03","GD-04","GD-05","GD-06","GD-07","GD-08","GD-09","GD-10","GD-11","GD-12","GD-13","GD-14","KREV-01","KREV-02","MZD-01","MZD-02","MZD-03","MZD-04","MZD-05","MZD-06","MZD-07","MZD-08","MZD-09","MZD-10","MZD-11","MZD-12","MZD-13","MZD-14","MZD-15","MZD-16"],"–ø–µ—Ç—Ä":["GD-01","GD-02","GD-03","GD-04","GD-05","GD-06","GD-07","GD-08","GD-09","GD-10","GD-11","GD-12","GD-13","GD-14","KREV-01","KREV-02","MZD-01","MZD-02","MZD-03","MZD-04","MZD-05","MZD-06","MZD-07","MZD-08","MZD-09","MZD-10","MZD-11","MZD-12","MZD-13","MZD-14","MZD-15","MZD-16"],"–≥–æ—Ä–±–∞—á–µ–≤":["GD-01","GD-02","GD-03","GD-04","GD-05","GD-06","GD-07","GD-08","GD-09","GD-10","GD-11","GD-12","GD-13","GD-14","KREV-01","KREV-02","MZD-01","MZD-02","MZD-03","MZD-04","MZD-05","MZD-06","MZD-07","MZD-08","MZD-09","MZD-10","MZD-11","MZD-12","MZD-13","MZD-14","MZD-15","MZD-16"],"—Ä—É–ª–µ—Ç–∫–∞":["GD-01","KREV-01","MZD-01"],"—Å–æ—Ü–∏–∞–ª—å–Ω—ã–π":["GD-01","KREV-01","MZD-01"],"–≥—Ä–∏–ø–ø":["GD-01","KREV-01","MZD-01"],"–∫–æ—Å–∏—Ç":["GD-01","KREV-01","MZD-01"],"–¥—É—à–∏":["GD-01","GD-02","GD-03","GD-04","GD-05","GD-06","GD-07","GD-08","GD-09","GD-10","GD-11","GD-12","GD-13","GD-14","KREV-01","MZD-01","MZD-03","MZD-10","MZD-16","OS-03","OS-05","OS-11"],"–ª—é–¥–µ–π":["GD-01","GD-12","KREV-01","MZD-01","MZD-12","OS-02","OS-07"],"—Å–∏–º–ø—Ç–æ–º":["GD-01","KREV-01","MZD-01"],"—Ä–∞–≤–Ω–æ–¥—É—à–∏–µ":["GD-01","KREV-01","MZD-01","OS-03"],"–¥–∏–∞–≥–Ω–æ–∑":["GD-01","KREV-01","MZD-01"],"–∑–ª–æ–¥–µ–π":["GD-01","KREV-01","MZD-01"],"–º–∏—Ä":["GD-01","GD-03","GD-04","GD-05","GD-06","GD-08","GD-09","GD-10","GD-12","GD-13","KREV-01","MZD-01","MZD-03","MZD-04","MZD-05","MZD-06","MZD-08","MZD-09","MZD-10","MZD-12","MZD-13","MZD-16","OS-07","OS-08","OS-11","OS-15"],"–∫–∞–∑–∏–Ω–æ":["GD-01","KREV-01","MZD-01"],"–≥–¥–µ":["GD-01","GD-04","GD-06","GD-07","GD-11","GD-12","KREV-01","MZD-01","MZD-04","MZD-06","MZD-07","MZD-11","MZD-12","MZD-15","MZD-16","OS-05","OS-07","OS-08","OS-09","OS-10","OS-12","OS-13","OS-14"],"–∫—Ä—É–ø—å–µ":["GD-01","KREV-01","MZD-01"],"–≤—Å–µ–≥–¥–∞":["GD-01","GD-06","GD-12","GD-14","KREV-01","MZD-01","MZD-12","MZD-14","MZD-16","OS-01"],"–ø—Ä–∞–≤":["GD-01","KREV-01","MZD-01"],"—Ñ–∏—à–∫–∏":["GD-01","KREV-01","MZD-01"],"–∫—Ä–∞–ø–ª–µ–Ω—ã–µ":["GD-01","KREV-01","MZD-01"],"–¥–∞–∂–µ":["GD-01","GD-05","KREV-01","MZD-01","MZD-05"],"–µ—Å–ª–∏":["GD-01","GD-05","GD-06","KREV-01","MZD-01","MZD-05","MZD-06","MZD-16","OS-02","OS-06","OS-07","OS-09","OS-10"],"—Ç—ã":["GD-01","GD-02","GD-03","GD-08","GD-09","GD-12","GD-13","KREV-01","KREV-02","MZD-01","MZD-02","MZD-03","MZD-08","MZD-09","MZD-12","MZD-13","MZD-15","OS-03","OS-04","OS-05","OS-06","OS-07","OS-08","OS-10","OS-11","OS-12","OS-14","OS-15"],"–≥—Ä–∞—Ñ":["GD-01","KREV-01","MZD-01"],"–æ—Ç":["GD-01","GD-03","GD-04","GD-09","GD-10","GD-11","GD-13","KREV-01","MZD-01","MZD-03","MZD-04","MZD-09","MZD-10","MZD-11","MZD-13","MZD-15","OS-02","OS-05","OS-08","OS-13"],"–Ω–∏—â–µ—Ç—ã":["GD-01","KREV-01","MZD-01"],"–¥–æ":["GD-01","GD-05","GD-06","KREV-01","MZD-01","MZD-05","MZD-06","MZD-15","OS-09","OS-11","OS-13"],"–¥–≤–æ—Ä—Ü–æ–≤":["GD-01","KREV-01","MZD-01"],"–±—Ä–æ—Å–æ–∫":["GD-01","KREV-01","MZD-01"],"–∫–æ—Å—Ç–µ–π":["GD-01","GD-04","KREV-01","MZD-01","MZD-04","OS-02"],"—Ç—É—Ç":["GD-01","KREV-01","MZD-01"],"–ø—Ä–∞–≤–∏–ª–∞":["GD-01","KREV-01","MZD-01"],"–ø–∏—à–µ—Ç":["GD-01","KREV-01","MZD-01"],"—Ö–æ–∑—è–∏–Ω":["GD-01","KREV-01","MZD-01"],"–º–∞—Å—Ç–µ–π":["GD-01","KREV-01","MZD-01"],"–≤—ã–∏–≥—Ä—ã—à":["GD-01","KREV-01","MZD-01"],"–∏–ª–ª—é–∑–∏—è":["GD-01","KREV-01","MZD-01"],"–ø—Ä–æ–∏–≥—Ä—ã—à":["GD-01","KREV-01","MZD-01"],"–∑–∞–∫–æ–Ω":["GD-01","KREV-01","MZD-01","OS-03","OS-07"],"—á–µ—Å—Ç–Ω–æ—Å—Ç—å":["GD-01","KREV-01","MZD-01","OS-03"],"–º–∏—à–µ–Ω—å":["GD-01","KREV-01","MZD-01"],"–ø—Ä–∞–≤–¥–∞":["GD-01","GD-04","GD-08","GD-12","KREV-01","MZD-01","MZD-04","MZD-08","MZD-12"],"–ø–æ–∑–æ—Ä":["GD-01","KREV-01","MZD-01"],"—Å—Ç–∞–≤–∫–∏":["GD-01","KREV-01","MZD-01"],"—Ä–∞—Å—Ç—É—Ç":["GD-01","KREV-01","MZD-01"],"–Ω–æ":["GD-01","GD-02","GD-04","GD-05","GD-07","GD-08","GD-10","GD-11","GD-12","GD-13","GD-14","KREV-01","KREV-02","MZD-01","MZD-02","MZD-04","MZD-05","MZD-07","MZD-08","MZD-10","MZD-11","MZD-12","MZD-13","MZD-14","MZD-15","MZD-16","OS-03","OS-04","OS-06","OS-07","OS-08","OS-09","OS-10","OS-11","OS-14","OS-15"],"—à–∞–Ω—Å–æ–≤":["GD-01","KREV-01","MZD-01"],"—Ç–æ":["GD-01","GD-04","GD-05","GD-06","GD-09","GD-10","GD-13","GD-14","KREV-01","MZD-01","MZD-04","MZD-05","MZD-06","MZD-09","MZD-10","MZD-13","MZD-14","OS-02","OS-10","OS-11","OS-13"],"–Ω–æ–ª—å":["GD-01","GD-02","KREV-01","KREV-02","MZD-01","MZD-02"],"–æ–¥—É—Ä–º–∞–Ω–∏–ª":["GD-01","KREV-01","MZD-01"],"—Ç–æ—Ç–∞–ª—å–Ω—ã–π":["GD-01","KREV-01","MZD-01"],"–∫–æ–Ω—Ç—Ä–æ–ª—å":["GD-01","KREV-01","MZD-01"],"–≤—Å—è":["GD-01","GD-02","GD-08","GD-10","GD-11","GD-13","KREV-01","KREV-02","MZD-01","MZD-02","MZD-08","MZD-10","MZD-11","MZD-13","OS-04","OS-10"],"–∂–∏–∑–Ω—å":["GD-01","GD-02","GD-06","GD-07","GD-08","GD-10","GD-11","KREV-01","KREV-02","MZD-01","MZD-02","MZD-06","MZD-07","MZD-08","MZD-10","MZD-11","MZD-15","OS-04","OS-07","OS-08","OS-11","OS-14"],"–∏–≥—Ä–∞":["GD-01","KREV-01","MZD-01"],"–∫—Ä—É—Ç–∏—Å—å":["GD-01","KREV-01","MZD-01"],"—É—Ç—Ä–∞":["GD-01","KREV-01","MZD-01"],"–≤—Å–µ":["GD-01","GD-02","GD-03","GD-04","GD-05","GD-06","GD-07","GD-09","GD-10","GD-11","GD-12","KREV-01","KREV-02","MZD-01","MZD-02","MZD-03","MZD-04","MZD-05","MZD-06","MZD-07","MZD-09","MZD-10","MZD-11","MZD-12","MZD-16","OS-01","OS-03","OS-06","OS-07","OS-08","OS-10","OS-11","OS-13","OS-14"],"—Å–¥–µ–ª–∞–Ω—ã":["GD-01","KREV-01","MZD-01"],"–ø—Ä–æ–∏–≥—Ä–∞–ª":["GD-01","KREV-01","MZD-01"],"–µ—â–µ":["GD-01","KREV-01","MZD-01"],"–≤—á–µ—Ä–∞":["GD-01","KREV-01","MZD-01"],"–º—ã":["GD-01","GD-04","GD-05","GD-06","GD-07","GD-08","GD-10","GD-11","GD-14","KREV-01","MZD-01","MZD-04","MZD-05","MZD-06","MZD-07","MZD-08","MZD-10","MZD-11","MZD-14","OS-03","OS-07","OS-08","OS-10","OS-11","OS-12","OS-13","OS-14"],"–ø–æ–∫–æ–ª–µ–Ω–∏–µ":["GD-01","GD-12","KREV-01","MZD-01","MZD-12"],"–±–µ–∑":["GD-01","GD-06","GD-08","GD-10","KREV-01","MZD-01","MZD-06","MZD-08","MZD-10","OS-01","OS-03","OS-14","OS-15"],"–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π":["GD-01","KREV-01","MZD-01"],"—Å–ø–∞—Å–µ–Ω—å—é":["GD-01","KREV-01","MZD-01"],"–Ω–∞—à–∏":["GD-01","GD-11","KREV-01","MZD-01","MZD-11","OS-08","OS-10","OS-11"],"—Å–µ—Ä–¥—Ü–∞":["GD-01","GD-09","GD-13","KREV-01","MZD-01","MZD-09","MZD-13","OS-08","OS-10","OS-15"],"—ç—Ç–æ":["GD-01","GD-05","GD-06","GD-07","GD-12","GD-13","KREV-01","MZD-01","MZD-05","MZD-06","MZD-07","MZD-12","MZD-13","MZD-16","OS-01","OS-02","OS-03","OS-05","OS-06","OS-08","OS-09","OS-10"],"–ø—É—Ç—å":["GD-01","GD-02","GD-07","KREV-01","KREV-02","MZD-01","MZD-02","MZD-07","OS-02","OS-05","OS-10","OS-13"],"–≤–æ—Å–∫—Ä–µ—à–µ–Ω—å—é":["GD-01","KREV-01","MZD-01"],"–∞–ª—á–Ω–æ—Å—Ç—å":["GD-01","KREV-01","MZD-01"],"–¥–≤–∏–∂–æ–∫":["GD-01","KREV-01","MZD-01"],"—Ç–æ–ª–∫–∞–µ—Ç":["GD-01","KREV-01","MZD-01"],"–∫–æ—à–º–∞—Ä":["GD-01","KREV-01","MZD-01"],"–Ω–µ–Ω–∞–≤–∏—Å—Ç—å":["GD-01","GD-04","GD-11","KREV-01","MZD-01","MZD-04","MZD-11"],"—Ç–æ—Ä—Ñ":["GD-01","KREV-01","MZD-01"],"—Ä–∞–∑–∂–∏–≥–∞–µ—Ç":["GD-01","KREV-01","MZD-01"],"–ø–æ–∂–∞—Ä":["GD-01","KREV-01","MZD-01","OS-10"],"—Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ":["GD-01","KREV-01","MZD-01"],"–ª–∏—Ñ—Ç—ã":["GD-01","KREV-01","MZD-01"],"—Ä–∂–∞–≤—ã–µ":["GD-01","KREV-01","MZD-01"],"–∫–ª–µ—Ç–∫–∏":["GD-01","GD-12","KREV-01","MZD-01","MZD-12"],"—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å":["GD-01","KREV-01","MZD-01"],"–Ω–µ":["GD-01","GD-02","GD-03","GD-04","GD-05","GD-06","GD-07","GD-08","GD-09","GD-10","GD-11","GD-12","GD-13","GD-14","KREV-01","KREV-02","MZD-01","MZD-02","MZD-03","MZD-04","MZD-05","MZD-06","MZD-07","MZD-08","MZD-09","MZD-10","MZD-11","MZD-12","MZD-13","MZD-14","MZD-15","MZD-16","OS-01","OS-02","OS-03","OS-04","OS-06","OS-07","OS-08","OS-09","OS-10","OS-11","OS-12","OS-13","OS-14","OS-15"],"–∫—É–ø–∏—à—å":["GD-01","KREV-01","MZD-01"],"–∑–∞":["GD-01","GD-03","GD-04","GD-05","GD-06","GD-07","GD-08","GD-09","GD-12","KREV-01","MZD-01","MZD-03","MZD-04","MZD-05","MZD-06","MZD-07","MZD-08","MZD-09","MZD-12","OS-01","OS-03","OS-06","OS-07","OS-10","OS-12","OS-13","OS-14"],"–≥—Ä–æ—à":["GD-01","KREV-01","MZD-01"],"–∫–æ–ø–µ–π–∫–∏":["GD-01","KREV-01","MZD-01"],"—Å–≤–æ–±–æ–¥–∞":["GD-01","KREV-01","MZD-01"],"–ª–∏—à—å":["GD-01","GD-02","GD-03","GD-04","GD-05","GD-07","GD-08","GD-09","GD-11","GD-14","KREV-01","KREV-02","MZD-01","MZD-02","MZD-03","MZD-04","MZD-05","MZD-07","MZD-08","MZD-09","MZD-11","MZD-14","MZD-15","OS-03","OS-06","OS-09","OS-11","OS-13","OS-14","OS-15"],"—ç—Ö–æ":["GD-01","GD-02","KREV-01","KREV-02","MZD-01","MZD-02"],"–±–µ—Ç–æ–Ω–Ω–æ–π":["GD-01","KREV-01","MZD-01"],"–∫–æ—Ä–æ–±–∫–µ":["GD-01","KREV-01","MZD-01"],"—Ä–∞–≤–µ–Ω—Å—Ç–≤–æ":["GD-01","KREV-01","MZD-01"],"—Å–∫–∞–∑–∫–∞":["GD-01","KREV-01","MZD-01","MZD-16","OS-14"],"–∫—Ä–∞—Å–∏–≤–æ–π":["GD-01","KREV-01","MZD-01"],"–æ–±–µ—Ä—Ç–∫–µ":["GD-01","KREV-01","MZD-01"],"–∫–∞–∂–¥—ã–π":["GD-01","GD-04","GD-06","GD-07","GD-09","GD-12","GD-14","KREV-01","MZD-01","MZD-04","MZD-06","MZD-07","MZD-09","MZD-12","MZD-14","OS-13","OS-14"],"–≤—Ç–æ—Ä–æ–π":["GD-01","GD-02","GD-12","KREV-01","KREV-02","MZD-01","MZD-02","MZD-12"],"—Ä—É–±–∏—Ç":["GD-01","KREV-01","MZD-01"],"–≥–æ–ª–æ–≤—É":["GD-01","KREV-01","MZD-01"],"–ø–ª–µ—á":["GD-01","KREV-01","MZD-01"],"—Ç—Ä–µ—Ç–∏–π":["GD-01","KREV-01","MZD-01"],"–º–µ—á—Ç–∞–µ—Ç":["GD-01","KREV-01","MZD-01"],"–ø–æ–¥":["GD-01","GD-03","GD-06","KREV-01","MZD-01","MZD-03","MZD-06","MZD-16","OS-05","OS-11"],"–Ω–∞—á–∞–ª—å–Ω–∏–∫–∞":["GD-01","KREV-01","MZD-01"],"–ª–µ—á—å":["GD-01","KREV-01","MZD-01"],"—Ä–∞–∑–±–µ–π":["GD-01","KREV-01","MZD-01"],"—ç—Ç—É":["GD-01","GD-03","GD-09","KREV-01","MZD-01","MZD-03","MZD-09","OS-12"],"—Ç—å–º—É":["GD-01","KREV-01","MZD-01"],"–≤—ã—Ä–≤–∏—Å—å":["GD-01","GD-03","KREV-01","MZD-01","MZD-03"],"–∏–∑":["GD-01","GD-02","GD-03","GD-04","GD-05","GD-07","GD-09","GD-10","GD-12","KREV-01","KREV-02","MZD-01","MZD-02","MZD-03","MZD-04","MZD-05","MZD-07","MZD-09","MZD-10","MZD-12","OS-02","OS-06","OS-11","OS-12","OS-14"],"–ø–ª–µ–Ω–∞":["GD-01","GD-03","KREV-01","MZD-01","MZD-03"],"—Å–æ–∂–≥–∏":["GD-01","KREV-01","MZD-01"],"–¥–æ—Ç–ª–∞":["GD-01","KREV-01","MZD-01"],"—Å–Ω–∏–º–∏":["GD-01","KREV-01","MZD-01"],"–±—Ä–µ–º—è":["GD-01","KREV-01","MZD-01"],"–ø—É—Å—Ç—å":["GD-01","GD-11","GD-12","GD-13","GD-14","KREV-01","MZD-01","MZD-11","MZD-12","MZD-13","MZD-14","OS-01","OS-03","OS-05","OS-07","OS-08","OS-14"],"—Å–º–µ–µ—Ç—Å—è":["GD-01","KREV-01","MZD-01","OS-12"],"—Ä–∞–∑–¥–∞–≤–∞—è":["GD-01","KREV-01","MZD-01"],"—Ç—É–∑—ã":["GD-01","KREV-01","MZD-01"],"–∑–Ω–∞–µ–º":["GD-01","KREV-01","MZD-01"],"—á—Ç–æ":["GD-01","GD-02","GD-03","GD-04","GD-05","GD-06","GD-08","GD-09","GD-10","GD-11","GD-12","GD-13","GD-14","KREV-01","KREV-02","MZD-01","MZD-02","MZD-03","MZD-04","MZD-05","MZD-06","MZD-08","MZD-09","MZD-10","MZD-11","MZD-12","MZD-13","MZD-14","MZD-15","MZD-16","OS-03","OS-05","OS-06","OS-07","OS-09","OS-10","OS-12","OS-13","OS-14","OS-15"],"–∫–æ–ª–æ–¥–µ":["GD-01","KREV-01","MZD-01"],"–∫–æ–∑–ª—ã":["GD-01","KREV-01","MZD-01"],"–∏—Å–∫—Ä–∏—Ç":["GD-01","KREV-01","MZD-01"],"–∑—Ä–µ–µ—Ç":["GD-01","KREV-01","MZD-01"],"–≤–Ω—É—Ç—Ä–∏":["GD-01","GD-02","GD-03","GD-11","KREV-01","KREV-02","MZD-01","MZD-02","MZD-03","MZD-11"],"–Ω–∞–¥–µ–∂–¥–∞":["GD-01","GD-11","KREV-01","MZD-01","MZD-11","OS-05","OS-09"],"–Ω–∞":["GD-01","GD-02","GD-03","GD-04","GD-07","GD-08","GD-09","GD-11","GD-12","GD-14","KREV-01","KREV-02","MZD-01","MZD-02","MZD-03","MZD-04","MZD-07","MZD-08","MZD-09","MZD-11","MZD-12","MZD-14","MZD-15","OS-01","OS-03","OS-04","OS-05","OS-07","OS-08","OS-09","OS-10","OS-12","OS-15"],"–±—É–Ω—Ç":["GD-01","KREV-01","MZD-01"],"—Ä–≤–µ—Ç":["GD-01","KREV-01","MZD-01"],"—Ç–∏—à–∏–Ω—É":["GD-01","KREV-01","MZD-01"],"–∫—É—Å–∫–∏":["GD-01","KREV-01","MZD-01"],"–º–æ–∂–µ—Ç":["GD-01","GD-07","KREV-01","MZD-01","MZD-07","OS-02","OS-09","OS-10","OS-15"],"–±—ã—Ç—å":["GD-01","GD-07","KREV-01","MZD-01","MZD-07","OS-01","OS-03","OS-08","OS-09","OS-15"],"–∑–∞–≤—Ç—Ä–∞":["GD-01","GD-02","GD-05","GD-06","KREV-01","KREV-02","MZD-01","MZD-02","MZD-05"],"—Å–ª–æ–º–∞–µ—Ç—Å—è":["GD-01","KREV-01","MZD-01"],"–≤–¥—Ä—É–≥":["GD-01","GD-10","KREV-01","MZD-01","MZD-10","MZD-16","OS-02","OS-10"],"–ø–æ–¥–∞–≤–∏—Ç—Å—è":["GD-01","KREV-01","MZD-01"],"–ø–∏—Ä–∞–º–∏–¥–∞":["GD-01","KREV-01","MZD-01"],"—Ä–∞–∑–≤–∞–ª–∏—Ç—Å—è":["GD-01","KREV-01","MZD-01"],"–∞–¥—É":["GD-01","GD-11","KREV-01","MZD-01","MZD-11"],"–µ—Å—Ç—å":["GD-01","GD-07","KREV-01","MZD-01","MZD-07","OS-05"],"–ø—Ä–æ–±–ª–µ—Å–∫":["GD-01","KREV-01","MZD-01"],"–∑–∞—Ä–∏":["GD-01","KREV-01","MZD-01","OS-12"],"—É—Å–ª—ã—à—å":["GD-01","KREV-01","MZD-01"],"–≥–æ–ª–æ—Å":["GD-01","GD-02","GD-03","GD-04","GD-05","GD-06","GD-07","GD-08","GD-09","GD-10","GD-11","GD-12","GD-13","GD-14","KREV-01","MZD-01","MZD-12"],"–ø—Ä–∞–≤–¥—ã":["GD-01","KREV-01","MZD-01","OS-05"],"—Å–≤–æ–µ–π":["GD-01","GD-03","KREV-01","MZD-01","MZD-03","OS-04","OS-15"],"–≥—Ä—É–¥–∏":["GD-01","GD-02","KREV-01","KREV-02","MZD-01","MZD-02","MZD-15","OS-04","OS-10"],"–ø–æ–¥–Ω–∏–º–µ—Ç—Å—è":["GD-01","KREV-01","MZD-01"],"–±—É—Ä—è":["GD-01","KREV-01","MZD-01"],"–≤–æ—Å—Å—Ç–∞–Ω–µ—Ç":["GD-01","KREV-01","MZD-01"],"–≤–æ–ª–Ω–∞":["GD-01","KREV-01","MZD-01"],"–±—É–¥–µ—Ç":["GD-01","GD-05","GD-07","KREV-01","MZD-01","MZD-05","MZD-07"],"–æ–∫–æ–Ω—á–µ–Ω–∞":["GD-01","KREV-01","MZD-01"],"—ç—Ç–∞":["GD-01","KREV-01","MZD-01","MZD-16","OS-12","OS-14"],"–º–µ–∂–¥—É":["MZD-01","MZD-02","MZD-03","MZD-04","MZD-05","MZD-06","MZD-07","MZD-08","MZD-09","MZD-10","MZD-11","MZD-12","MZD-13","MZD-14","MZD-15","MZD-16"],"–∑–ª–æ–º":["MZD-01","MZD-02","MZD-03","MZD-04","MZD-05","MZD-06","MZD-07","MZD-08","MZD-09","MZD-10","MZD-11","MZD-12","MZD-13","MZD-14","MZD-15","MZD-16","OS-01"],"–¥–æ–±—Ä–æ–º":["MZD-01","MZD-02","MZD-03","MZD-04","MZD-05","MZD-06","MZD-07","MZD-08","MZD-09","MZD-10","MZD-11","MZD-12","MZD-13","MZD-14","MZD-15","MZD-16"],"–¥—ã—Ö–∞–Ω–∏–µ":["GD-02","KREV-02","MZD-02"],"–¥–≤–∞":["GD-02","KREV-02","MZD-02","OS-05","OS-11"],"–º–∏—Ä–∞":["GD-02","KREV-02","MZD-02"],"–∫–∞–∫":["GD-02","GD-04","GD-05","GD-07","GD-08","GD-09","GD-10","GD-11","GD-12","GD-13","GD-14","KREV-02","MZD-02","MZD-04","MZD-05","MZD-07","MZD-08","MZD-09","MZD-10","MZD-11","MZD-12","MZD-13","MZD-14","MZD-16","OS-01","OS-02","OS-04","OS-05","OS-07","OS-08","OS-09","OS-10","OS-11","OS-12","OS-13","OS-14","OS-15"],"–Ω–µ–±–æ":["GD-02","KREV-02","MZD-02","OS-13"],"–∑–µ–º–ª—è":["GD-02","GD-07","KREV-02","MZD-02","MZD-07","OS-12"],"–Ω–µ–≤–∏–¥–∏–º–∞—è":["GD-02","KREV-02","MZD-02"],"–≥—Ä–∞–Ω—å":["GD-02","GD-06","KREV-02","MZD-02","MZD-06","MZD-16"],"–º–µ–∂":["GD-02","KREV-02","MZD-02"],"–Ω–∞–º–∏":["GD-02","KREV-02","MZD-02"],"–ø—Ä–æ–ª–µ–≥–ª–∞":["GD-02","KREV-02","MZD-02"],"—Ç–≤–æ–π":["GD-02","KREV-02","MZD-02","OS-07"],"–æ–±—Ä–∞–∑":["GD-02","KREV-02","MZD-02"],"–Ω–µ–∑–µ–º–Ω–æ–π":["GD-02","KREV-02","MZD-02"],"–∞–Ω–≥–µ–ª—å—Å–∫–∏–π":["GD-02","KREV-02","MZD-02"],"–ø–æ–ª–µ—Ç":["GD-02","KREV-02","MZD-02","OS-15"],"–≤—Å–µ–≥–æ":["GD-02","GD-08","KREV-02","MZD-02","MZD-08","OS-04"],"—Å–º–µ—Ä—Ç–Ω—ã–π":["GD-02","KREV-02","MZD-02"],"–∂–¥—É—â–∏–π":["GD-02","KREV-02","MZD-02"],"–≤–æ—Ä–æ—Ç":["GD-02","KREV-02","MZD-02"],"—à–µ–ø—á—É—Ç":["GD-02","KREV-02","MZD-02"],"–º–Ω–µ":["GD-02","GD-04","GD-10","GD-12","GD-14","KREV-02","MZD-02","MZD-04","MZD-10","MZD-12","MZD-14","MZD-15","OS-01","OS-02","OS-03","OS-05","OS-06","OS-07","OS-08","OS-10","OS-12"],"–≤–µ—Ç—Ä–∞":["GD-02","GD-08","KREV-02","MZD-02","MZD-08"],"–≤–ø–ª–µ—Ç–∞—è":["GD-02","KREV-02","MZD-02"],"–≥—Ä—É—Å—Ç—å":["GD-02","KREV-02","MZD-02"],"—Å–ª–æ–≤–∞":["GD-02","KREV-02","MZD-02"],"–¥–ª—è":["GD-02","GD-07","GD-08","GD-12","GD-13","GD-14","KREV-02","MZD-02","MZD-07","MZD-08","MZD-12","MZD-13","MZD-14","OS-03","OS-06","OS-07","OS-13"],"–Ω–∞—Å":["GD-02","GD-05","GD-06","GD-07","GD-14","KREV-02","MZD-02","MZD-05","MZD-06","MZD-07","MZD-14","MZD-15","OS-08","OS-11","OS-13","OS-14","OS-15"],"—Ç–æ–±–æ–π":["GD-02","GD-14","KREV-02","MZD-02","MZD-14","OS-03","OS-12","OS-15"],"–≥–æ—Ä–∏—Ç":["GD-02","GD-04","GD-14","KREV-02","MZD-02","MZD-04","MZD-14","OS-08"],"–ª—é–±–≤–∏":["GD-02","GD-08","GD-10","KREV-02","MZD-02","MZD-08","MZD-10","OS-10","OS-12","OS-15"],"–∑–≤–µ–∑–¥–∞":["GD-02","GD-08","GD-14","KREV-02","MZD-02","MZD-14"],"–∑–Ω–∞—é":["GD-02","KREV-02","MZD-02","OS-15"],"—Å–µ—Ä–¥—Ü–µ":["GD-02","GD-04","GD-06","GD-08","GD-09","GD-12","GD-13","GD-14","KREV-02","MZD-02","MZD-04","MZD-06","MZD-08","MZD-09","MZD-12","MZD-13","MZD-14","OS-01","OS-09","OS-12","OS-13","OS-15"],"—Ä–≤–µ—Ç—Å—è":["GD-02","GD-09","KREV-02","MZD-02","MZD-09","OS-09"],"–∫–∞–∂–¥–æ–º":["GD-02","GD-08","KREV-02","MZD-02","MZD-08"],"—É–¥–∞—Ä–µ":["GD-02","KREV-02","MZD-02"],"—Å–æ—Ç–Ω–∏":["GD-02","GD-11","KREV-02","MZD-02","MZD-11"],"–Ω–µ—Ç":["GD-02","GD-03","GD-04","GD-07","GD-08","GD-10","GD-11","GD-13","KREV-02","MZD-02","MZD-03","MZD-04","MZD-07","MZD-08","MZD-10","MZD-11","MZD-13","OS-05","OS-06","OS-07","OS-08","OS-09","OS-12"],"–ø—Ä–æ—Å—Ç–∏":["GD-02","GD-12","KREV-02","MZD-02","MZD-12","OS-05"],"–±–æ–ª—å–Ω–æ":["GD-02","KREV-02","MZD-02"],"–æ–¥–Ω–æ–º—É":["GD-02","KREV-02","MZD-02"],"–ø—Ä–æ–π—Ç–∏":["GD-02","KREV-02","MZD-02","OS-08"],"–∫–æ–≥–¥–∞":["GD-02","GD-08","GD-10","KREV-02","MZD-02","MZD-08","MZD-10","OS-08","OS-11","OS-13"],"–ª–µ–∑–≤–∏–µ–º":["GD-02","KREV-02","MZD-02"],"—Ä–µ–∂—É—Ç":["GD-02","GD-03","KREV-02","MZD-02","MZD-03"],"–≥–≤–æ–∑–¥—è–º–∏":["GD-02","KREV-02","MZD-02"],"–¥–æ–∂–¥–∏":["GD-02","KREV-02","MZD-02"],"—á—É–≤—Å—Ç–≤—É—é":["GD-02","KREV-02","MZD-02","OS-09","OS-12"],"—Ç–æ–Ω–µ—Ç":["GD-02","GD-09","KREV-02","MZD-02","MZD-09"],"—Å—Ç—Ä–∞—Ö–µ":["GD-02","KREV-02","MZD-02"],"—Å–æ–∑–Ω–∞–Ω–∏–µ":["GD-02","GD-09","KREV-02","MZD-02","MZD-09"],"–¥–≤–∞–¥—Ü–∞—Ç—å":["GD-02","KREV-02","MZD-02"],"—á–µ—Ç—ã—Ä–µ":["GD-02","KREV-02","MZD-02"],"—Å–µ–º—å":["GD-02","KREV-02","MZD-02"],"–æ–∂–∏–¥–∞–Ω–∏–∏":["GD-02","KREV-02","MZD-02"],"–º–æ—è":["GD-02","GD-10","GD-12","KREV-02","MZD-02","MZD-10","MZD-12","MZD-15","OS-08","OS-10","OS-11"],"–¥–µ–≤—è—Ç—å":["GD-02","KREV-02","MZD-02"],"–±–∞–ª–æ–≤":["GD-02","KREV-02","MZD-02"],"—Ü—É–Ω–∞–º–∏":["GD-02","GD-12","KREV-02","MZD-02","MZD-12"],"–≤–¥–æ—Ö":["GD-02","KREV-02","MZD-02"],"–≤—ã–¥–æ—Ö":["GD-02","KREV-02","MZD-02"],"–º–æ–µ":["GD-02","GD-13","KREV-02","MZD-02","MZD-13","OS-05","OS-08","OS-09"],"–Ω–∞–∫–∞–∑–∞–Ω–∏–µ":["GD-02","KREV-02","MZD-02"],"–Ω–æ—Ç":["GD-02","KREV-02","MZD-02"],"–ø—É—Å—Ç–æ—Ç–µ":["GD-02","KREV-02","MZD-02"],"–∑–≤—É—á–∞—Ç":["GD-02","KREV-02","MZD-02"],"–Ω–∏–∫—Ç–æ":["GD-02","GD-10","GD-12","KREV-02","MZD-02","MZD-10","MZD-12","OS-11"],"—Å–ª—ã—à–∏—Ç":["GD-02","KREV-02","MZD-02","OS-02"],"–Ω–æ—á—å":["GD-02","KREV-02","MZD-02","OS-04","OS-09"],"–∫—Ä–æ–º–µ—à–Ω–æ–π":["GD-02","KREV-02","MZD-02"],"—Ç–µ–º–Ω–æ—Ç–µ":["GD-02","KREV-02","MZD-02","OS-02"],"–¥–≤–∞–∂–¥—ã":["GD-02","KREV-02","MZD-02"],"–ø–µ—Ä–µ–ø–∏—à–µ—Ç":["GD-02","KREV-02","MZD-02"],"—Ç—Ä–∏":["GD-02","KREV-02","MZD-02"],"–±–æ—é—Å—å":["GD-02","KREV-02","MZD-02"],"–ø—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏":["GD-02","KREV-02","MZD-02"],"–º–µ–Ω—è":["GD-02","GD-10","GD-12","KREV-02","MZD-02","MZD-10","MZD-12","MZD-15","MZD-16","OS-02","OS-05","OS-06","OS-08","OS-09","OS-10","OS-15"],"–æ—Å—Ç—Ä—ã–µ":["GD-02","KREV-02","MZD-02"],"–æ—Å–∫–æ–ª–∫–∏":["GD-02","GD-03","GD-09","KREV-02","MZD-02","MZD-03","MZD-09","OS-05","OS-09"],"–¥–≤–µ":["GD-02","KREV-02","MZD-02","OS-11"],"—Ç—ã—Å—è—á–∏":["GD-02","KREV-02","MZD-02"],"–ø—Ä–∏—á–∏–Ω":["GD-02","KREV-02","MZD-02"],"–∫—Ä–∏—á–∞—Ç":["GD-02","KREV-02","MZD-02"],"–º–æ–ª—á–∏":["GD-02","KREV-02","MZD-02","OS-07"],"–º—ã—Å–ª–∏":["GD-02","GD-09","KREV-02","MZD-02","MZD-09","OS-04"],"—Ä–∞—Å–∫–∞–ª–µ–Ω–Ω—ã–µ":["GD-02","KREV-02","MZD-02"],"–∏–≥–æ–ª–∫–∏":["GD-02","KREV-02","MZD-02"],"–∑–∞—á–µ–º":["GD-02","GD-05","GD-08","GD-10","KREV-02","MZD-02","MZD-05","MZD-08","MZD-10","OS-07"],"—ç—Ç–∏":["GD-02","GD-03","KREV-02","MZD-02","MZD-03","OS-03"],"—Å–ª–æ–≤":["GD-02","KREV-02","MZD-02"],"–ø—É—Å—Ç—ã—Ö":["GD-02","KREV-02","MZD-02"],"–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ":["GD-02","KREV-02","MZD-02"],"–æ–¥–Ω–æ–≥–æ":["GD-02","KREV-02","MZD-02"],"–≤–∑–≥–ª—è–¥–∞":["GD-02","KREV-02","MZD-02"],"—á—Ç–æ–±":["GD-02","GD-05","GD-08","GD-09","GD-10","KREV-02","MZD-02","MZD-05","MZD-08","MZD-09","MZD-10","OS-06","OS-11","OS-12","OS-15"],"–±–µ–∑–¥–Ω–µ":["GD-02","GD-10","KREV-02","MZD-02","MZD-10"],"–≥–ª–∞–∑":["GD-02","GD-05","GD-10","KREV-02","MZD-02","MZD-05","MZD-10","OS-13"],"—Ç–æ–Ω—É—Ç—å":["GD-02","KREV-02","MZD-02"],"—Ç–≤–æ–∏—Ö":["GD-02","GD-14","KREV-02","MZD-02","MZD-14","MZD-15"],"—ç—Ç–æ–º":["GD-02","GD-12","KREV-02","MZD-02","MZD-12"],"–æ–º—É—Ç–µ":["GD-02","KREV-02","MZD-02"],"–Ω–∞–≥—Ä–∞–¥–∞":["GD-02","KREV-02","MZD-02"],"—É–∑–Ω–∞—Ç—å":["GD-02","KREV-02","MZD-02"],"–±—å–µ—Ç—Å—è":["GD-02","GD-04","GD-14","KREV-02","MZD-02","MZD-04","MZD-14"],"—É–Ω–∏—Å–æ–Ω":["GD-02","KREV-02","MZD-02"],"–µ–¥–∏–Ω–æ–º":["GD-02","KREV-02","MZD-02"],"—Ä–∏—Ç–º–µ":["GD-02","KREV-02","MZD-02"],"–Ω–∞–≤—Å–µ–≥–¥–∞":["GD-02","GD-09","KREV-02","MZD-02","MZD-09","MZD-15","OS-11"],"–Ω–∞–≤–µ—á–Ω–æ":["GD-02","KREV-02","MZD-02","OS-08"],"—ç—Ç–æ—Ç":["GD-02","GD-12","KREV-02","MZD-02","MZD-12","OS-03","OS-08","OS-09"],"–≤–∑–¥–æ—Ö":["GD-02","GD-14","KREV-02","MZD-02","MZD-14"],"—Å—Ç–æ–Ω":["GD-02","KREV-02","MZD-02"],"–ø–µ—Ä–µ–∑–≤–æ–Ω":["GD-02","KREV-02","MZD-02"],"–ø–æ–≤—Ç–æ—Ä–∏—Ç—Å—è":["GD-02","KREV-02","MZD-02"],"–±–µ—Å–∫–æ–Ω–µ—á–Ω–æ":["GD-02","KREV-02","MZD-02"],"—Å—Ç–æ":["GD-02","GD-09","GD-11","KREV-02","MZD-02","MZD-09","MZD-11"],"–ø–µ—Ä–≤—ã–π":["GD-02","KREV-02","MZD-02"],"—Ä–∞–∑":["GD-02","GD-06","GD-09","KREV-02","MZD-02","MZD-06","MZD-09","OS-03","OS-05","OS-13","OS-14"],"–ª–æ–≤–ª—é":["GD-02","KREV-02","MZD-02"],"–º–∏–º–æ–ª–µ—Ç–Ω—ã–π":["GD-02","KREV-02","MZD-02","OS-13"],"–≤–∑–≥–ª—è–¥":["GD-02","GD-06","GD-08","GD-11","GD-13","KREV-02","MZD-02","MZD-06","MZD-08","MZD-11","MZD-13","OS-03","OS-15"],"–∫–∞–∂–µ—Ç—Å—è":["GD-02","KREV-02","MZD-02"],"–≤–æ—Ç":["GD-02","GD-03","GD-14","KREV-02","MZD-02","MZD-03","MZD-14","OS-03","OS-10","OS-11"],"—Å—É–¥—å–±–∞":["GD-02","GD-07","KREV-02","MZD-02","MZD-07","MZD-16","OS-01","OS-04","OS-09","OS-10"],"—Å–≤–µ–¥–µ—Ç":["GD-02","KREV-02","MZD-02"],"–ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç":["GD-02","KREV-02","MZD-02"],"–≥–∞—Å–Ω–µ—Ç":["GD-02","GD-07","GD-10","KREV-02","MZD-02","MZD-07","MZD-10"],"–¥–µ–Ω—å":["GD-02","GD-07","GD-09","GD-11","GD-14","KREV-02","MZD-02","MZD-07","MZD-09","MZD-11","MZD-14","OS-04","OS-07","OS-14"],"–ø–æ":["GD-02","GD-05","GD-06","GD-07","GD-10","GD-11","GD-12","KREV-02","MZD-02","MZD-05","MZD-06","MZD-07","MZD-10","MZD-11","MZD-12","OS-01","OS-05","OS-10","OS-13","OS-14","OS-15"],"–∫—Ä—É–≥—É":["GD-02","KREV-02","MZD-02"],"–≤–Ω–æ–≤—å":["GD-02","GD-08","GD-09","KREV-02","MZD-02","MZD-08","MZD-09","MZD-15","OS-09"],"–ø–æ–π–¥–µ—Ç":["GD-02","KREV-02","MZD-02"],"–≤–∏—Ç—Ä–∏–Ω–∞":["GD-03","MZD-03"],"—Ä–∞–∑–±–∏—Ç–∞":["GD-03","MZD-03"],"—Ç–æ–Ω–Ω—ã":["GD-03","MZD-03"],"–≥—Ä–∏–º–∞":["GD-03","MZD-03"],"—Ñ–∞–ª—å—à–∏–≤—ã–π":["GD-03","MZD-03"],"–∑–∞–≥–∞—Ä":["GD-03","MZD-03"],"—É–ª—ã–±–∫–∞":["GD-03","GD-13","MZD-03"],"—Ñ–æ—Ç–æ":["GD-03","MZD-03"],"–∏–∑–æ":["GD-03","MZD-03"],"—Ä—Ç–∞":["GD-03","MZD-03"],"–ø–µ—Ä–µ–≥–∞—Ä":["GD-03","MZD-03"],"–±—Ä–µ–Ω–¥—ã":["GD-03","MZD-03"],"—Ç–∞—á–∫–∏":["GD-03","MZD-03"],"–Ω–æ–≤—ã–π":["GD-03","GD-07","GD-09","MZD-03","MZD-07","MZD-09"],"–∫—É–º–∏—Ä":["GD-03","MZD-03"],"–ø—É—Å—Ç—ã–µ":["GD-03","GD-11","MZD-03","MZD-11"],"–±–æ–ª–≤–∞–Ω–∫–∏":["GD-03","MZD-03"],"–±–µ–∑–¥—É—à–Ω—ã–π":["GD-03","MZD-03"],"—ç—Ñ–∏—Ä":["GD-03","MZD-03"],"–¥–≤–∏–∂–µ–Ω—å–µ":["GD-03","MZD-03"],"–≤–µ—Ä—à–∏–Ω–µ":["GD-03","MZD-03"],"–±–µ–≥":["GD-03","MZD-03"],"–∫—Ä—ã—Å":["GD-03","MZD-03"],"–∫–æ–ª–µ—Å–µ":["GD-03","MZD-03"],"–ø—ã–ª—å":["GD-03","GD-07","GD-11","GD-14","MZD-03","MZD-07","MZD-11","MZD-14"],"–∞–º–±–∏—Ü–∏–π":["GD-03","MZD-03"],"–ª–µ—Ç–∞–µ—Ç":["GD-03","MZD-03"],"–≤–µ–∑–¥–µ":["GD-03","GD-06","MZD-03","MZD-06"],"—Ç–∞–º":["GD-03","GD-07","GD-09","MZD-03","MZD-07","MZD-09","MZD-16","OS-05","OS-10"],"–≥–ª—è–Ω—Ü–µ–º":["GD-03","MZD-03"],"–ø–æ–±–µ–¥":["GD-03","MZD-03","OS-05"],"—Ç–µ–Ω—å":["GD-03","GD-09","MZD-03","MZD-09","OS-03"],"–ø—É—Å—Ç–æ—Ç—ã":["GD-03","MZD-03"],"–≤—ã—Ö–æ–¥–∞":["GD-03","MZD-03"],"–ª–æ–∂—å":["GD-03","GD-04","GD-08","GD-09","GD-10","GD-11","GD-12","MZD-03","MZD-04","MZD-08","MZD-09","MZD-11","MZD-12"],"—É–≤—ã":["GD-03","GD-05","GD-10","GD-14","MZD-03","MZD-05","MZD-10","MZD-14","MZD-15","OS-01","OS-04"],"—Å–µ–±—è":["GD-03","MZD-03","OS-03","OS-05","OS-07","OS-08","OS-14"],"–Ω–∞–π–¥–µ—à—å":["GD-03","MZD-03"],"–æ–¥–∏–Ω":["GD-03","GD-04","GD-05","GD-07","GD-10","MZD-03","MZD-04","MZD-05","MZD-07","MZD-10","OS-02","OS-03","OS-07","OS-13"],"–Ω–µ–≤–µ—Ä–Ω—ã–π":["GD-03","MZD-03"],"—à–∞–≥":["GD-03","GD-06","GD-09","GD-14","MZD-03","MZD-06","MZD-09","MZD-14","OS-13"],"—Å–æ—Ä–≤–∞–ª—Å—è":["GD-03","MZD-03"],"–∑–∞–ø–æ–π":["GD-03","MZD-03"],"–∂–µ—Å—Ç":["GD-03","MZD-03"],"–ø—Ä–æ–±–∏–ª":["GD-03","MZD-03"],"–¥–Ω–æ":["GD-03","MZD-03"],"—Å–∫—Ä—ã–≤–∞–µ–º—Å—è":["GD-03","MZD-03"],"—Ñ—Ä–∞–∑–∞—Ö":["GD-03","MZD-03"],"—Å—É–ø–µ—Ä":["GD-03","MZD-03"],"–æ–∫–µ–π":["GD-03","MZD-03"],"–≤—ã—Ä—ã–≤–∞—è":["GD-03","MZD-03"],"–º–æ–≥–∏–ª—É":["GD-03","MZD-03"],"—Å–≤–æ–±–æ–¥–µ":["GD-03","MZD-03","OS-01"],"–ª–∞–π–∫–∞–º–∏":["GD-03","MZD-03"],"–ø—Ä—è—á–µ—Ç—Å—è":["GD-03","GD-10","MZD-03","MZD-10"],"–∑–∞–≤–∏—Å—Ç—å":["GD-03","GD-04","MZD-03","MZD-04","OS-07"],"–±–æ–ª—å":["GD-03","GD-04","GD-08","GD-09","GD-10","GD-11","GD-12","MZD-03","MZD-04","MZD-08","MZD-09","MZD-10","MZD-11","MZD-12","OS-04","OS-09","OS-13","OS-14"],"—Å—Ç–∞—Ç—É—Å–æ–º":["GD-03","MZD-03"],"—Å–∫—Ä—ã—Ç–∞":["GD-03","MZD-03"],"–≥–ª–∞–≤–Ω–∞—è":["GD-03","MZD-03"],"—Ä–æ–ª—å":["GD-03","MZD-03"],"–∏–≥—Ä–∞—é—Ç":["GD-03","MZD-03"],"—Å—á–∞—Å—Ç—å–µ":["GD-03","GD-13","MZD-03","MZD-13","OS-05","OS-10"],"–≤–µ—Ä—è—Ç":["GD-03","MZD-03"],"–º–∏—Ä–∞–∂":["GD-03","MZD-03"],"–¥–æ–º–∞":["GD-03","MZD-03"],"—Å–∫–∞–Ω–¥–∞–ª":["GD-03","MZD-03"],"—Ç–∞–±–ª–µ—Ç–æ–∫":["GD-03","MZD-03"],"–±–∞–≥–∞–∂":["GD-03","MZD-03"],"–º–∞—Å–∫–æ–π":["GD-03","MZD-03","OS-05"],"—É–ª—ã–±–æ–∫":["GD-03","MZD-03"],"—Å—Ç—Ä–∞—Ö":["GD-03","GD-04","GD-11","GD-14","MZD-03","MZD-04","MZD-11","MZD-14","OS-02","OS-04","OS-05","OS-09"],"—Ç–æ—Å–∫–∞":["GD-03","MZD-03"],"—Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å":["GD-03","GD-05","MZD-03","MZD-05","MZD-16","OS-14"],"–±–µ—Å—Å–∏–ª—å–Ω–∞":["GD-03","MZD-03"],"—Å–ª–æ–≤–Ω–æ":["GD-03","GD-04","GD-07","GD-09","GD-14","MZD-03","MZD-04","MZD-07","MZD-09","MZD-14"],"—Ç—é—Ä—å–º–∞":["GD-03","MZD-03"],"–≥–ª–∞–∑–∞—Ö":["GD-03","GD-10","MZD-03","MZD-10","OS-12","OS-15"],"–ø—É—Å—Ç–æ—Ç–∞":["GD-03","MZD-03"],"—Å–≤–µ—Ç–∏—Ç":["GD-03","MZD-03"],"–∑–∞—Ä—è":["GD-03","MZD-03"],"—Ä–∞–∑–±–∏—Ç":["GD-03","MZD-03"],"–º–∏—Ä–µ":["GD-03","GD-10","GD-12","GD-13","MZD-03","MZD-10","MZD-12","MZD-13","OS-01","OS-07"],"—Ñ–∞–ª—å—à–∏–≤—ã—Ö":["GD-03","MZD-03"],"–ª–∏—Ü":["GD-03","GD-07","MZD-03","MZD-07"],"–∫—Ç–æ":["GD-03","GD-07","GD-08","GD-09","GD-10","GD-11","MZD-03","MZD-07","MZD-08","MZD-09","MZD-10","MZD-11","OS-02","OS-06","OS-10","OS-13"],"—Å—Ç–µ–Ω–æ—é":["GD-03","MZD-03"],"—Å–±—Ä–æ—Å—å":["GD-03","MZD-03"],"–º–∞—Å–∫—É":["GD-03","MZD-03"],"—Å—Ç–∞–Ω—å":["GD-03","MZD-03"],"–ø—Ä–æ—Å—Ç–æ":["GD-03","GD-04","GD-09","GD-11","GD-12","MZD-03","MZD-04","MZD-09","MZD-11","MZD-12","OS-13"],"—Å–æ–±–æ—é":["GD-03","MZD-03"],"—Å–æ–ø—Ä–æ—Ç–∏–≤–ª—è–π—Å—è":["GD-03","MZD-03"],"–±—É–¥—å":["GD-03","MZD-03"],"–∏—Å–∫—Ä–µ–Ω–Ω–∏–º":["GD-03","MZD-03"],"—Å–º–µ–ª—ã–º":["GD-03","MZD-03"],"–∏–ª–ª—é–∑–∏–π":["GD-03","GD-14","MZD-03","MZD-14"],"—É–º–µ–ª–æ":["GD-03","MZD-03"],"—Ä–∞–∑–æ—Ä–≤–∏":["GD-03","MZD-03"],"—Ü–µ–ø–∏":["GD-03","MZD-03"],"—á–µ—Å—Ç–µ–Ω":["GD-03","MZD-03"],"–ø—Ä–æ—Å—Ç":["GD-03","MZD-03"],"—Ç–∞–∫":["GD-03","GD-05","GD-10","GD-14","MZD-03","MZD-05","MZD-10","MZD-14","OS-03","OS-05","OS-06","OS-07","OS-10","OS-11","OS-12","OS-13","OS-14"],"–∂–µ—Å—Ç–æ–∫":["GD-03","MZD-03"],"–¥–µ–ª–∞–π":["GD-03","GD-14","MZD-03","MZD-14"],"—Ä–µ–ø–æ—Å—Ç":["GD-03","MZD-03"],"–≤–¥–æ—Ö–Ω–∏":["GD-03","MZD-03"],"–ø–æ–ª–Ω–æ–π":["GD-03","MZD-03","OS-10"],"–≥—Ä—É–¥—å—é":["GD-03","MZD-03","OS-10"],"–Ω–∞—á–Ω–∏":["GD-03","MZD-03"],"–Ω—É–ª—è":["GD-03","MZD-03"],"–ø–æ—á—É–≤—Å—Ç–≤—É–π":["GD-03","MZD-03"],"–∏–Ω–∞—á–µ":["GD-03","GD-11","MZD-03","MZD-11","OS-08"],"–∑—Ä—è":["GD-03","MZD-03"],"–ø–æ—Å–ª–µ–¥–Ω–∏–π":["GD-03","GD-07","MZD-03","MZD-07","OS-04"],"–∞–∫–∫–æ—Ä–¥":["GD-03","MZD-03"],"—Å—Ç–µ–∫–ª–æ":["GD-03","GD-14","MZD-03","MZD-14"],"–Ω–æ–≥–∞–º–∏":["GD-03","MZD-03"],"–≤–æ–Ω–∑–∞–µ—Ç—Å—è":["GD-03","MZD-03"],"–ø–ª–æ—Ç—å":["GD-03","GD-09","MZD-03","MZD-09","OS-06"],"–∫—Ä–∏—á–∏":["GD-03","MZD-03"],"–∏–ª–∏":["GD-03","GD-07","GD-08","GD-10","MZD-03","MZD-07","MZD-08","MZD-10","MZD-16","OS-04"],"–ø–ª–∞—á—å":["GD-03","GD-10","MZD-03","MZD-10"],"—É–∂–µ":["GD-03","GD-04","GD-05","GD-06","GD-14","MZD-03","MZD-04","MZD-05","MZD-06","MZD-14","OS-10"],"–ø–æ–º–æ—á—å":["GD-03","MZD-03"],"–ª–µ—Ç–∏—Ç":["GD-03","GD-06","MZD-03","MZD-06"],"–¥—É—à–∞":["GD-03","GD-08","GD-13","MZD-03","MZD-08","MZD-13","OS-08","OS-11","OS-12","OS-15"],"–ø—Ä–æ—á—å":["GD-03","MZD-03"],"–∫–æ—à–∫–∏":["GD-04","MZD-04"],"–º—ã—à–∫–∏":["GD-04","MZD-04"],"—É—Å–∞—Ç—ã–π":["GD-04","MZD-04"],"–≤–∞–∂–Ω—ã–π":["GD-04","MZD-04"],"–≥–æ—Å–ø–æ–¥–∏–Ω":["GD-04","MZD-04"],"–æ–Ω":["GD-04","GD-05","GD-11","GD-14","MZD-04","MZD-05","MZD-11","MZD-14","OS-02","OS-03","OS-04","OS-07","OS-10"],"–∫–æ—Ç":["GD-04","MZD-04"],"–Ω–∞–¥–º–µ–Ω–Ω—ã–π":["GD-04","MZD-04"],"—à–∫—É—Ä–µ":["GD-04","MZD-04"],"—Ä–∂–∞–≤–æ–π":["GD-04","MZD-04"],"—Ä—è–¥–æ–º":["GD-04","MZD-04"],"–º—ã—à—å":["GD-04","MZD-04"],"–¥—Ä–æ–∂–∏—Ç":["GD-04","MZD-04"],"—Å—Ä–µ–¥—å":["GD-04","MZD-04"],"–ø–∞—É—Ç–∏–Ω":["GD-04","MZD-04"],"–Ω–æ—á–Ω–æ–º":["GD-04","MZD-04"],"–∫–ª—É–±–µ":["GD-04","MZD-04"],"–ø–µ—Ä–µ–¥":["GD-04","MZD-04"],"–æ–±–ª–∞–≤–æ–π":["GD-04","MZD-04"],"–∫–ª—É–±–æ–∫":["GD-04","MZD-04"],"–∏–Ω—Ç—Ä–∏–≥":["GD-04","MZD-04"],"–∏—â–µ—Ç":["GD-04","GD-07","MZD-04","MZD-07"],"–≤—ã–≥–æ–¥—É":["GD-04","MZD-04"],"—Å–≤–æ—é":["GD-04","GD-11","MZD-04","MZD-11","OS-06"],"—É—Å–∞–º–∏":["GD-04","MZD-04"],"—á—É–µ—Ç":["GD-04","MZD-04"],"–∑–∞–ø–∞–¥–Ω—é":["GD-04","MZD-04"],"–∫–æ—Ç—è—Ä–∞":["GD-04","MZD-04"],"–∫–æ–≥—Ç–∏":["GD-04","MZD-04","OS-09"],"—Ç–æ—á–∏—Ç":["GD-04","GD-07","MZD-04","MZD-07"],"–æ–±–µ–¥":["GD-04","MZD-04"],"—à–∏–ø–∏—Ç":["GD-04","MZD-04"],"–∑–ª–æ–±—ã":["GD-04","MZD-04"],"–∂–¥–µ—Ç":["GD-04","GD-07","GD-09","GD-13","MZD-04","MZD-07","MZD-09","MZD-13","OS-06","OS-09","OS-13","OS-15"],"–º–æ–º–µ–Ω—Ç":["GD-04","GD-14","MZD-04","MZD-14","OS-02","OS-10","OS-14"],"—Ä–∞–∑–±–µ—Ä–µ—à—å":["GD-04","MZD-04"],"–≤—Ä–∞–∂–¥–∞":["GD-04","MZD-04"],"–Ω–∞–≤–µ–∫–∏":["GD-04","MZD-04","OS-03"],"—Ä–æ–∫":["GD-04","MZD-04","MZD-15","MZD-16"],"–∑–¥–µ—Å—å":["GD-04","GD-11","GD-12","GD-14","MZD-04","MZD-11","MZD-12","MZD-14","OS-14"],"–Ω–µ–º–Ω–æ–≥–æ":["GD-04","MZD-04"],"–ø—Å–∏—Ö":["GD-04","MZD-04"],"–∂–∞–∂–¥–µ—Ç":["GD-04","MZD-04"],"–∫—Ä–æ–≤—å—é":["GD-04","MZD-04"],"—Å–≤–æ–π":["GD-04","GD-07","GD-08","GD-14","MZD-04","MZD-07","MZD-08","MZD-14","MZD-15","OS-13"],"–∫—É—Å–æ–∫":["GD-04","MZD-04"],"—Å–∫–∞–∂–∏":["GD-04","GD-08","MZD-04","MZD-08"],"–º–∏–ª–æ—Å—Ç—å":["GD-04","MZD-04"],"–¥—Ä—É–≥":["GD-04","GD-10","MZD-04","MZD-10","OS-07"],"–¥—Ä—É–≥–∞":["GD-04","MZD-04","OS-07"],"–Ω–µ–Ω–∞–≤–∏–¥—è—Ç":["GD-04","MZD-04"],"–ª—é—Ç–æ":["GD-04","MZD-04"],"–æ–≥–Ω–µ":["GD-04","MZD-04"],"–∑–∞–ª–æ–∂–Ω–∏–∫–∏":["GD-04","MZD-04"],"–¥—É—Ä–Ω–æ–≥–æ":["GD-04","MZD-04"],"–ø–ª—É—Ç–∞":["GD-04","MZD-04"],"–∏–Ω—Å—Ç–∏–Ω–∫—Ç":["GD-04","MZD-04"],"—Ü–µ–ø—å":["GD-04","GD-09","MZD-04","MZD-09"],"—Å—Ç–∞–ª—å–Ω–∞—è":["GD-04","MZD-04"],"–∑–∞–∫–æ–≤–∞–Ω":["GD-04","MZD-04"],"—Ä–∞–∑—É–º":["GD-04","GD-05","GD-06","MZD-04","MZD-05","MZD-06"],"—Ç—É–ø–æ":["GD-04","MZD-04"],"–ø–æ–∫–æ–ª–µ–Ω–∏—è":["GD-04","MZD-04"],"—á–µ—Ä–Ω–æ–π":["GD-04","MZD-04"],"–Ω–∏—Ç—å—é":["GD-04","MZD-04"],"–∫—Ä–æ–≤–∏":["GD-04","MZD-04","OS-08"],"–≤—å–µ—Ç—Å—è":["GD-04","MZD-04"],"–∏–º":["GD-04","GD-08","MZD-04","MZD-08"],"–±—ã":["GD-04","GD-08","MZD-04","MZD-08","OS-01","OS-03","OS-06","OS-07"],"—Å–æ–±—Ä–∞—Ç—å—Å—è":["GD-04","MZD-04"],"—Å–µ—Å—Ç—å":["GD-04","MZD-04"],"—Å—Ç–æ–ª":["GD-04","MZD-04"],"–ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å":["GD-04","MZD-04"],"–∑–∞–±—ã–≤":["GD-04","GD-06","GD-08","MZD-04","MZD-06","MZD-08","OS-11"],"–ø—Ä–æ":["GD-04","GD-06","GD-11","GD-14","MZD-04","MZD-06","MZD-11","MZD-14","OS-14"],"–∑–ª–æ–±—É":["GD-04","MZD-04"],"–≤–∏–¥–∏—Ç":["GD-04","GD-10","MZD-04","MZD-10"],"—Å–æ–±–æ–π":["GD-04","MZD-04","OS-12"],"–º—ã—à–∏–Ω—ã–π":["GD-04","MZD-04"],"–∫–æ—Ä–º":["GD-04","MZD-04"],"–∫–æ—Ç–µ":["GD-04","MZD-04"],"—Å–º–µ—Ä—Ç–µ–ª—å–Ω—É—é":["GD-04","MZD-04"],"—É–≥—Ä–æ–∑—É":["GD-04","MZD-04"],"–≤—á–µ—Ä–∞—à–Ω–∏–π":["GD-04","GD-14","MZD-04","MZD-14"],"–∫—Ä–∏–∫":["GD-04","GD-10","MZD-04","MZD-10"],"—É–º–æ–ª–∫":["GD-04","MZD-04"],"–≤–µ—Å—å":["GD-04","GD-05","GD-06","GD-11","GD-13","MZD-04","MZD-05","MZD-06","MZD-11","MZD-13"],"–ø—Ä–æ–≥–Ω–∏–ª":["GD-04","MZD-04"],"–≤–¥–æ–ª—å":["GD-04","MZD-04"],"–ø–æ–ø–µ—Ä–µ–∫":["GD-04","MZD-04"],"–ø–æ–º–æ–π–∫–µ":["GD-04","MZD-04"],"—Ü–µ–Ω–Ω–æ—Å—Ç–µ–π":["GD-04","MZD-04"],"–ª–µ–∂–∏—Ç":["GD-04","MZD-04"],"–º–µ—à–æ–∫":["GD-04","MZD-04"],"–≥–µ–Ω–∞—Ö":["GD-04","MZD-04"],"–ø–æ—Å–µ—è–Ω":["GD-04","MZD-04"],"–ø—Ä–æ—á–Ω–æ":["GD-04","MZD-04"],"–∑–∞–±—ã—Ç—å":["GD-04","GD-10","MZD-04","MZD-10"],"–æ–±–∏–¥—ã":["GD-04","GD-11","MZD-04","MZD-11","OS-14"],"—Å–ª–æ–∂–Ω–æ":["GD-04","MZD-04"],"–≤—Å–µ–º":["GD-04","GD-06","GD-08","GD-13","MZD-04","MZD-06","MZD-08","MZD-13","MZD-16","OS-08"],"—É–º–æ–º":["GD-04","MZD-04"],"—É—Ç–∏—Ö–∞–µ—Ç":["GD-04","MZD-04"],"–±—É–¥—Ç–æ":["GD-04","GD-14","MZD-04","MZD-14","OS-10"],"—Å–æ–≤–µ—Å—Ç—å":["GD-04","GD-11","GD-12","MZD-04","MZD-11","MZD-12"],"–≤—ã–∂–≥–ª–∏":["GD-04","MZD-04"],"—É—Ç—é–≥–æ–º":["GD-04","MZD-04"],"—Å–µ–≥–æ–¥–Ω—è":["GD-04","GD-14","MZD-04","MZD-14"],"—Ç–∏—à—å":["GD-04","MZD-04"],"–¥–∞":["GD-04","MZD-04","OS-08","OS-14"],"–≥–ª–∞–¥—å":["GD-04","MZD-04"],"–Ω–µ–∫–æ–≥–æ":["GD-04","MZD-04"],"–≤–∏–Ω–∏—Ç—å":["GD-04","MZD-04"],"–Ω–µ—á–µ–≥–æ":["GD-04","MZD-04"],"–∏—Å–∫–∞—Ç—å":["GD-04","MZD-04"],"–≤–∏—Ç—Ä–∏–Ω–µ":["GD-04","MZD-04"],"–º–∏—à—É—Ä–∞":["GD-04","MZD-04"],"—Å–µ—Ä–¥—Ü–∞—Ö":["GD-04","MZD-04"],"–∑–ª–æ–±–∞":["GD-04","MZD-04"],"—Ö–∞–Ω–¥—Ä–∞":["GD-04","MZD-04"],"–∑–∞–±—ã–ª–∏":["GD-04","GD-06","GD-11","MZD-04","MZD-06","MZD-11"],"—Ç–∞–∫–æ–µ":["GD-04","MZD-04"],"–∂–∏—Ç—å":["GD-04","MZD-04"],"–Ω–∞–º":["GD-04","GD-05","GD-07","GD-12","MZD-04","MZD-05","MZD-07","MZD-12","OS-10","OS-14"],"–≥—Ä—ã–∑—Ç—å":["GD-04","MZD-04"],"–±–ª–∏–∂–Ω–µ–≥–æ":["GD-04","MZD-04"],"–∫—Ä—É—à–∏—Ç—å":["GD-04","MZD-04"],"–≤–∫–ª—é—á–µ–Ω–æ":["GD-05","MZD-05"],"–ª–µ–Ω–∏–≤—ã–π":["GD-05","MZD-05"],"—Ä–∞–π":["GD-05","MZD-05"],"—Ç–µ–±—è":["GD-05","GD-12","MZD-05","MZD-12","OS-03","OS-10","OS-13","OS-14","OS-15"],"–º–∞–Ω–∏—Ç":["GD-05","MZD-05"],"–º–µ–¥–ª–µ–Ω–Ω–æ":["GD-05","GD-10","MZD-05","MZD-10"],"–ø–ª–µ–Ω–∏—Ç":["GD-05","GD-13","MZD-05","MZD-13"],"–ø–ª–∞—Ç–∏–º":["GD-05","MZD-05"],"—Ä–µ—à–∞–ª–∏":["GD-05","MZD-05"],"—Å–≤–æ–±–æ–¥—É":["GD-05","MZD-05","OS-11"],"–∏—Ç–æ–≥":["GD-05","GD-07","MZD-05","MZD-07"],"—É–∫—Ä–∞–ª–∏":["GD-05","MZD-05"],"–∫–∞–∂–¥—ã–º":["GD-05","MZD-05","OS-08"],"–≤–¥–æ—Ö–æ–º":["GD-05","MZD-05"],"—É–º–Ω—ã–π":["GD-05","MZD-05"],"—Å–ª–∏–≤–∞–µ—Ç":["GD-05","MZD-05"],"–¥–∞–Ω–Ω—ã–µ":["GD-05","MZD-05"],"–º–æ–∑–≥–∏":["GD-05","MZD-05"],"–≤—ã–∫–ª—é—á–µ–Ω—ã":["GD-05","MZD-05"],"–æ—á–Ω–∏—Å—å":["GD-05","MZD-05"],"–ø—Ä–æ—Å–Ω–∏—Å—å":["GD-05","MZD-05"],"–º–æ–≥–∏–ª—ã":["GD-05","MZD-05"],"–≤—ã–±–µ—Ä–∏—Å—å":["GD-05","MZD-05"],"–∫–ª–µ—Ç–∫—É":["GD-05","MZD-05"],"–∫–æ–º—Ñ–æ—Ä—Ç–∞":["GD-05","MZD-05"],"–∑–∞–º–∞–Ω–∏–ª–∏":["GD-05","MZD-05"],"–ø—Ä–æ–¥–ª–∏":["GD-05","MZD-05"],"–ø–æ–¥–ø–∏—Å–∫—É":["GD-05","MZD-05"],"–ø–æ–∫–∞":["GD-05","GD-07","GD-14","MZD-05","MZD-07","MZD-14"],"–æ—Ç–∫–ª—é—á–∏–ª–∏":["GD-05","MZD-05"],"–ø–æ–≥–∞—Å–Ω–µ—Ç":["GD-05","MZD-05"],"—ç–∫—Ä–∞–Ω":["GD-05","MZD-05"],"–ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—Å—è":["GD-05","MZD-05"],"–æ–±–º–∞–Ω":["GD-05","GD-11","MZD-05","MZD-11","OS-07","OS-09"],"—Å—Ç–∞–Ω–µ–º":["GD-05","MZD-05"],"—Å—Ç–µ—Ä—Ç—ã–µ":["GD-05","MZD-05"],"–ø—Ä–∞—Ö":["GD-05","MZD-05"],"–æ—à–∏–±–∫–æ–π":["GD-05","MZD-05"],"—Å–∏—Å—Ç–µ–º—ã":["GD-05","MZD-05"],"–ø—Ä–∏–∑–Ω–∞—é—Ç":["GD-05","MZD-05"],"—Å—É–¥–∞—Ö":["GD-05","MZD-05"],"–æ—Ç–º–µ–Ω–∏—Ç—å":["GD-05","MZD-05"],"—Ç—Ä—É–¥–Ω–æ":["GD-05","MZD-05"],"—É–∫–∞–∑":["GD-05","MZD-05"],"—Å–ª–∏—Ç–æ":["GD-05","MZD-05"],"–ø—Ä–∏–≤–µ—Ç":["GD-05","MZD-05"],"—Ü–∏—Ñ—Ä–æ–≤–æ–π":["GD-05","MZD-05"],"—É–Ω–∏—Ç–∞–∑":["GD-05","MZD-05"],"–ø—Ä–µ–¥—Å—Ç–∞–≤—å":["GD-05","MZD-05"],"–≥–∏–≥–∞–Ω—Ç—Å–∫–∏–π":["GD-05","MZD-05"],"–æ—Ç–µ–ª—å":["GD-05","MZD-05"],"—Ä–∞—Å—Å–≤–µ—Ç":["GD-05","GD-08","MZD-05","MZD-08","OS-09"],"—Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é":["GD-05","MZD-05"],"–ª—é–±–æ–≤—å":["GD-05","GD-08","GD-09","GD-10","GD-12","GD-13","MZD-05","MZD-08","MZD-09","MZD-10","MZD-12","MZD-13","MZD-15","OS-08","OS-10","OS-11","OS-14"],"—á–µ—Ä–µ–∑":["GD-05","GD-12","MZD-05","MZD-12","OS-02","OS-06"],"—à—Ç—Ä–∞—Ñ–Ω–æ–π":["GD-05","MZD-05"],"—Å—á–µ—Ç":["GD-05","MZD-05"],"–¥–æ–∂–¥—å":["GD-05","GD-09","MZD-05","MZD-09","OS-12"],"—Ç–æ–ª—å–∫–æ":["GD-05","GD-08","GD-09","GD-11","GD-14","MZD-05","MZD-08","MZD-09","MZD-11","MZD-14","OS-04","OS-08","OS-11"],"–¥–µ—Å—è—Ç–∏":["GD-05","MZD-05"],"–æ–¥–∏–Ω–Ω–∞–¥—Ü–∞—Ç–∏":["GD-05","MZD-05"],"—Å–º–µ—Ö":["GD-05","GD-13","MZD-05","MZD-13"],"–∫—É–ø–æ–Ω–∞–º":["GD-05","MZD-05"],"—Å–º–µ—Ä—Ç—å":["GD-05","GD-07","MZD-05","MZD-07","OS-04","OS-11"],"–æ–ø—Ü–∏—è":["GD-05","MZD-05"],"–ø–∞–∫–µ—Ç–∞":["GD-05","MZD-05"],"–±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å":["GD-05","MZD-05"],"—à–µ—Å—Ç—å—Å–æ—Ç":["GD-05","MZD-05"],"—à–µ—Å—Ç—å–¥–µ—Å—è—Ç":["GD-05","MZD-05"],"—à–µ—Å—Ç—å":["GD-05","MZD-05"],"–º–µ—Å—è—Ü":["GD-05","MZD-05"],"—Å–º–µ–Ω–∏":["GD-05","MZD-05"],"–æ—Å—Ç–∞–Ω–æ–≤–∏—Å—å":["GD-05","GD-11","MZD-05","MZD-11"],"–∂–∏–∑–Ω–∏":["GD-05","GD-07","GD-09","MZD-05","MZD-07","MZD-09","OS-11","OS-15"],"–ª–∏—à–∏–ª–∏":["GD-05","MZD-05"],"—á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–æ":["GD-05","MZD-05"],"–æ—Ü–∏—Ñ—Ä–æ–≤–∞–ª–∏":["GD-05","MZD-05"],"–∏–Ω—Ç–µ—Ä–µ—Å":["GD-05","MZD-05"],"–ª–∏–∑–∞–ª–∏":["GD-05","MZD-05"],"—Ç–µ—Ö":["GD-05","GD-09","MZD-05","MZD-09","OS-04","OS-06","OS-13"],"–ø–æ—Ä":["GD-05","MZD-05"],"–¥–µ–Ω—å–≥–∏":["GD-05","GD-08","MZD-05","MZD-08","OS-01"],"—Å–∫–∞—á–∞–ª–∏":["GD-05","MZD-05"],"–≤—ã—Ä–≤–∞—Ç—å":["GD-06","MZD-06"],"–∑–µ–º–ª—é":["GD-06","MZD-06"],"–∫–æ–ø–∞–µ–º":["GD-06","MZD-06"],"—Å—Ä—É–±–∞–µ–º":["GD-06","MZD-06"],"–ª–µ—Å–∞":["GD-06","MZD-06"],"–±–æ–≥–∞—Ç—Å—Ç–≤–∞":["GD-06","MZD-06"],"–∑–µ–º–Ω—ã–µ":["GD-06","MZD-06"],"—É–π–¥—É—Ç":["GD-06","MZD-06"],"—Å–ª–µ–¥–∞":["GD-06","MZD-06"],"–≤–ø–µ—Ä–µ–¥":["GD-06","MZD-06"],"—É—Å—Ç—Ä–µ–º–∏–ª–∏—Å—å":["GD-06","MZD-06"],"—Å–ª–µ–ø–æ–π":["GD-06","GD-12","MZD-06","MZD-12"],"—á–µ—Ä–µ–¥–æ–π":["GD-06","MZD-06"],"–Ω–∞–Ω–æ—Å–∏–º":["GD-06","MZD-06"],"–ø–ª–∞–Ω–µ—Ç–µ":["GD-06","GD-11","MZD-06","MZD-11"],"—É–¥–∞—Ä":["GD-06","MZD-06"],"—Ä–æ–∫–æ–≤–æ–π":["GD-06","MZD-06"],"–Ω–∞—à":["GD-06","MZD-06","MZD-16"],"—à–≤–∞–º":["GD-06","MZD-06"],"—Ç—Ä–µ—â–∏—Ç":["GD-06","MZD-06"],"–¥—Ä—É–≥–æ–π":["GD-06","GD-07","GD-11","MZD-06","MZD-07","MZD-11","OS-13","OS-15"],"–∑–≤–µ–∑–¥–µ":["GD-06","MZD-06"],"—Å–æ–ª–Ω—Ü–∞":["GD-06","GD-08","GD-13","GD-14","MZD-06","MZD-08","MZD-13","MZD-14"],"—á–µ–ª–æ–≤–µ–∫—É":["GD-06","MZD-06"],"–º–æ–∂–Ω–æ":["GD-06","MZD-06","OS-03","OS-10"],"–¥–æ—Ä–≤–∞–ª–∏—Å—å":["GD-06","MZD-06"],"–∑–≤–µ–∑–¥":["GD-06","MZD-06","OS-08"],"–≤–æ–∑–º–æ–∂–Ω–æ":["GD-06","MZD-06"],"–æ–ø–∞—Å–Ω–µ–π":["GD-06","MZD-06"],"—Å—Ç—Ä–∞—à–Ω–µ–π":["GD-06","MZD-06","OS-06"],"–±–µ–∑–±–æ–∂–Ω–µ–π":["GD-06","MZD-06"],"—Ç–∞":["GD-06","MZD-06","OS-14"],"–ø—Ä–µ–¥–µ–ª":["GD-06","MZD-06"],"–∫–æ–Ω—á–∞–µ—Ç—Å—è":["GD-06","MZD-06"],"–∫–ª–æ–Ω–∏—Ä—É–µ–º":["GD-06","MZD-06"],"–∏–≥—Ä–∞–µ–º":["GD-06","MZD-06"],"–±–æ–≥–∞":["GD-06","MZD-06"],"–≤–Ω–æ—Å—è":["GD-06","MZD-06"],"–¥–Ω–∫":["GD-06","MZD-06"],"—á—É–∂–µ—Ä–æ–¥–Ω—ã–µ":["GD-06","MZD-06"],"–∫–æ–¥—ã":["GD-06","MZD-06"],"–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π":["GD-06","MZD-06"],"—Ä–µ—à–∞–µ—Ç":["GD-06","MZD-06"],"–º–æ—Ä–∞–ª—å":["GD-06","MZD-06"],"–∫–æ–Ω–µ—Ü":["GD-06","MZD-06"],"–≤—ã—á–∏—Å–ª—è–µ—Ç":["GD-06","MZD-06"],"–º–µ–Ω—è–µ–º":["GD-06","MZD-06"],"–ø–æ–≥–æ–¥—É":["GD-06","MZD-06"],"–≤–µ—Ç—Ä–∞–º–∏":["GD-06","MZD-06"],"–∫–ª–∏–º–∞—Ç":["GD-06","MZD-06"],"–ø–ª–∞–Ω–µ—Ç—ã":["GD-06","MZD-06"],"–∫–∞–ª–µ—á–∏–º":["GD-06","MZD-06"],"—Ä—É–∫–∞–º–∏":["GD-06","MZD-06"],"–º–µ—Ä—É":["GD-06","MZD-06"],"–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–∏":["GD-06","MZD-06"],"—Ç–æ–Ω–µ–º":["GD-06","MZD-06"],"–ø–æ–≤–µ—Ä–∏–ª–∏":["GD-06","MZD-06"],"–∫–æ–Ω—Ç—Ä–æ–ª–µ–º":["GD-06","MZD-06"],"—Ä–≤–µ–º—Å—è":["GD-06","MZD-06"],"–≥–æ—Å–ø–æ–¥—Å—Ç–≤—É":["GD-06","MZD-06"],"—Ü–∞—Ä–∏":["GD-06","MZD-06"],"–∫–æ—Ä–æ–Ω—ã":["GD-06","MZD-06"],"—Å–ª—ã—à–∏–º":["GD-06","GD-11","MZD-06","MZD-11"],"–ø—Ä–∏—Ä–æ–¥—ã":["GD-06","GD-08","GD-13","MZD-06","MZD-08","MZD-13"],"–≥—Ä–æ–∑–Ω—ã–µ":["GD-06","MZD-06"],"—Å—Ç–æ–Ω—ã":["GD-06","MZD-06"],"–º–∏—Ä–æ–º":["GD-06","MZD-06"],"—Ö–æ—Ç–∏–º":["GD-06","MZD-06"],"—É–ø—Ä–∞–≤–ª—è—Ç—å":["GD-06","MZD-06"],"–Ω–∞–¥–æ":["GD-06","GD-11","MZD-06","MZD-11","OS-08","OS-10"],"—Å–ø–æ—Å–æ–±–Ω—ã":["GD-06","MZD-06"],"–æ—Ç–Ω—è—Ç—å":["GD-06","MZD-06","OS-01"],"–±—É–¥–µ–º":["GD-07","MZD-07","OS-08","OS-12"],"—á–∏–Ω–æ–≤–Ω–∏–∫":["GD-07","MZD-07"],"—Ç–æ–ª—Å—Ç—ã–π":["GD-07","MZD-07"],"–∂–∞–¥–Ω–æ":["GD-07","MZD-07"],"–∞–∫—Ç–∏–≤":["GD-07","MZD-07"],"–±–µ–¥–Ω—è–∫":["GD-07","MZD-07","OS-02"],"–∑–∞–ø–ª–∞–∫–∞–ª":["GD-07","MZD-07"],"—Ö–ª–µ–±":["GD-07","MZD-07"],"–ø—Ä–æ–≥–ª–æ—Ç–∏–≤":["GD-07","MZD-07"],"–≤–æ—Ä—á–∏—Ç":["GD-07","MZD-07"],"–∫—Ä—è—Ö—Ç–∏—Ç":["GD-07","MZD-07"],"–∑–æ–ª–æ—Ç–æ–º":["GD-07","MZD-07","OS-07"],"—Ç–æ–ª—á–∫–µ":["GD-07","MZD-07"],"–¥–æ–ª–≥–∞—Ö":["GD-07","MZD-07"],"—É—Ç–æ–ø":["GD-07","MZD-07"],"—É—à–∏":["GD-07","MZD-07"],"–¥–µ—Ä–º–µ":["GD-07","MZD-07"],"—Å—Ç—É—á–∏—Ç":["GD-07","MZD-07"],"–±–æ–π":["GD-07","MZD-07"],"—Å–≤–µ—á–∞":["GD-07","MZD-07"],"—É–ø–æ–∫–æ–π":["GD-07","MZD-07"],"–±–æ–≥–∞—Ç—ã–π":["GD-07","MZD-07"],"–±–µ–¥–Ω—ã–π":["GD-07","MZD-07","OS-02"],"—Ñ–∏–Ω–∞–ª":["GD-07","GD-11","MZD-07","MZD-11","OS-06"],"–≤—Å–µ—Ö":["GD-07","GD-12","GD-13","MZD-07","MZD-12","MZD-13","MZD-15","OS-13","OS-14"],"–ª—é–±–∏–ª":["GD-07","MZD-07"],"—Å—Ç—Ä–∞–¥–∞–ª":["GD-07","MZD-07"],"–≤—Ä–µ–º—è":["GD-07","GD-09","GD-10","MZD-07","MZD-09","MZD-10","OS-11","OS-12","OS-14"],"–≤–±–∏–≤–∞–µ—Ç":["GD-07","MZD-07"],"–∫–ª–∏–Ω":["GD-07","MZD-07"],"—ç—Ç–æ–π":["GD-07","GD-10","MZD-07","MZD-10"],"—Ç—å–º–µ":["GD-07","MZD-07","OS-05","OS-11"],"—Å–≤–µ—Ç":["GD-07","GD-08","GD-13","GD-14","MZD-07","MZD-08","MZD-13","MZD-14","OS-01","OS-08"],"—Ö–æ—á–µ—à—å":["GD-07","MZD-07","OS-03"],"–ø–æ—ç—Ç":["GD-07","MZD-07"],"–±–µ–∑—É–º–Ω—ã–π":["GD-07","MZD-07"],"—Å—Ç—Ä–æ—á–∏—Ç":["GD-07","MZD-07"],"–Ω–æ—á—å—é":["GD-07","MZD-07","OS-02"],"—Å—Ç–∏—Ö":["GD-07","MZD-07"],"–ø—Ä–æ—Ö–æ–∂–∏–π":["GD-07","MZD-07"],"–ø—å—è–Ω—ã–π":["GD-07","MZD-07"],"–¥–µ—Ç–µ–π":["GD-07","MZD-07"],"–ø—Ä–∏—é—Ç":["GD-07","MZD-07"],"–ø–æ—Ä—ã–≤–µ":["GD-07","MZD-07"],"–≤–∞–ª–∏—Ç":["GD-07","MZD-07"],"–º—É—Å–æ—Ä":["GD-07","GD-08","MZD-07","MZD-08"],"–¥—Ä—É–≥–∏—Ö":["GD-07","MZD-07"],"–¥—Ä—É–≥–æ–º—É":["GD-07","MZD-07"],"–ø–∞–º—è—Ç–Ω–∏–∫":["GD-07","MZD-07"],"–ø—Ä–∏":["GD-07","MZD-07"],"–æ—Ç–æ–ª—å—é—Ç":["GD-07","MZD-07"],"—É–º—ã":["GD-07","MZD-07"],"—Å—Ç–∞–≤—è—Ç":["GD-07","MZD-07","OS-07"],"—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã":["GD-07","MZD-07"],"–ª–æ—Ä–¥—ã":["GD-07","MZD-07"],"—Ä–∞–∑–¥–µ–ª—è—Ç":["GD-07","MZD-07"],"–∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç—ã":["GD-07","MZD-07"],"–∂–∏—Ä—É–µ—Ç":["GD-07","MZD-07"],"–±–µ—Å":["GD-07","MZD-07"],"–ø—Ä–æ—â–∞–Ω—å–µ":["GD-07","MZD-07","OS-04"],"–ø–∞–ø–µ—Ä—Ç–∏":["GD-07","MZD-07"],"—Ç–æ–ª–ø–∞":["GD-07","MZD-07"],"–ø–æ–¥–∞—è–Ω—å–µ":["GD-07","MZD-07"],"–∫—É–∫–ª—ã":["GD-07","GD-10","MZD-07","MZD-10"],"—Ç–≤–æ—Ä—Ü—ã":["GD-07","MZD-07"],"—Å—É–¥—å–±—ã":["GD-07","MZD-07","OS-05","OS-10"],"—Å–µ–π—á–∞—Å":["GD-07","GD-14","MZD-07","MZD-14","OS-03"],"–ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω":["GD-07","MZD-07"],"–∏–ª—å":["GD-07","MZD-07"],"–≤—ã–±–æ—Ä":["GD-07","MZD-07"],"–¥–∞—Ä":["GD-07","MZD-07","OS-08"],"—Ñ–∞—Ä—Å":["GD-07","MZD-07"],"–ø—Ä–∏–µ–º–ª–µ—Ç":["GD-07","MZD-07"],"—Ä–∞–∑–±–∏—Ä–∞—è":["GD-07","MZD-07"],"–¥–æ—Ä–æ–≥":["GD-07","MZD-07"],"–±–ª–µ—Å–∫":["GD-07","MZD-07"],"–±–æ–≥–∞—Ç—ã—Ö":["GD-07","MZD-07"],"–∫–æ–ª–µ—Å–Ω–∏—Ü":["GD-07","MZD-07"],"–±–µ—Å—Å–º–µ—Ä—Ç–Ω—ã—Ö":["GD-07","MZD-07"],"–∑–∞–ø–∏—Å–∞–Ω":["GD-07","MZD-07"],"–ø–æ–¥–ø–∏—Å–∞–Ω":["GD-07","MZD-07"],"—Å–ø–∏—Å–∞–Ω":["GD-07","MZD-07"],"—Ü–≤–µ—Ç—ã":["GD-08","MZD-08","MZD-15"],"–∫–æ—Ä–Ω—è–º–∏":["GD-08","MZD-08"],"–≤—ã—Ä—ã–≤–∞–µ–º":["GD-08","MZD-08"],"–±—É–∫–µ—Ç":["GD-08","MZD-08"],"—Å—Ç—Ä–∞—Å—Ç—å":["GD-08","MZD-08"],"–∏–∑–º–µ—Ä–∏—Ç—å":["GD-08","MZD-08"],"–º–µ—á—Ç—ã":["GD-08","MZD-08","OS-05","OS-08","OS-14"],"–º–æ–º–µ–Ω—Ç–µ":["GD-08","MZD-08"],"—Å—á–∞—Å—Ç—å—è":["GD-02","GD-08","GD-12","MZD-08","MZD-12","OS-14"],"—É—Ç–æ–ø–∞–µ–º":["GD-08","MZD-08"],"–ª–µ–ø–µ—Å—Ç–∫–∞—Ö":["GD-08","MZD-08"],"–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ":["GD-08","MZD-08"],"–ø—Ä–æ—á–ª–∞":["GD-08","MZD-08"],"–ø–æ–º–Ω–∏—à—å":["GD-08","MZD-08"],"–ø–æ–ª–µ":["GD-08","MZD-08","OS-12"],"—à–∏—Ä—å":["GD-08","MZD-08"],"–Ω–µ–±–µ—Å":["GD-08","MZD-08","OS-15"],"–∫—Ä–∞—è":["GD-08","MZD-08","OS-11"],"—à–µ–ø–æ—Ç":["GD-08","MZD-08"],"—Ç—Ä–∞–≤":["GD-08","MZD-08"],"–≤–µ—Ç—Ä—É":["GD-08","MZD-08","OS-13"],"–≤—Ç–æ—Ä—è—Ç":["GD-08","MZD-08"],"–ª–∞–¥":["GD-08","MZD-08"],"–æ–∂–∏–¥–∞–Ω—å—è":["GD-08","MZD-08"],"–≤–æ—Å—Ç–æ—Ä–≥":["GD-08","MZD-08"],"–ø—Ä–æ—Å—Ç–æ–π":["GD-08","MZD-08"],"—á–∏—Å—Ç—ã–π":["GD-08","MZD-08"],"–≥—É–±–∏—Ç—å":["GD-08","MZD-08"],"–∏—Ö":["GD-08","MZD-08","OS-02","OS-12","OS-15"],"–∫—Ä–∞—Å–æ—Ç–∞":["GD-08","GD-13","MZD-08","MZD-13"],"–ª–µ–∫–∞—Ä—Å—Ç–≤–æ":["GD-08","MZD-08"],"–¥–µ—Ç–∏":["GD-08","MZD-08"],"—Ö—Ä—É–ø–∫–∏–µ":["GD-08","MZD-08"],"—Å–æ–∑–¥–∞–Ω—å—è":["GD-08","MZD-08"],"—Ç–æ–Ω–∫–∞—è":["GD-08","MZD-08"],"—Å—Ç—Ä—É–Ω–∞":["GD-08","MZD-08"],"—Å—Ç–æ–∏—Ç":["GD-08","MZD-08"],"—Ä–≤–∞—Ç—å":["GD-08","MZD-08"],"—Ä–∞–¥–∏":["GD-08","MZD-08"],"–æ–ø—Ä–∞–≤–¥–∞–Ω—å—è":["GD-08","MZD-08"],"–≤–µ–¥—å":["GD-08","MZD-08","OS-02","OS-08","OS-10"],"—Å—Ç–µ–±–ª–µ":["GD-08","MZD-08"],"–º—É–∑—ã–∫–∞":["GD-08","MZD-08"],"—Å–ª—ã—à–Ω–∞":["GD-08","MZD-08"],"—Ä–∞–Ω–∞":["GD-08","MZD-08"],"–Ω–æ–µ—Ç":["GD-08","MZD-08"],"—Å–ª–æ–≤–æ":["GD-08","GD-13","MZD-08","MZD-13"],"–∑–∞—Å—Ç—Ä—è–ª–æ":["GD-08","MZD-08"],"–∫–æ–º–æ–∫":["GD-08","MZD-08"],"–∏–∑–≤–∏–Ω–∏":["GD-08","MZD-08"],"—Å–ø–æ—Ä–∏—Ç":["GD-08","MZD-08"],"–ø—Ä–æ—Å–∏—Ç":["GD-08","MZD-08"],"–º–æ–ª—á–∞":["GD-08","GD-10","MZD-08","MZD-10"],"–≥—É–±–∏":["GD-08","MZD-08"],"—Ç–µ":["GD-08","GD-10","GD-11","MZD-08","MZD-10","MZD-11","MZD-15"],"–∂–¥–∞–ª–∏":["GD-08","MZD-08"],"–≤–∞–∑–∞—Ö":["GD-08","MZD-08"],"–ø—Ä–∏—É–Ω—ã–ª–∏":["GD-08","MZD-08"],"–∑–∞–≤—è–ª–∏":["GD-08","MZD-08"],"–¥–æ–∂–¥–∞–≤—à–∏—Å—å":["GD-08","MZD-08"],"–Ω–µ–∂–Ω—ã—Ö":["GD-08","MZD-08","OS-15"],"—Ä—É–∫":["GD-08","MZD-08"],"–æ–¥–Ω–∏":["GD-08","MZD-08"],"–æ—Å—Ç–∞–ª–∏—Å—å":["GD-08","MZD-08"],"—Å–ª–æ–∂–∏–ª–∏":["GD-08","MZD-08"],"–Ω–∏—Ö":["GD-08","MZD-08"],"–∫—É–ø–∏–ª–∏":["GD-08","MZD-08"],"–≤–µ—Ä–Ω–µ—Ç":["GD-08","MZD-08"],"—É–≤–∏–¥–µ—Ç—å":["GD-08","MZD-08"],"–Ω–µ–∂–Ω–æ—Å—Ç—å":["GD-08","GD-13","MZD-08","MZD-13"],"—Ä—É—á—å—è":["GD-08","MZD-08"],"—Ä–∞–¥–æ—Å—Ç—å":["GD-08","GD-10","MZD-08","MZD-10","OS-11"],"—Ç–∏—Ö–∞—è":["GD-08","MZD-08"],"–ø–µ—á–∞–ª—å":["GD-08","GD-10","MZD-08","MZD-10","OS-15"],"–ø—Ä–µ–≤—Ä–∞—â–∞–π":["GD-08","MZD-08"],"–æ—Ä—É–¥–∏–µ":["GD-08","MZD-08"],"—Ä–∞–∑–ª—É–∫–∏":["GD-08","MZD-08"],"–ø–æ–¥–∞—Ä–∏":["GD-08","MZD-08"],"–ø—Ä–∏—á–∞–ª":["GD-08","MZD-08"],"–∂–µ":["GD-08","GD-10","GD-13","MZD-08","MZD-10","MZD-13","OS-02","OS-07","OS-08"],"–≥—É–±–∏–º":["GD-08","MZD-08"],"–∫—Ä–∞—Å–æ—Ç—É":["GD-08","MZD-08"],"–≤—ã—Ä–∞–∑–∏—Ç—å":["GD-08","MZD-08"],"—Ç—Ä–µ–ø–µ—Ç":["GD-08","MZD-08"],"–ø–æ—Ä—ã–≤":["GD-08","MZD-08"],"—á–µ–º":["GD-08","MZD-08"],"–ª–æ–≥–∏–∫–∞":["GD-08","MZD-08"],"–±—É–∫–µ—Ç–µ":["GD-08","MZD-08"],"—É–º–∏—Ä–∞–µ—Ç":["GD-08","MZD-08"],"—Ü–µ–ª—ã–π":["GD-08","MZD-08","OS-08"],"—Ç–∏—à–∏–Ω–∞":["GD-08","MZD-08"],"—Ç–∏—à–∏–Ω–µ":["GD-08","MZD-08"],"–±—ã—Ç–∏—è":["GD-08","MZD-08","OS-11"],"–≤—ã—Ä—ã–≤–∞–π":["GD-08","MZD-08"],"–∑–µ–º–ª–µ":["GD-08","MZD-08","OS-07","OS-10"],"–æ–¥–Ω–∞":["GD-08","MZD-08","OS-12","OS-13"],"—Å–µ–º—å—è":["GD-08","MZD-08"],"–ø–∞–º—è—Ç—å":["GD-09","MZD-09"],"–¥–Ω–µ–º":["GD-09","MZD-09","OS-08"],"—Ç—è–∂–∫–∏–π":["GD-09","MZD-09"],"–≥–Ω–µ—Ç":["GD-09","MZD-09"],"–¥–∞–≤–∏—Ç":["GD-09","GD-11","MZD-09","MZD-11"],"—Å–ø–µ—à–∞":["GD-09","MZD-09"],"–±–æ–ª—å—é":["GD-09","GD-14","MZD-09","MZD-14"],"–∂–∂–µ—Ç":["GD-09","MZD-09"],"—É—Ö–æ–¥–∏—Ç":["GD-09","MZD-09"],"–Ω–∏–∫—É–¥–∞":["GD-09","MZD-09"],"—Å—Ç—Ä–∞—à–Ω—ã–π":["GD-09","MZD-09"],"–º–∏–≥":["GD-09","GD-14","MZD-09","MZD-14","OS-13","OS-15"],"–æ—Å—Ç—Ä—ã–π":["GD-09","MZD-09"],"–Ω–æ–∂":["GD-09","MZD-09"],"–≤—Ä–µ–∑–∞–Ω":["GD-09","MZD-09"],"—Å–∞–º":["GD-09","GD-10","GD-11","MZD-09","MZD-10","MZD-11","MZD-15","OS-03"],"—Å–µ–±–µ":["GD-09","GD-10","MZD-09","MZD-10","OS-04","OS-07"],"—Å–æ–ª–∂–µ—à—å":["GD-09","MZD-09"],"–≤—Å–ø–æ–º–Ω–∏—Ç—å":["GD-09","MZD-09"],"–Ω–∏–∫–æ–≥–¥–∞":["GD-09","MZD-09","OS-10"],"–º–µ—Å—Ç–µ":["GD-09","MZD-09"],"–ª–µ–¥":["GD-09","GD-14","MZD-09","OS-15"],"–≤–ø–∏–≤—à–∏–µ—Å—è":["GD-09","MZD-09"],"–≥–ª—É–±–∂–µ":["GD-09","MZD-09"],"–¥—É—à—É":["GD-09","GD-12","MZD-09","MZD-12"],"—Å–æ–ª—å":["GD-09","MZD-09"],"–æ—Å—Ç–∞–≤–∏–≤":["GD-09","MZD-09"],"—à—Ä–∞–º":["GD-09","GD-12","MZD-09","MZD-12"],"—É–º–Ω–æ–∂–∏–≤":["GD-09","MZD-09"],"–≤–º–µ—Å—Ç–æ":["GD-09","MZD-09","OS-02"],"—Å–Ω–∞":["GD-09","MZD-09","OS-04","OS-12"],"—Ö–æ–ª–æ–¥–Ω—ã–π":["GD-09","MZD-09","MZD-15"],"–ø–æ—Ç":["GD-09","MZD-09"],"–≤—Å–∫—Ä—ã–≤–∞–µ—Ç":["GD-09","MZD-09"],"–ø—Ä–æ—à–ª–æ–µ":["GD-09","GD-14","MZD-09","MZD-14"],"—Å–æ–∑–Ω–∞–Ω—å–µ":["GD-09","GD-11","MZD-09","MZD-11"],"—Ç–æ—Ç":["GD-09","GD-10","MZD-09","MZD-10","OS-09","OS-10"],"–ø—Ä–∏–º–µ—Ç":["GD-09","MZD-09"],"–ø–æ–π–º–µ—Ç":["GD-09","GD-10","MZD-09","MZD-10","OS-02"],"—Å–∫–≤–æ–∑—å":["GD-09","GD-11","GD-12","MZD-09","MZD-11","MZD-12","OS-13"],"–Ω–∞—Å–∫–≤–æ–∑—å":["GD-09","MZD-09"],"–ø—Ä–æ–π–¥–µ—Ç":["GD-09","MZD-09"],"–ø–ª–∞—á—É—Ç":["GD-09","MZD-09"],"–ø—Ä–æ–º–æ–∫—à–∏–π":["GD-09","MZD-09"],"–Ω–∞–∫—Ä—ã–ª–∞":["GD-09","MZD-09"],"–¥—Ä–æ–∂—å":["GD-09","MZD-09"],"–Ω–µ–º—ã—Ö":["GD-09","MZD-09"],"–æ–∫–æ–≤":["GD-09","MZD-09"],"–æ—Å–≤–æ–±–æ–∂–¥–∞—è":["GD-09","MZD-09"],"—Å–Ω–æ–≤":["GD-09","MZD-09","OS-11"],"–æ—Ç–∫—Ä–æ–µ—à—å":["GD-09","MZD-09"],"–¥–≤–µ—Ä–∏":["GD-09","MZD-09"],"–ø—Ä–æ—à–ª–æ–π":["GD-09","MZD-09"],"–Ω–∞–ø–æ–º–Ω–∏—Ç":["GD-09","MZD-09"],"—Ä–∞–∑—Ä—É—à–∞–ª–∞":["GD-09","MZD-09"],"–æ—Ç—Å—Ç–∞–Ω–µ—Ç":["GD-09","MZD-09"],"–ø–µ—Ä–µ—É–ª–∫–∞—Ö":["GD-09","MZD-09"],"–ø—Ä–µ—Å–ª–µ–¥—É–µ—Ç":["GD-09","MZD-09"],"–ø–∞–º—è—Ç–∏":["GD-09","MZD-09"],"—Å–Ω–æ–≤–∞":["GD-09","MZD-09","OS-09","OS-12"],"—Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã":["GD-09","MZD-09"],"–¥–æ—Å—Ç–∞–Ω–µ—Ç":["GD-09","MZD-09"],"–æ–º—É—Ç":["GD-09","MZD-09"],"–ø–µ—á–∞–ª–∏":["GD-09","MZD-09"],"–≥–æ–ª–æ–≤–æ–π":["GD-09","MZD-09","OS-09"],"—É–≤–ª–µ—á–µ—Ç":["GD-09","MZD-09"],"–º–Ω–æ–≥–æ":["GD-09","GD-12","MZD-09","MZD-12","OS-05","OS-07"],"–ª–µ—Ç":["GD-09","GD-11","MZD-09","MZD-11","OS-05"],"–≤–∑–¥—Ä–æ–≥–Ω—É—Ç—å":["GD-09","MZD-09"],"—Ä–∏—Å–∫–Ω–µ—Ç":["GD-09","MZD-09"],"—É—Ç—Ä–∞—Ç":["GD-09","MZD-09"],"—Ç—è–∂–∫–∏—Ö":["GD-09","MZD-09"],"–±–µ–¥":["GD-09","MZD-09","OS-08"],"–≤–µ—Ä—å":["GD-09","MZD-09"],"–º–∞—à–∞":["GD-10","MZD-10"],"–∂–∏–ª":["GD-10","MZD-10"],"–æ–±—ä—è—Ç–∏—è—Ö":["GD-10","MZD-10"],"–º–∞—à–∏":["GD-10","MZD-10"],"–∏–≥—Ä–∞–ª–∏":["GD-10","MZD-10"],"–≤–µ—Å–µ–ª–æ":["GD-10","MZD-10"],"–≤—Å–µ–π":["GD-10","MZD-10","OS-07"],"—Ñ–∞–ª—å—à–∏":["GD-10","MZD-10"],"–ø—Ä–∏–∂–∞–≤—à–∏—Å—å":["GD-10","MZD-10"],"–∫—Ä–µ–ø–∫–æ":["GD-10","MZD-10"],"–∑–∞—Å—ã–ø–∞–ª–∏":["GD-10","MZD-10"],"—Ç–∞–∫–æ–π":["GD-10","GD-13","MZD-10","MZD-13","OS-07"],"–≤—Å—Ç—Ä–µ—á–∞–ª–∏":["GD-10","MZD-10"],"–ø—Ä–æ–º—á–∞–ª–∏—Å—å":["GD-10","MZD-10"],"—Å–∫–∞–∑–∫–∞–º":["GD-10","MZD-10"],"–ª–µ—Ç–∞–ª–∏":["GD-10","MZD-10"],"–≤–æ":["GD-10","GD-13","MZD-10","MZD-13","MZD-15","OS-04","OS-08"],"—Å–Ω–∞—Ö":["GD-10","MZD-10","MZD-15"],"–∑–Ω–∞—è":["GD-10","MZD-10","OS-13"],"–¥–µ—Ç—Å–∫–∏—Ö":["GD-10","MZD-10"],"–≥—É–ª—è–ª–∏":["GD-10","MZD-10"],"—á–∞—Å–∞–º–∏":["GD-10","MZD-10"],"–∑–Ω–∞–ª–∏":["GD-10","MZD-10","OS-06"],"–±–µ–¥—ã":["GD-10","MZD-10"],"–±—ã—Å—Ç—Ä–æ":["GD-10","MZD-10","MZD-15","OS-02"],"—É—Ö–æ–¥—è—Ç":["GD-10","MZD-10"],"—Å—á–∞—Å—Ç–ª–∏–≤—ã–µ":["GD-10","MZD-10"],"–¥–Ω–∏":["GD-10","MZD-10","OS-10"],"–ø—Ä–æ–Ω–∑–∏–ª–∞":["GD-10","MZD-10"],"–≥—Ä–æ–º–∫–∏–π":["GD-10","MZD-10"],"–ø—Ä–∏–≤—ã—á–Ω—ã–π":["GD-10","MZD-10"],"–º–æ–π":["GD-10","GD-11","GD-12","GD-13","MZD-10","MZD-11","MZD-12","MZD-13","OS-01","OS-03","OS-08","OS-09"],"–ø–æ–Ω–∏–∫":["GD-10","GD-11","MZD-10","MZD-11"],"—Ä–∞–Ω—ã":["GD-10","GD-11","MZD-10","MZD-11","OS-05"],"–º–æ—é":["GD-10","MZD-10","OS-03"],"—Å–ª–æ–º–∞–ª–∏":["GD-10","MZD-10"],"–ª–∞–ø—ã":["GD-10","MZD-10"],"–æ—Ç–æ—Ä–≤–∞–ª–∏":["GD-10","MZD-10"],"—Å–ª—ã—à–∞–ª":["GD-10","MZD-10"],"—Ä—ã–¥–∞–ª–∞":["GD-10","MZD-10"],"—É—Ç–µ—à–∞–ª":["GD-10","MZD-10"],"–µ–µ":["GD-10","GD-13","MZD-10","MZD-13"],"–ø–∞–ø–∞—à–∞":["GD-10","MZD-10"],"—Ä–æ–¥–Ω–∞—è":["GD-10","MZD-10"],"–∑–∞—à—å–µ–º":["GD-10","MZD-10"],"–Ω—É":["GD-10","MZD-10","OS-10"],"–Ω–æ–≤–æ–≥–æ":["GD-10","MZD-10"],"–Ω–∞–π–¥–µ–º":["GD-10","MZD-10"],"–∞—Ö":["GD-10","MZD-10"],"—Å–ª—É—á–∏–ª–æ—Å—å":["GD-10","MZD-10","OS-10"],"–ø—Ä–æ–ø–∞–ª–∞":["GD-10","MZD-10"],"–Ω–∞—à–∞":["GD-10","MZD-10","OS-08"],"—Ç–µ–ø–µ—Ä—å":["GD-10","MZD-10","OS-04","OS-08","OS-11"],"–ª–µ–∂—É":["GD-10","MZD-10"],"–∫—É—á–µ":["GD-10","MZD-10"],"—Ö–ª–∞–º–∞":["GD-10","MZD-10"],"—Å—Ç–∞–ª–∞":["GD-10","GD-12","MZD-10","MZD-12"],"—Å–ø–ª–æ—à–Ω–∞—è":["GD-10","MZD-10"],"–¥—Ä–∞–º–∞":["GD-10","MZD-10"],"–≤—Å—é":["GD-10","MZD-10","OS-02","OS-07","OS-08"],"–Ω–∞—à—É":["GD-10","MZD-10"],"–∑–∞–ø–µ—Ä—Ç":["GD-10","MZD-10"],"–ø–æ–ª–Ω–æ–º":["GD-10","MZD-10"],"–≥—Ä–µ–∑":["GD-10","MZD-10"],"–≥–æ—Ä—å–∫–∏—Ö":["GD-10","MZD-10"],"–º–æ–∏—Ö":["GD-10","MZD-10"],"—Å–ª–µ–∑":["GD-10","MZD-10","OS-13"],"–≤–∏–¥–µ–ª":["GD-10","MZD-10"],"–¥–µ–≤–æ—á–∫–∞":["GD-10","MZD-10"],"—Ä–æ—Å–ª–∞":["GD-10","MZD-10"],"–ø—ã–ª–∏–ª–∏—Å—å":["GD-10","MZD-10"],"—É–≥–ª—É":["GD-10","MZD-10"],"—Å—Ç–æ–ª–∞":["GD-10","MZD-10"],"–µ–π":["GD-10","MZD-10","OS-05"],"–æ—Ç–∫—Ä—ã–ª—Å—è":["GD-10","MZD-10"],"–≤–∑—Ä–æ—Å–ª—ã–π":["GD-10","MZD-10"],"–±–æ–ª—å—à–æ–π":["GD-10","MZD-10"],"–æ—Å—Ç–∞–ª—Å—è":["GD-10","MZD-10"],"–Ω–µ–º–æ—é":["GD-10","MZD-10"],"—Ç–æ—Å–∫–æ–π":["GD-10","GD-14","MZD-10","MZD-14"],"–≤—Å–ø–æ–º–Ω–∏":["GD-10","MZD-10"],"–¥–µ—Ç—Å—Ç–≤–µ":["GD-10","MZD-10"],"—Å–º–µ—è–ª–∏—Å—å":["GD-10","GD-14","MZD-10","MZD-14"],"–æ–¥–µ—è–ª–µ":["GD-10","MZD-10"],"–≥–æ–ª–æ–≤–æ—é":["GD-10","MZD-10"],"—Å–∫—Ä—ã–≤–∞–ª–∏—Å—å":["GD-10","MZD-10"],"–æ—Ç–≤–µ—Ä–Ω—É–ª–∞—Å—å":["GD-10","MZD-10"],"–º–µ—á—Ç–∞—é":["GD-10","MZD-10","OS-15"],"—Ç–æ–º":["GD-10","MZD-10"],"–≤–µ—Ä–Ω—É–ª–∞—Å—å":["GD-10","MZD-10"],"—É–ø–∞–ª":["GD-10","MZD-10","OS-12"],"–∂–º–µ—Ç":["GD-10","MZD-10"],"—É–º–∏—Ä–∞–µ–º":["GD-10","MZD-10"],"–∏–≥—Ä—É—à–∫–∏":["GD-10","MZD-10"],"–ª–µ–∂–∞—Ç":["GD-10","MZD-10"],"–ø—ã–ª–∏":["GD-10","MZD-10"],"–∫–æ–Ω–µ—á–Ω–æ":["GD-10","MZD-10"],"–ø–æ–Ω–∏–º–∞—é":["GD-10","MZD-10"],"—É—à–µ–ª":["GD-10","MZD-10"],"–º–∏—à–∫–∏":["GD-10","MZD-10"],"–¥–µ—Ç—Å–∫–∏–π":["GD-10","MZD-10"],"–¥—É—Ö":["GD-10","MZD-10"],"—à–µ–ø—á—É":["GD-10","MZD-10","OS-05"],"–¥–µ—Ä–∂–∏—Å—å":["GD-10","MZD-10"],"—Å—Ç–µ–∫–ª—è–Ω–Ω—ã–π":["GD-10","MZD-10"],"—Å–º–æ—Ç—Ä–∏—Ç":["GD-10","MZD-10"],"–≤–¥–∞–ª—å":["GD-10","MZD-10"],"–Ω–µ–º":["GD-10","GD-12","MZD-10","MZD-12","OS-03"],"–æ—Ç—Ä–∞–∂–∞–µ—Ç—Å—è":["GD-10","MZD-10"],"–±–µ–∑–º–æ–ª–≤–Ω–∞—è":["GD-10","MZD-10"],"–º–µ—Å—Ç–∞":["GD-10","MZD-10","OS-07"],"–±–æ–ª—å—à–µ":["GD-10","GD-13","MZD-10","MZD-13"],"—Å–∫–∞–∑–∫–µ":["GD-10","MZD-10","MZD-16","OS-01","OS-02","OS-03","OS-04","OS-05","OS-06","OS-07","OS-08","OS-09","OS-10","OS-11","OS-12","OS-13","OS-14","OS-15"],"–¥–µ—Ç—Å–∫–æ–π":["GD-10","MZD-10"],"–ª–∞—Å–∫–∏":["GD-10","MZD-10"],"–ø–ª–∞–Ω–µ—Ç–∞":["GD-11","MZD-11"],"—Å–µ—Ä—ã–π":["GD-11","MZD-11","OS-14"],"—Å–º–µ–Ω—è–µ—Ç":["GD-11","MZD-11"],"–º—Ä–∞—á–Ω—ã–π":["GD-11","MZD-11"],"–≤–µ—á–µ—Ä":["GD-11","MZD-11"],"–≥–æ—Ä–æ–¥":["GD-11","MZD-11"],"–±–µ—Ç–æ–Ω–Ω—ã–π":["GD-11","MZD-11"],"–ø—Ä–µ—Å—Å":["GD-11","MZD-11"],"–∞—Å—Ñ–∞–ª—å—Ç–µ":["GD-11","MZD-11"],"—Å–ª—É—á–∞–π–Ω–æ–π":["GD-11","MZD-11"],"–≤—Å—Ç—Ä–µ—á–∏":["GD-11","MZD-11","MZD-15"],"–æ—Å—Ç–∞–µ—Ç—Å—è":["GD-11","MZD-11","OS-12"],"—Å—Ç—Ä–µ—Å—Å":["GD-11","MZD-11"],"—à—É–º":["GD-11","MZD-11"],"–≥—Ä—è–∑—å":["GD-11","MZD-11"],"—Ä–∞–∑–≥–æ–≤–æ—Ä—ã":["GD-11","MZD-11"],"–æ–±–µ—â–∞–Ω–∏–π":["GD-11","MZD-11"],"–≥–Ω–∏—é—Ç":["GD-11","MZD-11"],"–ø–æ–≤—Å—é–¥—É":["GD-11","MZD-11","OS-12"],"—Å–ø–æ—Ä—ã":["GD-11","MZD-11"],"—Ä–∞–≤–Ω–æ–¥—É—à–Ω—ã–µ":["GD-11","MZD-11","OS-15"],"–ø–æ—Å–º–æ—Ç—Ä–∏":["GD-11","MZD-11"],"—Ç–µ—Ä–ø–µ—Ç—å":["GD-11","MZD-11","OS-13"],"—Å–∏–ª":["GD-11","MZD-11","OS-07"],"–≤–æ–∑–¥—É—Ö":["GD-11","MZD-11","OS-10"],"—Å–∂–∞—Ç":["GD-11","MZD-11"],"–∑–∞–¥—ã—Ö–∞—é—Å—å":["GD-11","MZD-11"],"—Å—Ä–æ—á–Ω–æ":["GD-11","MZD-11"],"—Å–æ–π–¥—É":["GD-11","MZD-11"],"–æ—Å—Ç–∞—é—Ç—Å—è":["GD-11","MZD-11"],"–ø—Ä–æ–∫–ª—è—Ç—ã":["GD-11","MZD-11"],"–Ω–∞–π–¥—É":["GD-11","MZD-11"],"–∞—Ä–µ–Ω—ã":["GD-11","MZD-11"],"—É–π–¥—É":["GD-11","MZD-11"],"–æ—à–∏–±–∫–∞—Ö":["GD-11","MZD-11"],"—É—Å–≤–æ–∏–ª–∏":["GD-11","MZD-11"],"–ø–ª–æ–¥–∏–º":["GD-11","MZD-11"],"—Å–ª–µ–∑—ã":["GD-11","GD-12","MZD-11","MZD-12"],"—Å–∞–º–∏":["GD-11","MZD-11"],"—É—Å—Ç—Ä–æ–∏–ª–∏":["GD-11","MZD-11"],"–ø–æ–≥—Ä—è–∑–ª–∏":["GD-11","MZD-11"],"–ø–æ—Ä–æ–∫–∞—Ö":["GD-11","MZD-11"],"–∫–∏–ø–∏—Ç":["GD-11","MZD-11"],"–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö":["GD-11","MZD-11"],"—Ç—Ä–µ–≤–æ–≥–∞—Ö":["GD-11","MZD-11"],"–º–Ω–æ–∂–∏–º":["GD-11","MZD-11"],"—Å—Ç–∞–≤–∏–º":["GD-11","MZD-11"],"–∫–∞–ø–∫–∞–Ω—ã":["GD-11","MZD-11"],"–º–æ–ª—å–±—ã":["GD-11","MZD-11"],"–≤–∏–¥–∏–º":["GD-11","MZD-11"],"–∏–∑—ä—è–Ω—ã":["GD-11","MZD-11"],"–∑–Ω–∞—á–∏—Ç":["GD-11","MZD-11"],"–¥—ã—à–∞—Ç—å":["GD-11","MZD-11"],"–ø—Ä–æ—â–∞—Ç—å":["GD-11","MZD-11"],"—Ç–µ—Ä–ø–µ–Ω–∏—é":["GD-11","MZD-11"],"–ø—Ä–∏—Ö–æ–¥–∏—Ç":["GD-11","MZD-11","OS-04"],"–∫—Ä–∞–π":["GD-11","MZD-11"],"–∫—Ä–∏—á—É":["GD-11","GD-12","MZD-11","MZD-12"],"–ø—Ä–æ—â–∞–π":["GD-11","MZD-11"],"—Å–ª–∏—à–∫–æ–º":["GD-11","MZD-11"],"–¥–æ–ª–≥–æ":["GD-11","MZD-11","OS-05"],"–∂–¥–∞–ª":["GD-11","MZD-11","OS-03","OS-10"],"–Ω–∞—Å—Ç–∞–ª":["GD-11","MZD-11"],"–ø—É—Ç–∏":["GD-11","MZD-11","OS-05"],"—Ç–∞–∫–æ—é":["GD-11","MZD-11"],"–ø—Ä–∞–≤–¥–æ—é":["GD-11","MZD-11"],"–ø–æ–≤–µ—Ä—å":["GD-11","MZD-11","OS-14"],"–≤–µ—Ä—ã":["GD-11","MZD-11"],"—Å–∫–æ—Ä–µ–π":["GD-11","MZD-11"],"–±–∏—Ç–≤—ã":["GD-11","MZD-11"],"—Å–∏—Å—Ç–µ–º–µ":["GD-11","GD-12","MZD-11","MZD-12"],"—Ü–∞—Ä–∏—Ç":["GD-11","MZD-11"],"–≥–Ω–∏–ª—å":["GD-11","MZD-11"],"—Ö–≤–∞—Ç–∏—Ç":["GD-11","MZD-11"],"–¥–µ—Ä–Ω–∏":["GD-11","MZD-11"],"—Ä—É—á–∫—É":["GD-11","MZD-11"],"—Å—Ç–æ–ø":["GD-11","MZD-11"],"–ª—è–∂–µ—Ç":["GD-11","MZD-11"],"–≥—Ä–æ–±":["GD-11","MZD-11","MZD-15"],"–≤–∞—Ä–∏—Ç—Å—è":["GD-11","MZD-11"],"—Ü–∏—Ä–∫":["GD-11","MZD-11"],"–ø—Ä–æ—Ç–∏–≤–µ–Ω":["GD-11","MZD-11"],"—Ñ–µ–π–∫":["GD-12","MZD-12"],"—Å–º–æ—Ç—Ä–∏":["GD-12","MZD-12","OS-14"],"–≤–∏—Ä—É—Å":["GD-12","MZD-12"],"–∫–æ–¥–µ":["GD-12","MZD-12"],"–∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å":["GD-12","MZD-12"],"–ø–µ–ø–µ–ª":["GD-12","MZD-12"],"–≤–µ—Ä–∞":["GD-12","MZD-12"],"–Ω–µ–Ω–∞—Å—Ç—å–µ":["GD-12","MZD-12"],"—Ä—É–∏–Ω–∞—Ö":["GD-12","MZD-12"],"–ø—Ä–∞–≤–∏—Ç":["GD-12","MZD-12","MZD-16"],"–±–∞–ª":["GD-12","MZD-12"],"–≥–æ—Ç–æ–≤":["GD-12","MZD-12"],"–ø—Ä–æ–¥–∞—Ç—å":["GD-12","MZD-12","OS-01"],"–Ω–∞–ª":["GD-12","MZD-12"],"—Ç—Ä–µ–Ω–¥–µ":["GD-12","MZD-12"],"–Ω–∞—Å–∏–ª–∏–µ":["GD-12","MZD-12"],"–∫–ª–µ—Ç–∫–µ":["GD-12","MZD-12"],"–ª–∞–π–∫–æ–≤":["GD-12","MZD-12"],"—Ä–µ–ø–æ—Å—Ç–æ–≤":["GD-12","MZD-12"],"–∑–∞–ª–æ–∂–Ω–∏–∫":["GD-12","MZD-12"],"–ø—Ä–æ–≥—Ä–µ—Å—Å–∞":["GD-12","MZD-12"],"—Ö—Ä–∏–ø–ª—ã–π":["GD-12","MZD-12"],"–≤–æ–∫—Ä—É–≥":["GD-12","MZD-12"],"—Å—Ç—Ä–µ—Å—Å–∞":["GD-12","MZD-12"],"–Ω–∞—Å—Ç–æ—è—â–∏–π":["GD-12","MZD-12"],"–¥—É—à–µ":["GD-12","MZD-12"],"—Å–∫—Ä–æ–µ—à—å":["GD-12","MZD-12"],"—Ñ–∞–ª—å—à—å—é":["GD-12","MZD-12"],"–ø–æ–ª—É–º—Ä–∞–∫–µ":["GD-12","MZD-12"],"—Å–ø–∏—á–∫–∞":["GD-12","MZD-12"],"—Ç–≤–æ–µ–º":["GD-12","MZD-12"],"–±–µ–Ω–∑–æ–±–∞–∫–µ":["GD-12","MZD-12"],"–≤–ø–∏—Ö–Ω—É—Ç—å":["GD-12","MZD-12"],"—Å—Ç–æ—Ä–∏—Å–æ–≤":["GD-12","MZD-12"],"–ª–∞–π–∫":["GD-12","MZD-12"],"–¥—Ä—É–∑—å—è":["GD-12","MZD-12"],"–º–µ—Ç–∫–∏":["GD-12","MZD-12"],"—Å–ª–æ–º–∞–µ—Ç":["GD-12","MZD-12"],"–∞–ª–≥–æ—Ä–∏—Ç–º–∞–º":["GD-12","MZD-12"],"—Ö—Ä–µ–±–µ—Ç":["GD-12","MZD-12"],"–ø–ª–∞—Ç—è—Ç":["GD-12","MZD-12"],"–ø—Ä–∞–≤–¥—É":["GD-12","MZD-12","OS-02"],"–≥—Ä—è–∑–Ω–æ–π":["GD-12","MZD-12"],"–ª–æ–∂—å—é":["GD-12","MZD-12"],"–æ—Ç–≤–µ—Ç":["GD-12","MZD-12","OS-12"],"–º–µ–º—ã":["GD-12","MZD-12"],"–∑–ª—ã–µ":["GD-12","MZD-12"],"–∫–∏—Å–ª–æ—Ç–Ω—ã–µ":["GD-12","MZD-12"],"–∫–∞–¥—Ä–µ":["GD-12","MZD-12"],"–≤—ã":["GD-12","MZD-12","OS-06","OS-10"],"–º–∞—Ä–∏–æ–Ω–µ—Ç–∫–∏":["GD-12","MZD-12"],"–∞–±—Å—É—Ä–¥–Ω–æ–º":["GD-12","MZD-12"],"—Ç–µ–∞—Ç—Ä–µ":["GD-12","MZD-12"],"—Ä–µ—á–∏":["GD-12","MZD-12"],"—Ñ–æ–Ω—Ç–∞–Ω":["GD-12","MZD-12"],"–∫—Ä–æ–≤—å":["GD-12","MZD-12","OS-08"],"–≤–æ–¥–∞":["GD-12","MZD-12"],"–∂–∞–∂–¥–∞":["GD-12","MZD-12"],"–Ω–∞–∂–∏–≤—ã":["GD-12","MZD-12"],"—Å–≤–µ–ª–∞":["GD-12","MZD-12"],"—É–º–∞":["GD-12","MZD-12"],"–≤—ã–∑–æ–≤":["GD-12","MZD-12"],"–ø—Ä–æ–¥–∞–∂–Ω–æ–π":["GD-12","MZD-12"],"–≥–ª—É—Ö–æ–π":["GD-12","MZD-12"],"—Å—Ç—É—á—É—Å—å":["GD-12","MZD-12"],"–±–µ–∑—É–º—å–µ":["GD-12","MZD-12"],"–Ω–µ–∫—É–¥–∞":["GD-12","MZD-12"],"–¥–µ—Ç—å—Å—è":["GD-12","MZD-12"],"–¥—ã—à—É":["GD-12","MZD-12","OS-08"],"—Å–º—Ä–∞–¥":["GD-12","MZD-12"],"–ª–∂–∏–≤—ã—Ö":["GD-12","MZD-12"],"—Ç—Ä–µ–Ω–¥–æ–≤":["GD-12","MZD-12"],"–ø–ª–æ–¥–∏—Ç":["GD-12","MZD-12"],"–º–∞–Ω–µ–∫–µ–Ω–æ–≤":["GD-12","MZD-12"],"–∂–∏–≤—É":["GD-12","MZD-12","OS-01"],"–≤–∞—à–∏–º":["GD-12","MZD-12"],"—à–∞–±–ª–æ–Ω–∞–º":["GD-12","MZD-12"],"—Å–ª–æ–º–∞—Ç—å":["GD-12","MZD-12"],"–º–æ–∏":["GD-12","MZD-12","OS-03","OS-06","OS-08"],"—à—Ä–∞–º—ã":["GD-12","MZD-12"],"–∑–∞–∫–æ–Ω–Ω—ã":["GD-12","MZD-12"],"–±—É—Ö–æ–π":["GD-12","MZD-12"],"–≥—Ä–∞–Ω–∏":["GD-12","MZD-12"],"—Å–º–µ—Ç–µ—Ç":["GD-12","MZD-12"],"–ø—Ä–∏–∑—Ä–∞–∫":["GD-12","GD-14","MZD-12","MZD-14","MZD-15"],"–±—Ä–æ–¥—è—â–∏–π":["GD-12","MZD-12"],"–ø—Ä–æ—Ç–µ—Å—Ç–∞":["GD-12","MZD-12"],"—Ç–æ–Ω—É":["GD-12","MZD-12"],"–ª–∏—Ü–µ–º–µ—Ä–Ω—ã–π":["GD-12","MZD-12"],"—á—É–∂–æ–π":["GD-12","MZD-12"],"–ø–æ—Ç–æ–º—É":["GD-12","MZD-12"],"–æ–ª—è":["GD-13","MZD-13"],"–º–æ—Ä—è":["GD-13","MZD-13"],"–æ–ª—å–≥–∞":["GD-13","MZD-13"],"—á—å–µ":["GD-13","MZD-13"],"–∫—Ä–∞—Å–æ—Ç–æ—é":["GD-13","MZD-13"],"—É–ª—ã–±–∫–∏":["GD-13","MZD-13"],"–º–∞–≥–Ω–∏—Ç":["GD-13","MZD-13","OS-15"],"–ª—å–µ—Ç—Å—è":["GD-13","MZD-13"],"–∏—Å–∫—Ä–∏—Å—Ç–∞—è":["GD-13","MZD-13"],"–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è":["GD-13","MZD-13"],"–æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å":["GD-13","MZD-13"],"—Å–∫—Ä–æ–º–Ω–æ—Å—Ç—å":["GD-13","MZD-13","OS-03"],"—Ç–µ–±–µ":["GD-13","GD-14","MZD-13","MZD-14","OS-03","OS-06","OS-15"],"–∏–¥–µ–∞–ª":["GD-13","MZD-13"],"—á—É–¥–æ":["GD-13","MZD-13"],"—Ä–µ–¥–∫–∏–π":["GD-13","MZD-13"],"–∫–æ—Ä–∞–ª–ª":["GD-13","MZD-13"],"–ø—Ä–µ–∫—Ä–∞—Å–Ω–∞":["GD-13","MZD-13","OS-08"],"–ø–æ–¥–æ–±—Ä–∞—Ç—å":["GD-13","MZD-13"],"—Å—á–∞—Å—Ç–ª–∏–≤–∞":["GD-13","MZD-13"],"–æ–±—ä—è—Ç—å—è—Ö":["GD-13","MZD-13","OS-11"],"–≥–æ—Ä–µ":["GD-13","MZD-13","OS-02","OS-06"],"–∑–∞–∫–∞—Ç—ã":["GD-13","MZD-13"],"—Ä–∞—Å—Å–≤–µ—Ç—ã":["GD-13","MZD-13"],"–≤–æ–ª–µ":["GD-13","MZD-13"],"–±—Ä–∏–∑":["GD-13","MZD-13","OS-11"],"–Ω–µ–∂–Ω–æ—Å—Ç–∏":["GD-13","MZD-13"],"–∫—Ä—É–∂–∏—Ç":["GD-13","MZD-13","OS-15"],"–ª–∞—Å–∫–æ–π":["GD-13","MZD-13"],"–∑–∞–±–æ—Ç–æ–π":["GD-13","MZD-13"],"–¥—Ä—É–∑–µ–π":["GD-13","MZD-13"],"–æ–∫—Ä—É–∂–∏—Ç":["GD-13","MZD-13"],"–≤–µ—Ä—É":["GD-13","MZD-13"],"–Ω–∞–¥–µ–∂–¥–æ–π":["GD-13","MZD-13"],"–ª—é–±–æ–≤—å—é":["GD-13","MZD-13","OS-15"],"–ø–æ–¥—Ä—É–∂–∏—Ç":["GD-13","MZD-13"],"–±–æ–ª–∏—Ç":["GD-13","MZD-13"],"—Ç–≤–æ—è":["GD-13","MZD-13","OS-03","OS-14"],"–∏—Å—Ü–µ–ª–∏—Ç":["GD-13","MZD-13"],"–∑–∞—Å—Ç–µ–Ω—á–∏–≤—ã–π":["GD-13","MZD-13"],"–¥–µ–∫–æ—Ä–µ":["GD-13","MZD-13"],"–≤–∞—Å":["GD-13","MZD-13","OS-06"],"–∑–æ–≤—É—Ç":["GD-13","MZD-13"],"—Ç–æ–≥–¥–∞":["GD-13","MZD-13","OS-03"],"–ø–µ—Å–Ω—è":["GD-13","MZD-13","OS-12"],"–∫–∞–∂–¥–æ–π":["GD-13","MZD-13","OS-06"],"–æ–ª—å–≥–∏":["GD-13","MZD-13"],"–ª—É—á":["GD-13","GD-14","MZD-13","MZD-14"],"–¥–∞—Ä–∏—Ç":["GD-13","MZD-13"],"—Å—Ä–µ–¥–∏":["GD-13","MZD-13","OS-13"],"—Ç—É—á":["GD-13","MZD-13"],"—Ä–∞–∑—Ä—ã–≤–∞–µ—Ç":["GD-13","MZD-13"],"–º–æ—Ä—Å–∫–æ—é":["GD-13","MZD-13","OS-12"],"–≤–æ–ª–Ω–æ–π":["GD-13","MZD-13","OS-12"],"–Ω–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è":["GD-13","MZD-13"],"–≤–µ—á–Ω–æ–π":["GD-13","MZD-13","OS-12","OS-15"],"–≤–µ—Å–Ω–æ–π":["GD-13","MZD-13"],"–ª–æ–≤–∏":["GD-14","MZD-14"],"—Ä–æ–∂–¥–∞–µ—Ç—Å—è":["GD-14","MZD-14"],"—Å–∫–æ–ª—å–∑–∏—Ç":["GD-14","MZD-14"],"–Ω–µ–≤–∏–¥–∏–º–æ—é":["GD-14","MZD-14"],"—Ç–µ–Ω—å—é":["GD-14","MZD-14"],"–ø—Ä–æ—à–ª–æ–º":["GD-14","MZD-14"],"—Ä–∞—Å—Ç–≤–æ—Ä–∏–ª—Å—è":["GD-14","MZD-14"],"–µ–≥–æ":["GD-14","MZD-14","OS-01","OS-03","OS-13"],"—Å–ª–µ–¥":["GD-14","MZD-14"],"–∑—ã–±–∫–æ–º":["GD-14","MZD-14"],"—É—Å–∫–æ–ª—å–∑–∞—é—â–µ–º":["GD-14","MZD-14"],"–º–≥–Ω–æ–≤–µ–Ω—å–µ":["GD-14","MZD-14","OS-15"],"–∏–≥—Ä–∞–ª":["GD-14","MZD-14"],"—Ä–µ—Å–Ω–∏—Ü–∞—Ö":["GD-14","MZD-14"],"–Ω–∞—Å—Ç–æ—è—â–µ–µ":["GD-14","MZD-14"],"—Ä–∞–∑–±–∏–ª–æ—Å—å":["GD-14","MZD-14"],"–¥–∞–ª–µ–∫–∏—Ö":["GD-14","MZD-14"],"–≤–µ—Ä–µ–Ω–∏—Ü–∞—Ö":["GD-14","MZD-14"],"—Ç–∞–Ω—Ü—É–π":["GD-14","MZD-14"],"—Å–æ":["GD-14","MZD-14","MZD-16","OS-07","OS-12"],"–≤—Ä–µ–º–µ–Ω–µ–º":["GD-14","MZD-14"],"–∑–∞–±—É–¥—å":["GD-14","MZD-14","OS-14"],"—Ç–∞–∫—Ç":["GD-14","MZD-14"],"–Ω–∞–∑–∞–¥":["GD-14","MZD-14"],"–¥—É–º–∞–µ–º":["GD-14","MZD-14"],"–∂–∏–≤–∏":["GD-14","MZD-14","MZD-15","OS-14"],"–ø—ã—Ç–∞–µ–º—Å—è":["GD-14","MZD-14"],"–æ–±—ä—è—Ç—å":["GD-14","MZD-14"],"–≤–¥–æ—Ö–Ω—É—Ç—å":["GD-14","MZD-14"],"–ø–æ–≥–ª—É–±–∂–µ":["GD-14","MZD-14"],"—Ö—Ä—É–ø–∫–∏–π":["GD-14","MZD-14"],"–ø–ª–µ–Ω":["GD-14","MZD-14"],"—Ä–µ–≤–Ω–∏–≤":["GD-14","MZD-14"],"–∑–∞–≥—Ä—É–∂–µ–Ω":["GD-14","MZD-14"],"—Ç–∞–Ω—Ü–µ":["GD-14","MZD-14","OS-15"],"–∫—Ä—É–∂–∏–º—Å—è":["GD-14","MZD-14"],"–≤–µ–¥–æ–º—ã–µ":["GD-14","MZD-14"],"–º–µ–ª–æ–¥–∏–µ–π":["GD-14","MZD-14"],"–Ω–µ–∑—Ä–∏–º–æ–π":["GD-14","MZD-14"],"–ª–µ–≥–æ–∫":["GD-14","MZD-14"],"—Ä–∞–¥–æ—Å—Ç–∏":["GD-14","MZD-14","OS-07"],"–Ω–µ–≤–æ–æ–±—Ä–∞–∑–∏–º–æ–π":["GD-14","MZD-14"],"–≤–ª–∞—Å—Ç–Ω—ã":["GD-14","MZD-14"],"–Ω–∞–¥":["GD-14","MZD-14"],"–≤—Ä–∞—â–∞–µ—Ç":["GD-14","MZD-14"],"—Å–≤–æ–µ–º":["GD-14","MZD-14","OS-01"],"–∫—Ä—É–≥–æ–≤–æ—Ä–æ—Ç–µ":["GD-14","MZD-14"],"—á–∞—Å":["GD-14","MZD-14","OS-13"],"–Ω–µ–æ–±—Ä–∞—Ç–∏–º":["GD-14","MZD-14"],"–Ω–µ–≤–µ–¥–æ–º–æ–º":["GD-14","MZD-14"],"–ø–æ–ª–µ—Ç–µ":["GD-14","MZD-14","OS-12"],"—Å—Ç–µ–Ω–µ":["GD-14","MZD-14"],"—à–∞–Ω—Å":["GD-14","MZD-14","OS-06"],"–ª–µ–≥–∫–æ":["GD-14","MZD-14"],"—É–ø—É—Å—Ç–∏–º":["GD-14","MZD-14"],"–¥–∞–Ω":["GD-14","MZD-14"],"–≤–æ–∑–¥—É—à–Ω—ã–º":["GD-14","MZD-14"],"–ø–æ—Ü–µ–ª—É–µ–º":["GD-14","MZD-14"],"–æ—Ç–ø—É—Å—Ç–∏–º":["GD-14","MZD-14"],"–±—É–¥—É":["MZD-15","OS-07","OS-15"],"–ø—Ä–∏–∑—Ä–∞–∫–æ–º":["MZD-15"],"–ª–µ—Ç–∞—Ç—å":["MZD-15"],"—Ç–∞–π–Ω–æ":["MZD-15"],"–≥—É–±—ã":["MZD-15"],"—Ü–µ–ª–æ–≤–∞—Ç—å":["MZD-15"],"—Ç–≤–æ–µ–π":["MZD-15","OS-07"],"—É—Å–Ω—É":["MZD-15"],"–ø—Ä–æ—Å–Ω—É—Å—å":["MZD-15","OS-09"],"—É—Ç—Ä—É":["MZD-15"],"—É—Ö–æ–¥–æ–º":["MZD-15"],"—Ç–µ–º–Ω–æ—Ç—ã":["MZD-15"],"—Ä–∞—Å—Ç–≤–æ—Ä—é—Å—å":["MZD-15"],"–º–æ–≥–∏–ª–µ":["MZD-15","OS-11"],"—Å–ø–∞—Ç—å":["MZD-15"],"–Ω–æ–≤–æ–π":["MZD-15","OS-06","OS-09"],"–Ω–∞—à–µ–π":["MZD-15"],"–∂–¥–∞—Ç—å":["MZD-15","OS-04","OS-06"],"–ø–æ–∫–∏–Ω—É–≤":["MZD-15"],"–Ω–æ—á–∏":["MZD-15","OS-02","OS-04","OS-08"],"—Ç–∏—Ö–æ":["MZD-15"],"–ø—Ä–æ–±–∏—Ä–∞—é—Å—å":["MZD-15"],"–ø–æ—Å—Ç–µ–ª–∏":["MZD-15"],"–∂–∏–≤—ã—Ö":["MZD-15"],"—Å–∫—Ä—ã–≤–∞—è—Å—å":["MZD-15"],"—Ä–∞–∑–ª—É—á–∏–ª":["MZD-15"],"–∫–æ–≤–∞—Ä–Ω—ã–π":["MZD-15"],"–≤–æ—Å–∫—Ä–µ—Å–∏—Ç—å":["MZD-15"],"—è–≤–ª—é—Å—å":["MZD-15"],"—á—Ç–æ–±—ã":["MZD-15","OS-07"],"–Ω–µ–º–Ω–æ–∂–∫–æ":["MZD-15"],"–ø–æ–≥–æ—Å—Ç–∏—Ç—å":["MZD-15"],"–ø—Ä–∏—Ö–æ–¥–∏—à—å":["MZD-15"],"–∫–æ":["MZD-15","OS-06"],"—Å–≤–∏–¥–∞–Ω—å–µ":["MZD-15","OS-04"],"—Å–ª–µ–∑—É":["MZD-15"],"—É–º–µ–µ—à—å":["MZD-15"],"—Å–¥–µ—Ä–∂–∞—Ç—å":["MZD-15"],"–≤–∑–æ—à–ª–∏":["MZD-15"],"—Å–Ω–∏–∑—É":["MZD-15"],"–ø–æ–ª–∏–≤–∞—Ç—å":["MZD-15"],"—É–ª—ã–±–Ω–∏—Å—å":["MZD-15"],"–¥–æ—Ä–æ–≥–∞—è":["MZD-15"],"—Ä–∞–∑–≤–µ–π—Å—è":["MZD-15"],"–ø–µ—á–∞–ª—å—Å—è":["MZD-15"],"–∫–æ–Ω—Ü–∞":["MZD-15","OS-04"],"–≤–µ–∫":["MZD-15"],"–ª—é–¥—Å–∫–æ–π":["MZD-15","OS-15"],"–ø—Ä–æ–ª–µ—Ç–∏—Ç":["MZD-15"],"–æ—á–µ–Ω—å":["MZD-15","OS-02","OS-07"],"–∑–∞–≥—Ä–æ–±—å–µ":["MZD-15"],"–≥–æ–±–ª–∏–Ω—ã":["MZD-16"],"–≥—Ä–µ–º–ª–∏–Ω—ã":["MZD-16"],"–ø—Ä–æ—á–∏–µ":["MZD-16"],"–¥–µ–º–æ–Ω—ã":["MZD-16"],"–≤—ã–¥—É–º–∫–∏":["MZD-16"],"–Ω–∏–∫–Ω–µ–π–º—ã":["MZD-16"],"–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ":["MZD-16"],"—É–≥—Ä–æ–∂–∞–µ—Ç":["MZD-16"],"–æ–ø–∞—Å–Ω–æ—Å—Ç—å":["MZD-16"],"–ø—Ä–æ–Ω–∏–∫–∞–µ—Ç":["MZD-16"],"–≤–µ—á–µ—Ä–æ–º":["MZD-16"],"–¥–æ–º":["MZD-16"],"–¥–µ—Ç—è–º":["MZD-16"],"—Ä–æ–¥–∏—Ç–µ–ª–∏":["MZD-16"],"—Å–∫–∞–∑–∫–∏":["MZD-16","OS-14"],"—Ä–∞—Å—Å–∫–∞–∂—É—Ç":["MZD-16"],"—Ç–µ–ª–µ–∫":["MZD-16"],"—Ä–æ–¥–∏—Ç–µ–ª—è–º":["MZD-16"],"–ø–æ–∫–∞–∂–µ—Ç":["MZD-16"],"—Ä–æ—Å":["MZD-16"],"–ø–µ—Å–Ω–∏":["MZD-16"],"–∫–æ—Ä–æ–ª—å":["MZD-16"],"—à—É—Ç":["MZD-16"],"–ø–æ–∫–ª–æ–Ω–Ω–∏–∫–∏":["MZD-16"],"–ø–æ–π–º—É—Ç":["MZD-16"],"–≥–µ—Ä–æ–µ–≤":["MZD-16"],"—Å—Ç—Ä–∞—à–Ω–∞":["MZD-16"],"–ø–æ–µ—Ç—Å—è":["MZD-16"],"–ø–µ—Å–Ω–µ":["MZD-16"],"–∫—É–∫–ª–∞":["MZD-16"],"–∫–æ–ª–¥—É–Ω–∞":["MZD-16"],"–∑–∞—Ö–≤–∞—Ç–∏—Ç":["MZD-16"],"–∫–æ–ª–¥—É–Ω":["MZD-16"],"–∫—Ä–æ–≤–æ–ø–∏–π—Ü–∞":["MZD-16"],"–∑–∞–≥—É–±–∏—Ç":["MZD-16"],"–∑–∞–∫—Ä–æ–µ—Ç":["MZD-16"],"—Ç–µ–º–Ω–∏—Ü–∞—Ö":["MZD-16"],"—Å—á–∞—Å—Ç–ª–∏–≤—ã–º":["MZD-16"],"–∫–æ–Ω—Ü–æ–º":["MZD-16"],"—É—Ç—Ä–æ–º":["MZD-16"],"–ø—Ä–æ—Å–Ω–µ–º—Å—è":["MZD-16"],"–¥—É—Ä–¥–æ–º":["MZD-16"],"–±–∞–ª–æ–º":["MZD-16"],"—Å–∫–∞–∑–æ—á–Ω—ã–π":["MZD-16"],"–ø–∞–Ω–∫":["MZD-16"],"—Å—Ç–∞—Ä–æ–π":["MZD-16"],"–∏—Å–ø—ã—Ç–∞–µ—à—å":["MZD-16"],"—à–æ–∫":["MZD-16"],"–ª—é–±–ª—é":["MZD-16"],"–º—É–∑—ã–∫—É":["MZD-16"],"—Å–º—ã—Å–ª–∞":["MZD-16"],"—Ç–µ–∫—Å—Ç–∞":["MZD-16"],"—Ü–µ–Ω–∞":["GD-02"],"–≥–∞–¥–∫–∞—è":["GD-03"],"–∞–Ω–≥–µ–ª":["GD-05"],"–Ω–∞—Å—Ç–∞–Ω–µ—Ç":["GD-06","OS-10"],"—É–ø–∞–ª–∞":["GD-07","KREV-01"],"—Å–ª–µ–∑–∞":["GD-07","KREV-01"],"–ø—É—Ç–µ–≤–æ–¥–Ω–∞—è":["GD-08"],"–º–µ–ª–æ–¥–∏–∏":["GD-09"],"–¥–æ–∂–¥–µ–π":["GD-09"],"–ø—Ä–µ–∫—Ä–∞—Å–Ω–∞—è":["GD-10"],"–æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ":["GD-11"],"–∫–æ–ª—ã–±–µ–ª—å–Ω–∞—è":["GD-12"],"–≤–µ—Å–Ω—ã":["GD-13"],"–±–µ–ª–∞—è":["OS-01"],"–≤–æ—Ä–æ–Ω–∞":["OS-01"],"–≤–æ–ª—à–µ–±—Å—Ç–≤–∞":["OS-01"],"—Ä–µ–∞–ª—å–Ω–æ–π":["OS-01"],"—á–∞—Ä":["OS-01"],"–∫–æ–ª–¥–æ–≤—Å—Ç–≤–∞":["OS-01"],"–Ω—É–∂–Ω—ã":["OS-01"],"–∑–∞–∫–ª—è—Ç—å—è":["OS-01"],"–∑–µ–ª—å—è":["OS-01"],"–∞–º—É–ª–µ—Ç—ã":["OS-01"],"–¥–æ–±—Ä–æ–º—É":["OS-01"],"—Ä–µ—à–∞—é":["OS-01"],"–∑–ª–æ–≤–µ—â–∏–µ":["OS-01"],"—Å—é–∂–µ—Ç—ã":["OS-01"],"lumos":["OS-01"],"—É–∫–∞–∂–µ—Ç":["OS-01"],"–¥–æ—Ä–æ–≥—É":["OS-01"],"accio":["OS-01"],"–∫–ª—é—á–∏":["OS-01"],"–Ω–∞–π–¥–µ—Ç":["OS-01"],"–º–æ–µ–π":["OS-01","OS-15"],"expecto":["OS-01"],"patronum":["OS-01"],"–ø—Ä–æ–∫–ª—è—Ç—å–µ":["OS-01"],"–æ—Ç–≥–æ–Ω–∏—Ç":["OS-01"],"avada":["OS-01"],"kedavra":["OS-01"],"–∑–ª–æ":["OS-01","OS-03"],"–≤–µ–∫–∞":["OS-01"],"–ø–æ—Ö–æ—Ä–æ–Ω–∏—Ç":["OS-01"],"–≥–µ—Ä–º–∏–æ–Ω–∞":["OS-01"],"–≥—Ä–µ–π–Ω–¥–∂–µ—Ä":["OS-01"],"—Ö–æ—Ç–µ–ª–∞":["OS-01"],"—Å—Ç–∞—Ç—å":["OS-01"],"–ø–∞–ª–æ—á–∫–æ–π":["OS-01"],"–≤–æ–ª—à–µ–±–Ω–æ–π":["OS-01"],"–∑–ª–æ–¥–µ–µ–≤":["OS-01"],"—É–∫—Ä–æ—â–∞—Ç—å":["OS-01"],"—Ö—Ä–∞–±—Ä–æ–π":["OS-01"],"—É–º–Ω–æ–π":["OS-01"],"—Å–∏–ª—å–Ω–æ–π":["OS-01"],"–≤–∞–º":["OS-01","OS-10"],"–∫—Ä–µ—Å—Ç—Ä–∞–∂":["OS-01"],"–∑–∞–ø—Ä—è—Ç–∞–Ω":["OS-01"],"–º–∞–≥–æ–º":["OS-01"],"–ø–∞–ª–æ—á–∫–∏":["OS-01"],"–Ω–∏–≥–¥–µ":["OS-01"],"–æ—Ç—ã—Å–∫–∞—Ç—å":["OS-01"],"—Å—Ç–∞–≤":["OS-01"],"—Å—Ç–æ—è—Ç—å":["OS-01"],"–∞–º—É–ª–µ—Ç":["OS-01"],"–∑–∞–∫–æ–ª–¥–æ–≤–∞—Ç—å":["OS-01"],"–æ–¥–Ω–∞–∂–¥—ã":["OS-01","OS-02","OS-03","OS-04","OS-05","OS-06","OS-07","OS-08","OS-09","OS-10","OS-11","OS-12","OS-13","OS-14","OS-15"],"—Ç—Ä—É—Å–ª–∏–≤—ã–π":["OS-02"],"–ø–∞—Ä–µ–Ω—å":["OS-02"],"–¥–æ–º–æ–π":["OS-02"],"–ø–æ—à–µ–ª":["OS-02","OS-04"],"—Ç–æ–π":["OS-02"],"—Ç—Ä–æ–ø–æ–π":["OS-02"],"–ø–æ—Ç—É":["OS-02"],"—Å—Ç—Ä–∞—Ö–∞":["OS-02","OS-13"],"–±–ª–µ–¥–Ω—ã–π":["OS-02"],"–ø–æ–≥–æ—Å—Ç":["OS-02"],"–≤–µ–ª":["OS-02"],"–∫—Ä–∏–≤–æ–π":["OS-02"],"–µ–ª–µ":["OS-02"],"–¥—ã—à–∏—Ç":["OS-02"],"—Å–ø–æ—Ç—ã–∫–∞—è—Å—å":["OS-02"],"—á—É—Ç—å":["OS-02"],"–±—Ä–µ–¥–µ—Ç":["OS-02"],"—Ö—Ä—É—Å—Ç":["OS-02"],"—á–µ—Ç–∫–æ":["OS-02"],"–∑–ª–æ–±–Ω–æ":["OS-02"],"–≥—Ä—ã–∑–µ—Ç":["OS-02"],"–æ—Ö":["OS-02","OS-10"],"–ø—Ä–æ–ø–∞—â–∏–π":["OS-02"],"—Å–æ–∑–Ω–∞–Ω–∏–∏":["OS-02"],"—Å—Ç—Ä–∞–Ω–Ω—ã–π":["OS-02"],"–∞—Ä–≥—É–º–µ–Ω—Ç":["OS-02"],"–≤–∫—É—Å–Ω—ã–π":["OS-02"],"—Å–æ—á–Ω—ã–π":["OS-02"],"—Ö—Ä—É—Å—Ç—è—â–∏–π":["OS-02"],"—Å–æ–∂—Ä–µ—Ç":["OS-02"],"–ø–∞—Ä–Ω–∏—à–∫–∞":["OS-02"],"–≤—Å—Ç–∞–ª":["OS-02"],"—à–∞–≥–Ω—É—Ç—å":["OS-02"],"–±–æ–∂–µ":["OS-02"],"–¥—É–º–∞–µ—Ç":["OS-02"],"–Ω–∞–≤–µ—Ä–Ω–æ–µ":["OS-02"],"–∫–æ—Å—Ç–∏":["OS-02"],"–≥–ª–æ–∂–µ—Ç":["OS-02"],"—É–±–∏–π—Ü–∞":["OS-02","OS-07","OS-08"],"–≤—É—Ä–¥–∞–ª–∞–∫":["OS-02"],"—Å–∏–ª—å–Ω—ã–π":["OS-02"],"—É–±—å–µ—Ç":["OS-02"],"—É–ø—ã—Ä—å":["OS-02"],"–∫–∞–∫–æ–π":["OS-02"],"–ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç":["OS-02"],"—É–∂–∏–Ω":["OS-02"],"–≤—É—Ä–¥–∞–ª–∞–∫–∞":["OS-02"],"–ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ":["OS-02"],"–ø–∞—Ä–Ω—è":["OS-02"],"–∑–ª–æ—Å—Ç—å":["OS-02","OS-07"],"–ø—Ä–µ–¥":["OS-02"],"–Ω–∏–º":["OS-02"],"—Å–æ–±–∞–∫–∞":["OS-02"],"–±—É–¥–∫–∏":["OS-02"],"–±—ã—á—å—é":["OS-02"],"–∫–æ—Å—Ç—å":["OS-02"],"–æ—Å–æ–∑–Ω–∞–ª":["OS-02"],"—Ç—Ä—É—Å–ª–∏–≤":["OS-02"],"—Å–∫–æ–≤–∞–ª":["OS-02"],"–±—É—Ä–ª—è—â–∏–π":["OS-02"],"–ø–æ–±–µ–∂–∞–ª":["OS-02"],"–¥—É—Ä–∞–∫":["OS-03"],"—Ä–µ—à–∏–ª":["OS-03","OS-04"],"–ø—Ä–æ–≥—É–ª—è—Ç—å":["OS-03"],"—É—Ä–æ–∫":["OS-03"],"—Å–≤–æ–µ–≥–æ":["OS-03","OS-04"],"–≤–æ—Å–ø–∏—Ç–∞–Ω–∏—è":["OS-03"],"–∑–∞—á–∞—Ä–æ–≤–∞–Ω–Ω—ã–π":["OS-03"],"–ª–µ—Å":["OS-03"],"—É–±–µ–∂–∞–ª":["OS-03"],"–ø–æ–∑–∞–±—ã–≤":["OS-03"],"–ø—Ä–µ–¥–∞–Ω–∏—è":["OS-03"],"—á—É–∂—É—é":["OS-03"],"–∑–µ–º–ª—è–Ω–∫—É":["OS-03"],"–ø–æ—Å–º–µ–ª":["OS-03","OS-06"],"–∑–∞–ª–µ–∑—Ç—å":["OS-03"],"—Å–æ–≥—Ä–µ—Ç—å—Å—è":["OS-03","OS-10","OS-15"],"–ø–æ—Å–ø–∞—Ç—å":["OS-03"],"–ø–æ—á—Ç–µ–Ω–∏—è":["OS-03"],"–ø–µ—á–∫–∏":["OS-03"],"—Å—Ç–∞—Ä–∏–∫":["OS-03"],"–¥–æ–±—Ä–æ–¥—É—à–Ω—ã–π":["OS-03"],"—Å–∏–¥–µ–ª":["OS-03"],"—Ç–∞–∫–æ–≥–æ":["OS-03"],"–≤—Ç–æ—Ä–∂–µ–Ω–∏—è":["OS-03"],"–¥—ã–º":["OS-03"],"–æ–≥–Ω—è":["OS-03"],"—Å–æ–≥—Ä–µ–µ—Ç":["OS-03"],"—Å–º–µ—à–∞–µ—Ç—Å—è":["OS-03"],"–æ—Å—Ç–∞—Ç–∫–∞":["OS-03"],"–ª–∏—Ü–µ–º–µ—Ä–∏–µ":["OS-03"],"–≤–∏–¥–Ω–æ":["OS-03","OS-10"],"–∑–∞–≥–∞–¥–∫–∞":["OS-03"],"–∑–∞–∫–ª–∏–Ω–∞–Ω—å–µ":["OS-03"],"–¥–æ–±—Ä–∞":["OS-03"],"—Å–ø–∞—Å–ª–æ":["OS-03"],"–ø—Ä–∏–≥–æ—Ç–æ–≤–∏–º":["OS-03"],"–≤–º–µ—Å—Ç–µ":["OS-03","OS-08","OS-11"],"—Ç–æ–±–æ—é":["OS-03"],"–¥–æ–±—Ä–æ":["OS-03","OS-07"],"–ø–æ–∑–Ω–∞–µ—à—å":["OS-03"],"—Ç–≤–æ–µ–≥–æ":["OS-03"],"–æ—Ç–≤–µ—á–∞–µ—Ç":["OS-03"],"—à–∞–ø–∫—É":["OS-03"],"—Å—É–Ω—É–≤":["OS-03"],"–∫–∞—Ä–º–∞–Ω":["OS-03"],"—Ö–æ—á—É":["OS-03"],"–≤–Ω–∏–º–∞–Ω–∏—è":["OS-03"],"—Å–∫–æ–ª—å–∫–æ":["OS-03","OS-05","OS-10","OS-13"],"–ª–µ—á–∏—Ç—å":["OS-03"],"–≤–µ—á–Ω–æ":["OS-03"],"–∫–Ω–∏–∂–∫–∏":["OS-03"],"—É—á–∏—Ç—å":["OS-03"],"—á–µ–º—É":["OS-03"],"–≤—Ç–∏—Ä–∞–Ω–∏—è":["OS-03"],"–ª–æ–±":["OS-03"],"–Ω–∞—Ö–º—É—Ä–∏–ª":["OS-03"],"—Ä—É–∫–∏":["OS-03"],"–≤–º–∏–≥":["OS-03"],"–∑–∞—Å—É—á–∏–≤":["OS-03"],"–ø—Ä–æ–π–¥–∏":["OS-03"],"–∏—Å–ø—ã—Ç–∞–Ω–∏—è":["OS-03","OS-06"],"—Å–ø–∏—á–∫–∏":["OS-03"],"–≤–æ–∑—å–º–∏":["OS-03"],"–ø–µ—á—å":["OS-03"],"—Ä–∞—Å—Ç–æ–ø–∏":["OS-03"],"–∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è":["OS-03"],"–æ—Ç—Ä–∞–∂–µ–Ω—å–µ":["OS-03"],"—Ä–∞—Å—Ç–≤–æ—Ä–∏—Ç—Å—è":["OS-03"],"–≥–æ—Ç–æ–≤–∏—Ç—å":["OS-03"],"–≤–¥—ã—Ö–∞–π":["OS-03"],"—è–¥":["OS-03"],"—Ä–∞–±":["OS-03"],"–æ–±—Ä–µ–∫":["OS-03"],"—Å—Ç—Ä–∞–¥–∞–Ω–∏—è":["OS-03"],"–æ—Ç–ø—É—Å—Ç–∏":["OS-03"],"–∑–∞–∫—Ä–∏—á–∞–ª":["OS-03"],"–∫–æ–ª–µ–Ω–∏":["OS-03","OS-07"],"—É–ø–∞–≤":["OS-03"],"–∏—Å–ø—Ä–∞–≤–ª—é—Å—å":["OS-03"],"–¥–∞—é":["OS-03"],"–æ–±–µ—â–∞–Ω–∏–µ":["OS-03"],"–≤–∑–¥–æ—Ö–Ω—É–ª":["OS-03"],"—Å—Ç–∞–ª":["OS-03","OS-04"],"—Å—É—Ä–æ–≤":["OS-03"],"–ø—Ä–æ–∏–∑–Ω–µ—Å":["OS-03"],"—Å–≤–æ–µ":["OS-03"],"–∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ":["OS-03"],"–Ω–æ–≤–∞—è":["OS-03"],"–æ–Ω–∞":["OS-03"],"—Ö–æ–¥–∏—Ç":["OS-03"],"—Å–ª–µ–¥–æ–º":["OS-03"],"–ø–µ—Ä–µ—Å—Ç–∞–Ω—å":["OS-03"],"–Ω–∞–∑—ã–≤–∞—Ç—å":["OS-03"],"–±—Ä–µ–¥–æ–º":["OS-03"],"–ø–æ–¥–ª–æ–π":["OS-03"],"–∫–æ–ª—å":["OS-03"],"—Å–ø—Ä–∞–≤–∏–ª—Å—è":["OS-03"],"–∏—Å–ø—ã—Ç–∞–Ω–∏–µ–º":["OS-03"],"–≤–æ—Å–∫–ª–∏–∫–Ω—É–ª":["OS-03"],"—É—Ö–æ–¥–∏":["OS-03"],"–æ–±—Ä–µ–∫–∞—é":["OS-03"],"—Å–∫–∏—Ç–∞–Ω–∏—è":["OS-03"],"–ø–æ–ª–Ω–æ–ª—É–Ω–Ω—É—é":["OS-04"],"–≤—Å—Ç—Ä–µ—Ç–∏–≤":["OS-04"],"—Å—Ç–∞—Ä—Ü–∞":["OS-04"],"—Å–Ω–µ":["OS-04"],"–∑–ª–æ–±–Ω—ã–π":["OS-04"],"–≤–æ—Ä":["OS-04","OS-06"],"—É–∑–Ω–∞–µ—Ç":["OS-04"],"–¥–∞—Ç—É":["OS-04"],"—Å–º–µ—Ä—Ç–∏":["OS-04","OS-11"],"–∑–∞—â–µ–º–∏–ª":["OS-04"],"–¥—Ä–æ–∂—å—é":["OS-04"],"—Ç–µ–ª–æ":["OS-04","OS-08"],"–ø–ª–µ–Ω–∏–ª":["OS-04"],"–±–æ—è—Ç—å—Å—è":["OS-04"],"—Ö–æ—á–µ—Ç—Å—è":["OS-04","OS-13"],"–ø–æ–∂–∏—Ç—å":["OS-04"],"—É–∫—Ä–∞—Å—Ç—å":["OS-04"],"–∫—É–ø–∏—Ç—å":["OS-04"],"—É–∂–∞—Å–Ω–∞—è":["OS-04"],"–∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å":["OS-04"],"–∑–ª–æ–¥–µ–π—Å–∫–∏–µ":["OS-04"],"–¥–µ–ª–∞":["OS-04","OS-10"],"–Ω–∞–¥–ª–æ–º–∏–ª–∞—Å—å":["OS-04"],"–ª–∏—à–∏–ª—Å—è":["OS-04"],"–∑–∞—Ä–µ—é":["OS-04"],"–≥–ª–∞–∑–∞":["OS-04","OS-08","OS-10"],"–ø–µ–ª–µ–Ω–∞":["OS-04"],"—Å—Ç–∞–ª–∏":["OS-04"],"–¥–ª–∏–Ω–Ω–µ–π":["OS-04"],"–Ω–µ–π":["OS-04"],"–∑–∞–±—É–¥–µ—Ç":["OS-04"],"—Ö–ª–æ–ø–Ω—É–≤":["OS-04"],"–¥–≤–µ—Ä—å—é":["OS-04","OS-06","OS-10"],"–ø—Ä–æ–¥–ª–∏—Ç—å":["OS-04"],"—É–∫—Ä–∞–≤":["OS-04"],"–ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω—å–µ":["OS-04"],"–æ–±—Ö–∏—Ç—Ä–∏—Ç—å":["OS-04"],"—Å–ø–µ—à–∏":["OS-04"],"–ø—Ä–æ—â–µ–Ω–∏—è":["OS-04"],"–ø—Ä–æ—Å–∏—Ç—å":["OS-04"],"–∫–æ–º—É":["OS-04","OS-13"],"–ø—Ä–∏—á–∏–Ω–∏–ª":["OS-04"],"—á—å—é":["OS-04"],"–Ω–∞–ø—Ä–∞—Å–Ω–æ":["OS-04"],"—Å–≥—É–±–∏–ª":["OS-04"],"–∑–∞–∑–µ—Ä–∫–∞–ª—å–µ":["OS-05"],"–æ–ø–ª–µ—Ç–µ–Ω–Ω–æ–π":["OS-05"],"—Ç—É–º–∞–Ω–æ–º":["OS-05","OS-11"],"–æ–∑–µ—Ä–æ":["OS-05"],"—Ç–≤–æ–∏–º":["OS-05"],"—Ç–∞–ª–∏—Å–º–∞–Ω–æ–º":["OS-05"],"–≤–æ–ª–Ω—ã":["OS-05"],"–Ω–∞–¥–µ–∂–¥—ã":["OS-05"],"–æ—Ç—Ä–∞–∂–∞—é—Ç":["OS-05"],"–∑–Ω–∞–∫–æ–º—ã–µ":["OS-05"],"–¥–µ—Ç—Å—Ç–≤–∞":["OS-05"],"–∑–ª–æ–¥–µ–π—Å—Ç–≤–∞":["OS-05"],"—Å–º–æ—Ç—Ä—é":["OS-05"],"–±–µ–∑–¥–Ω—É":["OS-05"],"—Ü–∞—Ä—Å—Ç–≤–æ":["OS-05"],"–∏—Å–∫—É—à–µ–Ω–∏—è":["OS-05"],"—Ö–æ–ª–æ–¥":["OS-05"],"—Ç–µ–ø–ª–æ":["OS-05"],"—Å–æ–º–Ω–µ–Ω–∏—è":["OS-05"],"–ª–µ–±–µ–¥—è":["OS-05"],"–ø–ª—ã–≤—É—Ç":["OS-05"],"–Ω–∞–≤—Å—Ç—Ä–µ—á—É":["OS-05"],"–∑–Ω–∞–∫–æ–º—ã—Ö":["OS-05"],"–æ—Ç—Ä–∞–∂–µ–Ω–∏—è":["OS-05"],"–≤—ã–±–∏—Ä–∞–π":["OS-05"],"—Å–æ–∑–µ—Ä—Ü–∞–π":["OS-05"],"–∫—Ä—ã–ª—å—è":["OS-05"],"—Ä–∞—Å–ø—Ä–∞–≤–ª—è—é":["OS-05"],"–∑–≤–µ–∑–¥–∞–º":["OS-05"],"—É–ª–µ—Ç–∞—é":["OS-05"],"—Å–æ–º–Ω–µ–Ω–∏–π":["OS-05"],"–≥–æ–ª–æ—Å–∞":["OS-05"],"—Å–≤–µ—Ç—É":["OS-05"],"–≤—ã–≤–µ–¥—É—Ç":["OS-05"],"—Ä–∞—Å—Ü–≤–µ—Ç–µ—Ç":["OS-05"],"—Ä–æ–∑–∞":["OS-05"],"—Å–∞–¥—É":["OS-05"],"–¥–Ω–µ":["OS-05"],"—ç—Ç–∏—Ö":["OS-05"],"–≤–æ–¥":["OS-05"],"–æ—Ç–≥–æ–ª–æ—Å–∫–∏":["OS-05"],"–ø—Ä–∏–∑–Ω–∞–Ω–∏–π":["OS-05"],"–∑–∞–±—ã—Ç—ã—Ö":["OS-05"],"–º–µ—á—Ç–∞–Ω–∏–π":["OS-05"],"—Ç–µ–Ω–∏":["OS-05"],"–≤—á–µ—Ä–∞—à–Ω–∏—Ö":["OS-05"],"–ø–æ—Ç–µ—Ä—å":["OS-05"],"–∑–∞—Ç–∏—Ö–∞—é—Ç":["OS-05"],"–∑–≤–µ–∑–¥—ã":["OS-05","OS-09"],"—É–ø–∞–≤—à–∏–µ":["OS-05"],"–æ—Å–≤–µ—â–∞—é—Ç":["OS-05"],"–ø–∞–¥–∞—é":["OS-05"],"–≤–≥–ª—É–±—å":["OS-05"],"–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è":["OS-05"],"–∏—Å—Ç–æ–∫—É":["OS-05"],"–Ω–∏":["OS-05","OS-06","OS-07"],"–≤–∏–Ω—ã":["OS-05"],"–∑–∞–±–≤–µ–Ω–∏—è":["OS-05"],"–±–µ–∂–∞–ª–∞":["OS-05"],"–Ω–∞—Å—Ç–æ—è—â–µ–π":["OS-05"],"–ø—Ä—è—Ç–∞–ª–∞":["OS-05"],"–±–ª–µ—Å—Ç—è—â–µ–π":["OS-05"],"–ª–∂–∏–≤—ã–µ":["OS-05"],"—Å—Ç–µ–Ω—ã":["OS-05"],"–Ω–∞–∑—ã–≤–∞–ª–∞":["OS-05"],"–∑–∞—â–∏—Ç–æ–π":["OS-05"],"—Ç–µ—Ä—è—è":["OS-05","OS-14"],"–¥–æ—Ä–æ–≥–µ":["OS-05","OS-14"],"–∏–∑–±–∏—Ç–æ–π":["OS-05"],"–º–æ–ª—á–∞–ª–∞":["OS-05"],"–∑–∞–¥—ã—Ö–∞—è—Å—å":["OS-05"],"–±–æ–ª–∏":["OS-05","OS-08","OS-09"],"–æ—Ç—Ä–µ–∫–∞—è—Å—å":["OS-05"],"—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π":["OS-05","OS-13"],"–≤–æ–ª–∏":["OS-05"],"–æ–±–Ω–∏–º–∞—é":["OS-05"],"—Ç—É":["OS-05"],"–ø–ª–∞–∫–∞–ª–∞":["OS-05"],"–¥–æ—Å—Ç–æ–π–Ω–∞":["OS-05"],"–≤–¥–≤–æ–π–Ω–µ":["OS-05"],"—Å—Ç—Ä–∞—Ö–∏":["OS-05"],"–æ—Ç–ø—É—Å–∫–∞—é":["OS-05"],"–º—É–º–∏—è":["OS-06"],"—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å":["OS-06"],"–¥—Ä–µ–≤–Ω–∏—Ö":["OS-06"],"–∫–ª–∞–¥–æ–≤":["OS-06"],"—Å–∫—Ä—ã—Ç—ã":["OS-06"],"–Ω–µ–¥—Ä–∞—Ö":["OS-06"],"—Å—Ç–∞—Ä—ã—Ö":["OS-06"],"–ø–∏—Ä–∞–º–∏–¥":["OS-06"],"–ø—Ä–∏—à–ª–∏":["OS-06"],"–≥—Ä–∞–±–∏—Ç–µ–ª–∏":["OS-06"],"—Å–º–µ–ª–µ–µ":["OS-06","OS-14"],"–Ω–∞—Ö–∞–ª–æ–≤":["OS-06"],"—Å—É–Ω–¥—É–∫–∏":["OS-06"],"–±–æ–≥–∞—Ç—Å—Ç–≤–æ–º":["OS-06"],"—É—Ç–∞—â–∏—Ç—å":["OS-06"],"—Å—é–¥–∞":["OS-06"],"–ø—Ä–∏–π—Ç–∏":["OS-06"],"–∫—Ä–∞—Å—Ç—å":["OS-06"],"—Å–æ–∫—Ä–æ–≤–∏—â–∞":["OS-06"],"–¥–µ—Ä–∑–∫–∏–µ":["OS-06"],"–≤–æ—Ä–∏—à–∫–∏":["OS-06"],"–∫–∞–∫–∏–µ":["OS-06"],"–∂–¥—É—Ç":["OS-06"],"–∫–∞–ø–ª–∏":["OS-06"],"—Å–æ–∂–∞–ª–µ–Ω—å—è":["OS-06"],"–ª–æ–≤—É—à–∫–∏":["OS-06"],"–æ—Å—Ç–∞–≤—è—Ç":["OS-06"],"—Å—Ç—É–ø–∏—Ç–µ":["OS-06"],"–ø–µ—Ä–≤–æ–º—É":["OS-06"],"–ø–æ—Ä–æ–≥—É":["OS-06"],"—Ç—è–∂–µ–ª—ã–π":["OS-06"],"–∫–∞–º–µ–Ω—å":["OS-06"],"—Å–≤–µ—Ä—Ö—É":["OS-06"],"–ø—Ä–∏–ª–µ—Ç–∏—Ç":["OS-06"],"–∫–æ–≥–æ":["OS-06","OS-13"],"–º–∏–Ω—É–µ—Ç":["OS-06"],"–ø—Ä–æ–≤–∞–ª—è—Ç—Å—è":["OS-06"],"–∫–æ–ª–æ–¥–µ—Ü":["OS-06"],"–º–µ—Ä–∑–∫–∏—Ö":["OS-06"],"–≥–Ω–∏–¥":["OS-06"],"–≤—ã–±—Ä–∞–ª—Å—è":["OS-06"],"–∂–∏–≤–æ–π":["OS-06","OS-08"],"–ø–æ–ª–∑–∏":["OS-06"],"—É–∫—Ä–∞–¥–∫–æ–π":["OS-06"],"–±—É–¥—É—Ç":["OS-06","OS-10"],"–ø—Ä–æ–π–¥–µ—à—å":["OS-06"],"–ª–∏":["OS-06"],"–∑–∞–ª":["OS-06"],"–æ–≥–Ω–µ–Ω–Ω—ã–º":["OS-06"],"–ø–æ–¥–∞—Ä–∫–æ–º":["OS-06"],"—Å—Ç—Ä—É—Å–∏–ª":["OS-06"],"—ç–π":["OS-06"],"–≤—Ö–æ–¥–∞":["OS-06"],"–±—ã–ª":["OS-06","OS-07"],"—Å–º–µ–ª–µ–π":["OS-06"],"—Å–∞–º—ã—Ö":["OS-06"],"–ª–æ–≤–∫–∏—Ö":["OS-06"],"—É–ø–æ—Ä–Ω—ã—Ö":["OS-06"],"—Ä–∞–±—ã":["OS-06"],"–ø–æ–π–¥—É—Ç":["OS-06"],"—Å—Ç–µ–Ω–æ–π":["OS-06"],"–∞—Ç–∞–∫—É":["OS-06"],"–≤–≥—Ä—ã–∑—É—Ç—Å—è":["OS-06"],"–ø–æ–π–º–µ—à—å":["OS-06"],"–∫—É–¥–∞":["OS-06","OS-12"],"–ø–æ–ø–∞–ª":["OS-06"],"—Å—Ç–∞–Ω–µ—à—å":["OS-06"],"–º—É–º–∏–µ–π":["OS-06"],"–¥–µ—Ä–∂–∏":["OS-06"],"–Ω–∞–≥—Ä–∞–¥—É":["OS-06"],"–µ–¥–∏–Ω—ã–π":["OS-06"],"—à–∞–π–∫–∏":["OS-06"],"–±–µ–∑—Ä–∞—Å—Å—É–¥–Ω–æ–π":["OS-06"],"—Å–º–æ–≥":["OS-06"],"–¥–æ–±—ã—Ç—å":["OS-06"],"–∫–ª–∞–¥–∞":["OS-06"],"–∫–ª—é—á–∞":["OS-06"],"—Ö–æ–∑—è–π–∫–∞":["OS-06"],"–ø–∏—Ä–∞–º–∏–¥—ã":["OS-06"],"—Å—Ç–∞–Ω—É—Ç":["OS-06"],"–≤–∫—É—Å–Ω–æ–π":["OS-06"],"–ø–∏—â–µ–π":["OS-06"],"–∑–∞–≤–∏—Å—Ç–∏":["OS-07"],"–ª–∂–∏":["OS-07"],"–ø–∞—Ä–æ—á–Ω–æ–º":["OS-07"],"—á–µ–ª–æ–≤–µ–∫–∞":["OS-07"],"—Å—Ç—Ä–µ–º–∏—à—å—Å—è":["OS-07"],"–º–µ—á—Ç–µ":["OS-07"],"–∑–∞—Ç—Ä–∞—Ç–∏–ª":["OS-07"],"–ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–π":["OS-07"],"—Å–ª–µ–∑–∞–º–∏":["OS-07"],"–∑–∞–ø–ª–∞–∫–∞—Ç—å":["OS-07"],"—Å–±—ã—Ç—å—Å—è":["OS-07"],"–∫–æ–≤–∞—Ä—Å—Ç–≤–æ":["OS-07"],"—Ç–∞–∫–æ–≤":["OS-07"],"–Ω–µ–≥–æ–¥—è—è":["OS-07"],"—Ç–∞–∫–∏—Ö":["OS-07"],"–∏–∑–±–µ–≥–∞–π":["OS-07"],"–ø—Ä–µ–∑–∏—Ä–∞–π":["OS-07"],"–∂–∏–≤–µ–º":["OS-07","OS-14"],"—É–±–∏–≤–∞–µ–º":["OS-07"],"–∂–µ—Å—Ç–æ–∫–∏–π":["OS-07"],"—Å–ª–∞–±—ã–º":["OS-07"],"–Ω–µ–≥–æ–¥—è–µ–≤":["OS-07"],"–∫–∞–∫–∏–º":["OS-07"],"—Å–∏–ª—å–Ω—ã–º":["OS-07"],"–∑–ª—ã—Ö":["OS-07"],"—Å–ª–∞–±–∞–∫":["OS-07"],"–∫–ª—è—Ç–≤–µ–Ω–Ω–æ":["OS-07"],"–≤–ª—é–±–∏—Ç—å—Å—è":["OS-07","OS-08"],"–ª—é–±–∞—è":["OS-07"],"—Ç—Ä—É–¥–Ω–æ—Å—Ç—å":["OS-07"],"–ø–æ–∫–æ—Ä–∏—Ç—Å—è":["OS-07"],"—Å—É–º–µ–π":["OS-07"],"–Ω–∞–π—Ç–∏":["OS-07","OS-13"],"–∏–∑—ä—è–Ω":["OS-07"],"—á–µ—Å—Ç—å":["OS-07"],"–∫–∞–ø–∏—Ç–∞–Ω":["OS-07"],"–ª—é–±—ã—Ö":["OS-07"],"–∑–ª–æ–¥–µ–π—Å—Ç–≤":["OS-07"],"—Ä–∞–∑—Ä—É—à–∞—Ç":["OS-07"],"–ø–ª–∞–Ω":["OS-07"],"–ø—Ä–æ—Ç–∏–≤":["OS-07"],"–≤–µ—á–Ω—ã—Ö":["OS-07"],"–ø—Ä–∞–≤–∏–ª":["OS-07"],"–ø–æ—Ç–µ—Ä–ø–∏":["OS-07"],"–≥—Ä—è–∑–Ω—ã—Ö":["OS-07"],"–∏–≥—Ä":["OS-07"],"–ø—Ä–∞–≤—è—Ç":["OS-07"],"–ø–∞–ª–∞—á–∏":["OS-07"],"–ø—Ä–æ–¥–∞—é":["OS-07"],"—Ö–æ—Ç—å":["OS-07","OS-13"],"–ø–ª–∞—Ç–∏":["OS-07"],"–ª—É—á—à–µ":["OS-07"],"—á–µ—Å—Ç–Ω–æ–π":["OS-07"],"—Ç–æ–ª–ø—ã":["OS-07"],"–≤—Å—Ç–∞–Ω—É":["OS-07"],"–≤–æ–ø—Ä–µ–∫–∏":["OS-07"],"—Å—Ç—Ä–∞—à–Ω–æ":["OS-07"],"—Å–≤–µ—Ç—è—Ç":["OS-07","OS-09"],"–º–∞—è–∫–∏":["OS-07"],"–¥–∞–≤—è—Ç":["OS-07"],"–≥–æ—Ä–ª–æ":["OS-07"],"–≤—ã–±–µ—Ä—É":["OS-07"],"–∫—Ä–∏—á–∞—Ç—å":["OS-07"],"–º–Ω–æ–π":["OS-07","OS-12"],"–∑–∞–º–æ–ª—á–∞—Ç—å":["OS-07"],"–±—ç–ª–ª–∞":["OS-08"],"–±–µ—Å—Å–º–µ—Ä—Ç—å–µ":["OS-08"],"—Å—Ç–∞–ª–æ":["OS-08"],"–≤—ã—Å—à–∏–º":["OS-08"],"–¥–∞—Ä–æ–º":["OS-08"],"–Ω–∞–ª–∏—Ç—ã":["OS-08"],"–ª—É–Ω–Ω—ã–º":["OS-08"],"—Å–≤–µ—Ç–æ–º":["OS-08"],"–ª—å–¥–æ–º":["OS-08"],"–∑–∞–º–µ—Ä–∑–∞—é":["OS-08"],"–≤–∞–º–ø–∏—Ä":["OS-08"],"—Å–∫—Ä—ã–≤–∞—é":["OS-08"],"–∑–≤–µ—Ä—å":["OS-08","OS-09"],"–º–æ–Ω—Å—Ç—Ä":["OS-08"],"–º—Ä–∞–∫–µ":["OS-08"],"—Ç–∞–π–Ω":["OS-08"],"–∑–≤—É—á–∏—Ç":["OS-08"],"—É–≥–æ—Ä–∞–∑–¥–∏–ª–æ":["OS-08"],"–Ω–µ–≥–æ":["OS-08"],"—Å—É–º–µ—Ä–∫–∞—Ö":["OS-08"],"–Ω–∞—à–ª–∞":["OS-08"],"–≤–∞–º–ø–∏—Ä—Å–∫–∞—è":["OS-08"],"—á–µ–ª–æ–≤–µ–∫–æ–º":["OS-08"],"–≤–µ—á–Ω–æ—Å—Ç—å":["OS-08","OS-11"],"–ø—Ä–æ–π–¥–µ–º":["OS-08"],"–ø—Ä–µ–≥—Ä–∞–¥—ã":["OS-08"],"–æ–¥–æ–ª–µ–≤":["OS-08"],"–±–µ—Å—Å–º–µ—Ä—Ç–Ω—ã":["OS-08"],"—Å–∫—Ä—ã–≤–∞—Ç—å—Å—è":["OS-08"],"–≤—Ä–∞–≥–æ–≤":["OS-08"],"—Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é":["OS-08"],"—Å–∏—è—é—Ç":["OS-08"],"–ø–æ–ª–Ω–∞":["OS-08"],"—á—É–¥–µ—Å":["OS-08"],"—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏":["OS-08"],"–ø–æ–º–æ–≥–∞—é—Ç":["OS-08"],"—â–∏—Ç":["OS-08"],"–∑–∞—â–∏—Ç–∏—Ç":["OS-08"],"–∏–º—è":["OS-08"],"–∏–∑–≤–µ—Å—Ç–Ω–æ":["OS-08"],"—Å–ø–ª–µ–ª–∏—Å—å":["OS-08"],"—Ç–µ–ª–∞":["OS-08","OS-11"],"—Å–æ–ª–Ω—Ü–µ":["OS-08","OS-09"],"—è—Ä—á–µ":["OS-08"],"–ø–æ–≥–∞—Å–∏—Ç—å":["OS-08"],"–ª—É–Ω–Ω—ã–π":["OS-08","OS-09"],"–ø–ª–µ—á–æ–º":["OS-08"],"–ø–ª–µ—á—É":["OS-08"],"–Ω–∏–∫–∞–∫":["OS-08"],"–ø–ª–∞—á–µ—Ç":["OS-08","OS-12"],"—Å—É–º–µ—Ä–∫–∏":["OS-08"],"–ª—É–Ω–∞":["OS-09"],"–≤—Å—Ç–∞–Ω–µ—Ç":["OS-09"],"–∑–∞–π–¥–µ—Ç":["OS-09"],"—Ç—å–º–∞":["OS-09"],"–∑–∞–±–µ—Ä–µ—Ç":["OS-09"],"—Ä–∞–∑–æ–±—å–µ—Ç":["OS-09"],"—à–µ—Ä—Å—Ç—å":["OS-09"],"–æ–±–µ—Ä–Ω–µ—Ç":["OS-09"],"–≤–µ—Ç–µ—Ä":["OS-09"],"–ø–æ–µ—Ç":["OS-09","OS-13"],"–Ω–æ–≤–æ–º":["OS-09"],"–æ–±–ª–∏—á—å–µ":["OS-09"],"—Å–∏–ª—É":["OS-09"],"—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è":["OS-09"],"—Ä—ã—á–∞":["OS-09"],"–≤–æ–π–¥—É":["OS-09"],"–∫—Ä—É–≥":["OS-09"],"–Ω–µ—Ç—É":["OS-09"],"—Å–ø–∞—Å–µ–Ω—å—è":["OS-09"],"–∏–º–µ–Ω":["OS-09"],"–ø–ª–µ—á–∞—Ö":["OS-09"],"–æ–±—Ä–∞—Ç–∏—Ç—Å—è":["OS-09"],"–¥–æ–∂–¥–∞—Ç—å—Å—è":["OS-09"],"–ø–µ—Ä–≤–æ–≥–æ":["OS-09"],"—Å–≤–µ—Ç–∞":["OS-09"],"–ª—É–Ω—ã":["OS-09"],"–Ω–∞—á–Ω–µ—Ç—Å—è":["OS-09"],"–≤–µ—á–Ω—ã–π":["OS-09"],"–±–æ—Ä—å–±–∞":["OS-09"],"—Å—Ç—Ä–∞–¥–∞–Ω—å—è":["OS-09"],"—Ç—É–º–∞–Ω":["OS-09"],"–æ—Å—Ç–∞–Ω–µ—Ç—Å—è":["OS-09"],"–∏—Å–∫—Ä–∞":["OS-09"],"—Ç–µ–ø–ª–∞":["OS-09"],"–Ω–∞–≤–µ–∫":["OS-09"],"–∑–∞–±—Ä–∞–ª–∞":["OS-09"],"–≤—Å–∫–æ—Ä–µ":["OS-09"],"–≤—Å—Ç—Ä–µ—á—É":["OS-09"],"–æ—Ç—Å—Ç—É–ø–∏—Ç":["OS-09"],"—É–∂":["OS-09"],"—à–ª–∞":["OS-10"],"–¥–æ—Ä–æ–∂–∫–µ":["OS-10"],"–Ω–æ–≥–∏":["OS-10"],"–¥—Ä—É–≥—É—é":["OS-10","OS-11"],"–Ω–æ–∂–∫—É":["OS-10"],"–Ω–∏–∫–æ–º—É":["OS-10"],"–º–µ—à–∞—è":["OS-10"],"–≤–¥—ã—Ö–∞—è":["OS-10"],"–Ω–∞–ª–µ—Ç–µ–ª–∞":["OS-10"],"—Ç—É—á–∫–∞":["OS-10"],"–∑–∞—Å–∫—Ä–∏–ø–µ–ª–∞":["OS-10"],"—Ä—É—á–∫–∞":["OS-10"],"–ø–æ–¥—ä–µ–∑–¥":["OS-10"],"–∑–∞–±–µ–∂–∞–ª–∞":["OS-10"],"–ø—Ä–æ–º–æ–∫–ª–∞":["OS-10"],"–±–æ—Å–∞—è":["OS-10"],"—Ç–∞–∫–∞—è":["OS-10"],"–Ω–∏—Ç–∫–∞":["OS-10"],"–Ω–∏—Ç–æ—á–∫–∞":["OS-10"],"–≤—è–∂–∏":["OS-10"],"—Å–≤–æ–∏":["OS-10","OS-14"],"—É–∑–ª—ã":["OS-10"],"–ø–µ—Ç–ª—è–π":["OS-10"],"—Å—Ç–æ—Ä–æ–Ω–∞–º":["OS-10"],"—Ç—Ä–µ–ø–∏":["OS-10"],"–Ω–µ—Ä–≤—ã":["OS-10"],"—É–∫–∞–∂–∏":["OS-10"],"–ø—Ä–∏–≤–µ–¥–∏":["OS-10"],"—Ç—É–¥–∞":["OS-10"],"–∂–∏–≤–µ—Ç":["OS-10","OS-13"],"–∑–∞–º–µ—Ä–∑–ª–∏":["OS-10"],"—Å–∫–∞–∑–∞–ª":["OS-10"],"–ª–∏—Ü–æ":["OS-10"],"–ø–æ–∫—Ä–∞—Å–Ω–µ–ª–æ":["OS-10"],"–ø—Ä–æ–¥–æ–ª–∂–∞–ª":["OS-10"],"–∑–∞—Å—Ç—É—á–∞–ª–æ":["OS-10"],"—á–µ–≥–æ":["OS-10"],"–ø—Ä–∏—Å—Ç–∞–ª":["OS-10"],"—É–ª–∏—Ü–µ":["OS-10"],"–≥—Ä–æ—Ö–æ—Ç":["OS-10"],"–Ω–∞–¥–æ–ª–≥–æ":["OS-10"],"–≥—Ä–æ–∑–∞":["OS-10"],"–≤—Å—Ç—Ä–µ—Ç–∏–ª–∏—Å—å":["OS-10"],"–≤–∑–≥–ª—è–¥–æ–º":["OS-10"],"—Å—Ç–∏—Ö–ª–æ":["OS-10"],"—Å–≤–æ–¥–∏–º":["OS-10"],"–º–∏–º–æ":["OS-10"],"–ø—Ä–æ—à–ª–∞":["OS-10"],"–ø–ª–µ—Å—Ç–∏":["OS-10"],"–Ω–∏—Ç–∏":["OS-10"],"–ø–æ–¥–≤–ª–∞—Å—Ç–Ω—ã":["OS-10"],"–æ–Ω–∏":["OS-10","OS-15"],"–ø–æ—á–µ–º—É":["OS-10"],"–ø–æ—à–ª–∞":["OS-10"],"–ø—Ä—è–º–æ":["OS-10"],"—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ":["OS-10"],"–∑–Ω–∞–∫":["OS-10"],"—Å–≤—ã—à–µ":["OS-10"],"—Å–∫–∞–∂–µ—Ç":["OS-10"],"–ø—Ä—è–º":["OS-10"],"—Ç–æ—á–Ω–æ":["OS-10"],"–Ω–∞—É—á–∏—Ç—å—Å—è":["OS-10"],"—Å—É–¥—å–±–µ":["OS-10"],"–¥–æ–≤–µ—Ä—è—Ç—å":["OS-10"],"–≤–µ—Ä–∏—Ç—å":["OS-10"],"–ø—Ä–æ—Å–ø–∞—Ç—å":["OS-10"],"–ø—Ä–æ—à–ª–∏":["OS-10"],"—Å–æ—á—Ç–µ–Ω—ã":["OS-10"],"—É–∑–Ω–∞–µ–º":["OS-10"],"—É—Å—Ç—Ä–æ–µ–Ω–∞":["OS-10"],"–ø–æ–≤–µ—Ä–∏—à—å":["OS-10"],"—Ö—ç–ø–ø–∏":["OS-10"],"—ç–Ω–¥":["OS-10"],"–ø—Ä–∏–≤–µ–¥–µ—Ç":["OS-10"],"–¥–æ–±—Ä–æ—Ç–∞":["OS-10"],"–±—ã–ª–∏":["OS-11"],"–¥–µ–ª–∏–ª–∏":["OS-11"],"–ø—Ä–∏—à–ª–∞":["OS-11"],"–∑–∞–±—Ä–∞–≤":["OS-11"],"–ø–æ—Ö–æ—Ä–æ–Ω–∏–≤":["OS-11"],"—Å—ã—Ä–æ–π":["OS-11"],"—Ç—Ä—É–ø–∞":["OS-11"],"—Ö–æ–ª–æ–¥–Ω–æ–π":["OS-11"],"–∑–µ–º–Ω–∞—è":["OS-11"],"–±–µ–∑–¥–Ω–∞":["OS-11"],"–ø—Ä–∏—é—Ç–∏–ª–∞":["OS-11"],"–æ–±—ä—è—Ç—ã":["OS-11"],"–¥–∏–≤–Ω—ã—Ö":["OS-11"],"–≤–µ–∫–æ–º":["OS-11"],"—Ç—å–º—ã":["OS-11"],"–ª–µ–∂–∏–º":["OS-11"],"—Ç–∏—à–∏":["OS-11"],"–ø—Ä–æ—Å–∏–º":["OS-11"],"–∂–∏–ª–∏":["OS-11"],"–ª—É–Ω–æ–π":["OS-11"],"–¥—ã—à–∞–ª–∏":["OS-11"],"–≤–ø–∏–≤–∞—è":["OS-11"],"—Å–≤–µ–∂–∏–π":["OS-11"],"–ª–µ—Ç–Ω–∏–π":["OS-11"],"–ª–µ–∂–∞–ª–∏":["OS-11"],"—Å–ª–∞–¥–æ—Å—Ç–Ω—ã—Ö":["OS-11"],"—à–µ–ª–µ—Å—Ç":["OS-11"],"–ª–∏—Å—Ç—å–µ–≤":["OS-11"],"–ø–µ–Ω—å–µ":["OS-11"],"–ø—Ç–∏—Ü":["OS-11"],"–∫–ª—è–ª–∏—Å—å":["OS-11"],"–ª—é–±–∏—Ç—å":["OS-11"],"–ø—Ä–æ–≤–æ–¥–∏—Ç—å":["OS-11"],"—Ç–µ—Å–Ω–æ":["OS-11"],"–±–ª–∏–∑–∫–æ":["OS-11"],"—Å–º–æ–∂–µ—Ç":["OS-11"],"—Ä–∞–∑–ª—É—á–∏—Ç—å":["OS-11"],"–∑–∞–≥—Ä–æ–±–Ω—ã–π":["OS-11"],"—á—Ä–µ–≤–æ":["OS-11"],"–º–∞–º—ã":["OS-11"],"—É–º—Ä–µ–º":["OS-11"],"—Ç–µ–ª–∞–º–∏":["OS-11"],"–æ–±—Ä–µ—Ç–µ—Ç":["OS-11"],"–ø–æ–∑–æ–≤–µ—Ç":["OS-11"],"—Ç—Ä–∞–≤—É":["OS-12"],"–ø–æ–≤–∞–ª–∏–ª":["OS-12"],"—Ç–∞–Ω—Ü—É–µ—à—å":["OS-12"],"–º–∞–∫–æ–≤":["OS-12"],"–∑–∞–ª–∏–≤":["OS-12"],"–æ–±–ª–∞–∫–∞":["OS-12"],"—Ä–∏—Å—É–µ—à—å":["OS-12"],"—É–∑–æ—Ä–æ–º":["OS-12"],"—Ç—Ä–æ–Ω—É–ª":["OS-12"],"–≤–µ—Ç–∫—É":["OS-12"],"–∫–ª–µ–Ω–∞":["OS-12"],"–ª–∏—Å—Ç":["OS-12"],"–Ω–µ–∂–Ω–æ":["OS-12"],"–¥—ã—Ö–∞–Ω—å–µ":["OS-12"],"–ø—Ä–æ—Å—Ç–æ—Ä–∞":["OS-12"],"–æ—Ç–∫–ª–∏–∫":["OS-12"],"–¥–∞–ª":["OS-12"],"–≤–µ—Ç–µ—Ä–æ–∫":["OS-12"],"—Å–æ–ª—å–µ—Ç—Å—è":["OS-12"],"–±–µ—Ä–µ–∑—ã":["OS-12"],"–ª—É–≥–∞–º–∏":["OS-12"],"—á–∞—Å—Ç—å—é":["OS-12"],"–æ–¥–Ω–æ–π":["OS-12"],"—Å–≤–µ–¥–µ–Ω—ã":["OS-12"],"—Å—É–¥—å–±–æ–π":["OS-12"],"–∑–Ω–∞–µ—à—å":["OS-12"],"—Å—Ç—Ä–∞—à–Ω–æ–π":["OS-12"],"–≥—Ä–æ–∑–æ–π":["OS-12"],"–¥—Ä–æ–∂–∞—Ç":["OS-12"],"–ª–∏—Å—Ç—å—è":["OS-12"],"—Å—É—Ä–æ–≤–æ–π":["OS-12"],"–ø–æ—Ä–æ–π":["OS-12"],"–∑–∞–º–∏—Ä–∞–µ—Ç":["OS-12"],"—É—Å–ª—ã—à–∞—Ç—å":["OS-12"],"–Ω–∞–ø–µ–≤":["OS-12"],"—Ä–∞—Å–∫–∞—Ç–∞–º–∏":["OS-12"],"–≥—Ä–æ–º–∞":["OS-12"],"–Ω–µ—Å–µ—Ç—Å—è":["OS-12"],"–ª—É—á–∞—Ö":["OS-12"],"—è—Ä–∫–æ–π":["OS-12"],"–æ—Ç–±–ª–µ—Å–∫":["OS-12"],"–ø–æ—Å—Ç–æ–π":["OS-12"],"—É–Ω–µ—Å–∏":["OS-12"],"–ø–µ—Å–Ω—é":["OS-12"],"–ø—Ä–æ—Å—Ç–æ—Ä—ã":["OS-12"],"–∫—Ä—ã–ª—å–µ–≤":["OS-12"],"—Å–ø–∏–Ω–æ–π":["OS-12","OS-13"],"–º–≥–Ω–æ–≤–µ–Ω—å—è":["OS-12"],"–ø—Ç–∏—Ü—ã":["OS-12"],"–ª–µ—Ç—è—Ç":["OS-12"],"–∫–∞–∂–¥–æ–≥–æ":["OS-13"],"—Å–≤–æ—è":["OS-13"],"–º–µ—á—Ç–∞":["OS-13"],"—É—á–∏—Ç–µ–ª—å":["OS-13"],"—Ç–µ—Ä–Ω–∏–∏":["OS-13"],"–ø—Ä–æ–≤–µ–¥–µ—Ç":["OS-13"],"—Å–±–µ—Ä–µ–∂–µ—Ç":["OS-13"],"—Ä—É–∫–∞":["OS-13"],"–ø–æ–¥—Å–∫–∞–∂–µ—Ç":["OS-13"],"—É–π–¥–µ—Ç":["OS-13"],"—Ä–æ–∂–¥–µ–Ω":["OS-13"],"—à–µ–ª–∫–æ–≤":["OS-13"],"–±–ª–∞–≥":["OS-13"],"–æ—Ç—Ç–æ—á–µ–Ω":["OS-13"],"–∏–∑–º–µ—Ä–µ–Ω":["OS-13"],"—Ä–æ–∂–¥–µ–Ω—å—è":["OS-13"],"–º—É–∑—ã–∫–æ–π":["OS-13"],"–≤–∑–ª–µ—Ç":["OS-13"],"–ø–µ—Ä–≤—ã—Ö":["OS-13"],"–ø–µ–ª–µ–Ω–∫–∞—Ö":["OS-13"],"–º–æ—Ä—â–∏–Ω":["OS-13"],"–∫–æ—Ä–∞–±–ª–∏":["OS-13"],"–ø–æ–ø–∞–¥–∞—é—Ç":["OS-13"],"—à—Ç–æ—Ä–º":["OS-13"],"—Å–∂–∏–≥–∞–µ–º":["OS-13"],"–º–æ—Å—Ç—ã":["OS-13"],"–Ω–µ—É–¥–∞—á":["OS-13"],"–±–∏–ª–∏":["OS-13"],"–æ—Ç—Å—Ç—É–ø–∞—è":["OS-13"],"–ø—Ä–∏–±–ª–∏–∂–∞–µ–º":["OS-13"],"–∑–≤–µ–∑–¥–Ω—ã–π":["OS-13"],"—à—Ç—É—Ä–º—É—è":["OS-13"],"–∏–¥–µ–º":["OS-13"],"—Å–≤–æ–µ—é":["OS-13"],"–º–µ—á—Ç–æ–π":["OS-13"],"—É—á–∏—Ç—Å—è":["OS-13"],"–ø—ã—Ç–∞–µ—à—å—Å—è":["OS-13"],"—Å—Ç—Ä—É–Ω—É":["OS-13"],"–∑–∞—Å—Ç–∞–≤–∏—Ç—å":["OS-13"],"–ø–µ—Ç—å":["OS-13"],"–Ω–µ–≤–∞–∂–Ω–æ":["OS-13"],"—Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π":["OS-13"],"—É—á–µ–±–µ":["OS-13"],"–ø—Ä—è—á—å—Å—è":["OS-13"],"—Ç—Ä–µ–≤–æ–≥–µ":["OS-13"],"–±—Ä–æ—Å–∏—Ç—å":["OS-13"],"—É–π—Ç–∏":["OS-13"],"–ø–æ–π—Ç–∏":["OS-13"],"–∏–≥—Ä–∞—Ç—å":["OS-13"],"—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å":["OS-13"],"–ª—é–±–∏—Ç":["OS-13"],"—É—Ä–æ–∫–∏":["OS-13"],"–º—É–∑—ã–∫–∏":["OS-13"],"—É—Ç—Ä–æ":["OS-14"],"–≤–µ—á–µ—Ä–∞":["OS-14"],"–º—É–¥—Ä–µ–µ":["OS-14"],"–ø–æ—Å–ª–æ–≤–∏—Ü–∞":["OS-14"],"–≥–ª–∞—Å–∏—Ç":["OS-14"],"—Å–ø–µ—à–∏–º":["OS-14"],"–ø—Ä–æ–∂–∏—Ç—å":["OS-14"],"—Ä–µ–∫—É":["OS-14"],"–ø–µ—Ä–µ–ø–ª—ã—Ç—å":["OS-14"],"–∑–∞–π—Ü–∞–º–∏":["OS-14"],"–ø–æ–≥–Ω–∞–ª–∏—Å—å":["OS-14"],"—É–ø–∞–ª–∏":["OS-14"],"–ø–æ–¥–Ω—è–ª–∏—Å—å":["OS-14"],"–≥—Ä—è–∑–∏":["OS-14"],"–∫–Ω—è–∑–∏":["OS-14"],"—Å–¥–∞–ª–∏—Å—å":["OS-14"],"–≤–æ–ª–∫":["OS-14"],"–ø—è—Ç–∞–º":["OS-14"],"–≥–µ—Ä–æ–∏":["OS-14"],"–∑–ª–æ–¥–µ–∏":["OS-14"],"–≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è":["OS-14"],"—Å–∫–æ—Ä–æ":["OS-14"],"—Å–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è":["OS-14"],"–∫—É—Å–∞–µ—Ç—Å—è":["OS-14"],"—Å–∫–∞–∑–∫—É":["OS-14"],"–ø–æ–≤—Å—Ç—Ä–µ—á–∞–µ–º":["OS-14"],"—á—É–¥–µ—Å–∞":["OS-14"],"–º–µ–Ω—è—é—Ç":["OS-14"],"–¥–æ–≤–µ—Ä—è–π":["OS-14"],"—Å–≤–æ–∏–º":["OS-14"],"—á—É–≤—Å—Ç–≤–∞–º":["OS-14"],"–±–µ—Ä–µ–≥–∏":["OS-14"],"–¥–æ—Ä–æ–≥–∏":["OS-14"],"—Å–≤–µ—Ä–Ω–∏":["OS-14"],"—Å–∫—Ä–æ–ª–ª–∏–º":["OS-14"],"–ª–µ–Ω—Ç—É":["OS-14"],"–ø–æ—Ä–æ—á–Ω—ã–µ":["OS-14"],"–∏–ª–ª—é–∑–∏–∏":["OS-14"],"—Ñ–∏–ª—å—Ç—Ä—ã":["OS-14"],"–º–∞—Å–∫–∏":["OS-14"],"—á—É–∂–∏–º–∏":["OS-14"],"–º–µ—á—Ç–∞–º–∏":["OS-14"],"–¥–æ—Ä–æ–≥–∞":["OS-14"],"—Å—á–∞—Å—Ç–ª–∏–≤—ã":["OS-14"],"–æ—Å—Ç–∞–≤—å":["OS-14"],"–ø–æ—Ä–æ–≥–æ–º":["OS-14"],"—Å–æ–º–Ω–µ–Ω—å—è":["OS-14"],"—Ç—Ä–µ–≤–æ–≥–∏":["OS-14"],"–∫—Ä–∏–≤—ã–µ":["OS-14"],"—á—É–∂–∏–µ":["OS-14"],"–∏–¥–∏":["OS-14"],"–æ—á–Ω–µ—à—å—Å—è":["OS-14"],"–ø–æ—Ä–æ—é":["OS-14"],"—Ç–µ–º–Ω–æ":["OS-14"],"–∑–∞–∂–≥—É—Ç—Å—è":["OS-14"],"–æ–≥–Ω–∏":["OS-14"],"—Å–ø–∏":["OS-14"],"–ø—Ä–æ–±–ª–µ–º—ã":["OS-14"],"–æ–±–æ–π–¥—É—Ç":["OS-14"],"—Å—Ç–æ—Ä–æ–Ω–æ–π":["OS-14"],"–≥–ª–∞–≤–Ω—ã–π":["OS-14"],"–≥–µ—Ä–æ–π":["OS-14"],"–ø—Ä–æ—Å–Ω–µ—à—å—Å—è":["OS-14"],"–∑–∞—Ö–ª–æ–ø–Ω–µ—à—å":["OS-14"],"—Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å":["OS-14"],"–≤–µ–¥—É—â—É—é":["OS-14"],"–¥–≤–µ—Ä—å":["OS-14"],"–∑–∞–±—É–¥–µ—à—å":["OS-14"],"—É—Å–ª–æ–≤–∏–π":["OS-14"],"happy":["OS-14"],"end":["OS-14"],"–æ–≥–æ–Ω—å":["OS-15"],"–ª—é–¥–∏":["OS-15"],"—Å–º–æ—Ç—Ä—è—Ç":["OS-15"],"–æ–∫–Ω–∞":["OS-15"],"–ø–µ—á–∞–ª—å–Ω—ã–µ":["OS-15"],"—Å–Ω–µ–∂–∏–Ω–∫–∏":["OS-15"],"—Ö—Ä—É—Å—Ç–∞–ª—å–Ω—ã–µ":["OS-15"],"–∑–Ω–∞—é—Ç":["OS-15"],"–≤–ø–µ—Ä–µ–¥–∏":["OS-15"],"—Å–Ω–µ–∂–∏–Ω–∫–∞":["OS-15"],"–ø—Ä–∏—é—Ç–∞":["OS-15"],"–º–æ–µ–º":["OS-15"],"–ª–µ–¥—è–Ω–∞—è":["OS-15"],"–ª–∞—Å–∫–∞—Ö":["OS-15"],"—Ä–∞—Å—Ç–∞—è—Ç—å":["OS-15"],"–∂–∞–ª—å":["OS-15"],"—Å–æ–≥—Ä–µ–µ—à—å":["OS-15"],"–∑–∞–¥–µ—Ä–∂–∏—à—å":["OS-15"],"–ø—Ä–∏–ª–µ—á—É":["OS-15"],"–≤—å—é–≥–æ–π":["OS-15"],"—Å–Ω–µ–∂–Ω–æ–π":["OS-15"],"—Ä–∞—Å—Ç–∞—é":["OS-15"],"—Ä—É–∫–∞—Ö":["OS-15"],"–≤–æ–¥–æ–π":["OS-15"],"–ø—Ä–∏–∫–æ—Å–Ω—É—Å—å":["OS-15"],"–Ω–µ–∂–Ω–æ—Å—Ç—å—é":["OS-15"],"–∞–ª—ã—Ö":["OS-15"],"–≥—É–±":["OS-15"],"–ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å":["OS-15"],"–≤–∫—É—Å":["OS-15"],"–ø—Ä–æ–∫–∞—á—É—Å—å":["OS-15"],"—â–µ–∫–µ":["OS-15"],"—Å–ª–µ–∑–æ–π":["OS-15"],"–≤–µ—Ä–Ω–æ—Å—Ç–∏":["OS-15"],"–ø—Ä–µ–≤—Ä–∞—â—É—Å—å":["OS-15"],"–±—Ä–∏–ª–ª–∏–∞–Ω—Ç":["OS-15"],"–¥–æ—Ä–æ–≥–æ–π":["OS-15"],"—Ä–æ–∂–¥–µ–Ω–∞":["OS-15"],"—Å—Ç—É–∂–µ–π":["OS-15"],"–∑–µ–º–Ω–æ–π":["OS-15"],"—Å–ø—É—Å–∫–∞—é—Å—å":["OS-15"],"–≤–æ–∑–¥—É—à–Ω—ã—Ö":["OS-15"],"–ø—Ä–∏–∫–æ–≤–∞–≤":["OS-15"],"–±–µ–ª–∏–∑–Ω–æ–π":["OS-15"],"–≤—å—é–≥–∞":["OS-15"],"—Ç—Ä–µ–ø–ª–µ—Ç":["OS-15"],"–±–µ—à–µ–Ω–æ":["OS-15"],"–∫–∞—Ä—Ç—ã":["OS-15"],"—Å–ø—É—Ç–∞–≤":["OS-15"],"–≤–∏–¥–µ–Ω":["OS-15"],"–º–∞—Ä—à—Ä—É—Ç":["OS-15"],"—Å–∞–º–æ–π":["OS-15"],"–ø–µ—Ä–≤–æ—é":["OS-15"],"–ø—Ä–æ–±—É–¥—É":["OS-15"],"–ø—Ä–∏—é—Ç–∏—Ç":["OS-15"],"–º–æ—Ä–æ–∑–Ω—ã–º":["OS-15"],"–¥–µ–Ω—å–∫–æ–º":["OS-15"],"–ø–∞—Ä–∫–µ":["OS-15"],"–≤—Å—Ç—Ä–µ—Ç–∏–º—Å—è":["OS-15"],"–ø—Ä–∏—Ç—è–Ω–µ—Ç":["OS-15"],"—Å–æ–≥—Ä–µ—é":["OS-15"],"–≤–µ—Ä–Ω–æ–π":["OS-15"],"–æ–ø–æ—Ä–æ–π":["OS-15"],"–≤—Å–ø–æ–º–Ω—é":["OS-15"],"–≤–µ—á–Ω–æ—Å—Ç–∏":["OS-15"],"—Å–∫–∞—Ç–∏–ª–∞—Å—å":["OS-15"],"–∫—Ä–µ–≤–µ„ÉÑtochka":["KREV-01","KREV-02"],"–ø—Ä–∏–Ω—Ü":["KREV-02"]}}
//=================================================
// FILE: /generate-context.js
/* eslint-disable no-console */
"use strict";

/**
 * generate-context.js
 *
 * –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä .meta/project-full.txt –∏ .meta/project-adaptive.txt
 * –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è (–≤—ã–ø–æ–ª–Ω–µ–Ω—ã):
 * 1) –í –Ω–∞—á–∞–ª–µ ‚Äî –±–ª–æ–∫ ¬´–ü–†–ê–í–ò–õ–ê –î–õ–Ø –ù–ï–ô–†–û–°–ï–¢–ï–ô¬ª, –∑–∞—Ç–µ–º –º–µ—Ç–∞‚Äë–±–ª–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º/URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –ø–æ–º–µ—Ç–∫–æ–π –ø—Ä–æ GitHub.
 * 2) –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê ‚Äî –ü–û–õ–ù–û–ï –¥–µ—Ä–µ–≤–æ –í–°–ï–• —Ñ–∞–π–ª–æ–≤ (–≤–∫–ª—é—á–∞—è assets/), –Ω–æ –±–µ–∑ .git/** –∏ .meta/**.
 *    –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∑–∞—â–∏—â–∞–µ–º—Å—è –æ—Ç —Å–∞–º–æ–≤–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤.
 * 3) –ü–æ—Å–ª–µ –¥–µ—Ä–µ–≤–∞ ‚Äî —Å–µ–∫—Ü–∏—è ¬´–§–ê–ô–õ–´¬ª: —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã, –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º (critical ‚Üí high ‚Üí medium ‚Üí low),
 *    –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –≤—ã–≤–æ–¥–∏—Ç—Å—è —Ü–µ–ª–∏–∫–æ–º. –ó–¥–µ—Å—å assets/** –∏—Å–∫–ª—é—á–∞–µ–º (–ø–æ –≤–∞—à–µ–º—É —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é), .meta/** —Ç–æ–∂–µ –∏—Å–∫–ª—é—á–∞–µ–º.
 * 4) –ù–ï–¢ –±–ª–æ–∫–∞ ¬´–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ª–æ–≥–∏¬ª.
 * 5) Adaptive-—Ä–µ–∂–∏–º –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –æ–±—â–∏–π –æ–±—ä—ë–º —Å—Ç—Ä–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º --max-lines (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20000).
 *
 * –ó–∞–ø—É—Å–∫:
 *   node generate-context.js --mode=both --max-lines=20000
 *   node generate-context.js --mode=full
 *   node generate-context.js --mode=adaptive --out-dir=.meta
 *
 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
 *   --mode=both|full|adaptive
 *   --max-lines=–ß–ò–°–õ–û           // —Ç–æ–ª—å–∫–æ –¥–ª—è adaptive
 *   --out-dir=–ü–£–¢–¨              // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é .meta
 *   --root=–ü–£–¢–¨                 // –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–µ–∫—É—â–∞—è –ø–∞–ø–∫–∞)
 */

const fs = require("fs");
const path = require("path");

// -------------------- CLI --------------------
const argv = Object.fromEntries(
  process.argv.slice(2).map(a => {
    const [k, ...r] = a.replace(/^--/, "").split("=");
    return [k, r.join("=") === "" ? true : r.join("=")];
  })
);

const ROOT     = path.resolve(argv.root || __dirname);
const META_DIR = path.resolve(argv["out-dir"] || path.join(ROOT, ".meta"));
const MODE     = (argv.mode || "both").toLowerCase(); // full | adaptive | both
const MAX_LINES = Number(argv["max-lines"] || 20000);

// –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –Ω–∞–ª–∏—á–∏–µ .meta
if (!fs.existsSync(META_DIR)) fs.mkdirSync(META_DIR, { recursive: true });

const FULL_FILE    = path.join(META_DIR, "project-full.txt");
const ADAPTIVE_FILE= path.join(META_DIR, "project-adaptive.txt");

// –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ –∫ self-—Ñ–∞–π–ª–∞–º (–¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–∞–º–æ–≤–∫–ª—é—á–µ–Ω–∏—è)
const SELF_FULL_REL  = toUnix(path.relative(ROOT, FULL_FILE));
const SELF_ADAPT_REL = toUnix(path.relative(ROOT, ADAPTIVE_FILE));

// -------------------- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ --------------------

// –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ç–æ—Ä—ã—Ö –≤–∫–ª—é—á–∞–µ–º –≤ —Å–µ–∫—Ü–∏—é ¬´–§–ê–ô–õ–´¬ª
const TEXT_EXTS = new Set([
  ".html",".htm",".css",".js",".mjs",".cjs",".ts",".tsx",
  ".json",".webmanifest",".md",".txt",".yml",".yaml"
]);

/**
 * –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –°–ï–ö–¶–ò–ò ¬´–§–ê–ô–õ–´¬ª (—Ç–æ–ª—å–∫–æ –∫ –ª–∏—Å—Ç–∏–Ω–≥—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –ù–ï –∫ –¥–µ—Ä–µ–≤—É):
 * - –ü–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –∏—Å–∫–ª—é—á–∞–µ–º .meta/** –∏ assets/** (–Ω–µ –ø–æ–ø–∞–¥—É—Ç –≤ –∫–æ–Ω—Ç–µ–Ω—Ç),
 * - –ò—Å–∫–ª—é—á–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏.
 */
const EXCLUDE_FILES_PATTERNS = [
  "node_modules/**",
  ".git/**",
  ".meta/**",
  "assets/**",
  ".next/**","dist/**","build/**","out/**","coverage/**",
  ".cache/**",".vscode/**",".idea/**",".husky/**",
  "**/*.log",".DS_Store"
].map(globToRegExp);

/**
 * –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¢–û–õ–¨–ö–û –¥–ª—è –°–¢–†–£–ö–¢–£–†–´ –î–ï–†–ï–í–ê:
 * - –ü–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –í–°–ï —Ñ–∞–π–ª—ã, –≤–∫–ª—é—á–∞—è assets/**.
 * - –ò—Å–∫–ª—é—á–∞–µ–º —Ç–æ–ª—å–∫–æ .git/**, .meta/** –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏ (node_modules –∏ —Ç.–ø.),
 *   –ø–ª—é—Å –∑–∞—â–∏—â–∞–µ–º—Å—è –æ—Ç —Å–∞–º–æ–≤–∫–ª—é—á–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤.
 */
const EXCLUDE_TREE_PATTERNS = [
  "node_modules/**",
  ".git/**",
  ".meta/**",
  ".next/**","dist/**","build/**","out/**","coverage/**",
  ".cache/**",".vscode/**",".idea/**",".husky/**",
  "**/*.log",".DS_Store"
].map(globToRegExp);

// –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –¥–ª—è —Å–µ–∫—Ü–∏–∏ ¬´–§–ê–ô–õ–´¬ª
const PRIORITY = {
  critical: [
    /^index\.html?$/i,
    /^service-worker\.js$/i,
    /^manifest\.json$/i,
    /^albums\.json$/i,
    /^custom\.json$/i,
    /^news\.html?$/i,
    /^generate-index\.(js|mjs|cjs)$/i,
    /^albums\/gallery\/[^/]+\/index\.json$/i,
    /^\.github\/workflows\/.*\.ya?ml$/i
  ],
  high: [
    /^AudioController\.(js|mjs|cjs|ts)$/i,
    /^GlobalState\.(js|mjs|cjs|ts)$/i,
    /^scripts\/.*\.(mjs|js|ts)$/i,
    /^performance\/.*\.(js|ts)$/i,
    /^.*\.(ya?ml)$/i
  ],
  medium: [
    /^.*\.(js|mjs|cjs|ts|tsx|json|html?|css)$/i
  ],
};

// -------------------- –£—Ç–∏–ª–∏—Ç—ã --------------------
function toUnix(p) {
  return String(p).replace(/\\/g, "/");
}
function globToRegExp(pat) {
  const esc = pat
    .replace(/[.+^${}()|[\]\\]/g, "\\$")
    .replace(/\*\*/g, "___GLOBSTAR___")
    .replace(/\*/g, "[^/]*")
    .replace(/___GLOBSTAR___/g, ".*");
  return new RegExp("^" + esc + "$");
}
function isTextFile(rel) {
  return TEXT_EXTS.has(path.extname(rel).toLowerCase());
}
function readText(rel) {
  try { return fs.readFileSync(path.join(ROOT, rel), "utf8"); }
  catch (e) { return `// read error: ${e.message}`; }
}
function countLines(s) {
  return (s.match(/\n/g) || []).length + (s.length ? 1 : 0);
}

// –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è —Å–µ–∫—Ü–∏–∏ ¬´–§–ê–ô–õ–´¬ª
function isExcludedForFiles(rel) {
  const u = toUnix(rel);
  if (!u) return true;
  if (u === SELF_FULL_REL || u === SELF_ADAPT_REL) return true; // –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–∞–º–æ–≤–∫–ª—é—á–µ–Ω–∏—è
  return EXCLUDE_FILES_PATTERNS.some(re => re.test(u));
}
// –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –¥–µ—Ä–µ–≤–∞
function isExcludedForTree(rel) {
  const u = toUnix(rel);
  if (!u) return true;
  if (u === SELF_FULL_REL || u === SELF_ADAPT_REL) return true; // –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–∞–º–æ–≤–∫–ª—é—á–µ–Ω–∏—è
  return EXCLUDE_TREE_PATTERNS.some(re => re.test(u));
}

// -------------------- –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ --------------------
function listAllEntries(includeFiles = true, forTree = false) {
  const res = [];
  const stack = [ROOT];

  while (stack.length) {
    const dir = stack.pop();
    let entries = [];
    try { entries = fs.readdirSync(dir, { withFileTypes: true }); } catch { continue; }

    for (const e of entries) {
      const full = path.join(dir, e.name);
      const rel = toUnix(path.relative(ROOT, full)) || ".";

      // –í—ã–±–æ—Ä –ø—Ä–∞–≤–∏–ª –∏—Å–∫–ª—é—á–µ–Ω–∏—è: –¥–ª—è –¥–µ—Ä–µ–≤–∞ ‚Äî —Å–≤–æ–∏, –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ ‚Äî —Å–≤–æ–∏
      const excluded = forTree ? isExcludedForTree(rel) : isExcludedForFiles(rel);
      if (excluded) continue;

      if (e.isDirectory()) {
        res.push({ rel, full, dir: true });
        stack.push(full);
      } else if (e.isFile() && includeFiles) {
        res.push({ rel, full, dir: false });
      }
    }
  }

  // –ü–∞–ø–∫–∏ —Å–≤–µ—Ä—Ö—É, –∑–∞—Ç–µ–º —Ñ–∞–π–ª—ã; –≤–Ω—É—Ç—Ä–∏ ‚Äî –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
  res.sort((a, b) => (a.dir !== b.dir ? (a.dir ? -1 : 1) : a.rel.localeCompare(b.rel)));
  return res;
}

function listTextFilesForContent() {
  return listAllEntries(true, /*forTree*/ false)
    .filter(e => !e.dir && isTextFile(e.rel))
    .map(e => e.rel);
}

// -------------------- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π --------------------
function readRepoMeta() {
  let url = "";
  try {
    const cfg = path.join(ROOT, ".git", "config");
    if (fs.existsSync(cfg)) {
      const raw = fs.readFileSync(cfg, "utf8");
      const m = raw.match(/url\s*=\s*(.+)\n/);
      if (m) url = m[1].trim();
    }
  } catch {}
  return {
    name: path.basename(ROOT),
    url: url || "(URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω; —É–∫–∞–∂–∏—Ç–µ –≤ .git/config)",
    madeWith: "–ü—Ä–æ–µ–∫—Ç –¥–µ–ª–∞–µ—Ç—Å—è –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ https://github.com/ (GitHub Pages + GitHub Actions).",
  };
}

// -------------------- –ë–ª–æ–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ --------------------
function rulesBlock() {
  return [
    "–ü–†–ê–í–ò–õ–ê –î–õ–Ø –ù–ï–ô–†–û–°–ï–¢–ï–ô (–≤–∞–∂–Ω–æ –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤):",
    "- –Ø–∑—ã–∫ –æ—Ç–≤–µ—Ç–æ–≤: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é RU. –ê–Ω–≥–ª–∏–π—Å–∫–∏–π ‚Äî –µ—Å–ª–∏ —è–≤–Ω–æ –ø–æ–ø—Ä–æ—Å—è—Ç –∏–ª–∏ –≤ –∏–º–µ–Ω–∞—Ö/—Ç–µ—Ä–º–∏–Ω–∞—Ö.",
    "- –í—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–π —Å –ø–æ–ª–Ω–æ–≥–æ –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.",
    "- –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π —Ç–æ—á–Ω—ã–µ –ø—É—Ç–∏ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ —Å—Å—ã–ª–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, src/app/(main)/timeline/page.tsx).",
    "- –õ—é–±–æ–π –∫–æ–¥ –≤—ã–≤–æ–¥–∏ –¢–û–õ–¨–ö–û –≤ —Ç—Ä–æ–π–Ω—ã—Ö –±—ç–∫—Ç–∏–∫–∞—Ö —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —è–∑—ã–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:",
    "  ```ts",
    "  export function x() {}",
    "  ```",
    "- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π —Ç—è–∂–µ–ª–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. –†–∞–∑—Ä–µ—à–µ–Ω—ã: —Å–ø–∏—Å–∫–∏, –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã.",
    "- –ï—Å–ª–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–π –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–∞—Ç—á (unified diff) –∏–ª–∏ —Ü–µ–ª–∏–∫–æ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Ñ–∞–π–ª (–Ω–µ —Å–º–µ—à–∏–≤–∞—Ç—å).",
    "- –ù–µ –≤—ã–¥—É–º—ã–≤–∞–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ API. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî —è–≤–Ω–æ —Å–∫–∞–∂–∏ ¬´–Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–µ–Ω–∏–µ¬ª.",
    "- –£—á–∏—Ç—ã–≤–∞–π —á—Ç–æ —è —Ä–∞–±–æ—Ç–∞—é —á–µ—Ä–µ–∑ web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å github.com –∏ –Ω–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ –¥–µ–ª–∞—Ç—å –ø—Ä–æ–µ–∫—Ç.",
    "- –°—Ç–∏–ª—å –∫–æ–¥–∞: TypeScript strict, ESM-–∏–º–ø–æ—Ä—Ç—ã, 2 –ø—Ä–æ–±–µ–ª–∞.",
    "- –ù–ò–ö–û–ì–î–ê –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–π –≤–µ—Å—å —Ñ–∞–π–ª project-full —Ü–µ–ª–∏–∫–æ–º; —Ç–æ–ª—å–∫–æ –±–ª–æ–∫–∏ –¥–ª—è –∑–∞–º–µ–Ω—ã —Å–æ —Å—Ç—Ä–æ–≥–∏–º —É–∫–∞–∑–∞–Ω–∏–µ–º –º–µ—Å—Ç–∞.",
    "- –§–æ—Ä–º–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π: -> –§–ê–ô–õ: –ø—É—Ç—å -> –ù–ê–ô–¢–ò: [—Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–æ—Å–ª–æ–≤–Ω–æ] -> –ó–ê–ú–ï–ù–ò–¢–¨ –ù–ê: [–ø–æ–ª–Ω—ã–π –Ω–æ–≤—ã–π –±–ª–æ–∫].",
    "- –ï—Å–ª–∏ –∫–∞–∫–æ–π —Ç–æ —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π –∑–∞–º–µ–Ω—ã, —Ç–æ –ø—Ä–∏—Å—ã–ª–∞–π –∏–º–µ–Ω–Ω–æ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ –ø–æ–ª–Ω—ã–π –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–æ–µ–º—É –ø—Ä–æ–µ–∫—Ç—É) —Ñ–∞–π–ª –∫–æ—Ç–æ—Ä—ã–π —ç—Ç–æ–≥–æ —Ç—Ä–µ–±—É–µ—Ç. ",
    "- –°–æ—Ö—Ä–∞–Ω—è–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏–º–ø–æ—Ä—Ç-—Å—Ç—Ä—É–∫—Ç—É—Ä—É.",
    "- –ï—Å–ª–∏ —É–¥–∞–ª—è–µ–º –±–ª–æ–∫ ‚Äî —É–∫–∞–∂–∏ —Å—Ç—Ä–æ–∫—É –ø–µ—Ä–µ–¥ –∏ —Å—Ç—Ä–æ–∫—É –ø–æ—Å–ª–µ (–∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞).",
    "- –í—Å–µ–≥–¥–∞ –ø–∏—à–∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ, —á—Ç–æ –∏ –ø–æ—á–µ–º—É –¥–µ–ª–∞–µ–º.",
    "- –û—á–µ–Ω—å –≤–∞–∂–Ω–æ! –ü—Ä–µ—Ä–≤–∞—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∏ –ü–∞—É–∑–∞, —Å—Ç–æ–ø, —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞, –ò–∑–±—Ä–∞–Ω–Ω–æ–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –≤—ã–∑–≤–∞—Ç—å STOP —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π —Å–Ω—è—Ç –≤ favorites view, –ø—Ä–∏ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∫–∞–∫–∏–µ –±—ã –Ω–µ –±—ã–ª–∏ –ø–ª–µ–µ—Ä –≤—Å–µ–≥–¥–∞ –∏–≥—Ä–∞–µ—Ç –∏ –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –Ω–∏—á–µ–≥–æ –¥—Ä—É–≥–æ–≥–æ –µ–≥–æ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫, –≤–æ–æ–±—â–µ –Ω–∏–∫–∞–∫–∞—è –¥—Ä—É–≥–∞—è —Ñ—É–Ω–∫—Ü–∏—è - —ç—Ç–æ –±–∞–∑–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ —ç—Ç–æ–≥–æ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—è.",
    "- –í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–π —Å–ø–∏—Å–æ–∫ –¥–∞–ª—å–Ω–µ–π—à–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –µ—Å–ª–∏ –æ–Ω–∏ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –≤–æ –≤—Å–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ.",
    "- –í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–π —Å–ø–∏—Å–æ–∫ —Å—Ç–∞—Ä–æ–≥–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∫–æ–¥–∞ –∏ –Ω–µ –æ—Å—Ç–∞–≤–ª—è—Ç—å —Å—Ç–∞—Ä–æ–≥–æ —Å–ª–µ–¥–∞, –µ—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º –∏–ª–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–µ–º —á—Ç–æ-—Ç–æ –≤ –∫–æ–¥–µ",
    "- –í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–π –∫–∞–∫ –º–∏–Ω–∏–º—É–º –æ–¥–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—ã –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–∏–ª–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ –∫–æ–¥–µ, –Ω–æ –ø—Ä–∏—ç—Ç–æ–º –ø–æ–ª–Ω–æ—Å—Ç—å–± –±—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ –ª–æ–≥–∏–∫—É, –ª–æ–≥–∏—Å—Ç–∏–∫—É –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –í—Å–µ–≥–¥–∞ —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É —É–ø—Ä–æ—â–µ–Ω–∏—é –∫–æ–¥–∞ –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",
    ""
  ].join("\n");
}

function metaBlock() {
  const m = readRepoMeta();

  const favoritesPrinciplesBlock = [
    "## –ò–ó–ë–†–ê–ù–ù–û–ï ‚Äî –ø—Ä–∏–Ω—Ü–∏–ø—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞",
    "–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞ –≤ –ò–ó–ë–†–ê–ù–ù–û–ï:",
    "–õ–∞–π–∫/–∞–Ω–ª–∞–π–∫ (‚≠ê) = –∏–∑–±—Ä–∞–Ω–Ω–æ—Å—Ç—å —Ç—Ä–µ–∫–∞.",
    "–°–æ—Å—Ç–æ—è–Ω–∏–µ ‚≠ê —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö (—Ä–æ–¥–Ω–æ–π –∞–ª—å–±–æ–º, ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–µ¬ª, –¥—Ä—É–≥–∏–µ —Å–ø–∏—Å–∫–∏).",
    "",
    "–£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞ –∏–∑ –æ–∫–Ω–∞ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–µ¬ª",
    "–≠—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ ‚Äì —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–∞–∫ –¥–≤—É—Ö—Å—Ç—É–ø–µ–Ω—á–∞—Ç–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è.",
    "",
    "–ü–æ–¥—Ä–æ–±–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã",
    "‚≠ê –≤ —Ä–æ–¥–Ω–æ–º –∞–ª—å–±–æ–º–µ (–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã):",
    "- –ü–æ—Å—Ç–∞–≤–∏–ª–∏ ‚≠ê ‚Äî —Ç—Ä–µ–∫ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–º¬ª –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–π.",
    "- –°–Ω—è–ª–∏ ‚≠ê ‚Äî —Ç—Ä–µ–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ¬ª (–¥–∞–∂–µ –µ—Å–ª–∏ –±—ã–ª –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º, ¬´–±–µ–∑ —Å–ª–µ–¥–∞¬ª).",
    "",
    "‚≠ê –≤ –æ–∫–Ω–µ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–µ¬ª:",
    "- –°–Ω—è–ª–∏ ‚≠ê —Å –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ ‚Äî –æ–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–µ—Ä–æ–π (inactive), ‚≠ê —Å–Ω–∏–º–∞–µ—Ç—Å—è –∏ –≤ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–º¬ª, –∏ –≤ —Ä–æ–¥–Ω–æ–º –∞–ª—å–±–æ–º–µ.",
    "- –°–Ω—è—Ç–∏–µ ‚≠ê –ù–ï —É–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ, –∞ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –µ—ë –≤ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (‚Äú–±—É—Ñ–µ—Ä‚Äù).",
    "",
    "–ü–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π (—Å–µ—Ä–æ–π) —Å—Ç—Ä–æ–∫–∏ –≤ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–º¬ª:",
    "- –ö–ª–∏–∫ –ø–æ —Å–µ—Ä–æ–π —Å—Ç—Ä–æ–∫–µ (–Ω–µ –ø–æ –∑–≤–µ–∑–¥–µ) ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª–∫—É —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏:",
    "  - –í–µ—Ä–Ω—É—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ ‚Äî —Å—Ç—Ä–æ–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π, ‚≠ê —Å—Ä–∞–∑—É –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤–µ–∑–¥–µ.",
    "  - –£–¥–∞–ª–∏—Ç—å ‚Äî —Å—Ç—Ä–æ–∫–∞ –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ¬ª –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ. –í —Ä–æ–¥–Ω–æ–º –∞–ª—å–±–æ–º–µ ‚≠ê –ø—Ä–∏ —ç—Ç–æ–º —Å–Ω—è—Ç–∞.",
    "- –ö–ª–∏–∫ –ø–æ ‚≠ê –Ω–∞ —Å–µ—Ä–æ–π —Å—Ç—Ä–æ–∫–µ ‚Äî –±—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –º–æ–¥–∞–ª–∫–∏, —Å—Ç—Ä–æ–∫–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π —Å ‚≠ê.",
    "- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ¬ª –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª–∫—É (–∏–ª–∏ ‚Äú–±–µ–∑ —Å–ª–µ–¥–∞‚Äù —á–µ—Ä–µ–∑ –∞–Ω–ª–∞–π–∫ –≤ —Ä–æ–¥–Ω–æ–º –∞–ª—å–±–æ–º–µ).",
    "",
    "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:",
    "- –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚≠ê –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–º—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–æ –≤—Å–µ—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è—Ö –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–æ–∫.",
    "- –í –æ–∫–Ω–µ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–µ¬ª: —Å–Ω—è—Ç–∏–µ ‚≠ê –Ω–∞ –ª—é–±–æ–π —Å—Ç—Ä–æ–∫–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å–Ω–∏–º–∞–µ—Ç ‚≠ê –≤ —Ä–æ–¥–Ω–æ–º –∞–ª—å–±–æ–º–µ.",
    "- –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª–∫—É.",
    "",
    "–ü–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–∞ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–µ¬ª:",
    "- –õ—é–±—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Ç—Ä–µ–∫–∞ –≤ inactive, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ —Å–æ—Å—Ç–∞–≤–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞.",
    "- –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –ø–µ—Å–Ω–∏ –ù–ï –æ–±—Ä—ã–≤–∞–µ—Ç—Å—è –∏–∑-–∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–µ–π–ª–∏—Å—Ç–∞, –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç ‚Äú–≤ —Ñ–æ–Ω–µ‚Äù.",
    "",
    "–û—Å–æ–±–æ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ç—Ä–µ–∫–∞:",
    "- –ï—Å–ª–∏ —Ç—Ä–µ–∫ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è inactive –≤ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–º¬ª –≤–æ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è ‚Äî —Å—Ä–∞–∑—É –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–∫.",
    "- –ï—Å–ª–∏ —ç—Ç–æ –±—ã–ª –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–∫ ‚Äî –ø–ª–µ–µ—Ä –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º —Å—Ç–æ–ø, –º—É–∑—ã–∫–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.",
    "",
    "–†–æ–¥–Ω–æ–π –∞–ª—å–±–æ–º –≤—Å–µ–≥–¥–∞ —Ä–µ—à–∞–µ—Ç –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ:",
    "- –ï—Å–ª–∏ —Å–Ω—è—Ç—å ‚≠ê —Å —Ç—Ä–µ–∫–∞ –≤ —Ä–æ–¥–Ω–æ–º –∞–ª—å–±–æ–º–µ ‚Äî –æ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–≥–æ¬ª, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏–ª—Å—è —Ç–∞–º –∫–∞–∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞—è (—Å–µ—Ä–∞—è) —Å—Ç—Ä–æ–∫–∞.",
    "",
    "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ:",
    "- –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ ‚≠ê –Ω–∞ —Ç—Ä–µ–∫–µ –≤ —Ä–æ–¥–Ω–æ–º –∞–ª—å–±–æ–º–µ, –µ—Å–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–º¬ª —É–∂–µ –µ—Å—Ç—å ‚Äî –æ–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π.",
    "",
    "–ò—Ç–æ–≥–∏",
    "- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è ‚Äî —à–∞–≥ —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è –º–æ–¥–∞–ª–∫–æ–π.",
    "- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è ‚≠ê –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –≤–æ –≤—Å–µ—Ö —Ç–æ—á–∫–∞—Ö.",
    "- –õ–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π: –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ–¥–Ω–æ–º—É –æ–∂–∏–¥–∞–µ–º–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.",
    "- –†–æ–¥–Ω–æ–π –∞–ª—å–±–æ–º —è–≤–ª—è–µ—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–º –∞—Ä–±–∏—Ç—Ä–æ–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è —Ç—Ä–µ–∫–∞ –≤ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–º¬ª.",
    "- –†–æ–¥–Ω–æ–π –∞–ª—å–±–æ–º —è–≤–ª—è–µ—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–º –∞—Ä–±–∏—Ç—Ä–æ–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è —Ç—Ä–µ–∫–∞ –≤ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–º¬ª.",
    " =========================================================================== ",
    "–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ F (–¢–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ)",
    "–ö–Ω–æ–ø–∫–∞ F –≤–∫–ª—é—á–∞–µ—Ç/–≤—ã–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º Favorites Only –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–ª–µ–π–ª–∏—Å—Ç–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è (playing-–ø–ª–µ–π–ª–∏—Å—Ç–∞).",
    "–û–Ω–∞ –Ω–µ —Å—Ç–∞–≤–∏—Ç/–Ω–µ —Å–Ω–∏–º–∞–µ—Ç ‚≠ê —É —Ç—Ä–µ–∫–æ–≤, –∞ —Ç–æ–ª—å–∫–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç, –ø–æ –∫–∞–∫–∏–º —Ç—Ä–µ–∫–∞–º –º–æ–∂–Ω–æ —Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ Next / Prev / –∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –∏ –∫–∞–∫–∏–µ —Ç—Ä–µ–∫–∏ —É—á–∞—Å—Ç–≤—É—é—Ç –≤ Shuffle.",
    "–ï–¥–∏–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø (–ø–æ–ª–Ω—ã–π –ø–ª–µ–µ—Ä –∏ –º–∏–Ω–∏-–ø–ª–µ–µ—Ä)",
    "–ü–æ–ª–Ω—ã–π –∏ –º–∏–Ω–∏-–ø–ª–µ–µ—Ä —É–ø—Ä–∞–≤–ª—è—é—Ç –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ playing-–ø–ª–µ–π–ª–∏—Å—Ç–æ–º.",
    "–ü–æ–≤–µ–¥–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ F –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –≤ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–∞—Ö: –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ playing, –∞ –Ω–µ –∫ –æ—Ç–∫—Ä—ã—Ç–æ–º—É –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Å–ø–∏—Å–∫—É.",
    "–ß—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è ‚Äú–¥–æ—Å—Ç—É–ø–Ω—ã–º —Ç—Ä–µ–∫–æ–º‚Äù",
    "–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç—Ä–µ–∫–∏ ‚Äî —ç—Ç–æ —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ —É—á–∞—Å—Ç–≤—É—é—Ç –≤:",
    "Next / Prev",
    "–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏—é —Ç—Ä–µ–∫–∞",
    "Shuffle-–ø–æ—Ä—è–¥–∫–µ (–µ—Å–ª–∏ shuffle –≤–∫–ª—é—á—ë–Ω)",
    "–ü—Ä–∞–≤–∏–ª–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏:",
    "F = OFF: –¥–æ—Å—Ç—É–ø–µ–Ω –æ–±—ã—á–Ω—ã–π –Ω–∞–±–æ—Ä playing-–ø–ª–µ–π–ª–∏—Å—Ç–∞, –Ω–æ —Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (—Å–º. ‚Äú–ò–ó–ë–†–ê–ù–ù–û–ï‚Äù –Ω–∏–∂–µ).",
    "F = ON: –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ (‚≠ê) —Ç—Ä–µ–∫–∏ playing-–ø–ª–µ–π–ª–∏—Å—Ç–∞.",
    "–ö–æ–Ω—Ç–µ–∫—Å—Ç: playing = –æ–±—ã—á–Ω—ã–π –∞–ª—å–±–æ–º",
    "–ò–∑–±—Ä–∞–Ω–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ ‚≠ê –≤ —ç—Ç–æ–º –∞–ª—å–±–æ–º–µ (–≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ª–∞–π–∫–æ–≤).",
    "–°–æ—Å—Ç–æ—è–Ω–∏–µ: Shuffle OFF ‚Üí –ù–∞–∂–∞—Ç–∏–µ F",
    "OFF ‚Üí ON",
    "–ï—Å–ª–∏ –≤ –∞–ª—å–±–æ–º–µ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ ‚≠ê —Ç—Ä–µ–∫–∞: –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ¬´–æ—Ç–º–µ—Ç—å—Ç–µ ‚≠ê –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–π—Å—è —Ç—Ä–µ–∫¬ª, –∫–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è OFF, –Ω–∏—á–µ–≥–æ –±–æ–ª—å—à–µ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è.",
    "–ï—Å–ª–∏ ‚≠ê –µ—Å—Ç—å: –∫–Ω–æ–ø–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è ON, –¥–æ—Å—Ç—É–ø–Ω—ã–π –Ω–∞–±–æ—Ä —Å—É–∂–∞–µ—Ç—Å—è –¥–æ ‚≠ê, Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –ø–æ ‚≠ê.",
    "ON ‚Üí OFF",
    "–ö–Ω–æ–ø–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è OFF, –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ —Ç—Ä–µ–∫–∏ –∞–ª—å–±–æ–º–∞, Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ –≤—Å–µ–º —Ç—Ä–µ–∫–∞–º.",
    "–°–æ—Å—Ç–æ—è–Ω–∏–µ: Shuffle ON ‚Üí –ù–∞–∂–∞—Ç–∏–µ F",
    "OFF ‚Üí ON",
    "–ï—Å–ª–∏ ‚≠ê –Ω–µ—Ç: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ¬´–æ—Ç–º–µ—Ç—å—Ç–µ ‚≠ê –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–π—Å—è —Ç—Ä–µ–∫¬ª, –∫–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è OFF.",
    "–ï—Å–ª–∏ ‚≠ê –µ—Å—Ç—å: –∫–Ω–æ–ø–∫–∞ ON, –¥–æ—Å—Ç—É–ø–Ω—ã–π –Ω–∞–±–æ—Ä = ‚≠ê, shuffle-–ø–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ ‚≠ê, Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –∏–¥—É—Ç –ø–æ —ç—Ç–æ–º—É shuffle-–ø–æ—Ä—è–¥–∫—É.",
    "ON ‚Üí OFF",
    "–ö–Ω–æ–ø–∫–∞ OFF, –¥–æ—Å—Ç—É–ø–Ω—ã–π –Ω–∞–±–æ—Ä = –≤—Å–µ —Ç—Ä–µ–∫–∏, shuffle-–ø–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ –ø–æ–ª–Ω–æ–º—É –Ω–∞–±–æ—Ä—É, Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –∏–¥—É—Ç –ø–æ –Ω–µ–º—É.",
    "–ö–æ–Ω—Ç–µ–∫—Å—Ç: playing = –ò–ó–ë–†–ê–ù–ù–û–ï (–ø–ª–µ–π–ª–∏—Å—Ç –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ)",
    "–í ‚Äú–ò–ó–ë–†–ê–ù–ù–û–ï‚Äù –µ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã active –∏ inactive:",
    "active: —Ç—Ä–µ–∫ —Ä–µ–∞–ª—å–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º (‚≠ê –µ—Å—Ç—å) ‚Äî —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏",
    "inactive: ‚≠ê —Å–Ω—è—Ç–∞, —Å—Ç—Ä–æ–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞/—É–¥–∞–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª–∫—É ‚Äî –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏",
    "–ë–∞–∑–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ (–≤–∞–∂–Ω–æ): inactive –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –≤ Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥–µ –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –∏ shuffle-–ø–æ—Ä—è–¥–æ–∫ ‚Äî –ø—Ä–∏ –ª—é–±–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ F.",
    "–°–æ—Å—Ç–æ—è–Ω–∏–µ: Shuffle OFF ‚Üí –ù–∞–∂–∞—Ç–∏–µ F",
    "OFF ‚Üí ON",
    "–ï—Å–ª–∏ –Ω–µ—Ç active (–≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º –Ω–µ—á–µ–≥–æ –∏–≥—Ä–∞—Ç—å): –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ¬´–æ—Ç–º–µ—Ç—å—Ç–µ ‚≠ê –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–π—Å—è —Ç—Ä–µ–∫¬ª, –∫–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è OFF.",
    "–ï—Å–ª–∏ active –µ—Å—Ç—å: –∫–Ω–æ–ø–∫–∞ ON, –¥–æ—Å—Ç—É–ø–Ω—ã–π –Ω–∞–±–æ—Ä = active (–ø–æ —Ñ–∞–∫—Ç—É –æ–Ω –∏ —Ç–∞–∫ —Ç–∞–∫–æ–π), Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ —Ö–æ–¥—è—Ç —Ç–æ–ª—å–∫–æ –ø–æ active.",
    "ON ‚Üí OFF",
    "–ö–Ω–æ–ø–∫–∞ OFF, –¥–æ—Å—Ç—É–ø–Ω—ã–π –Ω–∞–±–æ—Ä –æ—Å—Ç–∞—ë—Ç—Å—è = active (inactive –≤—Å—ë —Ä–∞–≤–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω—ã), Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ active.",
    "–°–æ—Å—Ç–æ—è–Ω–∏–µ: Shuffle ON ‚Üí –ù–∞–∂–∞—Ç–∏–µ F",
    "OFF ‚Üí ON",
    "–ï—Å–ª–∏ –Ω–µ—Ç active: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ¬´–æ—Ç–º–µ—Ç—å—Ç–µ ‚≠ê –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–π—Å—è —Ç—Ä–µ–∫¬ª, –∫–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è OFF.",
    "–ï—Å–ª–∏ active –µ—Å—Ç—å: –∫–Ω–æ–ø–∫–∞ ON, shuffle-–ø–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ active, Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –∏–¥—É—Ç –ø–æ –Ω–µ–º—É.",
    "ON ‚Üí OFF",
    "–ö–Ω–æ–ø–∫–∞ OFF, shuffle-–ø–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ active (–ø–æ—Ç–æ–º—É —á—Ç–æ inactive –≤—Å—ë —Ä–∞–≤–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω—ã), Next/Prev/–∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –∏–¥—É—Ç –ø–æ –Ω–µ–º—É.",
    "–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)",
    "–ù–∞–∂–∞—Ç–∏–µ F –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–∞–≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ (‚≠ê –Ω–µ —Å—Ç–∞–≤–∏—Ç—Å—è –∏ –Ω–µ —Å–Ω–∏–º–∞–µ—Ç—Å—è).",
    "–ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ (–Ω–µ—Ç ‚≠ê –≤ –∞–ª—å–±–æ–º–µ / –Ω–µ—Ç active –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º –ø–ª–µ–π–ª–∏—Å—Ç–µ): –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ¬´–æ—Ç–º–µ—Ç—å—Ç–µ ‚≠ê –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–π—Å—è —Ç—Ä–µ–∫¬ª, –∏ F –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è (–æ—Å—Ç–∞—ë—Ç—Å—è OFF).",
    "inactive –≤ –ò–ó–ë–†–ê–ù–ù–û–ú ‚Äî —ç—Ç–æ UI-—ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞/—É–¥–∞–ª–µ–Ω–∏—è, –æ–Ω –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞–¥–∞—Ç—å –Ω–∏ –≤ –∫–∞–∫–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è, –Ω–∏ –≤ Next/Prev, –Ω–∏ –≤ Shuffle.",
    ""
  ].join("\n");

  return [
    `–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: ${m.name}`,
    `–ê–¥—Ä–µ—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: ${m.url}`,
    "# –ü–û–õ–ù–´–ô –ò –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø.",
    favoritesPrinciplesBlock,
    m.madeWith,
    ""
  ].join("\n");
}

// -------------------- –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê (–¥–µ—Ä–µ–≤–æ) --------------------
function buildFullTree() {
  const lines = [];
  lines.push(path.basename(ROOT) + "/");

  function walk(dir, prefix = "") {
    let entries = [];
    try { entries = fs.readdirSync(dir, { withFileTypes: true }); } catch { return; }

    const visible = entries
      .filter(e => !isExcludedForTree(toUnix(path.relative(ROOT, path.join(dir, e.name)))))
      .sort((a, b) => (a.isDirectory() !== b.isDirectory() ? (a.isDirectory() ? -1 : 1) : a.name.localeCompare(b.name)));

    visible.forEach((e, i) => {
      const isLast = i === visible.length - 1;
      const branch = isLast ? "‚îî‚îÄ‚îÄ " : "‚îú‚îÄ‚îÄ ";
      lines.push(prefix + branch + e.name + (e.isDirectory() ? "/" : ""));
      if (e.isDirectory()) {
        walk(path.join(dir, e.name), prefix + (isLast ? "    " : "‚îÇ   "));
      }
    });
  }

  walk(ROOT);
  return lines.join("\n") + "\n\n";
}

// -------------------- –°–µ–∫—Ü–∏—è ¬´–§–ê–ô–õ–´¬ª --------------------
function getPriority(rel) {
  const u = toUnix(rel);
  for (const [lvl, rules] of Object.entries(PRIORITY)) {
    if (rules.some(re => re.test(u))) return lvl;
  }
  return "low";
}

function groupFilesByPriority() {
  const all = listTextFilesForContent(); // —É–∂–µ –∏—Å–∫–ª—é—á–µ–Ω—ã assets/.meta –∏ –ø—Ä–æ—á–∏–µ –ø–æ EXCLUDE_FILES_PATTERNS
  return {
    critical: all.filter(f => getPriority(f) === "critical"),
    high:     all.filter(f => getPriority(f) === "high"),
    medium:   all.filter(f => getPriority(f) === "medium"),
    low:      all.filter(f => getPriority(f) === "low"),
  };
}

function fileBlock(rel) {
  return [
    "//=================================================",
    `// FILE: /${toUnix(rel)}`,
    readText(rel),
    ""
  ].join("\n");
}

// -------------------- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç—á—ë—Ç–∞ --------------------
function headerBlock() {
  const now = new Date().toISOString().replace("T"," ").slice(0,19) + " UTC";
  return [
    rulesBlock(),
    metaBlock(),
    "–°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê:",
    buildFullTree(),
    `–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: ${now}`,
    ""
  ].join("\n");
}

// -------------------- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã --------------------
function generateFull() {
  let out = headerBlock();

  const groups = groupFilesByPriority();
  const order = ["critical", "high", "medium", "low"];
  for (const lvl of order) {
    for (const f of groups[lvl]) {
      out += fileBlock(f);
    }
  }

  // –ë–ï–ó –±–ª–æ–∫–∞ ¬´–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ª–æ–≥–∏¬ª
  return out;
}

function generateAdaptive() {
  let out = headerBlock();
  let cur = countLines(out);
  const max = MAX_LINES;

  const groups = groupFilesByPriority();
  const order = ["critical", "high", "medium"]; // low –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≤ adaptive —á–∞—â–µ –≤—Å–µ–≥–æ

  for (const lvl of order) {
    for (const f of groups[lvl]) {
      const block = fileBlock(f);
      const L = countLines(block);
      if (cur + L > max) {
        out += "\n// ... (truncate)\n";
        return out;
      }
      out += block; cur += L;
    }
  }

  // –ë–ï–ó –±–ª–æ–∫–∞ ¬´–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ª–æ–≥–∏¬ª
  return out;
}

// -------------------- MAIN --------------------
function main() {
  if (MODE === "full" || MODE === "both") {
    fs.writeFileSync(FULL_FILE, generateFull(), "utf8");
    console.log(`‚úÖ ${FULL_FILE}`);
  }
  if (MODE === "adaptive" || MODE === "both") {
    fs.writeFileSync(ADAPTIVE_FILE, generateAdaptive(), "utf8");
    console.log(`‚úÖ ${ADAPTIVE_FILE}`);
  }
}

try { main(); } catch (e) { console.error("‚ùå", e); process.exit(1); }

//=================================================
// FILE: /news/news.json
{
  "items": [
    {
      "id": "2025-11-01-release",
      "title": "–ù–æ–≤—ã–π —Ä–µ–ª–∏–∑ ‚Äî –ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º",
      "date": "2025-11-01",
      "text": "–î–æ—Å—Ç—É–ø–µ–Ω –Ω–æ–≤—ã–π –∞–ª—å–±–æ–º. –°–ª—É—à–∞–π—Ç–µ –æ–Ω–ª–∞–π–Ω –∏ –æ—Ñ–ª–∞–π–Ω –≤ –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.",
      "image": "img/logo.png",
      "tags": ["—Ä–µ–ª–∏–∑", "–∞–ª—å–±–æ–º"]
    },
    {
      "id": "2025-10-20-video",
      "title": "–ö–ª–∏–ø –Ω–∞ —Ç—Ä–µ–∫ ¬´–û—Ç—Ä–∞–∂–µ–Ω–∏–µ¬ª",
      "date": "2025-10-20",
      "embedUrl": "https://www.youtube.com/embed/dQw4w9WgXcQ",
      "tags": ["–∫–ª–∏–ø", "–≤–∏–¥–µ–æ"]
    },
    {
      "id": "2025-10-05-tour",
      "title": "–¢—É—Ä: –∑–∏–º–Ω–∏–µ –∫–æ–Ω—Ü–µ—Ä—Ç—ã",
      "date": "2025-10-05",
      "text": "–ê–∫—Ç—É–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ ‚Äî –≤ –Ω–∞—à–∏—Ö —Å–æ—Ü—Å–µ—Ç—è—Ö.",
      "tags": ["–∫–æ–Ω—Ü–µ—Ä—Ç—ã"]
    }
  ]
}

//=================================================
// FILE: /src/player-core/media-session.js
// src/player-core/media-session.js
// Optimized MediaSession bindings

export function ensureMediaSession(handlers = {}) {
  const ms = navigator.mediaSession;
  if (!ms) return null;

  if (!ms.__bound) {
    ms.__bound = true;
    const safe = fn => details => { try { fn?.(details); } catch {} };
    
    const acts = {
      play: handlers.onPlay, pause: handlers.onPause, stop: handlers.onStop,
      previoustrack: handlers.onPrev, nexttrack: handlers.onNext,
      seekbackward: d => handlers.onSeekBy?.(-(Number(d?.seekOffset) || 10)),
      seekforward: d => handlers.onSeekBy?.((Number(d?.seekOffset) || 10)),
      seekto: d => Number.isFinite(d?.seekTime) && handlers.onSeekTo?.(d.seekTime)
    };
    
    for (const [k, fn] of Object.entries(acts)) ms.setActionHandler(k, safe(fn));
  }

  return {
    updateMetadata: ({ title = '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è', artist = '', album = '', artworkUrl, playing } = {}) => {
      try {
        const src = String(artworkUrl || '').trim();
        const artwork = src ? [96, 128, 192, 256, 384, 512].map(s => ({ src, sizes: `${s}x${s}`, type: 'image/png' })) : [];
        ms.metadata = new MediaMetadata({ title, artist, album, artwork });
        ms.playbackState = playing ? 'playing' : 'paused';
      } catch {}
    },
    updatePositionState: () => {
      try {
        const st = handlers.getPositionState?.();
        if (st && ms.setPositionState) ms.setPositionState({ duration: Number(st.duration) || 0, playbackRate: Number(st.playbackRate) || 1, position: Number(st.position) || 0 });
      } catch {}
    }
  };
}

//=================================================
// FILE: /src/PlayerCore.js
import { getTrackByUid } from '../scripts/app/track-registry.js';
import { Favorites } from '../scripts/core/favorites-manager.js';
import { ensureMediaSession } from './player-core/media-session.js';

(function () {
  'use strict';
  const W = window, ls = localStorage;
  const LS_VOL = 'playerVolume', LS_PQ = 'qualityMode:v1';
  const clamp = (n, a, b) => Math.min(Math.max(Number(n) || 0, a), b);
  const sUid = v => (v == null ? '' : String(v)).trim() || null;
  const qNorm = v => String(v || '').toLowerCase() === 'lo' ? 'lo' : 'hi';
  const emitG = (n, d) => W.dispatchEvent(new CustomEvent(n, d ? { detail: d } : undefined));
  
  class PlayerCore {
    playlist = []; originalPlaylist = []; currentIndex = -1;
    flags = { shuf: false, rep: false, mute: false }; shufHist = [];
    sound = null; qMode = qNorm(ls.getItem(LS_PQ));
    _tok = 0; _tick = null; _sleep = null; _skips = 0;
    _ev = new Map(); _favSubs = new Set();
    
    constructor() {
      W.addEventListener('offline:uiChanged', () => this.qMode = qNorm(ls.getItem(LS_PQ)));
      this._ms = ensureMediaSession({
        onPlay: () => this.play(), onPause: () => this.pause(), onStop: () => this.stop(),
        onPrev: () => this.prev(), onNext: () => this.next(), onSeekTo: t => this.seek(t)
      });
      const unlock = () => { 
        if (W.Howler?.ctx?.state === 'suspended') W.Howler.ctx.resume().catch(()=>{});
        if (this._unlk) return; this._unlk = true;
        try { new Howl({ src: ['data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//OEAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAEAAABIWFhYW5uYWFuYW5uYW5uYW5uYW5uYW5uYW5uYW5uYW5u//OEAAAAAAAAAAAAAAAAAAAAAAAAMGluZ2QAAAAcAAAABAAAASFycnJyc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nz//OEAAAAAAAAAAAAAAAAAAAAAAAATGF2YzU4Ljc2AAAAAAAAAAAAAAAAJAAAAAAAAAAAASCCOzuJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//OEAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAASCCOzuJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'], html5: true, volume: 0 }).play(); } catch {}
      };
      ['touchend', 'click', 'keydown'].forEach(e => document.addEventListener(e, unlock, { once: true, capture: true }));
    }

    initialize() { Favorites?.init?.(); }
    prepareContext() { if (W.Howler?.ctx?.state === 'suspended') W.Howler.ctx.resume().catch(()=>{}); }

    setPlaylist(tracks, startIdx = 0, meta, opts = {}) {
      const prevPos = this.getPosition(), wasPlay = this.isPlaying();
      this.playlist = (tracks || []).map(t => ({ ...t, uid: sUid(t.uid), title: t.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è', artist: t.artist || '–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞' }));
      if (!opts.preserveOriginalPlaylist) this.originalPlaylist = [...this.playlist];

      this.currentIndex = clamp(startIdx, 0, this.playlist.length - 1);
      const tUid = this.playlist[this.currentIndex]?.uid;
      if (!opts.preserveShuffleMode) this.shufHist = [];

      if (this.flags.shuf && !opts.preserveShuffleMode) this.shufflePlaylist(tUid);
      else if (tUid) this.currentIndex = Math.max(0, this.playlist.findIndex(t => t.uid === tUid));

      this._skips = 0;
      if (this.sound && this.getCurrentTrackUid() === tUid && wasPlay && opts.preservePosition) {
        this._emit('onTrackChange', this.getCurrentTrack(), this.currentIndex); return this._updMedia();
      }

      if (wasPlay) this.load(this.currentIndex, { autoPlay: true, resumePosition: opts.preservePosition ? prevPos : 0 });
      else { this._emit('onTrackChange', this.getCurrentTrack(), this.currentIndex); this._updMedia(); }
    }

    shufflePlaylist(keepUid = null) {
      const cUid = keepUid || this.getCurrentTrackUid();
      for (let i = this.playlist.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [this.playlist[i], this.playlist[j]] = [this.playlist[j], this.playlist[i]];
      }
      this.currentIndex = 0;
      if (cUid) { const idx = this.playlist.findIndex(t => t.uid === cUid); if (idx >= 0) this.playlist.unshift(...this.playlist.splice(idx, 1)); }
    }

    getPlaylistSnapshot() { return [...this.playlist]; }
    getCurrentTrack() { return this.playlist[this.currentIndex] || null; }
    getIndex() { return this.currentIndex; }
    getNextIndex() { return this.playlist.length ? (this.currentIndex + 1) % this.playlist.length : -1; }
    getCurrentTrackUid() { return sUid(this.getCurrentTrack()?.uid); }

    isPlaying() { return !!this.sound?.playing(); }
    play(idx, opts = {}) {
      this.prepareContext();
      if (idx != null) return (idx === this.currentIndex && this.sound) ? (!this.isPlaying() && this.sound.play()) : this.load(idx, opts);
      if (this.sound) !this.isPlaying() && this.sound.play(); else if (this.currentIndex >= 0) this.load(this.currentIndex, { autoPlay: true });
    }
    pause() { this.sound?.pause(); }
    stop() { this._unload(false); this._updMedia(); }
    
    next() {
      if (!this.playlist.length) return;
      if (this.flags.shuf) { this.shufHist.push(this.currentIndex); if (this.shufHist.length > 50) this.shufHist.shift(); }
      this.load((this.currentIndex + 1) % this.playlist.length, { autoPlay: true, dir: 1 });
    }
    
    prev() {
      if (!this.playlist.length) return;
      if (this.getPosition() > 3) return void this.seek(0);
      if (this.flags.shuf && this.shufHist.length) return this.load(this.shufHist.pop(), { autoPlay: true, dir: -1 });
      this.load((this.currentIndex - 1 + this.playlist.length) % this.playlist.length, { autoPlay: true, dir: -1 });
    }
    
    seek(s) { return this.sound?.seek(s) || 0; }
    getPosition() { return this.sound?.seek() || 0; }
    getDuration() { return this.sound?.duration() || 0; }

    setVolume(v) { const vol = clamp(Number(v)/100, 0, 1); ls.setItem(LS_VOL, String(Math.round(vol * 100))); if (!this.flags.mute) Howler.volume(vol); }
    getVolume() { return Number(ls.getItem(LS_VOL)) || 100; }
    setMuted(m) { this.flags.mute = !!m; Howler.volume(this.flags.mute ? 0 : this.getVolume() / 100); }
    isMuted() { return this.flags.mute; }

    async load(idx, opts = {}) {
      const t = this.playlist[idx], tok = ++this._tok, dir = Number(opts.dir) || 1, uid = sUid(t?.uid);
      if (!t) return;
      
      this.currentIndex = idx;
      if (!opts.isAutoSkip) this._skips = 0;
      this._emit('onTrackChange', t, idx); emitG('player:trackChanged', { uid, dir });

      let r = null, url = null;
      try { r = await W.TrackResolver?.resolve?.(uid, this.qMode); } catch {}
      if (tok !== this._tok) return;

      const netOk = W.NetPolicy?.isNetworkAllowed?.() ?? navigator.onLine;
      if (r?.blob) {
        this._oK = 'p_' + uid;
        this._oKTok = tok;
        url = W.Utils?.blob?.createUrl
          ? W.Utils.blob.createUrl(this._oK, r.blob)
          : URL.createObjectURL(r.blob);
      }
      else if (r?.source === 'stream' && r.url && netOk) {
        this._oK = null; url = r.url;
        if (W.Utils?.getNet?.()?.kind === 'cellular' && W.NetPolicy?.shouldShowCellularToast?.()) W.NotificationSystem?.show?.('–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –º–æ–±–∏–ª—å–Ω—É—é —Å–µ—Ç—å', 'info');
      }
      
      if (!url && t.src && (!r || r.source === 'none') && netOk) {
        url = (this.qMode === 'lo' && (getTrackByUid(uid)?.audio_low || t.sources?.audio?.lo)) ? (getTrackByUid(uid)?.audio_low || t.src) : t.src;
      }

      const sf = fn => (...a) => tok === this._tok && fn(...a);

      if (!url) {
        if (this._skips >= this.playlist.length) { W.NotificationSystem?.show?.('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤', 'error'); return this._emit('onPlaybackError', { reason: 'no_source' }); }
        return setTimeout(sf(() => { this._skips++; this.load((idx + dir + this.playlist.length) % this.playlist.length, { ...opts, autoPlay: true, isAutoSkip: true, dir }); }), 80);
      }

      const pos = Number(opts.resumePosition) || 0, retry = Number(opts._retryN) || 0;
      this._unload(true);

      this.sound = new Howl({
        src: [url], html5: r?.source === 'stream' || !r?.blob, volume: this.getVolume() / 100, format: ['mp3'], autoplay: opts.autoPlay ?? this.isPlaying(),
        onload: sf(() => { pos && this.seek(pos); this._updMedia(); }),
        onplay: sf(() => { this._startT(); this._emit('onPlay', t, idx); this._updMedia(); emitG('player:play', { uid, duration: this.getDuration(), type: 'audio' }); }),
        onpause: sf(() => { this._stopT(); this._emit('onPause'); this._updMedia(); emitG('player:pause'); }),
        onend: sf(() => { this._emit('onEnd'); this._updMedia(); emitG('player:ended'); emitG('analytics:forceFlush'); this.flags.rep ? this.play(this.currentIndex) : this.next(); }),
        onloaderror: sf(() => this._err(idx, retry, opts, dir)),
        onplayerror: sf(() => this._err(idx, retry, opts, dir))
      });
    }

    _err(idx, r, o, d) {
      this._emit('onPlaybackError', { reason: 'error' });
      if ((W.NetPolicy?.isNetworkAllowed?.() ?? navigator.onLine) && r < 2) setTimeout(() => this._tok === this._tok && this.load(idx, { ...o, autoPlay: true, _retryN: r + 1, dir: d }), 250 + r * 500);
      else { this._skips = Math.min(this.playlist.length, this._skips + 1); setTimeout(() => this._tok === this._tok && this.load((idx + d + this.playlist.length) % this.playlist.length, { ...o, autoPlay: true, isAutoSkip: true, dir: d }), 120); }
    }

    _unload(silent) {
      if (this.sound) {
        try { this.sound.stop(); this.sound.unload(); } catch {}
        this.sound = null;
      }

      // CRITICAL: –Ω–µ –æ—Ç–∑—ã–≤–∞–µ–º blob-url "–Ω–∞ –≥–æ—Ä—è—á—É—é" –ø—Ä–∏ silent unload.
      // Howler –º–æ–∂–µ—Ç –µ—â—ë –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –Ω–µ–º—É (—Ä–µ—Ç—Ä–∞–∏/–±—É—Ñ–µ—Ä/—Å–æ–±—ã—Ç–∏—è) => blob: ERR_FILE_NOT_FOUND => –∞–≤—Ç–æ—Å–∫–∏–ø.
      //
      // –ü—Ä–∞–≤–∏–ª–æ:
      // - silent=true: revoke —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ blob-url –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ù–ï —Ç–µ–∫—É—â–µ–π –∑–∞–≥—Ä—É–∑–∫–µ (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π token)
      // - silent=false (stop): –º–æ–∂–Ω–æ revoke –≤—Å–µ–≥–¥–∞ (–º—ã —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏)
      if (this._oK) {
        const canRevoke = !silent || (this._oKTok && this._oKTok !== this._tok);
        if (canRevoke) {
          try { W.Utils?.blob?.revokeUrl?.(this._oK); } catch {}
          this._oK = null;
          this._oKTok = 0;
        }
      }

      this._stopT();
      if (!silent) {
        emitG('player:stop');
        this._emit('onStop');
      }
    }

    _startT() { this._stopT(); this._tick = setInterval(() => { this._emit('onTick', this.getPosition(), this.getDuration()); emitG('player:tick', { currentTime: this.getPosition(), volume: this.getVolume(), muted: this.isMuted() }); }, 250); }
    _stopT() { if (this._tick) clearInterval(this._tick); this._tick = null; }
    _updMedia() { try { this._ms?.updateMetadata?.({ title: this.getCurrentTrack()?.title, artist: this.getCurrentTrack()?.artist, album: this.getCurrentTrack()?.album, artworkUrl: this.getCurrentTrack()?.cover, playing: this.isPlaying() }); } catch {} }

    canToggleQualityForCurrentTrack() { return !!this.getCurrentTrack() && !!(getTrackByUid(this.getCurrentTrackUid())?.audio_low || this.getCurrentTrack()?.sources?.audio?.lo); }
    switchQuality(m) {
      const nq = qNorm(m); if (this.qMode === nq) return;
      this.qMode = nq; ls.setItem(LS_PQ, nq); emitG('quality:changed', { quality: nq }); emitG('offline:uiChanged');
      if (this.currentIndex >= 0 && this.sound) this.load(this.currentIndex, { autoPlay: this.isPlaying(), resumePosition: this.getPosition(), dir: 1 });
      W.NotificationSystem?.show?.(`–ö–∞—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ ${nq === 'hi' ? 'Hi' : 'Lo'}`, 'info');
    }

    isFavorite(uid) { return Favorites.isLiked(sUid(uid)); }
    toggleFavorite(uid, opts = {}) {
      const u = sUid(uid); if (!u) return { liked: false };
      const pA = W.AlbumsManager?.getPlayingAlbum?.(), isFavView = pA === W.SPECIAL_FAVORITES_KEY;
      const src = opts.source || (opts.fromAlbum ? 'album' : (isFavView ? 'favorites' : 'album'));
      const liked = Favorites.toggle(u, { source: src, albumKey: opts.albumKey });
      this._favSubs.forEach(f => { try { f({ uid: u, liked, albumKey: opts.albumKey }); } catch {} });

      if (!liked && src === 'favorites' && isFavView && this.getCurrentTrackUid() === u) {
        if ((this.getFavoritesState().active?.length || 0) <= 0) this.stop(); else this.next();
      }
      return { liked };
    }

    removeInactivePermanently(uid) { const u = sUid(uid); if (u && Favorites.remove(u)) this._favSubs.forEach(f => { try { f({ uid: u, liked: false, removed: true }); } catch {} }); }
    restoreInactive(uid) { return this.toggleFavorite(uid, { source: 'favorites' }); }
    
    showInactiveFavoriteModal(p = {}) {
      if (!W.Modals?.open) return;
      const m = W.Modals.open({ title: '–¢—Ä–µ–∫ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω', maxWidth: 420, bodyHtml: `<div style="color:#9db7dd;margin-bottom:14px"><div><strong>${W.Utils?.escapeHtml?.(p.title)||'–¢—Ä–µ–∫'}</strong></div><div style="opacity:.9">–í–µ—Ä–Ω—É—Ç—å –≤ ‚≠ê –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å?</div></div><div class="om-actions"><button type="button" class="modal-action-btn online" data-act="add">–í–µ—Ä–Ω—É—Ç—å</button><button type="button" class="modal-action-btn" data-act="remove">–£–¥–∞–ª–∏—Ç—å</button></div>` });
      m.querySelector('[data-act="add"]')?.addEventListener('click', () => { m.remove(); this.restoreInactive(p.uid); });
      m.querySelector('[data-act="remove"]')?.addEventListener('click', () => { m.remove(); this.removeInactivePermanently(p.uid); try { p.onDeleted?.(); } catch {} });
    }

    getFavoritesState() {
      return Favorites.getSnapshot().reduce((r, i) => {
        const u = sUid(i?.uid);
        if (u) r[i.inactiveAt ? 'inactive' : 'active'].push({ uid: u, sourceAlbum: sUid(i.sourceAlbum || i.albumKey || getTrackByUid(u)?.sourceAlbum), ...(i.inactiveAt && { inactiveAt: i.inactiveAt }) });
        return r;
      }, { active: [], inactive: [] });
    }

    getLikedUidsForAlbum(key) { const k = sUid(key); return k ? Favorites.getSnapshot().filter(i => !i.inactiveAt && sUid(getTrackByUid(i.uid)?.sourceAlbum) === k).map(i => i.uid) : []; }
    
    applyFavoritesOnlyFilter() {
      const pA = W.AlbumsManager?.getPlayingAlbum?.(), isFav = ls.getItem('favoritesOnlyMode') === '1';
      if (!pA || !this.originalPlaylist?.length || this.currentIndex < 0) return;
      
      const uniq = this.originalPlaylist.filter((t, i, a) => t?.uid && a.findIndex(x => x.uid === t.uid) === i);
      const liked = new Set(this.getLikedUidsForAlbum(pA));
      const tgt = (pA === W.SPECIAL_FAVORITES_KEY || (isFav && !W.Utils?.isShowcaseContext?.(pA))) ? uniq.filter(t => pA === W.SPECIAL_FAVORITES_KEY ? this.isFavorite(t.uid) : liked.has(t.uid)) : (isFav ? uniq.filter(t => this.isFavorite(t.uid)) : uniq);

      if (!tgt.length) return;
      const nIdx = Math.max(0, tgt.findIndex(t => t.uid === this.getCurrentTrackUid()));
      this.shufHist = [];
      this.setPlaylist(tgt, nIdx, {}, { preserveOriginalPlaylist: true, preserveShuffleMode: false, preservePosition: (nIdx === this.currentIndex && tgt[nIdx]?.uid === this.getCurrentTrackUid()) });
      W.PlayerUI?.updatePlaylistFiltering?.();
    }

    onFavoritesChanged(cb) { this._favSubs.add(cb); return () => this._favSubs.delete(cb); }

    toggleShuffle() { 
      this.flags.shuf = !this.flags.shuf; 
      if (this.flags.shuf) this.shufflePlaylist(); else { const u = this.getCurrentTrackUid(); this.playlist = [...this.originalPlaylist]; if(u) this.currentIndex = Math.max(0, this.playlist.findIndex(t => t.uid === u)); } 
      emitG('playlist:changed', { reason: 'shuffle', shuffleMode: this.flags.shuf }); 
    }
    isShuffle() { return this.flags.shuf; }
    
    toggleRepeat() { this.flags.rep = !this.flags.rep; emitG('playlist:changed', { reason: 'repeat', repeatMode: this.flags.rep }); }
    isRepeat() { return this.flags.rep; }

    on(evs) { Object.entries(evs||{}).forEach(([k, f]) => { if (!this._ev.has(k)) this._ev.set(k, new Set()); this._ev.get(k).add(f); }); }
    _emit(n, ...a) { this._ev.get(n)?.forEach(f => { try { f(...a); } catch {} }); }

    setSleepTimer(ms) { clearTimeout(this._sleep); this._sleepTarget = ms > 0 ? Date.now() + ms : 0; if (ms > 0) this._sleep = setTimeout(() => { this.pause(); this._emit('onSleepTriggered'); }, ms); }
    getSleepTimerTarget() { return this._sleepTarget; }
    clearSleepTimer() { this.setSleepTimer(0); }
  }

  W.playerCore = new PlayerCore();
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', () => W.playerCore.initialize()); else W.playerCore.initialize();
})();

//=================================================
// FILE: /styles/main.css
:root{--primary-bg:#181818;--primary-color:#e80100;--secondary-color:#4daaff;--text-color:#f2f2f2;--modal-bg:#252d39;--border-color:#394866;--btn-size:44px;--btn-radius:8px;--bg-0:#0f1218;--c-blue:#8ab8fd;--c-w:#fff;--c-e:#eee;--shadow-1:0 4px 24px rgba(0,0,0,.3);--shadow-2:0 8px 32px rgba(0,0,0,.4);--grad-blue:linear-gradient(90deg,#4daaff,#357ac9);--om-bd:rgba(255,255,255,.10);--om-sub:#9db7dd}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:rgba(0,0,0,0)}
html,body{height:100%;background:var(--primary-bg);color:var(--text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;display:flex;flex-direction:column}
body{min-height:100vh;min-width:100vw;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;padding-top:env(safe-area-inset-top);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
.hidden{display:none!important}

/* Promocode */
#promocode-block{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:var(--primary-bg);z-index:100}
.promo-inner{display:flex;flex-direction:column;align-items:center;background:rgba(15,18,24,.98);border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.5);padding:36px 26px 32px;min-width:280px;max-width:90vw}
.promo-cover{width:256px;height:256px;max-width:70vw;max-height:70vw;object-fit:cover;border-radius:12px;box-shadow:0 4px 24px rgba(0,0,0,.7);margin-bottom:19px;display:block;background:var(--primary-bg)}
.promo-inner h2{margin-bottom:16px;color:var(--secondary-color);font-size:20px}
#promo-inp{padding:12px 16px;border-radius:8px;border:1px solid var(--border-color);background:rgba(255,255,255,.1);color:var(--text-color);margin:10px 0;width:100%;max-width:280px;font-size:16px;outline:0;transition:border-color .3s}
#promo-inp:focus{border-color:var(--secondary-color)}
#promo-inp.error{border-color:var(--primary-color);animation:shake .3s}
@keyframes shake{0%,to{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}
#promo-btn{padding:12px 32px;background:var(--primary-color);color:var(--c-w);border:0;border-radius:8px;cursor:pointer;font-weight:800;font-size:16px;transition:opacity .2s,transform .1s;margin-top:8px}
#promo-btn:hover:not(:disabled){opacity:.9;transform:translateY(-1px)}
#promo-btn:active{transform:translateY(0)}
#promo-btn:disabled{opacity:.5;cursor:not-allowed}
#promo-error{color:#ff6b6b;margin-top:12px;font-size:14px;min-height:20px}

/* Layout */
#main-block{max-width:420px;margin:0 auto;flex:1 0 auto;display:flex;flex-direction:column;align-items:center;width:100%;padding:0 10px;padding-bottom:env(safe-area-inset-bottom)}

/* --- RPG Classic Achievements Widget --- */
.ach-progress-root {
  width: 100%; max-width: 398px; margin: 16px auto 8px;
  background: rgba(15,18,24,0.85); border-radius: 14px;
  padding: 14px 16px; border: 1px solid #232b38;
  box-shadow: 0 4px 20px rgba(0,0,0,0.4); text-align: center;
}
.ach-hint-bubble {
  background: rgba(77, 170, 255, 0.1); border-radius: 8px;
  padding: 8px 12px; font-size: 13px; color: #eaf2ff; font-weight: 600;
  display: inline-block; margin-bottom: 12px; cursor: pointer;
  box-shadow: inset 0 0 0 1px rgba(77, 170, 255, 0.2); transition: 0.2s;
}
.ach-hint-bubble:hover { background: rgba(77, 170, 255, 0.2); transform: translateY(-1px); }
.ach-rpg-header { display: flex; align-items: center; gap: 14px; margin-bottom: 14px; text-align: left; }
.rpg-level-badge {
  background: linear-gradient(135deg, #ff9800, #ff5722);
  width: 54px; height: 54px; border-radius: 50%;
  display: flex; flex-direction: column; justify-content: center; align-items: center;
  box-shadow: 0 0 15px rgba(255,87,34,0.4); border: 2px solid #fff; flex-shrink: 0;
}
.rpg-level-badge .lvl-lbl { font-size: 10px; font-weight: 900; color: #fff; opacity: 0.9; line-height: 1; }
.rpg-level-badge .lvl-val { font-size: 24px; font-weight: 900; color: #fff; line-height: 1.1; }
.ach-progress-bars { flex: 1; min-width: 0; }
.ach-progress-header { margin-bottom: 6px; }
.ach-progress-title { font-size: 12px; font-weight: 900; color: #fff; letter-spacing: 0.5px; }
.ach-bar { background: #232b38; height: 6px; border-radius: 3px; overflow: hidden; margin-bottom: 4px; }
.ach-bar-xp { height: 4px; opacity: 0.8; }
.ach-bar-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #e80100, #4daaff); transition: width 0.5s ease; }
.ach-bar-fill.xp-fill { background: linear-gradient(90deg, #ff9800, #ffeb3b); }
.ach-stat-row { display: flex; justify-content: space-between; font-size: 11px; font-weight: 700; color: #8ab8fd; margin-bottom: 4px; }
.ach-xp-label { color: #ff9800; }
.backup-btn {
  background: #0088cc; color: #fff; border: none; border-radius: 8px;
  padding: 10px 20px; font-size: 13px; font-weight: 900; cursor: pointer;
  width: 100%; transition: 0.2s; box-shadow: 0 4px 12px rgba(0, 136, 204, 0.3);
}
.backup-btn:hover { background: #0099e6; transform: translateY(-1px); }
.backup-btn:active { transform: scale(0.98); }

/* Classic Achievements (Profile -> –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è) */
.ach-classic-tabs{display:flex;gap:8px;margin-bottom:12px;background:rgba(0,0,0,.18);padding:4px;border-radius:10px;overflow-x:auto;scrollbar-width:none}
.ach-classic-tab{flex:1;padding:7px 10px;text-align:center;font-size:12px;font-weight:900;color:rgba(255,255,255,.45);cursor:pointer;border-radius:8px;transition:.18s;white-space:nowrap;border:1px solid transparent}
.ach-classic-tab.active{background:rgba(77,170,255,.18);border-color:rgba(77,170,255,.28);color:#eaf2ff}

.ach-item{display:flex;flex-direction:column;gap:8px;padding:12px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:14px;margin-bottom:10px;box-shadow:0 8px 30px rgba(0,0,0,.22)}
.ach-item.done{background:rgba(76,175,80,.05);border-color:rgba(76,175,80,.18)}

.ach-top{display:flex;align-items:center;min-width:0}
.ach-title{font-size:14px;font-weight:900;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.ach-sub{font-size:12px;color:rgba(234,242,255,.72);line-height:1.25}

.ach-progress{margin-top:8px}
.ach-mini-bar{width:100%;background:rgba(255,255,255,.06);height:6px;border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,.08)}
.ach-mini-fill{height:100%;background:linear-gradient(90deg,#4daaff,#7c4dff);transition:width .25s ease}

.ach-bottom{margin-top:2px;display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:10px}
.ach-xp{display:inline-flex;align-items:center;justify-content:center;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:900;color:#ffd54f;background:rgba(255,193,7,.10);border:1px solid rgba(255,193,7,.20);white-space:nowrap}
.ach-item.done .ach-xp{color:#81c784;background:rgba(76,175,80,.12);border-color:rgba(76,175,80,.22)}
.ach-remaining{text-align:center;font-size:12px;color:rgba(157,183,221,.92);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

.ach-more{appearance:none;border:1px solid rgba(77,170,255,.22);background:rgba(77,170,255,.10);color:#eaf2ff;border-radius:10px;padding:6px 10px;font-size:11px;font-weight:900;cursor:pointer;line-height:1;text-transform:uppercase;min-width:110px}
.ach-more:hover{background:rgba(77,170,255,.18);border-color:rgba(77,170,255,.32)}
.ach-more:active{transform:scale(.98)}

.ach-details{display:none;padding:10px 2px 2px;border-top:1px dashed rgba(255,255,255,.12)}
.ach-details-title{color:#cfe3ff;font-weight:900;margin-bottom:6px}
.ach-details-how{color:#eaeffb;margin-bottom:6px;font-size:12px;line-height:1.35}
.ach-details-desc{color:#9aa8c4;font-size:12px;line-height:1.35}

/* Modern Profile View (v4.0) */
.profile-wrap { padding: 0 10px 20px; display: flex; flex-direction: column; gap: 16px; animation: fadeIn 0.3s ease; }
.profile-header { display: flex; flex-direction: column; align-items: center; gap: 12px; background: rgba(255,255,255,0.03); padding: 20px; border-radius: 16px; border: 1px solid var(--border-color); position: relative; }
.profile-avatar-btn { background: #232b38; border: 2px solid var(--secondary-color); width: 80px; height: 80px; border-radius: 50%; font-size: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
.profile-avatar-btn:hover { transform: scale(1.05); box-shadow: 0 0 15px rgba(77,170,255,0.4); }
.profile-name-wrap { display: flex; align-items: center; gap: 8px; }
.profile-name-input { background: transparent; border: none; border-bottom: 1px dashed var(--secondary-color); color: #fff; font-size: 20px; font-weight: 900; text-align: center; outline: none; width: 150px; transition: 0.2s; }
.profile-name-input:focus { border-bottom-color: #fff; }
.profile-edit-icon { cursor: pointer; color: var(--c-blue); font-size: 16px; }

/* Auth & Sync */
.profile-auth-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
.auth-btn { padding: 10px 0; border-radius: 10px; border: none; font-weight: bold; font-size: 13px; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; align-items: center; gap: 4px; color: #fff; }
.auth-btn:active { transform: scale(0.95); }
.auth-btn.yandex { background: #E60000; } .auth-btn.google { background: #4285F4; } .auth-btn.vk { background: #0077FF; }
.auth-btn.connected { opacity: 0.5; border: 2px solid #4caf50; background: #232b38; }

/* Tabs */
.profile-tabs { display: flex; background: rgba(255,255,255,0.05); border-radius: 10px; padding: 4px; overflow-x: auto; scrollbar-width: none; }
.profile-tabs::-webkit-scrollbar { display: none; }
.profile-tab-btn { flex: 1; min-width: max-content; padding: 8px 12px; background: transparent; border: none; color: #888; font-weight: 700; font-size: 13px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
.profile-tab-btn.active { background: var(--secondary-color); color: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
.profile-tab-content { display: none; flex-direction: column; gap: 12px; }
.profile-tab-content.active { display: flex; animation: slideUp 0.3s ease; }

/* Lists & Items (Logs, Recs, Stats) */
.profile-list-item { background: rgba(255,255,255,0.03); border-radius: 12px; padding: 12px; border: 1px solid rgba(255,255,255,0.05); display: flex; gap: 12px; align-items: center; }
.log-time { font-size: 11px; color: #888; min-width: 45px; }
.log-info { flex: 1; }
.log-title { font-size: 13px; font-weight: bold; color: #eaf2ff; }
.log-desc { font-size: 11px; color: var(--secondary-color); margin-top: 2px; }

.rec-cover { width: 48px; height: 48px; border-radius: 8px; object-fit: cover; }
.rec-play-btn { background: rgba(77,170,255,0.15); color: var(--secondary-color); border: none; width: 36px; height: 36px; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: 0.2s; }
.rec-play-btn:hover { background: var(--secondary-color); color: #fff; transform: scale(1.1); }

.ach-info { flex: 1; text-align: left; }
.ach-name { font-size: 14px; font-weight: bold; color: #fff; margin-bottom: 2px; }
.ach-desc { font-size: 11px; color: #888; }
.ach-check { color: #4caf50; font-weight: bold; font-size: 18px; }

.stats-grid-compact { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
.stat-box { 
  background: rgba(255,255,255,0.03); padding: 12px; border-radius: 10px; 
  text-align: center; border: 1px solid rgba(255,255,255,0.05);
}
.stat-box b { display: block; font-size: 18px; color: #fff; }
.stat-box span { font-size: 10px; color: #888; text-transform: uppercase; }

/* Album title */
.active-album-title{width:100%;max-width:400px;margin:18px auto 6px;text-align:center;color:#eaf2ff;font-weight:900;letter-spacing:.01em;line-height:1.15;text-shadow:0 1px 0 rgba(0,0,0,.35);font-size:clamp(18px,4.6vw,24px);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.active-album-title.fav{color:#ffd166;letter-spacing:.06em}
.active-album-title.news{color:var(--c-blue);letter-spacing:.02em}

/* Album icons */
.album-icons{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;align-items:center;justify-items:center;margin:12px auto 0;max-width:400px;width:100%;padding:4px 8px;overflow:hidden}
.album-icons::-webkit-scrollbar{display:none}
.album-icon[data-album="__favorites__"]{grid-row:2;grid-column:2}
.album-icon[data-album="__reliz__"]{grid-row:2;grid-column:3}
.album-icon[data-album="odnazhdy-v-skazke"],.album-icon[data-album="golos-dushi"],.album-icon[data-album="mezhdu-zlom-i-dobrom"],.album-icon[data-album="krevetochka"]{grid-row:1}
.album-icon{width:clamp(62px,16vw,82px);height:clamp(62px,16vw,82px);border-radius:10px;overflow:hidden;border:1px solid var(--border-color);cursor:pointer;filter:grayscale(70%) brightness(.88);opacity:.72;transition:transform .15s,filter .15s,opacity .15s,box-shadow .15s,width .15s ease,height .15s ease;touch-action:manipulation;-webkit-touch-callout:none}
.album-icon img{width:100%;height:100%;object-fit:cover;display:block}
.album-icon.active{filter:none;opacity:1;box-shadow:0 2px 10px rgba(0,0,0,.35);width:clamp(68px,17vw,88px);height:clamp(68px,17vw,88px)}
.album-icon:hover{transform:translateY(-2px);opacity:.9}
.album-icon:active{transform:translateY(0) scale(.95)}

/* Common tap/click targets */
.track,.like-star,.player-control-btn,.sleep-timer-btn,.offline-btn,.lyrics-toggle-btn,.animation-btn,.pulse-btn,.karaoke-btn,.player-download-btn,button,a,input,select,textarea,[role="button"]{touch-action:manipulation;-webkit-touch-callout:none}

/* Cover / gallery */
#cover-wrap{width:100%;max-width:400px;margin:14px auto 0;aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;position:relative}
.cover-gallery-arrow{position:absolute;top:50%;transform:translateY(-50%);z-index:2;border:0;cursor:pointer;background:0 0;padding:0;width:44px;height:44px;display:flex;align-items:center;justify-content:center;transition:opacity .2s;visibility:hidden;pointer-events:none}
.cover-gallery-arrow:hover{opacity:.8}
.cover-gallery-arrow:active{transform:translateY(-50%) scale(.9)}
#cover-gallery-arrow-left{left:7px}
#cover-gallery-arrow-right{right:7px}
#cover-wrap.gallery-nav-ready .cover-gallery-arrow{visibility:visible;pointer-events:auto}
#cover-slot{width:100%;height:100%;border-radius:12px;overflow:hidden;background:var(--primary-bg);box-shadow:var(--shadow-1);position:relative}
#cover-slot iframe,#cover-slot img{width:100%;height:100%;display:block;border:0;background:0 0}
#cover-slot img{object-fit:contain}

/* Socials */
.socials-under-cover{margin:14px auto 0;width:100%;max-width:398px;text-align:center;font-size:1.03em;display:flex;flex-wrap:wrap;justify-content:center;gap:12px}
.socials-under-cover a{color:var(--secondary-color);text-decoration:none;transition:color .2s;padding:4px 8px}
.socials-under-cover a:hover{color:var(--text-color);text-decoration:underline}

/* Player */
.lyrics-player-block{max-width:370px;width:100%;margin:20px auto 0;background:linear-gradient(180deg,rgba(30,34,45,.95),rgba(15,18,24,.98));border-radius:14px;overflow:hidden;box-shadow:var(--shadow-2);position:relative}

/* Lyrics window */
#lyrics-window{position:relative;overflow:hidden;border-radius:12px 12px 0 0;background:var(--bg-0);transition:height .2s ease,opacity .2s ease}
#lyrics-window.lyrics-normal{height:8.7em}
#lyrics-window.lyrics-expanded{height:15.6em}
#lyrics-window.lyrics-hidden{height:0!important;opacity:0!important;pointer-events:none!important;margin:0!important}
.lyrics-scroll{position:relative;z-index:1;display:flex;flex-direction:column;justify-content:center;height:100%;overflow:hidden;padding:0}
.lyrics-scroll::-webkit-scrollbar{display:none}
.lyrics-window-line{text-align:center;padding:6px 16px;color:var(--c-e);font-size:15px;opacity:.57;transition:color .25s,opacity .25s,font-size .25s,font-weight .25s,background .25s;user-select:none;line-height:1.35}
.lyrics-window-line.active{color:var(--primary-color);font-size:1.19em;font-weight:800;opacity:1;background:rgba(0,0,0,.07);text-shadow:0 1px 7px rgba(115,22,22,.27)}
.lyrics-placeholder{text-align:center;padding:40px 16px;color:#5a6989;font-size:14px;opacity:.6;user-select:none}
.lyrics-spinner{width:40px;height:40px;margin:40px auto;border:4px solid rgba(77,170,255,.2);border-top-color:var(--secondary-color);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* Countdown */
.lyrics-countdown{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:4em;font-weight:900;color:rgba(77,170,255,.35);z-index:0;pointer-events:none;user-select:none;text-shadow:0 2px 12px rgba(77,170,255,.2);animation:countdownPulse 1s ease-in-out infinite}
.lyrics-countdown.fade-out{animation:countdownFadeOut 1s ease-out forwards}
@keyframes countdownPulse{0%,to{transform:scale(1);opacity:.35}50%{transform:scale(1.05);opacity:.45}}
@keyframes countdownFadeOut{from{opacity:.35;transform:scale(1)}to{opacity:0;transform:scale(.9)}}

/* Animated bg */
.lyrics-animated-bg{position:absolute;inset:0;opacity:0;pointer-events:none;z-index:0;transition:opacity .5s;background:linear-gradient(45deg,rgba(232,1,0,.15),rgba(77,170,255,.15),rgba(232,1,0,.15));background-size:400% 400%;animation:none}
.lyrics-animated-bg.active{opacity:1;animation:lyricsGradient 10s ease infinite}
@keyframes lyricsGradient{0%{background-position:0 50%}50%{background-position:100% 50%}to{background-position:0 50%}}

/* Progress */
.player-progress-wrapper{padding:16px 20px 12px;background:rgba(15,18,24,.6)}
.player-progress-bar{position:relative;height:6px;background:rgba(255,255,255,.08);border-radius:3px;cursor:pointer;overflow:visible}
.player-progress-fill{position:relative;height:100%;background:var(--grad-blue);border-radius:3px;width:0%;transition:width .1s linear}
.player-progress-handle{position:absolute;right:-7px;top:50%;transform:translateY(-50%);width:14px;height:14px;background:var(--c-w);border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,.4);opacity:0;transition:opacity .2s,transform .1s}
.player-progress-bar:hover .player-progress-handle{opacity:1}
.player-progress-handle:hover{transform:translateY(-50%) scale(1.2)}

/* Controls */
.player-controls{padding:14px 18px 16px;background:rgba(25,28,36,.8)}
.player-controls-row{display:flex;justify-content:center;align-items:center;gap:12px;margin-bottom:12px}
.player-controls-row:last-child{margin-bottom:0}
.time-in-controls{color:var(--c-blue);font-size:13px;min-width:42px;text-align:center;font-variant-numeric:tabular-nums;font-weight:500}
.player-control-btn,.sleep-timer-btn{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);color:var(--c-blue);cursor:pointer;padding:10px;border-radius:50%;transition:.25s;display:flex;align-items:center;justify-content:center;width:var(--btn-size);height:var(--btn-size);outline:0}
.player-control-btn:hover,.sleep-timer-btn:hover{background:rgba(77,170,255,.15);border-color:rgba(77,170,255,.3);transform:scale(1.05)}
.player-control-btn:active,.sleep-timer-btn:active{transform:scale(.95)}
.player-control-btn.main{background:var(--primary-color);border-color:var(--primary-color);color:var(--c-w);width:52px;height:52px}
.player-control-btn.main:hover{background:#c60000}
.player-control-btn svg{width:20px;height:20px}
.player-control-btn.main svg{width:24px;height:24px}
.player-control-btn.active,.player-control-btn.repeat-active,.sleep-timer-btn.active{background:rgba(77,170,255,.2);border-color:var(--secondary-color);color:var(--secondary-color);box-shadow:0 0 12px rgba(77,170,255,.3)}

/* Favorites */
#favorites-btn{position:relative}
#favorites-btn-icon{width:18px;height:18px;transition:transform .2s}
#favorites-btn.favorites-active{background:rgba(77,170,255,.2);border-color:var(--secondary-color)}
#favorites-btn.favorites-active #favorites-btn-icon{transform:scale(1.2)}

/* PQ */
#pq-btn{position:relative}
#pq-btn .pq-btn-label{font-weight:900;font-size:14px;letter-spacing:.02em}
#pq-btn.pq-hi{background:rgba(39,179,76,.16);border-color:rgba(39,179,76,.35);color:#b8ffd0}
#pq-btn.pq-lo{background:rgba(255,152,0,.16);border-color:rgba(255,152,0,.35);color:#ffe0b2}
#pq-btn.disabled{background:rgba(30,30,30,.6)!important;border-color:rgba(255,255,255,.06)!important;color:rgba(255,255,255,.25)!important;box-shadow:none!important;cursor:not-allowed!important;opacity:.6}

/* Sleep menu */
.sleep-timer-btn{position:relative}
.sleep-timer-badge{position:absolute;top:-4px;right:-4px;background:var(--primary-color);color:var(--c-w);font-size:10px;font-weight:800;border-radius:10px;padding:2px 6px;min-width:18px;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,.4)}
.sleep-menu{position:absolute;bottom:100%;right:0;margin-bottom:8px;background:var(--modal-bg);border:1px solid var(--border-color);border-radius:10px;padding:8px;box-shadow:0 4px 20px rgba(0,0,0,.5);min-width:180px;z-index:100}
.sleep-menu-item{padding:10px 14px;cursor:pointer;border-radius:6px;transition:background .2s;color:var(--text-color);font-size:14px}
.sleep-menu-item:hover{background:rgba(77,170,255,.15)}
.sleep-menu-item.active{background:rgba(77,170,255,.2);color:var(--secondary-color)}

/* Sleep timer: time dialog (HH:MM) */
.sleep-time-modal-backdrop{position:fixed;inset:0;z-index:10000;background:rgba(0,0,0,.65);display:flex;align-items:center;justify-content:center;padding:14px}
.sleep-time-modal{width:min(360px,100%);background:var(--modal-bg);border:1px solid var(--border-color);border-radius:14px;padding:14px;box-shadow:0 8px 40px rgba(0,0,0,.6)}
.sleep-time-title{color:var(--secondary-color);font-weight:900;margin:0 0 12px;text-align:center}
.sleep-time-row{display:flex;gap:8px;align-items:center;justify-content:center;margin-bottom:12px}
.sleep-time-input{width:72px;text-align:center;padding:10px 8px;border-radius:10px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);color:var(--text-color);outline:none}
.sleep-time-sep{opacity:.75}
.sleep-time-actions{display:flex;justify-content:flex-end;gap:8px}
.sleep-time-btn{padding:9px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);color:var(--text-color);cursor:pointer;font-weight:800}
.sleep-time-btn.primary{background:rgba(77,170,255,.25);border-color:rgba(77,170,255,.35);color:var(--secondary-color)}

/* Volume */
.volume-control-wrapper{position:relative;padding:16px 20px 12px;background:rgba(15,18,24,.5);border-top:1px solid rgba(255,255,255,.05)}
.volume-track{position:relative;height:6px;background:rgba(255,255,255,.08);border-radius:3px}
.volume-fill{position:absolute;inset:0 auto auto 0;height:6px;background:var(--grad-blue);width:0%;border-radius:3px;pointer-events:none;transition:width .08s linear}
.volume-handle{position:absolute;top:50%;left:0;transform:translate(-50%,-50%);width:14px;height:14px;background:var(--c-w);border-radius:50%;box-shadow:0 2px 6px rgba(0,0,0,.35);pointer-events:none;z-index:3;transition:left .05s linear}
.volume-slider{position:absolute;left:20px;right:20px;top:50%;transform:translateY(-50%);height:28px;background:0 0;outline:0;-webkit-appearance:none;cursor:pointer;z-index:4;margin:0}
.volume-slider::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;background:0 0;border-radius:50%;cursor:pointer;box-shadow:none}
.volume-slider::-moz-range-thumb{width:14px;height:14px;background:0 0;border-radius:50%;cursor:pointer;border:0;box-shadow:none}

/* Extra buttons */
.player-buttons-wrapper{background:rgba(15,18,24,.5);padding:12px 16px;border-top:1px solid rgba(255,255,255,.05);display:flex;gap:8px;flex-wrap:wrap}
.player-extra-buttons-row{display:flex;flex:1;gap:8px;justify-content:space-between;width:100%}
.lyrics-toggle-btn,.animation-btn,.pulse-btn,.karaoke-btn,.player-download-btn{width:var(--btn-size);min-width:var(--btn-size);max-width:var(--btn-size);height:var(--btn-size);min-height:var(--btn-size);max-height:var(--btn-size);padding:0;border-radius:var(--btn-radius);font-weight:800;font-size:18px;cursor:pointer;transition:transform .1s,background .2s,border-color .2s,box-shadow .2s,color .2s;text-align:center;text-decoration:none;display:flex;align-items:center;justify-content:center;flex-shrink:0;user-select:none}
.lyrics-toggle-btn,.karaoke-btn{background:rgba(77,170,255,.12);border:1px solid rgba(77,170,255,.25);color:var(--secondary-color)}
.lyrics-toggle-btn:hover,.karaoke-btn:hover{background:rgba(77,170,255,.2);transform:translateY(-1px)}
.lyrics-toggle-btn:active,.karaoke-btn:active{transform:translateY(0)}
.lyrics-toggle-btn-visual{display:inline-block;line-height:1;transition:font-size .2s,color .2s,transform .1s;pointer-events:none}
.lyrics-toggle-btn.lyrics-normal .lyrics-toggle-btn-visual{color:var(--secondary-color);font-size:28px}
.lyrics-toggle-btn.lyrics-expanded .lyrics-toggle-btn-visual{color:var(--secondary-color);font-size:18px}
.lyrics-toggle-btn.lyrics-hidden{background:rgba(232,1,0,.12);border-color:rgba(232,1,0,.25)}
.lyrics-toggle-btn.lyrics-hidden .lyrics-toggle-btn-visual{color:var(--primary-color);font-size:28px}
.lyrics-toggle-btn.lyrics-hidden:hover{background:rgba(232,1,0,.2);border-color:rgba(232,1,0,.35)}
.animation-btn{background:linear-gradient(135deg,#4a1a7a,#2a0a4a);border:1px solid rgba(138,43,226,.3);color:#c8a2ff}
.animation-btn.active{background:linear-gradient(135deg,#5a2a8a,#3a1a5a);box-shadow:0 0 12px rgba(138,43,226,.4)}
.animation-btn:hover{background:linear-gradient(135deg,#5a2a8a,#3a1a5a);transform:translateY(-1px)}
.pulse-btn{background:linear-gradient(135deg,#2a2a2a,#1a1a1a);border:1px solid rgba(255,255,255,.1);color:var(--c-w);font-size:20px}
.pulse-btn.active{background:linear-gradient(135deg,#4a1a1a,#2a0a0a);border-color:rgba(232,1,0,.3);color:var(--primary-color);box-shadow:0 0 12px rgba(232,1,0,.3)}
.pulse-btn:hover{background:linear-gradient(135deg,#3a3a3a,#2a2a2a);transform:translateY(-1px)}
.player-download-btn{background:linear-gradient(135deg,#1a4a7a,#0a2a4a);border:1px solid rgba(77,170,255,.3);color:var(--secondary-color)}
.player-download-btn:hover{background:linear-gradient(135deg,#2a5a8a,#1a3a5a);transform:translateY(-1px);box-shadow:0 4px 12px rgba(77,170,255,.2)}
.lyrics-toggle-btn.disabled,.animation-btn.disabled,.karaoke-btn.disabled{background:rgba(30,30,30,.6)!important;border-color:rgba(255,255,255,.06)!important;color:rgba(255,255,255,.2)!important;box-shadow:none!important;cursor:not-allowed!important;opacity:.5;pointer-events:none;filter:grayscale(100%)}
.lyrics-toggle-btn.disabled .lyrics-toggle-btn-visual{color:rgba(255,255,255,.2)!important}
@media (hover:hover){.lyrics-toggle-btn.disabled:hover,.animation-btn.disabled:hover,.karaoke-btn.disabled:hover{transform:none!important}}

/* Track list */
.track-list{margin:0 auto;max-width:370px;width:100%;font-size:1.05em;color:var(--c-e);background:0 0;padding:0}

/* Favorites empty */
.fav-empty{padding:20px;text-align:center;color:#8ab8fd}
.fav-empty h3{margin:0 0 10px}
.fav-empty p{margin:0;opacity:.9}

/* News inline (album __reliz__) */
.news-inline__head{padding:14px 10px;text-align:center;color:#8ab8fd}
.news-inline__links{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:12px}
.news-inline__links a{color:#4daaff;text-decoration:underline}
.news-inline__dot{opacity:.6}
.news-inline__status{opacity:.85}
.news-inline__status--error{color:#ff6b6b}
.news-inline__list{display:grid;gap:12px;padding:0 0 10px}
.news-inline__card{background:#131a26;border:1px solid #23324a;border-radius:12px;padding:12px;box-shadow:0 4px 16px rgba(0,0,0,.25)}
.news-inline__title{font-weight:900;font-size:16px;color:#eaf2ff}
.news-inline__date{color:#9db7dd;font-size:13px;margin-top:6px}
.news-inline__text{margin-top:8px;line-height:1.45;color:#eaf2ff}
.news-inline__media{margin:10px 0}
.news-inline__media iframe,.news-inline__media img,.news-inline__media video{width:100%;border:0;border-radius:10px;min-height:220px;background:#0b0e15}
.news-inline__media img{min-height:auto}
.news-inline__tags{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
.news-inline__tag{font-size:12px;color:#4daaff;background:rgba(77,170,255,.12);border:1px solid rgba(77,170,255,.25);padding:4px 8px;border-radius:999px}

.track{display:flex;align-items:center;padding:9px 10px;border-bottom:1px solid var(--border-color);cursor:pointer;transition:background .13s,transform .1s;background:0 0;-webkit-user-select:none;user-select:none}
.track:hover{background:rgba(255,255,255,.05)}
.track.current{background:#232b38;border-left:3px solid var(--secondary-color)}
.track:active{transform:scale(.98);background:rgba(255,255,255,.08)!important}
.track.inactive{opacity:.45;filter:grayscale(.6)}

/* FavoritesOnly: UI-only —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ ‚≠ê */
.track-list.favonly-filtered .track[data-hidden-by-favonly="1"]{display:none!important}
.track.is-favorite{background:rgba(77,170,255,.06)}
.tnum{min-width:30px;color:var(--c-blue);font-weight:500}
.track-title{margin-left:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1}
.like-star{margin-left:auto;width:20px;height:20px;cursor:pointer;opacity:.97;transition:transform .2s,filter .13s,opacity .13s;pointer-events:auto!important;position:relative;z-index:10}
.like-star:hover{filter:brightness(1.13);opacity:1;transform:scale(1.15)}
.like-star:active{transform:scale(.9)}
.like-star.animating{animation:starPulse .3s}
@keyframes starPulse{0%,to{transform:scale(1)}50%{transform:scale(1.4)}}

/* Offline indicators üîí/‚òÅ */
.offline-ind{display:inline-flex;align-items:center;justify-content:center;width:20px;height:20px;min-width:20px;font-size:12px;line-height:1;cursor:pointer;user-select:none;-webkit-user-select:none;flex-shrink:0;border-radius:3px;transition:opacity .2s,transform .15s;vertical-align:middle;margin-right:2px}
.offline-ind:hover{transform:scale(1.2)}
.offline-ind:active{transform:scale(.95)}
.offline-ind--none{opacity:.4;color:#888}
.offline-ind--none:hover{opacity:.6}
.offline-ind--nospace{opacity:.2;color:#888}
.offline-ind--pinned{opacity:1;color:#f5c842;text-shadow:0 0 4px rgba(245,200,66,.4)}
.offline-ind--pinned-loading{opacity:1;color:#f5c842;animation:offline-ind-blink 1s ease-in-out infinite}
.offline-ind--cloud{opacity:1;color:#5bc0de;text-shadow:0 0 4px rgba(91,192,222,.4)}
.offline-ind--cloud:hover{color:#29b6f6}
.offline-ind--cloud-loading{opacity:.4;color:#888;animation:offline-ind-blink 1s ease-in-out infinite}
@keyframes offline-ind-blink{50%{opacity:.4}}

/* Mini header / Next up */
.mini-now{display:flex;align-items:center;gap:10px;padding:8px 12px;border-radius:10px;background:#232b38;margin-bottom:8px;box-shadow:0 2px 8px rgba(0,0,0,.2);transition:none!important}
.mini-now .tnum{color:var(--c-blue);min-width:28px;font-weight:500}
.mini-now .track-title{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:15px}
.next-up{display:none;margin:8px 4px 0;font-size:.98em;align-items:center;gap:8px;padding:6px 10px;background:rgba(255,255,255,.03);border-radius:8px;transition:none!important}
.next-up .label{color:var(--c-blue);opacity:.9;font-size:13px}
.next-up .title{color:var(--primary-color);font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:0;flex:1;font-size:14px}

/* Logo bottom */
.logo-bottom{max-width:112px;width:23vw;min-width:66px;height:auto;display:block;margin:0 auto 15px!important;cursor:pointer;transition:transform .05s ease-out!important;will-change:transform;transform:translateZ(0);transform-origin:center}
.logo-bottom:hover{opacity:.9}

/* Bottom controls */
.bottom-controls-center{display:flex;flex-direction:column;align-items:center;justify-content:center;margin:32px auto 0;gap:10px;width:100%;max-width:300px;padding-bottom:env(safe-area-inset-bottom)}
#install-pwa-btn{color:var(--c-w);background:var(--secondary-color);border:0;border-radius:8px;font-size:1.07em;font-weight:900;letter-spacing:.02em;margin:8px 0;padding:12px 18px;cursor:pointer;width:100%;box-shadow:0 4px 14px rgba(0,0,0,.3);transition:background .2s,transform .1s,box-shadow .2s}
#install-pwa-btn:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,0,0,.4);background:#3275c2}
#install-pwa-btn:active{transform:translateY(0)}
.feedback-link,.support-link,.hotkeys-btn{color:var(--secondary-color)!important;text-decoration:underline!important;font-weight:800;text-transform:uppercase;letter-spacing:.03em;cursor:pointer;transition:color .18s;font-size:1em;display:block;text-align:center;width:100%;margin:6px 0;background:0 0;border:0;padding:8px}
.feedback-link:hover,.support-link:hover,.hotkeys-btn:hover{color:var(--c-w)!important}
.offline-btn{min-width:110px;height:40px;font-size:1.05em;font-weight:900;border:0;border-radius:10px;cursor:pointer;letter-spacing:.07em;box-shadow:0 2px 8px rgba(6,0,0,.2);transition:background .2s,color .14s,transform .1s,box-shadow .2s;display:block;margin:10px auto 0}
.offline-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(6,0,0,.3)}
.offline-btn:active{transform:translateY(0)}
.offline-btn.online{background:var(--primary-color);color:var(--c-w)}
.offline-btn.offline{background:#27b34c;color:var(--c-w)}
#offline-btn.alert::after{content:"!";color:var(--primary-color);font-weight:900;margin-left:6px}

/* Toasts */
#toast-container{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);z-index:10000;pointer-events:none;display:flex;flex-direction:column;gap:10px;align-items:center}
.toast{background:#2a2a2a;border-radius:12px;padding:15px 20px;box-shadow:0 4px 20px rgba(0,0,0,.3);opacity:0;transform:translateY(20px);transition:.3s ease;max-width:90vw;word-wrap:break-word;pointer-events:auto}
.toast.show{opacity:1;transform:translateY(0)}
.toast-content{display:flex;align-items:center;gap:10px}
.toast-emoji{width:24px;height:24px;display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;font-size:18px}
.toast-message{flex:1;font-size:14px;line-height:1.4}
.toast-info{border-left:4px solid var(--secondary-color)}
.toast-success{border-left:4px solid #27b34c}
.toast-error{border-left:4px solid var(--primary-color)}
.toast-warning{border-left:4px solid #ff9800}
.toast-offline{border-left:4px solid #666}

/* Cloud menu */
.cloud-menu{position:fixed;z-index:10000;background:#1e1e2e;border:1px solid #444;border-radius:8px;padding:4px 0;min-width:160px;box-shadow:0 8px 24px rgba(0,0,0,.5);font-size:14px}
.cloud-menu__item{display:block;width:100%;padding:10px 16px;border:none;background:none;color:#e0e0e0;text-align:left;cursor:pointer;font-size:14px;transition:background .15s}
.cloud-menu__item:hover{background:#333}
.cloud-menu__item--danger{color:#ef5350}
.cloud-menu__item--danger:hover{background:#3a1a1a}

/* Modals */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;backdrop-filter:blur(6px);z-index:9999;animation:fadeIn .3s}
.modal-bg.active{display:flex}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.modal-feedback{background:var(--modal-bg);border-radius:14px;padding:28px 24px;min-width:240px;max-width:90vw;max-height:85vh;overflow-y:auto;box-shadow:0 8px 40px rgba(0,0,0,.6);position:relative;animation:slideUp .3s}
@keyframes slideUp{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}
.modal-feedback h2{margin:0 0 18px;color:var(--secondary-color);font-size:22px}
.bigclose{background:0 0;border:0;position:absolute;top:14px;right:14px;cursor:pointer;color:var(--c-e);border-radius:50%;width:34px;height:34px;display:flex;align-items:center;justify-content:center;transition:transform .2s,background .2s}
.bigclose:hover{transform:scale(1.1);background:rgba(255,255,255,.1)}
.bigclose:active{transform:scale(.95)}
.bigclose svg{width:22px;height:22px}
.lyrics-modal .lyrics-fulltext::-webkit-scrollbar{width:8px}
.lyrics-modal .lyrics-fulltext::-webkit-scrollbar-track{background:rgba(255,255,255,.05);border-radius:4px}
.lyrics-modal .lyrics-fulltext::-webkit-scrollbar-thumb{background:rgba(77,170,255,.3);border-radius:4px}
.modal-action-btn{background:rgba(77,170,255,.15);border:1px solid rgba(77,170,255,.3);color:var(--secondary-color);padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:900;font-size:14px;transition:.2s}
.modal-action-btn:hover{background:rgba(77,170,255,.25);transform:translateY(-1px);box-shadow:0 4px 12px rgba(77,170,255,.2)}
.modal-action-btn:active{transform:translateY(0)}

/* iOS install prompt */
.ios-install-prompt{position:fixed;bottom:0;left:0;right:0;background:#1a1a1a;border-top-left-radius:20px;border-top-right-radius:20px;padding:20px;transform:translateY(100%);transition:transform .3s ease;z-index:10000;box-shadow:0 -4px 20px rgba(0,0,0,.3)}
.ios-install-prompt.show{transform:translateY(0)}
.ios-prompt-content{max-width:400px;margin:0 auto;text-align:center}
.ios-prompt-icon{width:60px;height:60px;margin:0 auto 15px;display:block}
.ios-prompt-close{position:absolute;top:10px;right:10px;background:0 0;border:0;color:#666;font-size:28px;cursor:pointer;line-height:1;width:32px;height:32px;display:flex;align-items:center;justify-content:center}
.ios-prompt-button{background:var(--primary-color);color:var(--c-w);border:0;padding:12px 30px;border-radius:25px;font-weight:900;margin-top:20px;cursor:pointer;transition:opacity .2s}
.ios-prompt-button:hover{opacity:.9}

/* Jump-to-playing */
.jump-to-playing{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);width:44px;height:44px;border-radius:999px;border:1px solid rgba(255,255,255,.18);background:rgba(0,0,0,.45);color:var(--c-w);display:none;align-items:center;justify-content:center;z-index:9999;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}
.jump-to-playing:active{transform:translateX(-50%) scale(.98)}
.jump-to-playing button{all:unset;width:100%;height:100%;cursor:pointer;display:grid;place-items:center;line-height:1;user-select:none}

/* Platform */
body.ios .volume-control-wrapper,body.ios #mute-btn{display:none!important}

/* Responsive */
@media (max-width:600px){
  .hotkeys-btn{display:none!important}
  .player-controls-row{gap:8px}
  .player-control-btn,.sleep-timer-btn{width:40px;height:40px;padding:8px}
  .player-control-btn.main{width:48px;height:48px}
  .player-control-btn svg{width:18px;height:18px}
  .player-control-btn.main svg{width:22px;height:22px}
  .time-in-controls{font-size:12px;min-width:38px}
  .player-extra-buttons-row{flex-wrap:wrap;gap:6px}
  .lyrics-toggle-btn,.animation-btn,.pulse-btn,.karaoke-btn,.player-download-btn{width:calc(33.333% - 4px);min-width:unset;max-width:unset}
  .lyrics-window-line{font-size:14px;padding:7px 12px}
  .lyrics-window-line.active{font-size:16px}
}
@media (max-width:380px){
  .promo-cover{width:200px;height:200px}
  .album-icon{width:54px;height:54px}
  .album-icon.active{width:60px;height:60px}
}
@media (display-mode:standalone){.bottom-controls-center{padding-bottom:calc(env(safe-area-inset-bottom) + 10px)}}
@media (prefers-color-scheme:dark){body{background:#0d0d0d}}

/* Accessibility */
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}
button:focus-visible,a:focus-visible,input:focus-visible{outline:2px solid var(--secondary-color);outline-offset:2px}

/* Optional utility */
@keyframes fadeInUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.animate-in{animation:fadeInUp .4s ease-out}

/* OFFLINE MODAL (om-*) ‚Äî v3.3 clean, no dupes */
:root{--om-bg:#141420;--om-border:rgba(255,255,255,.08);--om-muted:rgba(255,255,255,.4);--om-dim:rgba(255,255,255,.6);--om-card:rgba(255,255,255,.03);--om-accent:#7c4dff;--om-accent-a:rgba(124,77,255,.15);--om-green:#4caf50;--om-red:#f44336;--om-yellow:#ffc107;--om-r:10px}

/* Overlay + Modal */
.om-overlay{position:fixed;inset:0;z-index:10000;display:flex;align-items:flex-start;justify-content:center;background:rgba(0,0,0,0);backdrop-filter:blur(0);transition:all .25s;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:24px 12px 40px}
.om-overlay--visible{background:rgba(0,0,0,.65);backdrop-filter:blur(6px)}
.om-modal{width:100%;max-width:420px;background:var(--om-bg);border:1px solid var(--om-border);border-radius:16px;box-shadow:0 24px 80px rgba(0,0,0,.6);color:#e8e8f0;font:14px/1.5 -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;opacity:0;transform:translateY(20px) scale(.97);transition:opacity .25s,transform .25s}
.om-modal--visible{opacity:1;transform:none}

/* Header */
.om-header{display:flex;align-items:center;justify-content:space-between;padding:16px 20px 12px;border-bottom:1px solid rgba(255,255,255,.06)}
.om-header__title{display:flex;align-items:center;gap:8px;font:700 16px/1 inherit;letter-spacing:1.5px;text-transform:uppercase;color:#fff}
.om-header__close{all:unset;cursor:pointer;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:8px;font-size:22px;color:var(--om-muted);transition:all .15s}
.om-header__close:hover{background:rgba(255,255,255,.08);color:#fff}

/* Body */
.om-body{padding:4px 0;max-height:calc(100vh - 120px);overflow-y:auto;scrollbar-width:thin;scrollbar-color:rgba(255,255,255,.15) transparent}
.om-body::-webkit-scrollbar{width:5px}
.om-body::-webkit-scrollbar-thumb{background:rgba(255,255,255,.12);border-radius:4px}

/* Sections */
.om-section{padding:16px 20px;border-bottom:1px solid rgba(255,255,255,.06)}
.om-section--last{border-bottom:none}
.om-section__title{display:flex;align-items:center;gap:8px;margin:0 0 14px;font:600 13px/1 inherit;text-transform:uppercase;letter-spacing:.8px;color:rgba(255,255,255,.55)}
.om-section__icon{font-size:15px}
.om-divider{height:1px;background:rgba(255,255,255,.06);margin:14px 0}

/* Shared card bg */
.om-storage-info,.om-traffic,.om-mode-card{background:var(--om-card);border-radius:var(--om-r);padding:12px 14px}
.om-mode-card{border:1px solid rgba(255,255,255,.06)}

/* Storage segmented bar */
.om-storage-segbar{display:flex;height:8px;background:rgba(255,255,255,.06);border-radius:4px;overflow:hidden;cursor:pointer;margin-bottom:8px;transition:box-shadow .2s}
.om-storage-segbar:hover{box-shadow:0 0 0 2px rgba(124,77,255,.25)}
.om-storage-segbar:active{box-shadow:0 0 0 2px rgba(124,77,255,.4)}
.om-segbar__fill{height:100%;transition:width .5s ease;min-width:0}
.om-segbar--pinned{background:#f5c842}
.om-segbar--cloud{background:#5bc0de}
.om-segbar--transient{background:#ef5350}
.om-segbar--other{background:#78909c}

/* Storage compact legend */
.om-storage-legend{display:flex;flex-wrap:wrap;gap:10px;font-size:12px;color:var(--om-dim)}
.om-legend-item{display:inline-flex;align-items:center;gap:4px}
.om-legend-dot{width:8px;height:8px;border-radius:2px;flex-shrink:0}
.om-legend-dot--pinned{background:#f5c842}
.om-legend-dot--cloud{background:#5bc0de}
.om-legend-dot--transient{background:#ef5350}
.om-legend-dot--other{background:#78909c}

/* Storage expandable detail */
.om-storage-detail{animation:omFadeIn .2s ease}
@keyframes omFadeIn{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:none}}

/* Net policy */
.om-net-speed{font-size:13px;color:var(--om-muted);margin-bottom:12px}
.om-net-unsupported{font-size:13px;color:var(--om-muted);font-style:italic;margin-bottom:10px;padding:8px 12px;background:var(--om-card);border-radius:8px;border-left:3px solid rgba(255,255,255,.12)}
.om-net-status{font-size:12px;color:var(--om-muted);margin:8px 0}
.om-net-kill-hint{font-size:12px;color:#ffab40;background:rgba(255,171,64,.08);border:1px solid rgba(255,171,64,.2);border-radius:8px;padding:8px 12px;margin-top:8px;line-height:1.4}

/* Toggles */
.om-toggles-row{display:flex;gap:8px;margin-bottom:10px}
.om-toggle{all:unset;cursor:pointer;display:flex;align-items:center;gap:8px;flex:1;padding:10px 12px;border-radius:var(--om-r);font:500 13px inherit;transition:all .15s;user-select:none}
.om-toggle--on{background:rgba(76,175,80,.15);box-shadow:inset 0 0 0 1px rgba(76,175,80,.35);color:#81c784}
.om-toggle--off{background:rgba(244,67,54,.1);box-shadow:inset 0 0 0 1px rgba(244,67,54,.25);color:#ef9a9a}
.om-toggle--neutral{background:rgba(255,255,255,.05);box-shadow:inset 0 0 0 1px rgba(255,255,255,.1);color:var(--om-dim)}
.om-toggle:hover{filter:brightness(1.12)}
.om-toggle:active{transform:scale(.98)}
.om-toggle__dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.om-toggle--on .om-toggle__dot{background:var(--om-green);box-shadow:0 0 6px rgba(76,175,80,.5)}
.om-toggle--off .om-toggle__dot{background:var(--om-red);box-shadow:0 0 6px rgba(244,67,54,.4)}
.om-toggle--neutral .om-toggle__dot{background:rgba(255,255,255,.3)}
.om-toggle__label{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.om-toggle-small{all:unset;cursor:pointer;display:block;width:100%;box-sizing:border-box;padding:8px 12px;border-radius:8px;font-size:12px;color:var(--om-muted);background:var(--om-card);border:1px solid rgba(255,255,255,.06);transition:all .15s;margin-bottom:10px;text-align:center;user-select:none}
.om-toggle-small--on{color:var(--om-dim);background:rgba(255,193,7,.08);border-color:rgba(255,193,7,.2)}

/* Traffic */
.om-traffic{margin-bottom:12px}
.om-traffic__title{font:600 12px inherit;text-transform:uppercase;letter-spacing:.5px;color:var(--om-muted);margin-bottom:8px}
.om-traffic__group{margin-bottom:8px}
.om-traffic__group:last-child{margin-bottom:0}
.om-traffic__subtitle{font:500 11px inherit;color:rgba(255,255,255,.35);margin-bottom:3px}
.om-traffic__row{display:flex;justify-content:space-between;font-size:13px;color:var(--om-dim);padding:2px 0}
.om-traffic__row span:last-child{font-weight:500;color:rgba(255,255,255,.8);font-variant-numeric:tabular-nums}

/* Quality + Mode segment toggles */
.om-quality-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.om-quality-label{font-size:13px;color:var(--om-dim)}
.om-quality-toggle,.om-mode-toggle{display:flex;border-radius:8px;overflow:visible;border:1px solid rgba(255,255,255,.1);flex-shrink:0}
.om-quality-btn,.om-mode-btn{all:unset;cursor:pointer;padding:6px 16px;font:600 13px inherit;color:rgba(255,255,255,.35);background:var(--om-card);transition:all .15s;user-select:none;text-align:center;white-space:nowrap}
.om-mode-btn{font-size:12px;min-width:40px}
.om-quality-btn:first-child,.om-mode-btn:first-child{border-right:1px solid rgba(255,255,255,.08)}
.om-quality-btn:hover,.om-mode-btn:hover{background:rgba(255,255,255,.08)}
.om-quality-btn--active-hi{background:rgba(76,175,80,.18)!important;color:#81c784!important;box-shadow:inset 0 -2px 0 var(--om-green)}
.om-quality-btn--active-lo{background:rgba(255,193,7,.15)!important;color:#ffd54f!important;box-shadow:inset 0 -2px 0 var(--om-yellow)}
.om-mode-btn--active{background:var(--om-accent-a)!important;color:#b388ff!important;box-shadow:inset 0 -2px 0 var(--om-accent)}

/* Settings grid */
.om-settings-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:14px 0}
.om-setting{display:flex;flex-direction:column;gap:4px}
.om-setting__label{font:500 11px inherit;color:rgba(255,255,255,.45)}
.om-setting__input{all:unset;box-sizing:border-box;width:100%;padding:8px 12px;border-radius:8px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);color:#fff;font:500 14px inherit;font-variant-numeric:tabular-nums;transition:all .15s;-moz-appearance:textfield}
.om-setting__input::-webkit-outer-spin-button,.om-setting__input::-webkit-inner-spin-button{-webkit-appearance:none}
.om-setting__input:focus{border-color:rgba(124,77,255,.5);background:rgba(124,77,255,.06);outline:none}

/* Downloads */
.om-dl-stats{display:flex;gap:12px;margin-bottom:12px}
.om-dl-stat{flex:1;display:flex;flex-direction:column;align-items:center;padding:12px 8px;background:var(--om-card);border-radius:var(--om-r);border:1px solid rgba(255,255,255,.05)}
.om-dl-stat__num{font:700 22px inherit;color:#fff;font-variant-numeric:tabular-nums}
.om-dl-stat__label{font-size:11px;color:var(--om-muted);margin-top:2px}

/* Mode card */
.om-mode-card__head{display:flex;align-items:flex-start;justify-content:space-between;gap:8px}
.om-mode-card__head>div:first-child{flex:1;min-width:0}
.om-mode-card__name{font:600 14px inherit;color:#fff;margin-bottom:2px}
.om-mode-card__desc{font-size:12px;color:var(--om-muted);line-height:1.4}
.om-mode-card__hint{font-size:12px;color:rgba(255,255,255,.35);margin-top:10px;padding-top:10px;border-top:1px solid rgba(255,255,255,.05)}

/* Disabled mode cards (R2) */
.om-mode-card--disabled{opacity:.45;pointer-events:none;position:relative}
.om-mode-card--disabled::after{content:'';position:absolute;inset:0;border-radius:var(--om-r);background:repeating-linear-gradient(135deg,transparent,transparent 10px,rgba(255,255,255,.02) 10px,rgba(255,255,255,.02) 20px)}
.om-mode-card--disabled .om-mode-btn{cursor:not-allowed}

/* Track list */
.om-track-list{margin-top:12px;max-height:260px;overflow-y:auto;scrollbar-width:thin}
.om-track-list::-webkit-scrollbar{width:4px}
.om-track-list::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:3px}
.om-list-loading,.om-list-empty{text-align:center;padding:20px 12px;font-size:13px;color:rgba(255,255,255,.35)}
.om-list-item{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:8px;transition:background .12s}
.om-list-item:hover{background:rgba(255,255,255,.04)}
.om-list-icon{font-size:14px;flex-shrink:0;width:20px;text-align:center}
.om-list-title{flex:1;font-size:13px;color:rgba(255,255,255,.8);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:0}
.om-list-meta{font-size:11px;color:rgba(255,255,255,.35);flex-shrink:0;font-variant-numeric:tabular-nums}

/* Buttons */
.om-btn{all:unset;cursor:pointer;box-sizing:border-box;display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 18px;border-radius:var(--om-r);font:600 13px inherit;text-align:center;transition:all .15s;user-select:none}
.om-btn:active{transform:scale(.97)}
.om-btn--primary{background:linear-gradient(135deg,#7c4dff,#651fff);color:#fff;box-shadow:0 2px 12px rgba(124,77,255,.25)}
.om-btn--primary:hover{box-shadow:0 4px 20px rgba(124,77,255,.35);filter:brightness(1.08)}
.om-btn--accent{background:var(--om-accent-a);color:#b388ff;border:1px solid rgba(124,77,255,.25)}
.om-btn--accent:hover{background:rgba(124,77,255,.2)}
.om-btn--ghost{background:rgba(255,255,255,.05);color:var(--om-dim);border:1px solid var(--om-border)}
.om-btn--ghost:hover{background:rgba(255,255,255,.09);color:rgba(255,255,255,.8)}
.om-btn--outline{background:transparent;color:var(--om-dim);border:1px solid rgba(255,255,255,.15)}
.om-btn--outline:hover{background:rgba(255,255,255,.05);border-color:rgba(255,255,255,.25);color:#fff}
.om-btn--danger{background:rgba(244,67,54,.12);color:#ef5350;border:1px solid rgba(244,67,54,.25)}
.om-btn--danger:hover{background:rgba(244,67,54,.2);box-shadow:0 2px 16px rgba(244,67,54,.15)}
.om-btn--danger-outline{background:transparent;color:rgba(244,67,54,.7);border:1px solid rgba(244,67,54,.2)}
.om-btn--danger-outline:hover{background:rgba(244,67,54,.08);color:#ef5350}

/* Confirm dialog ‚Äî z-index ABOVE modal */
.om-confirm-bg{position:fixed;inset:0;z-index:10010;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);transition:background .2s;padding:20px}
.om-confirm-bg--visible{background:rgba(0,0,0,.55)}
.om-confirm-box{background:#1a1a2e;border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:24px;max-width:340px;width:100%;box-shadow:0 16px 48px rgba(0,0,0,.5);opacity:0;transform:scale(.95);transition:opacity .2s,transform .2s}
.om-confirm-bg--visible .om-confirm-box{opacity:1;transform:scale(1)}
.om-confirm-title{font:700 16px/1.3 inherit;color:#fff;margin-bottom:10px}
.om-confirm-body{font-size:14px;line-height:1.5;color:rgba(255,255,255,.65);margin-bottom:20px}
.om-confirm-btns{display:flex;gap:10px;justify-content:flex-end}

/* Responsive Offline Modal */
@media(max-width:380px){
  .om-overlay{padding:8px 6px 24px}
  .om-modal{border-radius:12px}
  .om-section,.om-header{padding:14px}
  .om-settings-grid{grid-template-columns:1fr}
  .om-toggles-row{flex-direction:column;gap:6px}
  .om-mode-card__head,.om-quality-row{flex-direction:column;align-items:flex-start;gap:8px}
}
@media(max-height:500px){.om-body{max-height:calc(100vh - 80px)}.om-overlay{padding:8px}}
@media(min-width:768px){.om-overlay{align-items:center;padding:40px 20px}.om-body{max-height:70vh}}
@media(prefers-reduced-motion:reduce){.om-modal,.om-overlay,.om-progress-fill{transition:none!important}}

/* Pinned & Cloud top row (quality + recache) */
.om-pc-toprow{display:flex;gap:12px;align-items:flex-end;margin-bottom:14px}
.om-pc-quality,.om-pc-recache{display:flex;flex-direction:column;gap:6px}
.om-pc-quality{flex:0 0 auto}
.om-pc-recache{flex:1}
.om-pc-quality__label,.om-pc-recache__label{font-size:11px;color:rgba(255,255,255,.45);font-weight:500}
.om-pc-recache__btn{width:100%;justify-content:center;white-space:nowrap;padding:6px 14px}

/* Disabled button state */
.om-btn--disabled{opacity:.35!important;pointer-events:none!important;cursor:not-allowed!important;filter:grayscale(.6)}

/* Track list delete button */
.om-list-del{all:unset;cursor:pointer;flex-shrink:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;border-radius:6px;font-size:14px;color:rgba(244,67,54,.6);transition:all .15s;margin-left:4px}
.om-list-del:hover{background:rgba(244,67,54,.12);color:#ef5350}
.om-list-del:active{transform:scale(.9)}
.om-list-del-all{margin-top:10px}
.om-list-item{transition:opacity .2s,transform .2s}

@media(max-width:340px){.om-pc-toprow{flex-direction:column;gap:8px}}

/* SHOWCASE STYLES OPTIMIZED */
.showcase-header-controls { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; padding: 0 10px; }
.showcase-search-wrap { position: relative; width: 100%; }
.showcase-search { width: 100%; padding: 10px 38px 10px 14px; border-radius: 8px; border: 1px solid var(--border-color); background: rgba(255,255,255,0.05); color: #fff; outline: none; transition: border-color 0.2s; }

.showcase-search-clear {
  position: absolute; right: 8px; top: 50%; transform: translateY(-50%); width: 28px; height: 28px;
  border-radius: 8px; border: 1px solid rgba(255,255,255,0.10); background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.8); cursor: pointer; display: none;
}
.showcase-search-clear:active { transform: translateY(-50%) scale(0.98); }
.showcase-search:focus { border-color: var(--secondary-color); }
.showcase-btns-row { display: flex; gap: 10px; }
.showcase-btn { flex: 1; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: rgba(255,255,255,0.05); color: var(--c-blue); font-weight: 700; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px; user-select: none; }
.showcase-btn:hover { background: rgba(77,170,255,0.15); border-color: var(--secondary-color); }
.showcase-btn.active { background: var(--secondary-color); color: #fff; }
.showcase-btn--danger { color: #ff6b6b; border-color: rgba(255,107,107,0.3); }

/* Showcase playlists (vertical UI) */
.showcase-playlists-actions { display: flex; gap: 10px; padding: 4px 0 6px; }
.sc-pl-action {
  flex: 1; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.06); color: #fff; font-weight: 800; cursor: pointer;
}
.sc-pl-action.active { border-color: rgba(77,170,255,.45); background: rgba(77,170,255,.18); color: var(--secondary-color); }

.showcase-playlists-list { display: flex; flex-direction: column; gap: 8px; padding: 0 0 10px; }
.sc-pl-row {
  width: 100%; display: flex; align-items: center; justify-content: space-between; gap: 12px;
  padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.05);
}
.sc-pl-row.active { border-color: rgba(77,170,255,.45); background: rgba(77,170,255,.10); }

.sc-pl-left { display: flex; align-items: center; gap: 10px; min-width: 0; }
.sc-pl-title { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.sc-pl-dot { width: 10px; height: 10px; border-radius: 999px; background: var(--pl-color, rgba(255,255,255,.25)); flex-shrink: 0; }

.sc-pl-right { display: flex; gap: 8px; flex-shrink: 0; }
.sc-pl-btn { width: 36px; height: 32px; border-radius: 10px; border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.06); color: #fff; cursor: pointer; }
.sc-pl-btn.danger { border-color: rgba(255,80,80,.35); }

.sc-pl-empty { opacity: .65; font-size: 13px; padding: 6px 2px; }

.showcase-status-bar { display: flex; justify-content: space-between; font-size: 13px; color: #9db7dd; padding: 0 10px 10px; border-bottom: 1px solid var(--border-color); align-items: center; }
.showcase-group-header { padding: 16px 10px 8px; font-weight: 800; color: var(--secondary-color); font-size: 14px; letter-spacing: 1px; text-transform: uppercase; background: rgba(0,0,0,0.2); }

/* Track Row */
.showcase-track { position: relative; padding: 6px 10px; display: flex; align-items: center; background: transparent; border-bottom: 1px solid var(--border-color); user-select: none; transition: background 0.2s, opacity 0.2s; gap: 0; }
.showcase-track.is-dragging { opacity: 0.4; background: rgba(255,255,255,0.1); }
.showcase-track.drag-over { border-top: 2px solid var(--secondary-color); }
.showcase-track-thumb { width: 32px; height: 32px; border-radius: 4px; margin: 0 8px 0 8px; object-fit: cover; flex-shrink: 0; }
.showcase-track-meta { font-size: 11px; color: #888; margin-top: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* Showcase: compact left side when numbering is hidden */
.showcase-track .tnum { min-width: 28px; color: var(--c-blue); font-weight: 500; padding-left: 6px; }
.showcase-track .offline-ind { margin-right: 6px; }
.sc-arrow-up, .sc-arrow-down { all: unset; cursor: pointer; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; font-size: 20px; color: #888; flex-shrink: 0; }
.sc-arrow-up:hover, .sc-arrow-down:hover { color: #fff; background: rgba(255,255,255,0.1); border-radius: 4px; }
.showcase-drag-handle { cursor: grab; padding: 0 10px; color: #666; font-size: 22px; display: flex; align-items: center; height: 100%; touch-action: none; }
.showcase-drag-handle:active { cursor: grabbing; color: #fff; }
.showcase-hide-btn { all: unset; cursor: pointer; margin-right: 10px; font-size: 18px; opacity: 0.6; padding: 4px; }
.showcase-hide-btn:hover { opacity: 1; }
.showcase-track-menu-btn { all: unset; cursor: pointer; padding: 8px 12px; color: #888; font-weight: 900; font-size: 16px; margin-left: 4px; letter-spacing: 1px; }
.showcase-track-menu-btn:hover { color: #fff; }
.showcase-checkbox { width: 20px; height: 20px; border: 2px solid #666; border-radius: 4px; margin-right: 10px; display: flex; align-items: center; justify-content: center; }
.showcase-track.selected .showcase-checkbox { background: var(--secondary-color); border-color: var(--secondary-color); }
.showcase-track.selected .showcase-checkbox::after { content: '‚úì'; color: #fff; font-size: 14px; font-weight: bold; }

/* Edit Banners & Panels */
.showcase-edit-banner { background: rgba(255,152,0,0.15); color: #ff9800; padding: 12px; text-align: center; font-weight: 900; border-radius: 8px; margin-bottom: 10px; border: 1px solid rgba(255,152,0,0.3); }
.showcase-multi-panel { position: fixed; bottom: 85px; left: 50%; transform: translateX(-50%); background: #1e222d; padding: 10px; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.8); z-index: 1000; display: flex; gap: 8px; align-items: center; border: 1px solid var(--secondary-color); width: max-content; max-width: 95vw; flex-wrap: nowrap; overflow-x: auto; }
.showcase-color-picker { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 10px; justify-content: center; }
.showcase-color-dot { width: 34px; height: 34px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: transform 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.5); }
.showcase-color-dot:hover { transform: scale(1.15); }

/* Stats UI */
.stat-card { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 16px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }

/* Classic MyStats Chart UI */
.stat-list { margin: 8px 0 12px; padding: 0; list-style: none; text-align: left; }
.stat-list li { display: flex; justify-content: space-between; gap: 10px; padding: 6px 0; border-bottom: 1px dashed rgba(255,255,255,0.08); font-size: 0.96em; color: #eaf2ff; }
.stat-list li:last-child { border-bottom: none; }
.stat-list li span:last-child { color: var(--secondary-color); font-weight: bold; }
.chart-block { margin: 12px 0; background: rgba(255,255,255,0.03); padding: 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.05); }
.chart-title { margin-bottom: 10px; font-size: 0.92em; font-weight: 800; text-transform: uppercase; color: #9fc3ff; }
.chart-bars { display: grid; gap: 4px; }
.chart-row { display: grid; grid-template-columns: 26px 1fr 40px; align-items: center; gap: 6px; }
.chart-row .label { font-size: 0.86em; color: #9aa8c4; text-align: right; }
.chart-row .bar { height: 8px; border-radius: 4px; overflow: hidden; background: rgba(255,255,255,0.1); }
.chart-row .fill { height: 100%; width: 0; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); transition: width 0.5s ease-out; }
.chart-row .val { font-size: 0.86em; color: rgba(255,255,255,0.8); text-align: right; }

/* Fast Bottom Sheet (No Blur) */
.sc-bottom-sheet-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 10000; opacity: 0; transition: opacity 0.2s, visibility 0.2s; display: flex; align-items: flex-end; justify-content: center; pointer-events: none; visibility: hidden; }
.sc-bottom-sheet-bg.active { opacity: 1; pointer-events: auto; visibility: visible; }
.sc-bottom-sheet { width: 100%; max-width: 420px; background: #1a1a2e; border-radius: 20px 20px 0 0; padding: 20px 16px 30px; transform: translateY(100%); transition: transform 0.2s cubic-bezier(0.1, 0.8, 0.2, 1); box-shadow: 0 -4px 24px rgba(0,0,0,0.5); border-top: 1px solid rgba(255,255,255,0.1); max-height: 85vh; overflow-y: auto; }
.sc-bottom-sheet-bg.active .sc-bottom-sheet { transform: translateY(0); }
.sc-sheet-title { color: #fff; font-weight: 800; font-size: 16px; margin-bottom: 4px; text-align: center; }
.sc-sheet-sub { color: #888; font-size: 12px; text-align: center; margin-bottom: 16px; }
.sc-sheet-btn { width: 100%; padding: 14px; text-align: left; background: transparent; border: none; color: #e0e0e0; font-size: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; align-items: center; gap: 12px; cursor: pointer; }
.sc-sheet-btn:active { background: rgba(255,255,255,0.05); }
.sc-sheet-btn:last-child { border-bottom: none; }

