<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="description" content="–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∞–ª—å–±–æ–º—ã –≥—Ä—É–ø–ø—ã –í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞. –°–ª—É—à–∞–π—Ç–µ –æ–Ω–ª–∞–π–Ω –∏ –æ—Ñ–ª–∞–π–Ω.">

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#181818" />

  <!-- iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">

  <!-- Preload -->
  <link rel="preload" href="img/logo.png" as="image">

  <!-- FAVICONS -->
  <link rel="icon" href="icons/favicon-32.png" sizes="32x32" type="image/png">
  <link rel="alternate icon" href="icons/favicon-32.png" sizes="32x32" type="image/png">
  <link rel="alternate icon" href="icons/favicon-16.png" sizes="16x16" type="image/png">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">

  <!-- Howler + ESM-–º–æ–¥—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>

  <!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–¥–æ –º–æ–¥—É–ª–µ–π) -->
  <script type="module">
    // –í–µ—Ä—Å–∏—è –¥–ª—è UI –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∞ —Å service-worker.js
    window.VERSION = '8.0.3';
    window.BUILD_DATE = '2025-11-08';
    window.PROMO_CODE = 'VITRINA2025';

    // –†–µ–∂–∏–º—ã/–∫–ª—é—á–∏
    window.SPECIAL_FAVORITES_KEY = '__favorites__';
    window.SPECIAL_RELIZ_KEY = '__reliz__';
    window.viewMode = 'album';

    // –ë–∞–∑–æ–≤—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏/—Å–æ—Å—Ç–æ—è–Ω–∏–µ
    window.albumsIndex = [];
    window.currentAlbumKey = null;
    window.playingAlbumKey = null;
    window.playingTrack = -1;
    window.config = null;
    window.albumBase = '';

    // –ò–∫–æ–Ω–∫–∏ –∞–ª—å–±–æ–º–æ–≤ (–≤–∏–∑—É–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫)
    window.ICON_ALBUMS_ORDER = [
      { key: window.SPECIAL_FAVORITES_KEY,  title: '‚≠ê‚≠ê‚≠ê–ò–ó–ë–†–ê–ù–ù–û–ï‚≠ê‚≠ê‚≠ê', icon: 'img/icon_album/icon-album-00.png' },
      { key: 'golos-dushi',          title: '–ì–æ–ª–æ—Å –î—É—à–∏',            icon: 'img/icon_album/icon-album-02.png' },
      { key: 'mezhdu-zlom-i-dobrom', title: '–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º',   icon: 'img/icon_album/icon-album-01.png' },
      { key: 'krevetochka',          title: '–ö–†–ï–í–ï„ÉÑTOCHKA',         icon: 'img/icon_album/icon-album+00.png' },
      { key: window.SPECIAL_RELIZ_KEY,      title: '–ù–û–í–û–°–¢–ò',               icon: 'img/icon_album/icon-album-news.png' }
    ];
    window.ICON_KEY_ALIASES = {
      'golos-dushi': ['golos', 'golos-dushi'],
      'mezhdu-zlom-i-dobrom': ['mzid', 'mezhdu-zlom-i-dobrom'],
      'krevetochka': ['krevetochka']
    };
    window.ICON_TITLE_MAP = {
      'golos-dushi': '–ì–æ–ª–æ—Å –î—É—à–∏',
      'mezhdu-zlom-i-dobrom': '–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º',
      'krevetochka': '–ö–†–ï–í–ï„ÉÑTOCHKA'
    };

    // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –≥–∞–ª–µ—Ä–µ—è (–∫–∞—Ä–∫–∞—Å)
    window.CENTRAL_GALLERY_BASE = './albums/gallery/';
    window.ALBUM_GALLERY_MAP = {
      'krevetochka': '00',
      'mezhdu-zlom-i-dobrom': '01',
      'golos-dushi': '02',
      [window.SPECIAL_RELIZ_KEY]: 'news'
    };
    window.CENTRAL_ALLOWED_IDS = new Set(['00','01','02','news']);
    window.PUBLISHED_ALBUM_KEYS = new Set(['golos-dushi','mezhdu-zlom-i-dobrom','krevetochka']);

    // Fallback —Å–ø–∏—Å–æ–∫ –∞–ª—å–±–æ–º–æ–≤ (–µ—Å–ª–∏ ./albums.json –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
    window.ALBUMS_FALLBACK = [
      { key: 'mezhdu-zlom-i-dobrom', title: '–ú–µ–∂–¥—É –ó–ª–æ–º –∏ –î–æ–±—Ä–æ–º (2025)', base: 'https://apel-s-in.github.io/vi3na1bita-mezhdu-zlom-i-dobrom/' },
      { key: 'golos-dushi',          title: '–ì–æ–ª–æ—Å –î—É—à–∏',                base: 'https://apel-s-in.github.io/vi3na1bita-golos-dushi/' },
      { key: 'krevetochka',          title: '–ö–†–ï–í–ï„ÉÑTOCHKA',             base: 'https://apel-s-in.github.io/krevetochka/' }
    ];

    // –ü—Ä–æ—Å—Ç–µ–π—à–∏–µ —É—Ç–∏–ª–∏—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–æ–¥—É–ª–∏
    window.isMobileUA = function(){ try { return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent); } catch { return false; } };
    window.hasKeyboard = function(){
      try {
        const isDesktop = !/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const hasPointer = matchMedia('(pointer: fine)').matches;
        const canHover = matchMedia('(hover: hover)').matches;
        const noTouch = (navigator.maxTouchPoints || 0) === 0;
        return (isDesktop && hasPointer) || (canHover && noTouch);
      } catch { return true; }
    };
  </script>

  <!-- –ú–æ–¥—É–ª–∏ —è–¥—Ä–∞ –∏ –∞–¥–∞–ø—Ç–µ—Ä—ã -->
  <script type="module" src="./scripts/core/bridge.js"></script>
  <script type="module" src="./scripts/player-adapter.js"></script>
  <script type="module" src="./scripts/energy.js"></script>

  <!-- –ú–æ–¥—É–ª–∏ UI -->
  <script type="module" src="./scripts/ui/tracks.js"></script>
  <script type="module" src="./scripts/ui/mini.js"></script>
  <script type="module" src="./scripts/ui/modals.js"></script>
  <script type="module" src="./scripts/ui/notify.js"></script>
  <script type="module" src="./scripts/ui/sleep.js"></script>
  <script type="module" src="./scripts/ui/offline.js"></script>
  <script type="module" src="./scripts/ui/gallery.js"></script>
  <script type="module" src="./scripts/ui/sysinfo.js"></script>
  <script type="module" src="./scripts/ui/bindings.js"></script>
  <script type="module" src="./scripts/ui/lyrics-runtime.js"></script>

  <!-- –ú–æ–¥—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
  <script type="module" src="./scripts/app/albums.js"></script>
  <script type="module" src="./scripts/app/player-controls.js"></script>
  <script type="module" src="./scripts/app/downloads.js"></script>
  <script type="module" src="./scripts/app/pwa.js"></script>
  <script type="module" src="./scripts/app/navigation.js"></script>

  <style>
    :root {
      --primary-bg: #181818;
      --primary-color: #E80100;
      --secondary-color: #4daaff;
      --text-color: #f2f2f2;
      --modal-bg: #252d39;
      --border-color: #394866;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      min-height: 100vh;
      background: var(--primary-bg);
      color: var(--text-color);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0; padding: 0; display: flex; flex-direction: column; min-width: 100vw;
      padding-top: env(safe-area-inset-top);
    }

    /* –ü—Ä–æ–º–æ–∫–æ–¥ */
    #promocode-block {
      position: fixed; inset: 0; display: flex; align-items: center; justify-content: center;
      background: var(--primary-bg); z-index: 100;
    }
    .promo-inner {
      display: flex; flex-direction: column; align-items: center;
      background: rgba(15,18,24,0.98); border-radius: 16px; box-shadow: 0 6px 24px #0008;
      padding: 36px 26px 32px 26px; min-width: 260px; min-height: 170px;
    }
    .promo-cover {
      width: 256px; height: 256px; object-fit: cover; border-radius: 12px; box-shadow: 0 4px 24px #000c;
      margin-bottom: 19px; display: block; background: var(--primary-bg);
    }
    #promo-inp {
      padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);
      background: rgba(255,255,255,0.1); color: var(--text-color); margin: 10px 0; width: 100%; font-size: 16px;
    }
    #promo-btn {
      padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 8px;
      cursor: pointer; font-weight: bold; transition: opacity 0.2s;
    }
    #promo-btn:hover:not(:disabled) { opacity: .8; }
    #promo-btn:disabled { opacity: .5; cursor: not-allowed; }
    #promo-error { color: #ff6b6b; margin-top: 10px; font-size: 14px; }

    .hidden { display: none !important; }

    /* –û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ */
    #main-block { max-width: 420px; margin: 0 auto; flex: 1 0 auto; display: flex; flex-direction: column; align-items: center; width: 100%; padding: 0 10px; }
    header { width: 100%; text-align: center; margin: 0 auto; }
    .active-album-title{
      width: 100%;
      max-width: 400px;
      margin: 18px auto 6px auto;
      text-align: center;
      color: #eaf2ff;
      font-weight: 900;
      letter-spacing: .01em;
      line-height: 1.15;
      text-shadow: 0 1px 0 rgba(0,0,0,.35);
      font-size: clamp(18px, 4.6vw, 24px);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .active-album-title.fav{ color: #ffd166; letter-spacing: .06em; }
    .active-album-title.news{ color: #8ab8fd; letter-spacing: .02em; }

    /* –û–±–ª–æ–∂–∫–∞/–≥–∞–ª–µ—Ä–µ—è */
    #cover-wrap { width: 100%; max-width: 400px; margin: 14px auto 0 auto; aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; position: relative; }
    .cover-gallery-arrow {
      position: absolute; top: 50%; transform: translateY(-50%); z-index: 2; border: none; cursor: pointer; background: none; padding: 0; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; transition: opacity 0.2s;
      visibility: hidden; pointer-events: none; /* –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ */
    }
    .cover-gallery-arrow:hover { opacity: 0.8; }
    #cover-gallery-arrow-left { left: 7px; }
    #cover-gallery-arrow-right { right: 7px; }
    #cover-wrap.gallery-nav-ready .cover-gallery-arrow { visibility: visible; pointer-events: auto; }

    /* –°–ª–æ—Ç –ø–æ–¥ –∫–∞—Ä—Ç–∏–Ω–∫—É/–±–∞–Ω–Ω–µ—Ä */
    #cover-slot {
      width: 100%;
      height: 100%;
      border-radius: 12px;
      overflow: hidden;
      background: var(--primary-bg);
      box-shadow: 0 4px 24px rgba(0,0,0,0.3);
      position: relative;
    }
    #cover-slot img,
    #cover-slot iframe {
      width: 100%;
      height: 100%;
      display: block;
      border: 0;
      background: transparent;
    }
    #cover-slot img { object-fit: contain; }

    /* –õ–æ–≥–æ */
    .logo-bottom {
      max-width: 112px; width: 23vw; min-width: 66px; height: auto; display: block; margin: 0 auto 15px auto !important;
      cursor: pointer; transition: transform 0.1s ease-out; will-change: transform; transform: translateZ(0); transform-origin: center center; isolation: isolate; z-index: 10; position: relative;
    }
    #logo-bottom { will-change: transform; backface-visibility: hidden; transform: translateZ(0); }

    .socials-under-cover { margin: 14px auto 0 auto; width: 100%; max-width: 398px; text-align: center; font-size: 1.03em; display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; }
    .socials-under-cover a { color: var(--secondary-color); text-decoration: none; transition: color 0.2s; }
    .socials-under-cover a:hover { color: var(--text-color); }

    /* –¢—Ä–µ–∫–∏ */
    .track-list { margin: 0 auto; max-width: 370px; width: 100%; font-size: 1.05em; color: #eee; background: none; padding: 0; }
    .track-list.filtered .track:not(.is-favorite) { display: none !important; }
    .track { display: flex; align-items: center; padding: 7px 8px; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: background 0.13s; background: none; }
    .track:hover { background: rgba(255,255,255,0.05); }
    .track.current { background: #232b38; }
    #track-list .track.inactive { opacity: 0.45; filter: grayscale(0.6); }

    .mini-now {
      display:flex; align-items:center; gap:8px;
      padding: 6px 8px; border-radius: 8px;
      background: #232b38; margin-bottom: 6px;
    }
    .mini-now .tnum { color:#8ab8fd; min-width:27px; }
    .mini-now .track-title { flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .tnum { min-width: 27px; color: #8ab8fd; }
    .track-title { margin-left: 7px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1; }
    .like-star { margin-left: auto; width: 19px; height: 19px; cursor: pointer; opacity: 0.97; border: none; background: none; padding: 0; appearance: none; display: inline-block; transition: transform 0.2s, filter 0.13s, opacity 0.13s; }
    .like-star:hover { filter: brightness(1.13); opacity: 1; transform: scale(1.1); }
    .like-star.animating { animation: starPulse 0.3s; }
    @keyframes starPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.3); } }

    /* –õ–∏—Ä–∏–∫–∞ + –ü–ª–µ–µ—Ä */
    .lyrics-player-block { width: 100%; margin: 8px 0 3px 0; }
    #lyrics-window { width: 100%; background: rgba(34,34,34,0.98); border-radius: 12px; box-shadow: 0 8px 24px #0007; overflow: hidden; height: 8.5em; position: relative; display: flex; flex-direction: column; align-items: stretch; justify-content: center; margin-bottom: 7px; transition: height 0.2s ease, opacity 0.2s ease, margin 0.2s ease; will-change: height, opacity; }
    #lyrics-window.lyrics-hidden { height: 0 !important; opacity: 0; margin: 0; overflow: hidden; pointer-events: none; }
    #lyrics-window.lyrics-normal { height: 8.7em; }
    #lyrics-window.lyrics-expanded { height: 15.6em; }
    .lyrics-scroll { position: relative; z-index: 1; }
    .lyrics-window-line { opacity: 0.57; font-size: 1.13em; transition: all 0.2s; line-height: 1.7em; text-align: center; min-height: 1.7em; max-width: 97%; margin: 0 auto; color: #eee; white-space: pre-line; user-select: none; word-break: break-word; position: relative; z-index: 1; }
    .lyrics-window-line.active { color: var(--primary-color); font-weight: bold; opacity: 1; text-shadow: 0 1px 7px #73161644; background: rgba(0,0,0,0.07); border-radius: 8px; font-size: 1.19em; }

    .lyrics-animated-bg { position: absolute; inset:0; opacity:0; background: linear-gradient(45deg, rgba(232,1,0,0.15), rgba(77,170,255,0.15), rgba(232,1,0,0.15)); background-size: 400% 400%; animation: none; z-index:0; pointer-events:none; transition: opacity .5s; }
    .lyrics-animated-bg.active { opacity: 1; animation: lyricsGradient 10s ease infinite; }
    @keyframes lyricsGradient { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    #lyrics-window.animation-active .lyrics-window-line { transition: opacity .3s ease; }
    #lyrics-window.animation-active .lyrics-window-line.active { animation: lyricsGlow 2s ease-in-out infinite; }
    @keyframes lyricsGlow { 0%,50%,100% { opacity:1 } }

    .audio-wrapper { width: 100%; max-width: 395px; margin: 0 auto; }
    #audio { position:absolute; width:1px; height:1px; opacity:0; pointer-events:none; }

    .player-controls { display:flex; flex-direction:column; gap:5px; margin:5px 0; padding:8px 10px; background:rgba(0,0,0,0.3); border-radius:12px; }
    .player-controls-row { display:flex; align-items:center; justify-content:center; gap:12px; }
    .player-control-btn {
      background:none; border:none; color:var(--secondary-color); cursor:pointer; padding:4px; border-radius:50%;
      transition:all .2s; display:flex; align-items:center; justify-content:center;
      width:32px; height:32px; font-weight:bold; font-size:16px; position:relative;
      overflow: hidden;
    }
    .player-controls-row:first-child .player-control-btn { width:48px; height:48px; padding:8px; }
    .player-controls-row:first-child .player-control-btn svg { width:28px; height:28px; }

    .player-control-btn:hover { background: rgba(77,170,255,.2); transform: scale(1.1); }
    .player-control-btn:active { transform: scale(.95); }
    .player-control-btn.active,
    .player-control-btn.repeat-active { color:var(--primary-color); background: rgba(232,1,0,.2); }
    .player-control-btn.favorites-active { background: rgba(255,215,0,.3); }
    .player-control-btn.animation-btn,
    .player-control-btn.bit-btn { font-size:22px; font-weight:bold; }
    .player-control-btn.animation-active,
    .player-control-btn.bit-active { color: var(--primary-color); background: rgba(232,1,0,.2); }

    .player-control-btn svg { width:24px; height:24px; }
    .player-control-btn img { width: 22px; height: 22px; display: block; object-fit: contain; pointer-events: none; }
    .player-control-btn.favorites-active img { filter: drop-shadow(0 0 4px gold); }
    @keyframes pulseFav { 0%,100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    .player-control-btn.favorites-active img { animation: pulseFav 2s infinite; }

    .player-control-btn.main { width:54px; height:54px; }
    .player-control-btn.main svg { width:30px; height:30px; }

    .player-progress-wrapper { width:100%; margin:3px 0 5px 0; position:relative; }
    .player-progress-bar { width:100%; height:6px; background: rgba(255,255,255,.1); border-radius:3px; position:relative; cursor:pointer; overflow:visible; }
    .player-progress-fill { height:100%; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); width:0%; transition: width .1s linear; border-radius:3px; position:relative; }
    .player-progress-handle { position:absolute; top:50%; transform:translateY(-50%); width:20px; height:20px; background:#fff; border-radius:50%; box-shadow:0 2px 8px rgba(0,0,0,.3); right:-10px; z-index:2; }

    .time-in-controls { font-family: 'SF Mono', Monaco, 'Courier New', monospace; font-size:13px; color:var(--secondary-color); min-width:45px; text-align:center; user-select:none; }

    .volume-control-wrapper { width:100%; margin:5px 0; padding:0; position:relative; }
    .volume-track { position:absolute; top:50%; transform:translateY(-50%); width:100%; height:6px; background:rgba(255,255,255,.2); border-radius:3px; pointer-events:none; }
    .volume-fill { position:absolute; top:50%; transform:translateY(-50%); height:6px; background:var(--secondary-color); border-radius:3px; pointer-events:none; transition: width .1s; }
    .volume-slider { appearance:none; width:100%; height:20px; background:transparent; outline:none; cursor:pointer; position:relative; z-index:2; }
    .volume-slider::-webkit-slider-thumb { appearance:none; width:20px; height:20px; background:#fff; border-radius:50%; cursor:pointer; box-shadow:0 2px 8px rgba(0,0,0,.3); }
    .volume-slider::-moz-range-thumb { width:20px; height:20px; background:#fff; border-radius:50%; cursor:pointer; border:none; box-shadow:0 2px 8px rgba(0,0,0,.3); }
    body.ios .volume-control-wrapper { display: none !important; }

    /* Sleep */
    .sleep-timer-btn { background:none; border:none; color:var(--secondary-color); cursor:pointer; padding:8px; border-radius:50%; transition:.2s; display:flex; align-items:center; justify-content:center; width:44px; height:44px; position:relative; }
    .sleep-timer-btn:hover { background: rgba(77,170,255,.2); transform: scale(1.1); }
    .sleep-timer-btn.active { color: var(--primary-color); background: rgba(232,1,0,.2); }
    .sleep-timer-badge { position:absolute; top:-2px; right:-2px; background: var(--primary-color); color:#fff; border-radius:10px; padding:2px 6px; font-size:10px; font-weight:bold; min-width:20px; text-align:center; }
    .sleep-menu { position:absolute; bottom:100%; left:50%; transform:translateX(-50%); background: var(--modal-bg); border-radius:12px; padding:10px; margin-bottom:10px; box-shadow:0 4px 20px rgba(0,0,0,.3); z-index:100; min-width:150px; display:none; }
    .sleep-menu.active { display:block; animation: slideUp .2s; }
    .sleep-menu-item { padding:8px 12px; cursor:pointer; border-radius:6px; transition: background .2s; white-space:nowrap; color:var(--text-color); }
    .sleep-menu-item:hover { background: rgba(255,255,255,.1); }

    .sleep-overlay { position: fixed; inset:0; background: rgba(0,0,0,.95); display:none; align-items:center; justify-content:center; z-index:10000; }
    .sleep-overlay.active { display:flex; animation: fadeIn .5s; }
    .sleep-content { text-align:center; padding:40px; max-width:400px; }
    .sleep-icon { font-size:64px; margin-bottom:20px; opacity:.5; }
    .sleep-title { font-size:24px; margin-bottom:10px; color: var(--text-color); }
    .sleep-message { color: rgba(255,255,255,.6); margin-bottom:30px; }
    .sleep-buttons { display:flex; gap:10px; justify-content:center; }
    .sleep-btn { padding:12px 24px; border-radius:8px; border:none; cursor:pointer; font-weight:bold; transition:opacity .2s; }
    .sleep-btn-primary { background: var(--primary-color); color:#fff; }
    .sleep-btn-secondary { background: rgba(255,255,255,.1); color: var(--text-color); }
    .sleep-btn:hover { opacity:.8; }

    /* –ö–Ω–æ–ø–∫–∞ –ª–∏—Ä–∏–∫–∏ –∏ –ø—Ä–æ—á–∏–µ –Ω–∏–∂–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ */
    .lyrics-toggle-btn { position:absolute; left:10px; top:50%; transform: translateY(-50%); width:44px; height:44px; background:none; border:none; cursor:pointer; padding:0; display:flex; align-items:center; justify-content:center; font-weight:bold; transition:.2s; user-select:none; z-index:5; }
    .lyrics-toggle-btn-visual { font-size:36px; line-height:1; transition:.2s; pointer-events:none; }
    .lyrics-toggle-btn.lyrics-normal .lyrics-toggle-btn-visual { color: var(--secondary-color); font-size:36px; }
    .lyrics-toggle-btn.lyrics-hidden .lyrics-toggle-btn-visual { color: var(--primary-color); font-size:36px; }
    .lyrics-toggle-btn.lyrics-expanded .lyrics-toggle-btn-visual { color: var(--secondary-color); font-size:20px; }
    .lyrics-toggle-btn:hover .lyrics-toggle-btn-visual { transform: scale(1.1); }

    .player-buttons-wrapper { display:flex; flex-direction:column; align-items:center; gap:9px; margin-top:10px; width:100%; position:relative; }
    .karaoke-btn, .player-download-btn {
      color: var(--secondary-color) !important; background:none; border:none; cursor:pointer; font-size:1em; text-transform:uppercase; font-weight:700; letter-spacing:.02em; text-decoration:underline; transition:.18s; padding:4px 16px; min-width:148px; text-align:center; border-radius:7px; display:block; margin: 0 auto;
    }
    .karaoke-btn:hover, .player-download-btn:hover { color:#fff !important; background:#273050; }

    .player-extra-buttons-row {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 8px;
      align-items: center;
      width: 100%;
      max-width: 395px;
    }
    .eco-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 7px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.08);
      color: var(--secondary-color);
      cursor: pointer;
      font-weight: 800;
      letter-spacing: .02em;
      transition: background .18s, color .18s, transform .12s;
      justify-self: end;
      min-height: 36px;
    }
    .eco-btn:hover { color: #fff; background: #2a2f45; transform: translateY(-1px); }
    .eco-btn.eco-active { color: var(--primary-color); background: rgba(232,1,0,.12); border-color: rgba(232,1,0,.25); }
    .eco-btn svg { width: 18px; height: 18px; display: block; }
    .eco-btn .eco-label { font-size: .95em; user-select: none; }

    .bottom-controls-center { display:flex; flex-direction:column; align-items:center; justify-content:center; margin:32px auto 0 auto; gap:8px; width:100%; max-width:280px; padding-bottom: env(safe-area-inset-bottom); }

    .filter-favorites-btn { display:block; margin:0 auto 15px auto; padding:10px 20px; background: linear-gradient(135deg,#2a2a2a,#1a1a1a); color: var(--secondary-color); border:2px solid var(--border-color); border-radius:12px; font-size:.95em; font-weight:bold; cursor:pointer; transition:.3s; text-align:center; min-width:100%; white-space:nowrap; box-shadow:0 2px 8px rgba(0,0,0,.3); }
    .filter-favorites-btn:hover { background: linear-gradient(135deg,#3a3a3a,#2a2a2a); border-color: var(--secondary-color); transform: translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,.5); }
    .filter-favorites-btn.filtered { background: linear-gradient(135deg,#4a1a1a,#2a0a0a); border-color: var(--primary-color); color:#fff; }

    #install-pwa-btn, #download-album-main {
      color:#fff; background: var(--secondary-color); border:none; border-radius:7px; font-size:1.07em; font-weight:bold; letter-spacing:.02em; margin:15px 0 5px 0; padding:8px 13px; cursor:pointer; width:98%; box-shadow:0 4px 14px #0005; transition: background .2s;
    }
    #download-album-main { background: var(--primary-color); font-size:1.09em; margin-bottom:8px; }
    #install-pwa-btn:hover { background:#3275c2; } #download-album-main:hover { background:#c60000; }

    .feedback-link, .support-link { color: var(--secondary-color) !important; text-decoration: underline !important; font-weight:700; text-transform:uppercase; letter-spacing:.03em; cursor:pointer; transition: color .18s; font-size:1em; display:block; text-align:center; width:100%; margin:0; }
    .feedback-link:hover, .support-link:hover { color:#fff !important; }

    .offline-btn { min-width:102px; height:38px; font-size:1.05em; font-weight:bold; border:none; border-radius:9px; cursor:pointer; letter-spacing:.07em; box-shadow:0 2px 8px #06000032; transition: background .2s, color .14s; display:block; margin:0 auto; }
    .offline-btn.online { background: var(--primary-color); color:#fff; }
    .offline-btn.offline { background:#27b34c; color:#fff; }
    .offline-progress { margin-top:11px; width:100%; height:8px; background:#222; border-radius:6px; overflow:hidden; box-shadow:0 1px 6px #222b; }
    .offline-progress-bar { height:100%; background:#2fed54; transition: width .33s; }
    .offline-desc { text-align:center; font-size:.97em; margin-top:5px; opacity:.85; }

    .modal-bg { position:fixed; inset:0; background:rgba(0,0,0,.62); display:none; align-items:center; justify-content:center; backdrop-filter: blur(4px); z-index: 99; }
    .modal-bg.active { display:flex; animation: fadeIn .3s; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    .modal-feedback { background: var(--modal-bg); border-radius:14px; padding:24px 20px; min-width:215px; max-width:96vw; box-shadow:0 4px 32px #0009; position:relative; animation: slideUp .3s; }
    @keyframes slideUp { from{ transform:translateY(20px); opacity:0 } to{ transform:translateY(0); opacity:1 } }
    .modal-feedback .bigclose { background:none; border:none; position:absolute; top:13px; right:13px; cursor:pointer; color:#eee; border-radius:50%; width:32px; height:32px; transition: transform .2s; }
    .modal-feedback .bigclose:hover { transform: scale(1.1); }
    .modal-feedback .bigclose svg { width:31px; height:31px; }

    .hotkeys-btn { color: var(--secondary-color) !important; text-decoration: underline !important; font-weight:700; text-transform:uppercase; letter-spacing:.03em; cursor:pointer; transition:color .18s; font-size:1em; display:block; text-align:center; width:100%; margin:0; background:none; border:none; padding:8px; }
    .hotkeys-btn:hover { color:#fff !important; }
    @media (max-width: 600px) { .hotkeys-btn { display:none !important; } }
    @media (display-mode: standalone) { .bottom-controls-center { padding-bottom: calc(env(safe-area-inset-bottom) + 10px); } }
    @media (hover:none) { .tooltip { display:none; } }

    /* –¢–æ—Å—Ç—ã */
    .toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%) translateY(100px); background: #2a2a2a; border-radius: 12px; padding: 15px 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 9999; opacity: 0; transition: all 0.3s ease; max-width: 90%; word-wrap: break-word; pointer-events: none; }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    .toast-content { display: flex; align-items: center; gap: 10px; }
    .toast-emoji { width: 24px; height: 24px; display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .toast-info { border-left: 4px solid var(--secondary-color); }
    .toast-success { border-left: 4px solid #27b34c; }
    .toast-error { border-left: 4px solid var(--primary-color); }
    .toast-warning { border-left: 4px solid #ff9800; }
    .toast-offline { border-left: 4px solid #666; }

    /* iOS —É—Å—Ç–∞–Ω–æ–≤–∫–∞ */
    .ios-install-prompt { position: fixed; bottom:0; left:0; right:0; background:#1a1a1a; border-top-left-radius: 20px; border-top-right-radius: 20px; padding: 20px; transform: translateY(100%); transition: transform 0.3s ease; z-index: 10000; box-shadow: 0 -4px 20px rgba(0,0,0,0.3); }
    .ios-install-prompt.show { transform: translateY(0); }
    .ios-prompt-content { max-width: 400px; margin: 0 auto; text-align: center; }
    .ios-prompt-icon { width: 60px; height: 60px; margin-bottom: 15px; }
    .ios-prompt-close { position: absolute; top: 10px; right: 10px; background: none; border: none; color: #666; font-size: 28px; cursor: pointer; }
    .ios-prompt-button { background: var(--primary-color); color: white; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold; margin-top: 20px; cursor: pointer; }

    /* –ú–∏–Ω–∏‚Äë—Ä–µ–∂–∏–º –ø–ª–µ–µ—Ä–∞ */
    #now-playing:empty { display: none; }
    .mini-mode .player-buttons-wrapper { display: none !important; }

    /* –†—è–¥ –∏–∫–æ–Ω–æ–∫ –∞–ª—å–±–æ–º–æ–≤ */
    .album-icons { display: flex; gap: 10px; align-items: center; justify-content: center; margin: 12px auto 0 auto; max-width: 400px; overflow-x: auto; padding: 4px 0; }
    .album-icon { width: 60px; height: 60px; border-radius: 10px; overflow: hidden; border: 1px solid var(--border-color); cursor: pointer; filter: grayscale(70%) brightness(.88); opacity: .72; transition: transform .15s, filter .15s, opacity .15s, box-shadow .15s, width .15s ease, height .15s ease; flex: 0 0 auto; }
    .album-icon.active { filter: none; opacity: 1; box-shadow: 0 2px 10px rgba(0,0,0,.35); width: 66px; height: 66px; }
    .album-icon:hover { transform: translateY(-2px); }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ¬´–ù–æ–≤–æ—Å—Ç–∏¬ª */
    #reliz-container { width: 100%; max-width: 400px; margin: 12px auto 0 auto; }
    #reliz-container iframe, #reliz-container .embed-reliz { width: 100%; border: none; }

    /* –°–ª–µ–¥—É—é—â–∞—è –≤ –º–∏–Ω–∏‚Äë—Ä–µ–∂–∏–º–µ */
    .next-up { display: none; margin: 8px 4px 0 4px; font-size: .98em; align-items: center; gap: 6px; }
    .mini-mode .next-up { display: flex; }
    .next-up .label { color: #8ab8fd; opacity: .9; }
    .next-up .title { color: var(--primary-color); font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; min-width: 0; flex: 1; }

    /* –ú–æ–¥–∞–ª–∫–∞ —Ç–µ–∫—Å—Ç–∞ –ø–µ—Å–Ω–∏ */
    #lyrics-text-modal { z-index: 110; }
    #lyrics-text-modal .lyrics-modal {
      position: relative;
      width: min( calc(var(--lyrics-modal-ch, 64) * 1ch + 48px), 96vw, 960px );
      max-width: min( calc(var(--lyrics-modal-ch, 64) * 1ch + 48px), 96vw, 960px );
      height: min(92vh, 820px);
      background: var(--modal-bg);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 16px;
      box-shadow: 0 10px 32px rgba(0,0,0,.6);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      padding: 12px;
    }
    @media (max-width: 600px) {
      #lyrics-text-modal .lyrics-modal { width: 100vw; max-width: 100vw; border-radius: 16px; }
    }
    #lyrics-text-modal .lyrics-animated-bg {
      position: absolute; inset: 0; opacity: .5;
      background: linear-gradient(45deg, rgba(232,1,0,0.15), rgba(77,170,255,0.15), rgba(232,1,0,0.15));
      background-size: 400% 400%;
      animation: lyricsGradient 10s ease infinite;
      pointer-events: none; z-index: 0;
    }
    .lyrics-modal-header { position: relative; z-index: 1; display: flex; align-items: center; gap: 10px; padding: 4px 4px 8px 4px; border-bottom: 1px solid rgba(255,255,255,.08); background: linear-gradient(180deg, rgba(255,255,255,.03), transparent); }
    .lyrics-modal-title { font-size: 1.2rem; font-weight: 800; letter-spacing: .02em; color: #e7f0ff; flex: 1; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
    .lyrics-modal-close { background: none; border: none; color: #cfe3ff; cursor: pointer; border-radius: 10px; width: 36px; height: 36px; display: inline-flex; align-items: center; justify-content: center; transition: transform .15s ease; z-index: 1; }
    .lyrics-modal-close:hover { transform: scale(1.05); }
    .lyrics-modal-close svg { width: 28px; height: 28px; }

    .lyrics-modal-content { position: relative; z-index: 1; flex: 1; display: flex; min-height: 0; padding: 8px 4px 8px 4px; }
    .lyrics-modal-scroll { position: relative; flex: 1; min-height: 0; overflow: auto; border-radius: 10px; border: 1px solid rgba(255,255,255,.08); background: rgba(0,0,0,.25); padding: 10px; }
    .lyrics-modal-pre { margin: 0; color: #eef4ff; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 1rem; line-height: 1.5; white-space: pre; word-break: normal; overflow-wrap: normal; }

    .lyrics-modal-buttons { position: relative; z-index: 1; display: flex; flex-direction: column; gap: 8px; padding: 8px 4px 4px 4px; border-top: 1px solid rgba(255,255,255,.08); background: linear-gradient(0deg, rgba(255,255,255,.03), transparent); }
    .lyrics-modal-btn { padding: 12px 16px; border: none; border-radius: 10px; font-weight: 800; letter-spacing: .02em; cursor: pointer; color: var(--text-color); background: rgba(255,255,255,.12); transition: transform .12s ease, opacity .2s ease; }
    .lyrics-modal-btn.primary { background: none; color: var(--secondary-color); text-decoration: underline; }
    .lyrics-modal-btn:hover { opacity: .9; transform: translateY(-1px); }
    .lyrics-controls-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; align-items: center; }
    .lyrics-square-btn { height: 42px; border-radius: 10px; border: 1px solid rgba(255,255,255,.1); background: rgba(255,255,255,.1); color: #cfe3ff; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; transition: transform .12s ease, opacity .2s ease; }
    .lyrics-square-btn:hover { opacity: .95; transform: translateY(-1px); }
    .lyrics-square-btn svg { width: 22px; height: 22px; }
    .lyrics-modal:fullscreen { width: 100vw !important; max-width: 100vw !important; height: 100dvh !important; border-radius: 0 !important; margin: 0 !important; padding: 12px !important; }
    .lyrics-modal:fullscreen .lyrics-modal-content { flex: 1 1 auto; }

    #lyrics-text-modal.active { display: flex; }
    #lyrics-text-modal { align-items: center; justify-content: center; }
  </style>

  <!-- RUM –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏/—Å–µ—Ç–∏ –≤ SW -->
  <script src="./performance/rum.js" defer></script>
  <script>
    (function(){
      async function postConfigToSW(cfg) {
        try {
          const msg = { type: 'CONFIG_UPDATE', config: { sw: (cfg && cfg.sw) ? cfg.sw : {} } };
          const doPost = () => {
            const t = navigator.serviceWorker?.controller || null;
            if (t) t.postMessage(msg);
            else navigator.serviceWorker?.ready?.then(reg => reg.active && reg.active.postMessage(msg)).catch(()=>{});
          };
          doPost();
        } catch {}
      }
      async function initRumIfConfigured() {
        try {
          const r = await fetch('./custom.json', { cache: 'no-store' });
          if (!r.ok) return;
          const cfg = await r.json().catch(()=>null);
          const ep = (cfg && (cfg.rumEndpoint || (cfg.rum && cfg.rum.endpoint))) || '';
          if (typeof initRUM === 'function' && ep) {
            window.__rumEndpoint = ep;
            initRUM({ endpoint: ep, sampleRate: 1.0 });
          }
          await postConfigToSW(cfg);
        } catch {}
      }
      function sendNetStateToSW() {
        try {
          const c = navigator.connection || navigator.webkitConnection || navigator.mozConnection || {};
          const state = {
            saveData: !!c.saveData,
            downlink: typeof c.downlink === 'number' ? c.downlink : null,
            effectiveType: c.effectiveType || null
          };
          const post = () => navigator.serviceWorker.controller && navigator.serviceWorker.controller.postMessage({ type: 'NET_STATE', state });
          if (navigator.serviceWorker && navigator.serviceWorker.controller) post();
          else if (navigator.serviceWorker && navigator.serviceWorker.ready) navigator.serviceWorker.ready.then(()=>post()).catch(()=>{});
        } catch {}
      }
      window.addEventListener('load', () => {
        initRumIfConfigured();
        sendNetStateToSW();
        try {
          const c = navigator.connection;
          if (c && c.addEventListener) c.addEventListener('change', sendNetStateToSW);
        } catch {}
        window.addEventListener('online', sendNetStateToSW);
        window.addEventListener('offline', sendNetStateToSW);
      });
    })();
  </script>
</head>
<body>
  <!-- –ü—Ä–æ–º–æ–∫–æ–¥ -->
  <div id="promocode-block">
    <div class="promo-inner">
      <img class="promo-cover" id="promo-cover" src="img/logo.png" alt="–û–±–ª–æ–∂–∫–∞" draggable="false"/>
      <h2>–í—Ö–æ–¥ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É</h2>
      <input id="promo-inp" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" autocomplete="off" autofocus />
      <button id="promo-btn">–í–æ–π—Ç–∏</button>
      <div id="promo-error"></div>
    </div>
  </div>

  <div id="main-block" class="hidden">
    <header>
      <div id="active-album-title" class="active-album-title">‚Äî</div>
      <div id="album-icons" class="album-icons" aria-label="–ê–ª—å–±–æ–º—ã"></div>
      <select id="album-select" aria-label="–í—ã–±–æ—Ä –∞–ª—å–±–æ–º–∞" style="display:none;"></select>

      <div id="cover-wrap">
        <button class="cover-gallery-arrow" id="cover-gallery-arrow-left" title="–ù–∞–∑–∞–¥" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∞—è –æ–±–ª–æ–∂–∫–∞">
          <svg width="34" height="34" viewBox="0 0 34 34"><circle cx="17" cy="17" r="16" fill="#23252e" opacity="0.65"/><polyline points="20,10 13,17 20,24" fill="none" stroke="#fff" stroke-width="2.9" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>

        <div id="cover-slot" aria-label="–û–±–ª–æ–∂–∫–∞ –∞–ª—å–±–æ–º–∞"></div>

        <button class="cover-gallery-arrow" id="cover-gallery-arrow-right" title="–í–ø–µ—Ä—ë–¥" aria-label="–°–ª–µ–¥—É—é—â–∞—è –æ–±–ª–æ–∂–∫–∞">
          <svg width="34" height="34" viewBox="0 0 34 34"><circle cx="17" cy="17" r="16" fill="#23252e" opacity="0.65"/><polyline points="14,10 21,17 14,24" fill="none" stroke="#fff" stroke-width="2.9" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </div>

      <div id="social-links" class="socials-under-cover"></div>
    </header>

    <div id="now-playing" style="width:100%; max-width:395px; margin:8px auto 0 auto;"></div>
    <div class="track-list" id="track-list"></div>

    <div class="bottom-controls-center">
      <button class="filter-favorites-btn" id="filter-favorites-btn">–°–∫—Ä—ã—Ç—å –Ω–µ –æ—Ç–º–µ—á–µ–Ω–Ω—ã–µ ‚≠ê –ø–µ—Å–Ω–∏</button>
      <img class="logo-bottom" id="logo-bottom" src="img/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø"/>

      <button id="install-pwa-btn" style="display: none;">–£–°–¢–ê–ù–û–í–ò–¢–¨ –ö–ê–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–ï</button>
      <button id="download-album-main">–°–ö–ê–ß–ê–¢–¨ –í–ï–°–¨ –ê–õ–¨–ë–û–ú</button>

      <button class="hotkeys-btn" id="hotkeys-btn" style="display:none;">–ì–û–†–Ø–ß–ò–ï –ö–õ–ê–í–ò–®–ò</button>
      <button class="hotkeys-btn" id="sysinfo-btn" style="display:none;">–û –°–ò–°–¢–ï–ú–ï</button>
      <span class="feedback-link" id="feedback-link">–û–ë–†–ê–¢–ù–ê–Ø –°–í–Ø–ó–¨</span>
      <a class="support-link" id="support-link" href="#" target="_blank">–ü–û–î–î–ï–†–ñ–ê–¢–¨</a>
      <button class="offline-btn online" id="offline-btn">ONLINE</button>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∏: –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å -->
  <div class="modal-bg" id="modal-feedback">
    <div class="modal-feedback" style="max-width:420px;">
      <button class="bigclose" data-action="close-feedback" title="–ó–∞–∫—Ä—ã—Ç—å">
        <svg viewBox="0 0 48 48"><line x1="12" y1="12" x2="36" y2="36" stroke="currentColor" stroke-width="6" stroke-linecap="round"/><line x1="36" y1="12" x2="12" y2="36" stroke="currentColor" stroke-width="6" stroke-linecap="round"/></svg>
      </button>
      <div style="font-size:1.12em;font-weight:700;margin-bottom:10px;">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</div>
      <div style="color:#cfe3ff; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1); border-radius:8px; padding:12px;">
        –†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ Telegram: <a href="https://t.me/vitrina_razbita" target="_blank" rel="noopener">@vitrina_razbita</a>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ç—Ä–µ–∫–∞ -->
  <div class="modal-bg" id="download-modal">
    <div class="modal-feedback" style="max-width:400px;">
      <div class="download-modal-title">–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å —Å —ç—Ç–∏–º —Ñ–∞–π–ª–æ–º?</div>
      <div style="margin-bottom:19px;font-size:.98em;" id="download-modal-filename"></div>
      <button class="offline-btn online" style="width:98%;margin-bottom:10px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</button>
      <button class="offline-btn" style="width:98%;margin-bottom:10px;">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å –¥—Ä—É–∑—å—è–º–∏</button>
      <button class="offline-btn" style="width:98%;margin-bottom:10px;">–û—Ç–∫—Ä—ã—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</button>
      <button class="offline-btn" style="width:98%;margin-bottom:10px;">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
      <button class="offline-btn" style="width:98%;margin-bottom:10px;">–°–∫–∞—á–∞—Ç—å –≤–µ—Å—å –∞–ª—å–±–æ–º</button>
      <button class="offline-btn" style="width:98%;">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ ¬´–°–∫–∞—á–∞—Ç—å –∞–ª—å–±–æ–º¬ª -->
  <div class="modal-bg" id="albumDownloadModal">
    <div class="modal-feedback" style="max-width: 400px;">
      <h2 style="text-align: center; margin-bottom: 25px;" id="album-title-modal">–ê–ª—å–±–æ–º</h2>
      <div class="download-options">
        <label class="checkbox-container"><input type="checkbox" id="includeCovers" checked><span class="checkmark"></span>–û–±–ª–æ–∂–∫–∏ (–≥–∞–ª–µ—Ä–µ—è)</label>
        <label class="checkbox-container"><input type="checkbox" id="includeLyrics" checked><span class="checkmark"></span>–¢–µ–∫—Å—Ç—ã –ø–µ—Å–µ–Ω</label>
        <hr style="margin: 15px 0; border-color: #333;">
        <label class="checkbox-container"><input type="checkbox" id="onlyFavorites"><span class="checkmark"></span>–¢–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –ø–µ—Å–Ω–∏</label>
        <label class="checkbox-container"><input type="checkbox" id="fullAlbum" checked><span class="checkmark"></span>–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–ª—å–±–æ–º</label>
      </div>
      <div class="modal-buttons">
        <button class="btn-secondary">–û–¢–ú–ï–ù–ê</button>
        <button class="btn-primary">–°–ö–ê–ß–ê–¢–¨</button>
      </div>
    </div>
  </div>

  <!-- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∞—Ä—Ö–∏–≤–∞ -->
  <div class="modal-bg" id="sizeConfirmModal">
    <div class="modal-feedback" style="max-width: 350px;">
      <h3 style="text-align: center;">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
      <div class="size-info">
        <div style="font-size: 48px; color: #E80100; margin-bottom: 15px;">üì¶</div>
        <p style="font-size: 18px; margin: 10px 0;">–†–∞–∑–º–µ—Ä –∞—Ä—Ö–∏–≤–∞: <strong id="archiveSize">0 –ú–ë</strong></p>
        <p style="color: #888; font-size: 14px;">–§–∞–π–ª–æ–≤ –≤ –∞—Ä—Ö–∏–≤–µ: <span id="fileCount">0</span></p>
      </div>
      <div class="modal-buttons">
        <button class="btn-secondary">–û–¢–ú–ï–ù–ê</button>
        <button class="btn-primary">–°–ö–ê–ß–ê–¢–¨</button>
      </div>
    </div>
  </div>

  <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∞—Ä—Ö–∏–≤–∞ -->
  <div class="modal-bg" id="downloadProgressModal">
    <div class="modal-feedback" style="max-width: 400px;">
      <h3 style="text-align: center; margin-bottom: 20px;">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—Ä—Ö–∏–≤–∞</h3>
      <div class="progress-bar"><div id="progressFill" class="progress-fill" style="width: 0%"></div></div>
      <p id="progressText" style="text-align: center; margin-top: 10px;">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤: 0/0</p>
      <div id="errorsList" style="display: none; color: #ff6b6b; font-size: 14px; margin-top: 15px;">
        <p><strong>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å:</strong></p>
        <ul id="errorsListContent"></ul>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ —Ç–µ–∫—Å—Ç–∞ –ø–µ—Å–Ω–∏ -->
  <div class="modal-bg" id="lyrics-text-modal">
    <div class="lyrics-modal" role="dialog" aria-modal="true" aria-labelledby="lyrics-modal-title">
      <div class="lyrics-animated-bg"></div>
      <div class="lyrics-modal-header"><div class="lyrics-modal-title" id="lyrics-modal-title">–¢—Ä–µ–∫</div></div>
      <div class="lyrics-modal-content">
        <div class="lyrics-modal-scroll"><pre class="lyrics-modal-pre" id="lyrics-modal-pre"></pre></div>
      </div>
      <div class="lyrics-modal-buttons">
        <button class="lyrics-modal-btn primary bigcopy" type="button" data-action="copy-lyrics">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞</button>
        <div class="lyrics-controls-grid">
          <button class="lyrics-square-btn" type="button" title="–£–º–µ–Ω—å—à–∏—Ç—å" aria-label="–£–º–µ–Ω—å—à–∏—Ç—å" data-action="zoom--">
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M15.5 14h-.79l-.28-.27A6.47 6.47 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 5L20.49 19l-5-5zM9.5 14C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><rect x="7" y="9" width="5" height="1.8" rx=".9"></rect></svg>
          </button>
          <button class="lyrics-square-btn" id="lyrics-fs-btn" type="button" title="–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º" aria-label="–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º" data-action="fs-toggle">
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M3 10V3h7v2H5v5H3zm16-5h-5V3h7v7h-2V5zM5 19h5v2H3v-7h2v5zm16-5h2v7h-7v-2h5v-5z"/></svg>
          </button>
          <button class="lyrics-square-btn" type="button" title="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" aria-label="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" data-action="share-lyrics">
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M14 9l-4-4v3H5v2h5v3l4-4zM19 13v5H5v-5H3v7h18v-7h-2z"/></svg>
          </button>
          <button class="lyrics-square-btn" type="button" title="–£–≤–µ–ª–∏—á–∏—Ç—å" aria-label="–£–≤–µ–ª–∏—á–∏—Ç—å" data-action="zoom++">
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M15.5 14h-.79l-.28-.27A6.47 6.47 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 5L20.49 19l-5-5zM9.5 14C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M10.4 7.7h-1.8v1.8H6.8v1.8h1.8v1.8h1.8v-1.8h1.8V9.5h-1.8V7.7z"/></svg>
          </button>
        </div>
        <button class="lyrics-modal-btn" type="button" data-action="close-lyrics-modal">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à -->
  <div class="modal-bg" id="hotkeys-modal">
    <div class="modal-feedback hotkeys-modal">
      <button class="bigclose" onclick="closeHotkeysModal()" title="–ó–∞–∫—Ä—ã—Ç—å">
        <svg viewBox="0 0 48 48"><line x1="12" y1="12" x2="36" y2="36" stroke="currentColor" stroke-width="6" stroke-linecap="round"/><line x1="36" y1="12" x2="12" y2="36" stroke="currentColor" stroke-width="6" stroke-linecap="round"/></svg>
      </button>
      <h2>üìå –ì–û–†–Ø–ß–ò–ï –ö–õ–ê–í–ò–®–ò</h2>
      <div class="hotkeys-section">
        <h3>‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ</h3>
        <div class="hotkey-item"><span class="hotkey-combo">K / –ü—Ä–æ–±–µ–ª</span><span class="hotkey-desc">–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ/–ü–∞—É–∑–∞</span></div>
        <div class="hotkey-item"><span class="hotkey-combo">X</span><span class="hotkey-desc">–°—Ç–æ–ø</span></div>
        <div class="hotkey-item"><span class="hotkey-combo">N</span><span class="hotkey-desc">–°–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫</span></div>
        <div class="hotkey-item"><span class="hotkey-combo">P</span><span class="hotkey-desc">–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç—Ä–µ–∫</span></div>
        <div class="hotkey-item"><span class="hotkey-combo">J / L</span><span class="hotkey-desc">–ü–µ—Ä–µ–º–æ—Ç–∫–∞ ‚Üê10—Å–µ–∫ / 10—Å–µ–∫‚Üí</span></div>
        <div class="hotkey-item"><span class="hotkey-combo">+ / -</span><span class="hotkey-desc">–ì—Ä–æ–º–∫–æ—Å—Ç—å ¬±10%</span></div>
      </div>
      <div class="hotkeys-section">
        <h3>üéµ –†–µ–∂–∏–º—ã</h3>
        <div class="hotkey-item"><span class="hotkey-combo">R</span><span class="hotkey-desc">–ü–æ–≤—Ç–æ—Ä</span></div>
        <div class="hotkey-item"><span class="hotkey-combo">U</span><span class="hotkey-desc">–°–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫</span></div>
        <div class="hotkey-item"><span class="hotkey-combo">F</span><span class="hotkey-desc">–ò–∑–±—Ä–∞–Ω–Ω—ã–µ</span></div>
        <div class="hotkey-item"><span class="hotkey-combo">M</span><span class="hotkey-desc">–ë–µ–∑ –∑–≤—É–∫–∞</span></div>
        <div class="hotkey-item"><span class="hotkey-combo">T</span><span class="hotkey-desc">–¢–∞–π–º–µ—Ä —Å–Ω–∞</span></div>
      </div>
      <div class="hotkeys-section">
        <h3>‚ú® –≠—Ñ—Ñ–µ–∫—Ç—ã</h3>
        <div class="hotkey-item"><span class="hotkey-combo">A</span><span class="hotkey-desc">–ê–Ω–∏–º–∞—Ü–∏—è –ª–∏—Ä–∏–∫–∏</span></div>
        <div class="hotkey-item"><span class="hotkey-combo">B</span><span class="hotkey-desc">–ü—É–ª—å—Å–∞—Ü–∏—è –ª–æ–≥–æ—Ç–∏–ø–∞</span></div>
        <div class="hotkey-item"><span class="hotkey-combo">1 / 2 / 3</span><span class="hotkey-desc">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å (100%/50%/15%)</span></div>
      </div>
      <div class="hotkeys-section">
        <h3>üì± –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h3>
        <div class="hotkey-item"><span class="hotkey-combo">Y</span><span class="hotkey-desc">–ü–æ–∫–∞–∑–∞—Ç—å –ª–∏—Ä–∏–∫—É</span></div>
        <div class="hotkey-item"><span class="hotkey-combo">W</span><span class="hotkey-desc">–ü–æ–∫–∞–∑–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç</span></div>
        <div class="hotkey-item"><span class="hotkey-combo">D</span><span class="hotkey-desc">–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</span></div>
        <div class="hotkey-item"><span class="hotkey-combo">?</span><span class="hotkey-desc">–≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞</span></div>
        <div class="hotkey-item"><span class="hotkey-combo">Esc</span><span class="hotkey-desc">–ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ</span></div>
      </div>
    </div>
  </div>

  <!-- –ü—É—Å—Ç–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–¥ –æ—Ñ—Ñ–ª–∞–π–Ω –º–æ–¥–∞–ª–∫–∏ -->
  <div class="modal-bg" id="modal-offline"></div>

  <!-- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
  <script>
    // –ü—Ä–æ–º–æ–∫–æ–¥
    function checkPromo() {
      const inp = document.getElementById('promo-inp');
      const err = document.getElementById('promo-error');
      const val = (inp?.value || '').trim();
      if (!val) { if (err) err.innerText = '–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥'; return; }
      if (val.toUpperCase() === String(window.PROMO_CODE || '').toUpperCase()) {
        try { localStorage.setItem('promoPassed', '1'); } catch {}
        showMain();
      } else {
        if (err) err.innerText = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë!';
      }
    }

    // –ü–æ–∫–∞–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –∏ –∑–∞–ø—É—Å–∫ UI
    function showMain() {
      document.getElementById('promocode-block').classList.add('hidden');
      document.getElementById('main-block').classList.remove('hidden');
      initializeMainUi();
    }

    // –õ–æ–≥–æ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö DPR/–ø–ª–∞—Ç—Ñ–æ—Ä–º
    function pickLogoUrl() {
      const dpr = window.devicePixelRatio || 1;
      const mobile = (window.isMobileUA && window.isMobileUA()) || (Math.min(screen.width, screen.height) <= 820);
      if (mobile) return dpr >= 2 ? 'img/mobile/logo@2x.jpg' : 'img/mobile/logo@1x.jpg';
      if (dpr >= 3) return 'img/desktop/logo@3x.png';
      if (dpr >= 2) return 'img/desktop/logo@2x.png';
      return 'img/desktop/logo@1x.png';
    }
    function applyLogos() {
      try {
        const logoBottom = document.getElementById('logo-bottom');
        if (logoBottom) logoBottom.src = pickLogoUrl();
        const promo = document.getElementById('promo-cover');
        if (promo) promo.src = pickLogoUrl();
      } catch {}
    }

    async function initializeMainUi() {
      try {
        // –ó–∞–≥—Ä—É–∑–∏–º –∏–Ω–¥–µ–∫—Å –∞–ª—å–±–æ–º–æ–≤ –∏ –ø–æ—Å—Ç—Ä–æ–∏–º –∏–∫–æ–Ω–∫–∏
        if (window.loadAlbumsIndex) await window.loadAlbumsIndex();

        // –í—ã–±–æ—Ä —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –∞–ª—å–±–æ–º–∞/—Ä–µ–∂–∏–º–∞
        const sel = document.getElementById('album-select');
        const params = new URLSearchParams(location.search);
        const urlAlbum = params.get('album');
        const savedAlbum = localStorage.getItem('currentAlbum');
        const first = (Array.isArray(window.albumsIndex) && window.albumsIndex[0]) ? window.albumsIndex[0].key : null;

        const toLoad = (urlAlbum && window.albumByKey && window.albumByKey(urlAlbum)) ? urlAlbum
                      : ((savedAlbum && window.albumByKey && window.albumByKey(savedAlbum)) ? savedAlbum : first);
        if (sel && toLoad) sel.value = toLoad;

        const view = params.get('view');
        if (view === 'favorites' && window.openFavoritesView) {
          window.setAlbumHeaderTitle && window.setAlbumHeaderTitle(window.SPECIAL_FAVORITES_KEY);
          window.openFavoritesView();
        } else if (view === 'reliz' && window.openRelizView) {
          window.setAlbumHeaderTitle && window.setAlbumHeaderTitle(window.SPECIAL_RELIZ_KEY);
          window.openRelizView();
        } else if (toLoad && window.loadAlbumByKey) {
          window.setAlbumHeaderTitle && window.setAlbumHeaderTitle(toLoad);
          await window.loadAlbumByKey(toLoad);
        }

        // –í—ã–±–æ—Ä –∞–ª—å–±–æ–º–∞ –∏–∑–º–µ–Ω–∏–ª—Å—è
        if (sel) {
          sel.onchange = async () => {
            if (window.applyRelizUiMode) window.applyRelizUiMode(false);
            document.getElementById('track-list').style.display = '';
            document.getElementById('cover-wrap').style.display = '';
            window.setActiveAlbumIcon && window.setActiveAlbumIcon(sel.value);
            await window.loadAlbumByKey && window.loadAlbumByKey(sel.value);
          };
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –≥–∞–ª–µ—Ä–µ–∏
        const leftBtn  = document.getElementById('cover-gallery-arrow-left');
        const rightBtn = document.getElementById('cover-gallery-arrow-right');
        const guard = () => {
          if (window.energySaver) { window.NotificationSystem && window.NotificationSystem.info('–ì–∞–ª–µ—Ä–µ—è –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ —Ä–µ–∂–∏–º–µ —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏—è'); return true; }
          if (document.hidden) { window.NotificationSystem && window.NotificationSystem.info('–ì–∞–ª–µ—Ä–µ—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ —Ñ–æ–Ω–µ'); return true; }
          return false;
        };
        if (leftBtn)  leftBtn.onclick  = () => { if (guard()) return; window.setCoverImage && window.setCoverImage((window.coverGalleryIdx || 0) - 1); window.startCoverAutoPlay && window.startCoverAutoPlay(); };
        if (rightBtn) rightBtn.onclick = () => { if (guard()) return; window.setCoverImage && window.setCoverImage((window.coverGalleryIdx || 0) + 1); window.startCoverAutoPlay && window.startCoverAutoPlay(); };

        // –ü–æ–∫–∞–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫/–∫–Ω–æ–ø–æ–∫ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ
        if (window.hasKeyboard && window.hasKeyboard()) {
          const hot = document.getElementById('hotkeys-btn');
          if (hot) hot.style.display = 'block';
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker (–¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω–∞/–∫—ç—à–µ–π –∏ sysinfo)
        if ('serviceWorker' in navigator) {
          try {
            const reg = await navigator.serviceWorker.register('./service-worker.js');
            await navigator.serviceWorker.ready;
            try { reg.active && reg.active.postMessage({ type: 'REQUEST_OFFLINE_STATE' }); } catch {}
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            setInterval(async () => {
              try { const r = await navigator.serviceWorker.getRegistration(); if (r) r.update(); } catch {}
            }, 60 * 60 * 1000);
          } catch (e) {
            console.warn('SW register failed', e);
          }
        }
      } catch (e) {
        console.error('init failed', e);
      }
    }

    // –ù–∞–≤–µ—à–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('load', () => {
      try { if (/iphone|ipad|ipod/i.test(navigator.userAgent)) document.body.classList.add('ios'); } catch {}
      applyLogos();

      // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–∫–æ–≤: –ø—Ä–æ–º–æ–∫–æ–¥ –∏ –ª–æ–≥–æ—Ç–∏–ø
      document.getElementById('promo-btn')?.addEventListener('click', checkPromo);
      document.getElementById('promo-inp')?.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') checkPromo(); });
      document.getElementById('logo-bottom')?.addEventListener('click', () => {
        const logo = document.getElementById('logo-bottom');
        if (!logo) return;
        logo.style.transition = 'transform .08s ease-out';
        logo.style.transform = 'scale(1.13)';
        setTimeout(() => { logo.style.transform = 'scale(1)'; logo.style.transition = 'transform .1s ease-out'; }, 120);
      });

      const passed = localStorage.getItem('promoPassed') === '1';
      if (passed) { document.getElementById('promocode-block').classList.add('hidden'); document.getElementById('main-block').classList.remove('hidden'); initializeMainUi(); }
    });
  </script>
</body>
</html>
